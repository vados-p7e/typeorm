var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}var n,i,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},__assign=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};System.register("typeorm/driver/types/ColumnTypes",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/RelationTypes",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/naming-strategy/NamingStrategyInterface",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/OnDeleteType",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/ForeignKeyMetadata",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e){this.columns=[],this.referencedColumns=[],this.columnNames=[],this.referencedColumnNames=[],this.entityMetadata=e.entityMetadata,this.referencedEntityMetadata=e.referencedEntityMetadata,this.columns=e.columns,this.referencedColumns=e.referencedColumns,this.onDelete=e.onDelete,e.namingStrategy&&this.build(e.namingStrategy)}return e.prototype.build=function(e){this.columnNames=this.columns.map(function(e){return e.databaseName}),this.referencedColumnNames=this.referencedColumns.map(function(e){return e.databaseName}),this.tableName=this.entityMetadata.tableName,this.referencedTableName=this.referencedEntityMetadata.tableName,this.name=e.foreignKeyName(this.tableName,this.columnNames,this.referencedEntityMetadata.tableName,this.referencedColumnNames)},e}(),e("ForeignKeyMetadata",r)}}}),System.register("typeorm/common/ObjectLiteral",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/EmbeddedMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/QueryBuilderUtils",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(){}return e.isAliasProperty=function(e){if("string"!=typeof e||-1===e.indexOf("."))return!1;var t=e.split("."),r=t[0],n=t[1];if(!r||!n)return!1;var i=/^[a-zA-Z0-9_-]+$/;return!(!i.test(r)||!i.test(n))},e}(),e("QueryBuilderUtils",r)}}}),System.register("typeorm/query-builder/Alias",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e){Object.assign(this,e||{})}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasMetadata",{get:function(){return!!this._metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!this._metadata)throw new Error('Cannot get entity metadata for the given alias "'+this.name+'"');return this._metadata},set:function(e){this._metadata=e},enumerable:!0,configurable:!0}),e}(),e("Alias",r)}}}),System.register("typeorm/find-options/OrderByCondition",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/JoinAttribute",["typeorm/query-builder/QueryBuilderUtils"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e,t,r){this.connection=e,this.queryExpressionMap=t,Object.assign(this,r||{})}return Object.defineProperty(e.prototype,"isMany",{get:function(){return void 0!==this.isMappingMany?this.isMappingMany:!!this.relation&&(this.relation.isManyToMany||this.relation.isOneToMany)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSelected",{get:function(){for(var e=this,t=function(t){return t.selection===r.alias.name?{value:!0}:r.metadata&&r.metadata.columns.find(function(r){return t.selection===e.alias.name+"."+r.propertyPath})?{value:!0}:void 0},r=this,n=0,i=this.queryExpressionMap.selects;n<i.length;n++){var o=t(i[n]);if("object"==typeof o)return o.value}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tableName",{get:function(){return this.metadata?this.metadata.tableName:this.entityOrProperty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(r.QueryBuilderUtils.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(r.QueryBuilderUtils.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(r.QueryBuilderUtils.isAliasProperty(this.entityOrProperty)){var e=this.queryExpressionMap.findAliasByName(this.parentAlias),t=e.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(t)return t;if(e.metadata.parentEntityMetadata&&(t=e.metadata.parentEntityMetadata.findRelationWithPropertyPath(this.relationPropertyPath)))return t;throw new Error("Relation with property path "+this.relationPropertyPath+" in entity was not found.")}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this.relation?this.relation.inverseEntityMetadata:this.connection.hasMetadata(this.entityOrProperty)?this.connection.getMetadata(this.entityOrProperty):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){if(!this.relation)throw new Error("Cannot get junction table for join without relation.");return this.relation.isOwning?this.parentAlias+"_"+this.alias.name:this.alias.name+"_"+this.parentAlias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]},enumerable:!0,configurable:!0}),e}(),e("JoinAttribute",n)}}}),System.register("typeorm/query-builder/relation-count/RelationCountAttribute",["typeorm/query-builder/QueryBuilderUtils"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e,t){this.expressionMap=e,Object.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!r.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationProperty",{get:function(){if(!r.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");return this.relationName.split(".")[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=this.relationName.split(".");return e[0]+"_"+e[1]+"_relation_count"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!r.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");var e=this.relationName.split("."),t=e[0],n=e[1],i=this.expressionMap.findAliasByName(t).metadata.findRelationWithPropertyPath(n);if(!i)throw new Error("Relation with property path "+n+" in entity was not found.");return i},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!r.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");var e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){return this.mapToProperty.split(".")[1]},enumerable:!0,configurable:!0}),e}(),e("RelationCountAttribute",n)}}}),System.register("typeorm/query-builder/SelectQuery",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/error/ConnectionIsNotSetError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;return r.name="ConnectionIsNotSetError",r.message="Connection with "+t+" database is not established. Check connection configuration.",r}return __extends(t,e),t}(Error),e("ConnectionIsNotSetError",r)}}}),System.register("typeorm/error/DriverPackageNotInstalledError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r){var n=e.call(this)||this;return n.name="DriverPackageNotInstalledError",n.message=t+" package has not been found installed. Try to install it: npm install "+r+" --save",n}return __extends(t,e),t}(Error),e("DriverPackageNotInstalledError",r)}}}),System.register("typeorm/driver/DriverUtils",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(){}return e.buildDriverOptions=function(e,t){if(e.url){var r=this.parseConnectionUrl(e.url);if(t&&t.useSid){n={type:e.type,host:r.host,username:r.username,password:r.password,port:r.port,sid:r.database};return Object.assign(n,e)}var n={type:e.type,host:r.host,username:r.username,password:r.password,port:r.port,database:r.database};return Object.assign(n,e)}return Object.assign({},e)},e.parseConnectionUrl=function(e){var t=e.indexOf("//"),r=e.substr(t+2),n=r.indexOf("/"),i=-1!==n?r.substr(0,n):r,o=-1!==n?r.substr(n+1):void 0,a=i.split("@"),s=a[0],u=a[1],c=s.split(":"),l=c[0],p=c[1],d=u.split(":"),m=d[0],f=d[1];return{host:m,username:l,password:p,port:f?parseInt(f):void 0,database:o||void 0}},e}(),e("DriverUtils",r)}}}),System.register("typeorm/error/TransactionAlreadyStartedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(){var t=e.call(this)||this;return t.name="TransactionAlreadyStartedError",t.message="Transaction already started for the given connection, commit current transaction before starting a new one.",t}return __extends(t,e),t}(Error),e("TransactionAlreadyStartedError",r)}}}),System.register("typeorm/error/TransactionNotStartedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(){var t=e.call(this)||this;return t.name="TransactionNotStartedError",t.message="Transaction is not started yet, start transaction before committing or rolling it back.",t}return __extends(t,e),t}(Error),e("TransactionNotStartedError",r)}}}),System.register("typeorm/metadata-args/IndexMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/IndexMetadata",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e){this.isUnique=!1,this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,this.isUnique=e.args.unique,this.isSparse=e.args.sparse,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}return e.prototype.build=function(e){var t=this,r={};if(this.tableName=this.entityMetadata.tableName,this.givenColumnNames){var n=[];if(this.givenColumnNames instanceof Array)(n=this.givenColumnNames.map(function(e){return t.embeddedMetadata?t.embeddedMetadata.propertyPath+"."+e:e})).forEach(function(e){return r[e]=1});else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);i instanceof Array?(n=i.map(function(e){return String(e)})).forEach(function(e){return r[e]=1}):(n=Object.keys(i).map(function(e){return String(e)}),Object.keys(i).forEach(function(e){return r[e]=i[e]}))}this.columns=n.map(function(e){var r=t.entityMetadata.columns.find(function(t){return t.propertyPath===e});if(r)return[r];var n=t.entityMetadata.relations.find(function(t){return t.isWithJoinColumn&&t.propertyName===e});if(n)return n.joinColumns;throw new Error("Index "+(t.givenName?'"'+t.givenName+'" ':"")+"contains column that is missing in the entity: "+e)}).reduce(function(e,t){return e.concat(t)})}return this.columnNamesWithOrderingMap=Object.keys(r).reduce(function(e,n){var i=t.entityMetadata.columns.find(function(e){return e.propertyPath===n});return i&&(e[i.databaseName]=r[n]),e},{}),this.name=e.indexName(this.givenName?this.givenName:void 0,this.entityMetadata.tableName,this.columns.map(function(e){return e.databaseName})),this},e}(),e("IndexMetadata",r)}}}),System.register("typeorm/schema-builder/schema/TableIndex",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e,t,r,n){this.tableName=e,this.name=t,this.columnNames=r,this.isUnique=n}return e.prototype.clone=function(){return new e(this.tableName,this.name,this.columnNames.map(function(e){return e}),this.isUnique)},e.create=function(t){return new e(t.entityMetadata.tableName,t.name,t.columns.map(function(e){return e.databaseName}),t.isUnique)},e}(),e("TableIndex",r)}}}),System.register("typeorm/schema-builder/schema/TableForeignKey",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e,t,r,n,i,o){this.name=e,this.columnNames=t,this.referencedColumnNames=r,this.referencedTableName=n,this.referencedTablePath=i,this.onDelete=o}return e.prototype.clone=function(){return new e(this.name,this.columnNames,this.referencedColumnNames,this.referencedTableName,this.referencedTablePath)},e.create=function(t){return new e(t.name,t.columnNames,t.referencedColumnNames,t.referencedTableName,t.referencedEntityMetadata.tablePath,t.onDelete)},e}(),e("TableForeignKey",r)}}}),System.register("typeorm/schema-builder/schema/TablePrimaryKey",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e,t){this.name=e,this.columnName=t}return e.prototype.clone=function(){return new e(this.name,this.columnName)},e}(),e("TablePrimaryKey",r)}}}),System.register("typeorm/schema-builder/schema/Table",["typeorm/schema-builder/schema/TableColumn"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e,t,n,i,o,a){this.columns=[],this.indices=[],this.foreignKeys=[],this.primaryKeys=[],this.justCreated=!1,this.name=e,t&&(this.columns=t.map(function(e){return e instanceof r.TableColumn?e:new r.TableColumn(e)})),void 0!==n&&(this.justCreated=n),this.engine=i,this.database=o,this.schema=a}return Object.defineProperty(e.prototype,"primaryKeysWithoutGenerated",{get:function(){var e=this.columns.find(function(e){return e.isGenerated});return e?this.primaryKeys.filter(function(t){return t.columnName!==e.name}):this.primaryKeys},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasGeneratedColumn",{get:function(){return!!this.columns.find(function(e){return e.isGenerated})},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e(this.name);return t.columns=this.columns.map(function(e){return e.clone()}),t.indices=this.indices.map(function(e){return e.clone()}),t.foreignKeys=this.foreignKeys.map(function(e){return e.clone()}),t.primaryKeys=this.primaryKeys.map(function(e){return e.clone()}),t.engine=this.engine,t.database=this.database,t.schema=this.schema,t},e.prototype.addColumns=function(e){this.columns=this.columns.concat(e)},e.prototype.replaceColumn=function(e,t){this.columns[this.columns.indexOf(e)]=t},e.prototype.removeColumn=function(e){var t=this.columns.find(function(t){return t.name===e.name});t&&this.columns.splice(this.columns.indexOf(t),1)},e.prototype.removeColumns=function(e){var t=this;e.forEach(function(e){return t.removeColumn(e)})},e.prototype.addPrimaryKeys=function(e){var t=this;e.forEach(function(e){t.primaryKeys.push(e);var r=t.columns.findIndex(function(t){return t.name===e.columnName});-1!==r&&(t.columns[r].isPrimary=!0)})},e.prototype.removePrimaryKeys=function(e){var t=this;e.forEach(function(e){t.primaryKeys.splice(t.primaryKeys.indexOf(e),1);var r=t.columns.findIndex(function(t){return t.name===e.columnName});-1!==r&&(t.columns[r].isPrimary=!1)})},e.prototype.removePrimaryKeysOfColumns=function(e){this.primaryKeys=this.primaryKeys.filter(function(t){return!e.find(function(e){return e.name===t.columnName})})},e.prototype.addForeignKeys=function(e){this.foreignKeys=this.foreignKeys.concat(e)},e.prototype.removeForeignKey=function(e){var t=this.foreignKeys.find(function(t){return t.name===e.name});t&&this.foreignKeys.splice(this.foreignKeys.indexOf(t),1)},e.prototype.removeForeignKeys=function(e){var t=this;e.forEach(function(e){return t.removeForeignKey(e)})},e.prototype.removeIndex=function(e){var t=this.indices.find(function(t){return t.name===e.name});t&&this.indices.splice(this.indices.indexOf(t),1)},e.prototype.findChangedColumns=function(e,t){var r=this;return this.columns.filter(function(n){var i=t.find(function(e){return e.databaseName===n.name});return!!i&&(n.name!==i.databaseName||n.type!==e.normalizeType(i)||n.comment!==i.comment||!n.isGenerated&&!r.compareDefaultValues(e.normalizeDefault(i),n.default)||n.isNullable!==i.isNullable||n.isUnique!==e.normalizeIsUnique(i)||n.isGenerated!==i.isGenerated||!r.compareColumnLengths(e,n,i))})},e.prototype.findColumnByName=function(e){return this.columns.find(function(t){return t.name===e})},e.prototype.compareColumnLengths=function(e,t,r){var n=e.normalizeType(r);if(-1!==e.withLengthColumnTypes.indexOf(n)){var i=e.getColumnLength(r);if(i)return t.length.toLowerCase()===i.toLowerCase()}return!0},e.prototype.compareDefaultValues=function(e,t){return"string"==typeof e&&"string"==typeof t&&(e=e.replace(/\(\([0-9.]*\)\)$/g,"$1"),t=t.replace(/\(\(([0-9.]*?)\)\)$/g,"$1"),e=e.replace(/^\(|\)$/g,""),t=t.replace(/^\(|\)$/g,""),e=e.replace(/^'+|'+$/g,""),t=t.replace(/^'+|'+$/g,"")),e===t},e.create=function(t,n){var i=new e(t.tableName);return i.engine=t.engine,i.database=t.database,i.schema=t.schema,t.columns.forEach(function(e){var t=r.TableColumn.create(e,n.normalizeType(e),n.normalizeDefault(e),n.getColumnLength(e));i.columns.push(t)}),i},e}(),e("Table",n)}}}),System.register("typeorm/error/QueryRunnerAlreadyReleasedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(){var t=e.call(this)||this;return t.name="QueryRunnerAlreadyReleasedError",t.message="Query runner already released. Cannot run queries anymore.",t}return __extends(t,e),t}(Error),e("QueryRunnerAlreadyReleasedError",r)}}}),System.register("typeorm/platform/PlatformTools",[],function(e,t){"use strict";var r,n,i,o;t&&t.id;return{setters:[],execute:function(){r=function(){function e(){}return e.getGlobalVariable=function(){return window},e.load=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: require("'+e+'").');return""},e.pathNormalize=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.normalize("'+e+'").');return""},e.pathExtname=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.extname("'+e+'").');return""},e.pathResolve=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.resolve("'+e+'").');return""},e.fileExist=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.existsSync("'+e+'").');return!1},e.getEnvVariable=function(e){},e.readFileSync=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.readFileSync("'+e+'").');return null},e.appendFileSync=function(e,t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.appendFileSync("'+e+'").')},e.writeFile=function(e,t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.writeFile("'+e+'").');return Promise.reject(null)},e.highlightSql=function(e){return e},e.highlightJson=function(e){return e},e.logInfo=function(e,t){console.info(e+" ",t)},e.logError=function(e,t){console.error(e+" ",t)},e.logWarn=function(e,t){console.warn(e+" ",t)},e.log=function(e){console.log(e)},e.warn=function(e){return e},e.type="browser",e}(),e("PlatformTools",r),n=function(){return function(){}}(),e("EventEmitter",n),i=function(){return function(){}}(),e("Readable",i),o=function(){return function(){}}(),e("Writable",o)}}}),System.register("typeorm/driver/sqlserver/MssqlParameter",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){return function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];this.value=e,this.type=t,this.params=[],this.params=r||[]}}(),e("MssqlParameter",r)}}}),System.register("typeorm/find-options/JoinOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/find-options/FindOneOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/find-options/FindManyOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/common/ObjectType",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/error/EntityNotFoundError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(r,n){var i=e.call(this)||this;i.name="EntityNotFound",Object.setPrototypeOf(i,t.prototype);var o="string"==typeof r?r:r.constructor.name,a=i.stringifyCriteria(n);return i.message='Could not find any entity of type "'+o+'" matching: '+a,i}return __extends(t,e),t.prototype.stringifyCriteria=function(e){try{return JSON.stringify(e,null,4)}catch(e){}return""+e},t}(Error),e("EntityNotFoundError",r)}}}),System.register("typeorm/error/QueryRunnerProviderAlreadyReleasedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(){var t=e.call(this)||this;return t.name="QueryRunnerProviderAlreadyReleasedError",t.message="Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.",t.stack=(new Error).stack,t}return __extends(t,e),t}(Error),e("QueryRunnerProviderAlreadyReleasedError",r)}}}),System.register("typeorm/common/DeepPartial",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/repository/RemoveOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/repository/SaveOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/error/NoNeedToReleaseEntityManagerError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(){var t=e.call(this)||this;return t.name="NoNeedToReleaseEntityManagerError",t.message="Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.",t.stack=(new Error).stack,t}return __extends(t,e),t}(Error),e("NoNeedToReleaseEntityManagerError",r)}}}),System.register("typeorm/query-builder/result/DeleteResult",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){return function(){}}(),e("DeleteResult",r)}}}),System.register("typeorm/query-builder/result/UpdateResult",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){return function(){this.generatedMaps=[]}}(),e("UpdateResult",r)}}}),System.register("typeorm/query-builder/result/InsertResult",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){return function(){this.identifiers=[],this.generatedMaps=[]}}(),e("InsertResult",r)}}}),System.register("typeorm/query-builder/QueryPartialEntity",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/mongodb/typings",["typeorm/platform/PlatformTools"],function(e,t){"use strict";var r;t&&t.id;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/repository/Repository",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(){}return e.prototype.createQueryBuilder=function(e,t){return this.manager.createQueryBuilder(this.metadata.target,e||this.metadata.targetName,t||this.queryRunner)},Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),e.prototype.hasId=function(e){return this.manager.hasId(this.metadata.target,e)},e.prototype.getId=function(e){return this.manager.getId(this.metadata.target,e)},e.prototype.create=function(e){return this.manager.create(this.metadata.target,e)},e.prototype.merge=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return(n=this.manager).merge.apply(n,[this.metadata.target,e].concat(t));var n},e.prototype.preload=function(e){return this.manager.preload(this.metadata.target,e)},e.prototype.save=function(e,t){return this.manager.save(this.metadata.target,e,t)},e.prototype.remove=function(e,t){return this.manager.remove(this.metadata.target,e,t)},e.prototype.insert=function(e,t){return this.manager.insert(this.metadata.target,e,t)},e.prototype.update=function(e,t,r){return this.manager.update(this.metadata.target,e,t,r)},e.prototype.delete=function(e,t){return this.manager.delete(this.metadata.target,e,t)},e.prototype.count=function(e){return this.manager.count(this.metadata.target,e)},e.prototype.find=function(e){return this.manager.find(this.metadata.target,e)},e.prototype.findAndCount=function(e){return this.manager.findAndCount(this.metadata.target,e)},e.prototype.findByIds=function(e,t){return this.manager.findByIds(this.metadata.target,e,t)},e.prototype.findOne=function(e,t){return this.manager.findOne(this.metadata.target,e,t)},e.prototype.findOneOrFail=function(e,t){return this.manager.findOneOrFail(this.metadata.target,e,t)},e.prototype.query=function(e,t){return this.manager.query(e,t)},e.prototype.clear=function(){return this.manager.clear(this.metadata.target)},e}(),e("Repository",r)}}}),System.register("typeorm/subscriber/event/UpdateEvent",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/subscriber/event/RemoveEvent",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/subscriber/event/InsertEvent",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/subscriber/EntitySubscriberInterface",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/subscriber/BroadcasterResult",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){return function(){this.count=0,this.promises=[]}}(),e("BroadcasterResult",r)}}}),System.register("typeorm/subscriber/Broadcaster",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e){this.queryRunner=e}return e.prototype.broadcastBeforeInsertEvent=function(e,t,r){var n=this;r&&t.beforeInsertListeners.length&&t.beforeInsertListeners.forEach(function(t){if(t.isAllowed(r)){var n=t.execute(r);n instanceof Promise&&e.promises.push(n),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(i){if(n.isAllowedSubscriber(i,t.target)&&i.beforeInsert){var o=i.beforeInsert({connection:n.queryRunner.connection,queryRunner:n.queryRunner,manager:n.queryRunner.manager,entity:r});o instanceof Promise&&e.promises.push(o),e.count++}})},e.prototype.broadcastBeforeUpdateEvent=function(e,t,r,n){var i=this;r&&t.beforeUpdateListeners.length&&t.beforeUpdateListeners.forEach(function(t){if(t.isAllowed(r)){var n=t.execute(r);n instanceof Promise&&e.promises.push(n),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(o){if(i.isAllowedSubscriber(o,t.target)&&o.beforeUpdate){var a=o.beforeUpdate({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:r,databaseEntity:n,updatedColumns:[],updatedRelations:[]});a instanceof Promise&&e.promises.push(a),e.count++}})},e.prototype.broadcastBeforeRemoveEvent=function(e,t,r,n){var i=this;r&&t.beforeRemoveListeners.length&&t.beforeRemoveListeners.forEach(function(t){if(t.isAllowed(r)){var n=t.execute(r);n instanceof Promise&&e.promises.push(n),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(o){if(i.isAllowedSubscriber(o,t.target)&&o.beforeRemove){var a=o.beforeRemove({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:r,databaseEntity:n,entityId:t.getEntityIdMixedMap(n)});a instanceof Promise&&e.promises.push(a),e.count++}})},e.prototype.broadcastAfterInsertEvent=function(e,t,r){var n=this;r&&t.afterInsertListeners.length&&t.afterInsertListeners.forEach(function(t){if(t.isAllowed(r)){var n=t.execute(r);n instanceof Promise&&e.promises.push(n),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(i){if(n.isAllowedSubscriber(i,t.target)&&i.afterInsert){var o=i.afterInsert({connection:n.queryRunner.connection,queryRunner:n.queryRunner,manager:n.queryRunner.manager,entity:r});o instanceof Promise&&e.promises.push(o),e.count++}})},e.prototype.broadcastAfterUpdateEvent=function(e,t,r,n){var i=this;r&&t.afterUpdateListeners.length&&t.afterUpdateListeners.forEach(function(t){if(t.isAllowed(r)){var n=t.execute(r);n instanceof Promise&&e.promises.push(n),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(o){if(i.isAllowedSubscriber(o,t.target)&&o.afterUpdate){var a=o.afterUpdate({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:r,databaseEntity:n,updatedColumns:[],updatedRelations:[]});a instanceof Promise&&e.promises.push(a),e.count++}})},e.prototype.broadcastAfterRemoveEvent=function(e,t,r,n){var i=this;r&&t.afterRemoveListeners.length&&t.afterRemoveListeners.forEach(function(t){if(t.isAllowed(r)){var n=t.execute(r);n instanceof Promise&&e.promises.push(n),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(o){if(i.isAllowedSubscriber(o,t.target)&&o.afterRemove){var a=o.afterRemove({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:r,databaseEntity:n,entityId:t.getEntityIdMixedMap(n)});a instanceof Promise&&e.promises.push(a),e.count++}})},e.prototype.broadcastLoadEventsForAll=function(e,t,r){var n=this;r.forEach(function(r){r instanceof Promise||(t.relations.length&&t.relations.forEach(function(t){var i=t.getEntityValue(r);i instanceof Object&&n.broadcastLoadEventsForAll(e,t.inverseEntityMetadata,i instanceof Array?i:[i])}),t.afterLoadListeners.length&&t.afterLoadListeners.forEach(function(t){if(t.isAllowed(r)){var n=t.execute(r);n instanceof Promise&&e.promises.push(n),e.count++}}),n.queryRunner.connection.subscribers.length&&n.queryRunner.connection.subscribers.forEach(function(i){if(n.isAllowedSubscriber(i,t.target)&&i.afterLoad){var o=i.afterLoad(r);o instanceof Promise&&e.promises.push(o),e.count++}}))})},e.prototype.isAllowedSubscriber=function(e,t){return!e.listenTo||!e.listenTo()||e.listenTo()===Object||e.listenTo()===t},e}(),e("Broadcaster",r)}}}),System.register("typeorm/driver/mongodb/MongoQueryRunner",["typeorm/subscriber/Broadcaster"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e,t){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.connection=e,this.databaseConnection=t,this.broadcaster=new r.Broadcaster(this)}return e.prototype.cursor=function(e,t){return this.getCollection(e).find(t||{})},e.prototype.aggregate=function(e,t,r){return this.getCollection(e).aggregate(t,r)},e.prototype.bulkWrite=function(e,t,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).bulkWrite(t,r)];case 1:return[2,n.sent()]}})})},e.prototype.count=function(e,t,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).count(t||{},r)];case 1:return[2,n.sent()]}})})},e.prototype.createCollectionIndex=function(e,t,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).createIndex(t,r)];case 1:return[2,n.sent()]}})})},e.prototype.createCollectionIndexes=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).createIndexes(t)];case 1:return[2,r.sent()]}})})},e.prototype.deleteMany=function(e,t,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).deleteMany(t,r)];case 1:return[2,n.sent()]}})})},e.prototype.deleteOne=function(e,t,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).deleteOne(t,r)];case 1:return[2,n.sent()]}})})},e.prototype.distinct=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).distinct(t,r,n)];case 1:return[2,i.sent()]}})})},e.prototype.dropCollectionIndex=function(e,t,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).dropIndex(t,r)];case 1:return[2,n.sent()]}})})},e.prototype.dropCollectionIndexes=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).dropIndexes()];case 1:return[2,t.sent()]}})})},e.prototype.findOneAndDelete=function(e,t,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).findOneAndDelete(t,r)];case 1:return[2,n.sent()]}})})},e.prototype.findOneAndReplace=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).findOneAndReplace(t,r,n)];case 1:return[2,i.sent()]}})})},e.prototype.findOneAndUpdate=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).findOneAndUpdate(t,r,n)];case 1:return[2,i.sent()]}})})},e.prototype.geoHaystackSearch=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).geoHaystackSearch(t,r,n)];case 1:return[2,i.sent()]}})})},e.prototype.geoNear=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).geoNear(t,r,n)];case 1:return[2,i.sent()]}})})},e.prototype.group=function(e,t,r,n,i,o,a,s){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(u){switch(u.label){case 0:return[4,this.getCollection(e).group(t,r,n,i,o,a,s)];case 1:return[2,u.sent()]}})})},e.prototype.collectionIndexes=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).indexes()];case 1:return[2,t.sent()]}})})},e.prototype.collectionIndexExists=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).indexExists(t)];case 1:return[2,r.sent()]}})})},e.prototype.collectionIndexInformation=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).indexInformation(t)];case 1:return[2,r.sent()]}})})},e.prototype.initializeOrderedBulkOp=function(e,t){return this.getCollection(e).initializeOrderedBulkOp(t)},e.prototype.initializeUnorderedBulkOp=function(e,t){return this.getCollection(e).initializeUnorderedBulkOp(t)},e.prototype.insertMany=function(e,t,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).insertMany(t,r)];case 1:return[2,n.sent()]}})})},e.prototype.insertOne=function(e,t,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).insertOne(t,r)];case 1:return[2,n.sent()]}})})},e.prototype.isCapped=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).isCapped()];case 1:return[2,t.sent()]}})})},e.prototype.listCollectionIndexes=function(e,t){return this.getCollection(e).listIndexes(t)},e.prototype.mapReduce=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).mapReduce(t,r,n)];case 1:return[2,i.sent()]}})})},e.prototype.parallelCollectionScan=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).parallelCollectionScan(t)];case 1:return[2,r.sent()]}})})},e.prototype.reIndex=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).reIndex()];case 1:return[2,t.sent()]}})})},e.prototype.rename=function(e,t,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).rename(t,r)];case 1:return[2,n.sent()]}})})},e.prototype.replaceOne=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).replaceOne(t,r,n)];case 1:return[2,i.sent()]}})})},e.prototype.stats=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).stats(t)];case 1:return[2,r.sent()]}})})},e.prototype.updateMany=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).updateMany(t,r,n)];case 1:return[2,i.sent()]}})})},e.prototype.updateOne=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).updateOne(t,r,n)];case 1:return[2,i.sent()]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.databaseConnection.dropDatabase()];case 1:return e.sent(),[2]}})})},e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.release=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.query=function(e,t){throw new Error("Executing SQL query is not supported by MongoDB driver.")},e.prototype.stream=function(e,t,r,n){throw new Error("Stream is not supported by MongoDB driver.")},e.prototype.insertIntoClosureTable=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.getTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.getTables=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.hasDatabase=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Check database queries are not supported by MongoDB driver.")})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Check schema queries are not supported by MongoDB driver.")})})},e.prototype.createDatabase=function(e){throw new Error("Database create queries are not supported by MongoDB driver.")},e.prototype.createSchema=function(e){throw new Error("Schema create queries are not supported by MongoDB driver.")},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.renameColumn=function(e,t,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.changeColumn=function(e,t,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.databaseConnection.dropCollection(e)];case 1:return t.sent(),[2]}})})},e.prototype.enableSqlMemory=function(){throw new Error("This operation is not supported by MongoDB driver.")},e.prototype.disableSqlMemory=function(){throw new Error("This operation is not supported by MongoDB driver.")},e.prototype.getMemorySql=function(){throw new Error("This operation is not supported by MongoDB driver.")},e.prototype.getCollection=function(e){return this.databaseConnection.collection(e)},e}(),e("MongoQueryRunner",n)}}}),System.register("typeorm/metadata/types/TableTypes",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-schema/EntitySchemaTable",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-schema/EntitySchemaIndex",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-schema/EntitySchemaColumn",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/JoinColumnOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/JoinTableMuplipleColumnsOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-schema/EntitySchemaRelation",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-schema/EntitySchema",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/logger/LoggerOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/types/DatabaseType",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/logger/Logger",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/connection/BaseConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/mongodb/MongoConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/types/MappedColumnTypes",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/schema-builder/SchemaBuilder",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/schema-builder/MongoSchemaBuilder",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e){this.connection=e}return e.prototype.build=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:return e=this.connection.driver.createQueryRunner(),t=[],this.connection.entityMetadatas.forEach(function(r){r.indices.forEach(function(n){var i={name:n.name,unique:n.isUnique,sparse:n.isSparse};t.push(e.createCollectionIndex(r.tableName,n.columnNamesWithOrderingMap,i))})}),[4,Promise.all(t)];case 1:return r.sent(),[2]}})})},e.prototype.log=function(){return Promise.resolve([])},e}(),e("MongoSchemaBuilder",r)}}}),System.register("typeorm/driver/types/DataTypeDefaults",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/mysql/MysqlConnectionCredentialsOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/mysql/MysqlConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/postgres/PostgresConnectionCredentialsOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/postgres/PostgresConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/sqlite/SqliteConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/sqlserver/SqlServerConnectionCredentialsOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/sqlserver/SqlServerConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/oracle/OracleConnectionCredentialsOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/oracle/OracleConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/websql/WebSqlConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/cordova/CordovaConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/sqljs/SqljsConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/connection/ConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/mongodb/MongoDriver",["typeorm/error/ConnectionIsNotSetError","typeorm/error/DriverPackageNotInstalledError","typeorm/driver/mongodb/MongoQueryRunner","typeorm/platform/PlatformTools","typeorm/schema-builder/MongoSchemaBuilder"],function(e,t){"use strict";var r,n,i,o,a,s;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(){function e(e){this.connection=e,this.isReplicated=!1,this.treeSupport=!1,this.supportedDataTypes=[],this.withLengthColumnTypes=[],this.mappedDataTypes={createDate:"int",createDateDefault:"",updateDate:"int",updateDateDefault:"",version:"int",treeLevel:"int",migrationName:"int",migrationTimestamp:"int",cacheId:"int",cacheIdentifier:"int",cacheTime:"int",cacheDuration:"int",cacheQuery:"int",cacheResult:"int"},this.options=e.options,this.validateOptions(e.options),this.loadDependencies()}return e.prototype.connect=function(){var e=this;return new Promise(function(t,r){e.mongodb.MongoClient.connect(e.buildConnectionUrl(),{poolSize:e.options.poolSize,ssl:e.options.ssl,sslValidate:e.options.sslValidate,sslCA:e.options.sslCA,sslCert:e.options.sslCert,sslKey:e.options.sslKey,sslPass:e.options.sslPass,autoReconnect:e.options.autoReconnect,noDelay:e.options.noDelay,keepAlive:e.options.keepAlive,connectTimeoutMS:e.options.connectTimeoutMS,socketTimeoutMS:e.options.socketTimeoutMS,reconnectTries:e.options.reconnectTries,reconnectInterval:e.options.reconnectInterval,ha:e.options.ha,haInterval:e.options.haInterval,replicaSet:e.options.replicaSet,acceptableLatencyMS:e.options.acceptableLatencyMS,secondaryAcceptableLatencyMS:e.options.secondaryAcceptableLatencyMS,connectWithNoPrimary:e.options.connectWithNoPrimary,authSource:e.options.authSource,w:e.options.w,wtimeout:e.options.wtimeout,j:e.options.j,forceServerObjectId:e.options.forceServerObjectId,serializeFunctions:e.options.serializeFunctions,ignoreUndefined:e.options.ignoreUndefined,raw:e.options.raw,promoteLongs:e.options.promoteLongs,promoteBuffers:e.options.promoteBuffers,promoteValues:e.options.promoteValues,domainsEnabled:e.options.domainsEnabled,bufferMaxEntries:e.options.bufferMaxEntries,readPreference:e.options.readPreference,pkFactory:e.options.pkFactory,promiseLibrary:e.options.promiseLibrary,readConcern:e.options.readConcern,maxStalenessSeconds:e.options.maxStalenessSeconds,loggerLevel:e.options.loggerLevel,logger:e.options.logger},function(n,o){if(n)return r(n);e.queryRunner=new i.MongoQueryRunner(e.connection,o),t()})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){if(!e.queryRunner)return n(new r.ConnectionIsNotSetError("mongodb"));e.queryRunner.databaseConnection.close(function(e){return e?n(e):t()}),e.queryRunner=void 0})]})})},e.prototype.createSchemaBuilder=function(){return new a.MongoSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner},e.prototype.escapeQueryWithParameters=function(e,t,r){throw new Error("This operation is not supported by Mongodb driver.")},e.prototype.escape=function(e){return e},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),e},e.prototype.prepareHydratedValue=function(e,t){return t.transformer&&(e=t.transformer.from(e)),e},e.prototype.normalizeType=function(e){throw new Error("MongoDB is schema-less, not supported by this driver.")},e.prototype.normalizeDefault=function(e){throw new Error("MongoDB is schema-less, not supported by this driver.")},e.prototype.normalizeIsUnique=function(e){throw new Error("MongoDB is schema-less, not supported by this driver.")},e.prototype.getColumnLength=function(e){throw new Error("MongoDB is schema-less, not supported by this driver.")},e.prototype.createFullType=function(e){throw new Error("MongoDB is schema-less, not supported by this driver.")},e.prototype.obtainMasterConnection=function(){return Promise.resolve()},e.prototype.obtainSlaveConnection=function(){return Promise.resolve()},e.prototype.createGeneratedMap=function(e,t){return e.objectIdColumn.createValueMap(t)},e.prototype.isReturningSqlSupported=function(){return!1},e.prototype.isUUIDGenerationSupported=function(){return!1},e.prototype.createParameter=function(e,t){return""},e.prototype.validateOptions=function(e){},e.prototype.loadDependencies=function(){try{this.mongodb=o.PlatformTools.load("mongodb")}catch(e){throw new n.DriverPackageNotInstalledError("MongoDB","mongodb")}},e.prototype.buildConnectionUrl=function(){if(this.options.url)return this.options.url;return"mongodb://"+(this.options.username&&this.options.password?this.options.username+":"+this.options.password+"@":"")+(this.options.host||"127.0.0.1")+":"+(this.options.port||"27017")+"/"+this.options.database},e}(),e("MongoDriver",s)}}}),System.register("typeorm/query-builder/transformer/DocumentToEntityTransformer",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e){void 0===e&&(e=!1),this.enableRelationIdValues=e}return e.prototype.transformAll=function(e,t){var r=this;return e.map(function(e){return r.transform(e,t)})},e.prototype.transform=function(e,t){var r=t.create(),n=!1;t.objectIdColumn&&e[t.objectIdColumn.databaseNameWithoutPrefixes]&&(r[t.objectIdColumn.propertyName]=e[t.objectIdColumn.databaseNameWithoutPrefixes],n=!0),this.enableRelationIdValues&&t.columns.filter(function(e){return!!e.relationMetadata}).forEach(function(t){var i=e[t.databaseNameWithoutPrefixes];void 0!==i&&null!==i&&t.propertyName&&(r[t.propertyName]=i,n=!0)}),t.ownColumns.forEach(function(t){var i=e[t.databaseNameWithoutPrefixes];void 0===i||null===i||!t.propertyName||t.isVirtual||t.isParentId||t.isDiscriminator||(r[t.propertyName]=i,n=!0)});var i=function(e,t,r){r.forEach(function(r){t[r.prefix]&&(r.isArray?e[r.propertyName]=t[r.prefix].map(function(e){var t=r.create();return r.columns.forEach(function(r){t[r.propertyName]=e[r.databaseNameWithoutPrefixes]}),t}):r.columns.forEach(function(n){var i=t[r.prefix][n.databaseNameWithoutPrefixes];i&&(e[r.propertyName]||(e[r.propertyName]=r.create()),e[r.propertyName][n.propertyName]=i)}),i(e[r.propertyName],t[r.prefix],r.embeddeds))})};return i(r,e,t.embeddeds),n?r:null},e}(),e("DocumentToEntityTransformer",r)}}}),System.register("typeorm/find-options/FindOptionsUtils",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(){}return e.isFindOneOptions=function(e){var t=e;return t&&(t.select instanceof Array||t.where instanceof Object||t.relations instanceof Array||t.join instanceof Object||t.order instanceof Object||t.cache instanceof Object||"boolean"==typeof t.cache||"number"==typeof t.cache||t.loadRelationIds instanceof Object||"boolean"==typeof t.loadRelationIds)},e.isFindManyOptions=function(e){var t=e;return t&&(this.isFindOneOptions(t)||"number"==typeof t.skip||"number"==typeof t.take)},e.extractFindManyOptionsAlias=function(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias},e.applyFindManyOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindManyOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?e.where(t):e},e.applyOptionsToQueryBuilder=function(e,t){if(!t||!this.isFindOneOptions(t)&&!this.isFindManyOptions(t))return e;if(t.select&&e.select(t.select.map(function(t){return e.alias+"."+t})),t.where&&e.where(t.where),t.skip&&e.skip(t.skip),t.take&&e.take(t.take),t.order&&Object.keys(t.order).forEach(function(r){switch(t.order[r]){case 1:e.addOrderBy(e.alias+"."+r,"ASC");break;case-1:e.addOrderBy(e.alias+"."+r,"DESC");break;case"ASC":e.addOrderBy(e.alias+"."+r,"ASC");break;case"DESC":e.addOrderBy(e.alias+"."+r,"DESC")}}),t.relations&&t.relations.forEach(function(t){e.leftJoinAndSelect(e.alias+"."+t,t)}),t.join&&(t.join.leftJoin&&Object.keys(t.join.leftJoin).forEach(function(r){e.leftJoin(t.join.leftJoin[r],r)}),t.join.innerJoin&&Object.keys(t.join.innerJoin).forEach(function(r){e.innerJoin(t.join.innerJoin[r],r)}),t.join.leftJoinAndSelect&&Object.keys(t.join.leftJoinAndSelect).forEach(function(r){e.leftJoinAndSelect(t.join.leftJoinAndSelect[r],r)}),t.join.innerJoinAndSelect&&Object.keys(t.join.innerJoinAndSelect).forEach(function(r){e.innerJoinAndSelect(t.join.innerJoinAndSelect[r],r)})),t.cache)if(t.cache instanceof Object){var r=t.cache;e.cache(r.id,r.milliseconds)}else e.cache(t.cache);return!0===t.loadRelationIds?e.loadAllRelationIds():t.loadRelationIds instanceof Object&&e.loadAllRelationIds(t.loadRelationIds),e},e}(),e("FindOptionsUtils",r)}}}),System.register("typeorm/entity-manager/MongoEntityManager",["typeorm/entity-manager/EntityManager","typeorm/query-builder/transformer/DocumentToEntityTransformer","typeorm/find-options/FindOptionsUtils","typeorm/platform/PlatformTools","typeorm/query-builder/result/InsertResult","typeorm/query-builder/result/UpdateResult","typeorm/query-builder/result/DeleteResult"],function(e,t){"use strict";var r,n,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),Object.defineProperty(t.prototype,"queryRunner",{get:function(){return this.connection.driver.queryRunner},enumerable:!0,configurable:!0}),t.prototype.find=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(o){switch(o.label){case 0:return r=this.convertFindManyOptionsOrConditionsToMongodbQuery(t),[4,this.createEntityCursor(e,r)];case 1:return n=o.sent(),i.FindOptionsUtils.isFindManyOptions(t)&&(t.skip&&n.skip(t.skip),t.take&&n.limit(t.take),t.order&&n.sort(this.convertFindOptionsOrderToOrderCriteria(t.order))),[2,n.toArray()]}})})},t.prototype.findAndCount=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return r=this.convertFindManyOptionsOrConditionsToMongodbQuery(t),[4,this.createEntityCursor(e,r)];case 1:return n=u.sent(),i.FindOptionsUtils.isFindManyOptions(t)&&(t.skip&&n.skip(t.skip),t.take&&n.limit(t.take),t.order&&n.sort(this.convertFindOptionsOrderToOrderCriteria(t.order))),[4,Promise.all([n.toArray(),this.count(e,r)])];case 2:return o=u.sent(),a=o[0],s=o[1],[2,[a,parseInt(s)]]}})})},t.prototype.findByIds=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var n,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return n=this.connection.getMetadata(e),a=this.convertFindManyOptionsOrConditionsToMongodbQuery(r)||{},s=o.PlatformTools.load("mongodb").ObjectID,a._id={$in:t.map(function(e){return e instanceof s?e:e[n.objectIdColumn.propertyName]})},[4,this.createEntityCursor(e,a)];case 1:return u=c.sent(),i.FindOptionsUtils.isFindManyOptions(r)&&(r.skip&&u.skip(r.skip),r.take&&u.limit(r.take),r.order&&u.sort(this.convertFindOptionsOrderToOrderCriteria(r.order))),[4,u.toArray()];case 2:return[2,c.sent()]}})})},t.prototype.findOne=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var n,a,s,u,c;return __generator(this,function(l){switch(l.label){case 0:return n=o.PlatformTools.load("mongodb").ObjectID,a=t instanceof n||"string"==typeof t?t:void 0,s=this.convertFindOneOptionsOrConditionsToMongodbQuery(a?r:t)||{},a&&(s._id=a instanceof n?a:new n(a)),[4,this.createEntityCursor(e,s)];case 1:return u=l.sent(),i.FindOptionsUtils.isFindOneOptions(t)&&t.order&&u.sort(this.convertFindOptionsOrderToOrderCriteria(t.order)),[4,u.limit(1).toArray()];case 2:return c=l.sent(),[2,c.length>0?c[0]:void 0]}})})},t.prototype.insert=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var r,n,i,o=this;return __generator(this,function(s){switch(s.label){case 0:return r=new a.InsertResult,t instanceof Array?(n=r,[4,this.insertMany(e,t)]):[3,2];case 1:return n.raw=s.sent(),r.raw.insertedIds.forEach(function(t){r.generatedMaps.push(o.connection.driver.createGeneratedMap(o.connection.getMetadata(e),t)),r.identifiers.push(o.connection.driver.createGeneratedMap(o.connection.getMetadata(e),t))}),[3,4];case 2:return i=r,[4,this.insertOne(e,t)];case 3:i.raw=s.sent(),r.generatedMaps.push(this.connection.driver.createGeneratedMap(this.connection.getMetadata(e),r.raw.insertedId)),r.identifiers.push(this.connection.driver.createGeneratedMap(this.connection.getMetadata(e),r.raw.insertedId)),s.label=4;case 4:return[2,r]}})})},t.prototype.update=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){var n,i=this;return __generator(this,function(o){switch(o.label){case 0:return t instanceof Array?[4,Promise.all(t.map(function(t){return i.update(e,t,r)}))]:[3,2];case 1:return o.sent(),[3,4];case 2:return n=this.connection.getMetadata(e),[4,this.updateOne(e,this.convertMixedCriteria(n,t),r)];case 3:o.sent(),o.label=4;case 4:return[2,new s.UpdateResult]}})})},t.prototype.delete=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(n){switch(n.label){case 0:return t instanceof Array?[4,Promise.all(t.map(function(t){return r.delete(e,t)}))]:[3,2];case 1:return n.sent(),[3,4];case 2:return[4,this.deleteOne(e,this.convertMixedCriteria(this.connection.getMetadata(e),t))];case 3:n.sent(),n.label=4;case 4:return[2,new u.DeleteResult]}})})},t.prototype.createCursor=function(e,t){var r=this.connection.getMetadata(e);return this.queryRunner.cursor(r.tableName,t)},t.prototype.createEntityCursor=function(e,t){var r=this.connection.getMetadata(e),i=this.createCursor(e,t),a=o.PlatformTools.load("mongodb").Cursor;return i.toArray=function(e){if(!e)return a.prototype.toArray.call(this).then(function(e){return(new n.DocumentToEntityTransformer).transformAll(e,r)});a.prototype.toArray.call(this,function(t,i){if(!t){var o=new n.DocumentToEntityTransformer;return e(t,o.transformAll(i,r))}e(t,i)})},i.next=function(e){if(!e)return a.prototype.next.call(this).then(function(e){if(!e)return e;return(new n.DocumentToEntityTransformer).transform(e,r)});a.prototype.next.call(this,function(t,i){if(!t&&i){var o=new n.DocumentToEntityTransformer;return e(t,o.transform(i,r))}e(t,i)})},i},t.prototype.aggregate=function(e,t,r){var n=this.connection.getMetadata(e);return this.queryRunner.aggregate(n.tableName,t,r)},t.prototype.bulkWrite=function(e,t,r){var n=this.connection.getMetadata(e);return this.queryRunner.bulkWrite(n.tableName,t,r)},t.prototype.count=function(e,t,r){var n=this.connection.getMetadata(e);return this.queryRunner.count(n.tableName,t,r)},t.prototype.createCollectionIndex=function(e,t,r){var n=this.connection.getMetadata(e);return this.queryRunner.createCollectionIndex(n.tableName,t,r)},t.prototype.createCollectionIndexes=function(e,t){var r=this.connection.getMetadata(e);return this.queryRunner.createCollectionIndexes(r.tableName,t)},t.prototype.deleteMany=function(e,t,r){var n=this.connection.getMetadata(e);return this.queryRunner.deleteMany(n.tableName,t,r)},t.prototype.deleteOne=function(e,t,r){var n=this.connection.getMetadata(e);return this.queryRunner.deleteOne(n.tableName,t,r)},t.prototype.distinct=function(e,t,r,n){var i=this.connection.getMetadata(e);return this.queryRunner.distinct(i.tableName,t,r,n)},t.prototype.dropCollectionIndex=function(e,t,r){var n=this.connection.getMetadata(e);return this.queryRunner.dropCollectionIndex(n.tableName,t,r)},t.prototype.dropCollectionIndexes=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.dropCollectionIndexes(t.tableName)},t.prototype.findOneAndDelete=function(e,t,r){var n=this.connection.getMetadata(e);return this.queryRunner.findOneAndDelete(n.tableName,t,r)},t.prototype.findOneAndReplace=function(e,t,r,n){var i=this.connection.getMetadata(e);return this.queryRunner.findOneAndReplace(i.tableName,t,r,n)},t.prototype.findOneAndUpdate=function(e,t,r,n){var i=this.connection.getMetadata(e);return this.queryRunner.findOneAndUpdate(i.tableName,t,r,n)},t.prototype.geoHaystackSearch=function(e,t,r,n){var i=this.connection.getMetadata(e);return this.queryRunner.geoHaystackSearch(i.tableName,t,r,n)},t.prototype.geoNear=function(e,t,r,n){var i=this.connection.getMetadata(e);return this.queryRunner.geoNear(i.tableName,t,r,n)},t.prototype.group=function(e,t,r,n,i,o,a,s){var u=this.connection.getMetadata(e);return this.queryRunner.group(u.tableName,t,r,n,i,o,a,s)},t.prototype.collectionIndexes=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.collectionIndexes(t.tableName)},t.prototype.collectionIndexExists=function(e,t){var r=this.connection.getMetadata(e);return this.queryRunner.collectionIndexExists(r.tableName,t)},t.prototype.collectionIndexInformation=function(e,t){var r=this.connection.getMetadata(e);return this.queryRunner.collectionIndexInformation(r.tableName,t)},t.prototype.initializeOrderedBulkOp=function(e,t){var r=this.connection.getMetadata(e);return this.queryRunner.initializeOrderedBulkOp(r.tableName,t)},t.prototype.initializeUnorderedBulkOp=function(e,t){var r=this.connection.getMetadata(e);return this.queryRunner.initializeUnorderedBulkOp(r.tableName,t)},t.prototype.insertMany=function(e,t,r){var n=this.connection.getMetadata(e);return this.queryRunner.insertMany(n.tableName,t,r)},t.prototype.insertOne=function(e,t,r){var n=this.connection.getMetadata(e);return this.queryRunner.insertOne(n.tableName,t,r)},t.prototype.isCapped=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.isCapped(t.tableName)},t.prototype.listCollectionIndexes=function(e,t){var r=this.connection.getMetadata(e);return this.queryRunner.listCollectionIndexes(r.tableName,t)},t.prototype.mapReduce=function(e,t,r,n){var i=this.connection.getMetadata(e);return this.queryRunner.mapReduce(i.tableName,t,r,n)},t.prototype.parallelCollectionScan=function(e,t){var r=this.connection.getMetadata(e);return this.queryRunner.parallelCollectionScan(r.tableName,t)},t.prototype.reIndex=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.reIndex(t.tableName)},t.prototype.rename=function(e,t,r){var n=this.connection.getMetadata(e);return this.queryRunner.rename(n.tableName,t,r)},t.prototype.replaceOne=function(e,t,r,n){var i=this.connection.getMetadata(e);return this.queryRunner.replaceOne(i.tableName,t,r,n)},t.prototype.stats=function(e,t){var r=this.connection.getMetadata(e);return this.queryRunner.stats(r.tableName,t)},t.prototype.updateMany=function(e,t,r,n){var i=this.connection.getMetadata(e);return this.queryRunner.updateMany(i.tableName,t,r,n)},t.prototype.updateOne=function(e,t,r,n){var i=this.connection.getMetadata(e);return this.queryRunner.updateOne(i.tableName,t,r,n)},t.prototype.convertFindManyOptionsOrConditionsToMongodbQuery=function(e){if(e)return i.FindOptionsUtils.isFindManyOptions(e)?e.where:e},t.prototype.convertFindOneOptionsOrConditionsToMongodbQuery=function(e){if(e)return i.FindOptionsUtils.isFindOneOptions(e)?e.where:e},t.prototype.convertFindOptionsOrderToOrderCriteria=function(e){return Object.keys(e).reduce(function(t,r){switch(e[r]){case"DESC":t[r]=-1;break;case"ASC":t[r]=1;break;default:t[r]=e[r]}return t},{})},t.prototype.convertMixedCriteria=function(e,t){if(t instanceof Object)return e.getValueDatabasePaths(t);var r=o.PlatformTools.load("mongodb").ObjectID;return{_id:t instanceof r?t:new r(t)}},t}(r.EntityManager),e("MongoEntityManager",c)}}}),System.register("typeorm/repository/MongoRepository",["typeorm/repository/Repository"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.query=function(e,t){throw new Error("Queries aren't supported by MongoDB.")},t.prototype.createQueryBuilder=function(e,t){throw new Error("Query Builder is not supported by MongoDB.")},t.prototype.find=function(e){return this.manager.find(this.metadata.target,e)},t.prototype.findAndCount=function(e){return this.manager.findAndCount(this.metadata.target,e)},t.prototype.findByIds=function(e,t){return this.manager.findByIds(this.metadata.target,e,t)},t.prototype.findOne=function(e,t){return this.manager.findOne(this.metadata.target,e,t)},t.prototype.createCursor=function(e){return this.manager.createCursor(this.metadata.target,e)},t.prototype.createEntityCursor=function(e){return this.manager.createEntityCursor(this.metadata.target,e)},t.prototype.aggregate=function(e,t){return this.manager.aggregate(this.metadata.target,e,t)},t.prototype.bulkWrite=function(e,t){return this.manager.bulkWrite(this.metadata.target,e,t)},t.prototype.count=function(e,t){return this.manager.count(this.metadata.target,e||{},t)},t.prototype.createCollectionIndex=function(e,t){return this.manager.createCollectionIndex(this.metadata.target,e,t)},t.prototype.createCollectionIndexes=function(e){return this.manager.createCollectionIndexes(this.metadata.target,e)},t.prototype.deleteMany=function(e,t){return this.manager.deleteMany(this.metadata.tableName,e,t)},t.prototype.deleteOne=function(e,t){return this.manager.deleteOne(this.metadata.tableName,e,t)},t.prototype.distinct=function(e,t,r){return this.manager.distinct(this.metadata.tableName,e,t,r)},t.prototype.dropCollectionIndex=function(e,t){return this.manager.dropCollectionIndex(this.metadata.tableName,e,t)},t.prototype.dropCollectionIndexes=function(){return this.manager.dropCollectionIndexes(this.metadata.tableName)},t.prototype.findOneAndDelete=function(e,t){return this.manager.findOneAndDelete(this.metadata.tableName,e,t)},t.prototype.findOneAndReplace=function(e,t,r){return this.manager.findOneAndReplace(this.metadata.tableName,e,t,r)},t.prototype.findOneAndUpdate=function(e,t,r){return this.manager.findOneAndUpdate(this.metadata.tableName,e,t,r)},t.prototype.geoHaystackSearch=function(e,t,r){return this.manager.geoHaystackSearch(this.metadata.tableName,e,t,r)},t.prototype.geoNear=function(e,t,r){return this.manager.geoNear(this.metadata.tableName,e,t,r)},t.prototype.group=function(e,t,r,n,i,o,a){return this.manager.group(this.metadata.tableName,e,t,r,n,i,o,a)},t.prototype.collectionIndexes=function(){return this.manager.collectionIndexes(this.metadata.tableName)},t.prototype.collectionIndexExists=function(e){return this.manager.collectionIndexExists(this.metadata.tableName,e)},t.prototype.collectionIndexInformation=function(e){return this.manager.collectionIndexInformation(this.metadata.tableName,e)},t.prototype.initializeOrderedBulkOp=function(e){return this.manager.initializeOrderedBulkOp(this.metadata.tableName,e)},t.prototype.initializeUnorderedBulkOp=function(e){return this.manager.initializeUnorderedBulkOp(this.metadata.tableName,e)},t.prototype.insertMany=function(e,t){return this.manager.insertMany(this.metadata.tableName,e,t)},t.prototype.insertOne=function(e,t){return this.manager.insertOne(this.metadata.tableName,e,t)},t.prototype.isCapped=function(){return this.manager.isCapped(this.metadata.tableName)},t.prototype.listCollectionIndexes=function(e){return this.manager.listCollectionIndexes(this.metadata.tableName,e)},t.prototype.mapReduce=function(e,t,r){return this.manager.mapReduce(this.metadata.tableName,e,t,r)},t.prototype.parallelCollectionScan=function(e){return this.manager.parallelCollectionScan(this.metadata.tableName,e)},t.prototype.reIndex=function(){return this.manager.reIndex(this.metadata.tableName)},t.prototype.rename=function(e,t){return this.manager.rename(this.metadata.tableName,e,t)},t.prototype.replaceOne=function(e,t,r){return this.manager.replaceOne(this.metadata.tableName,e,t,r)},t.prototype.stats=function(e){return this.manager.stats(this.metadata.tableName,e)},t.prototype.updateMany=function(e,t,r){return this.manager.updateMany(this.metadata.tableName,e,t,r)},t.prototype.updateOne=function(e,t,r){return this.manager.updateOne(this.metadata.tableName,e,t,r)},t}(r.Repository),e("MongoRepository",n)}}}),System.register("typeorm/repository/TreeRepository",["typeorm/repository/Repository"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.findTrees=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(r){switch(r.label){case 0:return[4,this.findRoots()];case 1:return e=r.sent(),[4,Promise.all(e.map(function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.findDescendantsTree(e)];case 1:return t.sent(),[2]}})})}))];case 2:return r.sent(),[2,e]}})})},t.prototype.findRoots=function(){var e=this,t=this.manager.connection.namingStrategy.joinColumnName(this.metadata.treeParentRelation.propertyName,"id");return this.createQueryBuilder("treeEntity").where(function(t){return e.manager.connection.driver.escape(t)}("treeEntity")+"."+function(t){return e.manager.connection.driver.escape(t)}(t)+" IS NULL").getMany()},t.prototype.findDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findDescendantsTree=function(e){var t=this;return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getRawAndEntities().then(function(r){var n=t.createRelationMaps("treeEntity",r.raw);return t.buildChildrenEntityTree(e,r.entities,n),e})},t.prototype.countDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createDescendantsQueryBuilder=function(e,t,r){var n=this,i=function(e){return n.manager.connection.driver.escape(e)},o=i(e)+"."+i(this.metadata.primaryColumns[0].databaseName)+"="+i(t)+"."+i("descendant");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,o).where(i(t)+"."+i("ancestor")+"="+this.metadata.getEntityIdMap(r)[this.metadata.primaryColumns[0].propertyName])},t.prototype.findAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findAncestorsTree=function(e){var t=this;return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getRawAndEntities().then(function(r){var n=t.createRelationMaps("treeEntity",r.raw);return t.buildParentEntityTree(e,r.entities,n),e})},t.prototype.countAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createAncestorsQueryBuilder=function(e,t,r){var n=this,i=function(e){return n.manager.connection.driver.escape(e)},o=function(e){return n.manager.connection.driver.escape(e)},a=i(e)+"."+o(this.metadata.primaryColumns[0].databaseName)+"="+i(t)+"."+o("ancestor");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,a).where(i(t)+"."+o("descendant")+"="+this.metadata.getEntityIdMap(r)[this.metadata.primaryColumns[0].propertyName])},t.prototype.createRelationMaps=function(e,t){var r=this;return t.map(function(t){return{id:t[e+"_"+r.metadata.primaryColumns[0].databaseName],parentId:t[e+"_"+r.metadata.treeParentRelation.joinColumns[0].givenDatabaseName]}})},t.prototype.buildChildrenEntityTree=function(e,t,r){var n=this,i=this.metadata.treeChildrenRelation.propertyName,o=this.metadata.primaryColumns[0].getEntityValue(e),a=r.filter(function(e){return e.parentId===o}).map(function(e){return e.id});e[i]=t.filter(function(e){return-1!==a.indexOf(e.id)}),e[i].forEach(function(e){n.buildChildrenEntityTree(e,t,r)})},t.prototype.buildParentEntityTree=function(e,t,r){var n=this,i=this.metadata.treeParentRelation.propertyName,o=this.metadata.primaryColumns[0].getEntityValue(e),a=r.find(function(e){return e.id===o}),s=t.find(function(e){return!!a&&e[n.metadata.primaryColumns[0].propertyName]===a.parentId});s&&(e[i]=s,this.buildParentEntityTree(e[i],t,r))},t}(r.Repository),e("TreeRepository",n)}}}),System.register("typeorm/query-builder/transformer/PlainObjectToNewEntityTransformer",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(){}return e.prototype.transform=function(e,t,r,n){return void 0===n&&(n=!1),this.groupAndTransform(e,t,r,n),e},e.prototype.groupAndTransform=function(e,t,r,n){var i=this;void 0===n&&(n=!1),r.nonVirtualColumns.forEach(function(r){var n=r.getEntityValue(t);void 0!==n&&r.setEntityValue(e,n)}),r.relations.length&&r.relations.forEach(function(r){var o=r.getEntityValue(e),a=r.getEntityValue(t,n);if(void 0!==a)if(r.isOneToMany||r.isManyToMany){if(!(a instanceof Array))return;o||(o=[],r.setEntityValue(e,o)),a.forEach(function(e){var t=o.find(function(t){return r.inverseEntityMetadata.compareEntities(e,t)});t||(t=r.inverseEntityMetadata.create(),o.push(t)),i.groupAndTransform(t,e,r.inverseEntityMetadata,n)})}else{if(!(a instanceof Object))return void(o instanceof Object||r.setEntityValue(e,a));o||(o=r.inverseEntityMetadata.create(),r.setEntityValue(e,o)),i.groupAndTransform(o,a,r.inverseEntityMetadata,n)}})},e}(),e("PlainObjectToNewEntityTransformer",r)}}}),System.register("typeorm/query-builder/transformer/PlainObjectToDatabaseEntityTransformer",[],function(e,t){"use strict";var r,n,i;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e,t,r,n){this.plainEntity=e,this.metadata=t,this.parentLoadMapItem=r,this.relation=n}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.metadata.getEntityIdMixedMap(this.plainEntity)},enumerable:!0,configurable:!0}),e.prototype.compareEntities=function(e,t){return this.metadata.compareEntities(e,t)},e}(),n=function(){function e(){this.loadMapItems=[]}return Object.defineProperty(e.prototype,"mainLoadMapItem",{get:function(){return this.loadMapItems.find(function(e){return!e.relation&&!e.parentLoadMapItem})},enumerable:!0,configurable:!0}),e.prototype.addLoadMap=function(e){this.loadMapItems.find(function(t){return t.target===e.target&&t.id===e.id})||this.loadMapItems.push(e)},e.prototype.fillEntities=function(e,t){var r=this;t.forEach(function(t){var n=r.loadMapItems.find(function(r){return r.target===e&&r.compareEntities(t,r.plainEntity)});n&&(n.entity=t)})},e.prototype.groupByTargetIds=function(){var e=[];return this.loadMapItems.forEach(function(t){var r=e.find(function(e){return e.target===t.target});r||(r={target:t.target,ids:[]},e.push(r)),r.ids.push(t.id)}),e},e}(),i=function(){function e(e){this.manager=e}return e.prototype.transform=function(e,t){return __awaiter(this,void 0,void 0,function(){var i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return t.checkIfObjectContainsAllPrimaryKeys(e)?(i=new n,(o=function(e,n,a,s){var u=new r(e,n,a,s);i.addLoadMap(u),n.extractRelationValuesFromEntity(e,t.relations).filter(function(e){return null!==e&&void 0!==e}).forEach(function(e){var t=e[0],r=e[1],n=e[2];return o(r,n,u,t)})})(e,t),[4,Promise.all(i.groupByTargetIds().map(function(e){return a.manager.findByIds(e.target,e.ids).then(function(t){return i.fillEntities(e.target,t)})}))]):[2,Promise.reject("Given object does not have a primary column, cannot transform it to database entity.")];case 1:return s.sent(),i.loadMapItems.forEach(function(e){e.relation&&e.entity&&e.parentLoadMapItem&&e.parentLoadMapItem.entity&&(e.relation.isManyToMany||e.relation.isOneToMany?(e.parentLoadMapItem.entity[e.relation.propertyName]||(e.parentLoadMapItem.entity[e.relation.propertyName]=[]),e.parentLoadMapItem.entity[e.relation.propertyName].push(e.entity)):e.parentLoadMapItem.entity[e.relation.propertyName]=e.entity)}),[2,i.mainLoadMapItem?i.mainLoadMapItem.entity:void 0]}})})},e}(),e("PlainObjectToDatabaseEntityTransformer",i)}}}),System.register("typeorm/error/CustomRepositoryNotFoundError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;return r.name="CustomRepositoryNotFoundError",r.message="Custom repository "+(t instanceof Function?t.name:t.constructor.name)+" was not found. Did you forgot to put @EntityRepository decorator on it?",r}return __extends(t,e),t}(Error),e("CustomRepositoryNotFoundError",r)}}}),System.register("typeorm/error/CustomRepositoryDoesNotHaveEntityError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this,"Custom repository "+(t instanceof Function?t.name:t.constructor.name)+" does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? ")||this;return r.name="CustomRepositoryDoesNotHaveEntityError",r}return __extends(t,e),t}(Error),e("CustomRepositoryDoesNotHaveEntityError",r)}}}),System.register("typeorm/repository/AbstractRepository",["typeorm/error/CustomRepositoryDoesNotHaveEntityError","typeorm/index","typeorm/error/CustomRepositoryNotFoundError"],function(e,t){"use strict";var r,n,i,o;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e}],execute:function(){o=function(){function e(){}return Object.defineProperty(e.prototype,"repository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new r.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getRepository(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeRepository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new r.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getTreeRepository(e)},enumerable:!0,configurable:!0}),e.prototype.createQueryBuilder=function(e){var t=this.getCustomRepositoryTarget(this.constructor);if(!t)throw new r.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getRepository(t).createQueryBuilder(e)},e.prototype.createQueryBuilderFor=function(e,t){return this.getRepositoryFor(e).createQueryBuilder(t)},e.prototype.getRepositoryFor=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepositoryFor=function(e){return this.manager.getTreeRepository(e)},e.prototype.getCustomRepositoryTarget=function(e){var t=n.getMetadataArgsStorage().entityRepositories.find(function(t){return t.target===(e instanceof Function?e:e.constructor)});if(!t)throw new i.CustomRepositoryNotFoundError(e);return t.entity},e}(),e("AbstractRepository",o)}}}),System.register("typeorm/error/CustomRepositoryCannotInheritRepositoryError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this,"Custom entity repository "+(t instanceof Function?t.name:t.constructor.name)+"  cannot inherit Repository class without entity being set in the @EntityRepository decorator.")||this;return r.name="CustomRepositoryCannotInheritRepositoryError",r}return __extends(t,e),t}(Error),e("CustomRepositoryCannotInheritRepositoryError",r)}}}),System.register("typeorm/error/RepositoryNotFoundError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r){var n=e.call(this)||this;n.name="RepositoryNotFoundError";var i="function"==typeof r&&r.name?r.name:r;return n.message='No repository for "'+i+'" was found. Looks like this entity is not registered in current "'+t+'" connection?',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("RepositoryNotFoundError",r)}}}),System.register("typeorm/error/RepositoryNotTreeError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;r.name="RepositoryNotTreeError";var n="function"==typeof t&&t.name?t.name:t;return r.message='Repository of the "'+n+'" class is not a TreeRepository. Try to use @ClosureEntity decorator instead of @Entity.',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("RepositoryNotTreeError",r)}}}),System.register("typeorm/repository/RepositoryFactory",["typeorm/repository/TreeRepository","typeorm/repository/Repository","typeorm/driver/mongodb/MongoDriver","typeorm/repository/MongoRepository"],function(e,t){"use strict";var r,n,i,o,a;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(){}return e.prototype.create=function(e,t,a){if(t.isClosure){s=new r.TreeRepository;return Object.assign(s,{manager:e,metadata:t,queryRunner:a}),s}var s=void 0;return s=e.connection.driver instanceof i.MongoDriver?new o.MongoRepository:new n.Repository,Object.assign(s,{manager:e,metadata:t,queryRunner:a}),s},e}(),e("RepositoryFactory",a)}}}),System.register("typeorm/error/TreeRepositoryNotSupportedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;return r.name="TreeRepositoryNotSupportedError",r.message="Tree repositories are not supported in "+t.options.type+" driver.",r}return __extends(t,e),t}(Error),e("TreeRepositoryNotSupportedError",r)}}}),System.register("typeorm/error/MustBeEntityError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r){var n=e.call(this)||this;return n.name="MustBeEntityError",n.message="Cannot "+t+', given value must be an entity, instead "'+r+'" is given.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("MustBeEntityError",r)}}}),System.register("typeorm/persistence/SubjectChangeMap",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/util/OrmUtils",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(){}return e.chunk=function(e,t){return Array.from(Array(Math.ceil(e.length/t)),function(r,n){return e.slice(n*t,n*t+t)})},e.splitClassesAndStrings=function(e){return[e.filter(function(e){return"string"!=typeof e}),e.filter(function(e){return"string"==typeof e})]},e.groupBy=function(e,t){return e.reduce(function(e,r){var n=t(r),i=e.find(function(e){return e.id===n});return i||(i={id:n,items:[]},e.push(i)),i.items.push(r),e},[])},e.uniq=function(e,t){return e.reduce(function(e,r){var n=!1;if(t instanceof Function){var i=t(r);n=!!e.find(function(e){return t(e)===i})}else n="string"==typeof t?!!e.find(function(e){return e[t]===r[t]}):-1!==e.indexOf(r);return n||e.push(r),e},[])},e.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},e.mergeDeep=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(!t.length)return e;var n=t.shift();if(this.isObject(e)&&this.isObject(n))for(var i in n){var o=i;n[i]instanceof Promise||(!this.isObject(n[o])||n[o]instanceof Date||n[o]instanceof Buffer?Object.assign(e,(s={},s[i]=n[o],s)):(e[i]||Object.assign(e,(a={},a[i]={},a)),this.mergeDeep(e[i],n[o])))}return this.mergeDeep.apply(this,[e].concat(t));var a,s},e.deepCompare=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n,i,o;if(arguments.length<1)return!0;for(r=1,n=arguments.length;r<n;r++)if(i=[],o=[],!this.compare2Objects(i,o,arguments[0],arguments[r]))return!1;return!0},e.toBoolean=function(e){return"boolean"==typeof e?e:"string"==typeof e?"true"===e||"1"===e:"number"==typeof e&&e>0},e.zipObject=function(e,t){return e.reduce(function(e,r,n){return e[r]=t[n],e},{})},e.compare2Objects=function(e,t,r,n){var i;if(isNaN(r)&&isNaN(n)&&"number"==typeof r&&"number"==typeof n)return!0;if(r===n)return!0;if(r.equals instanceof Function&&r.equals(n))return!0;if("function"==typeof r&&"function"==typeof n||r instanceof Date&&n instanceof Date||r instanceof RegExp&&n instanceof RegExp||r instanceof String&&n instanceof String||r instanceof Number&&n instanceof Number)return r.toString()===n.toString();if(!(r instanceof Object&&n instanceof Object))return!1;if(r.isPrototypeOf(n)||n.isPrototypeOf(r))return!1;if(r.constructor!==n.constructor)return!1;if(r.prototype!==n.prototype)return!1;if(e.indexOf(r)>-1||t.indexOf(n)>-1)return!1;for(i in n){if(n.hasOwnProperty(i)!==r.hasOwnProperty(i))return!1;if(typeof n[i]!=typeof r[i])return!1}for(i in r){if(n.hasOwnProperty(i)!==r.hasOwnProperty(i))return!1;if(typeof n[i]!=typeof r[i])return!1;switch(typeof r[i]){case"object":case"function":if(e.push(r),t.push(n),!this.compare2Objects(e,t,r[i],n[i]))return!1;e.pop(),t.pop();break;default:if(r[i]!==n[i])return!1}}return!0},e}(),e("OrmUtils",r)}}}),System.register("typeorm/persistence/Subject",["typeorm/util/OrmUtils"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e){this.identifier=void 0,this.changeMaps=[],this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.metadata=e.metadata,this.entity=e.entity,this.databaseEntity=e.databaseEntity,void 0!==e.canBeInserted&&(this.canBeInserted=e.canBeInserted),void 0!==e.canBeUpdated&&(this.canBeUpdated=e.canBeUpdated),void 0!==e.mustBeRemoved&&(this.mustBeRemoved=e.mustBeRemoved),void 0!==e.identifier&&(this.identifier=e.identifier),void 0!==e.changeMaps&&(t=this.changeMaps).push.apply(t,e.changeMaps),this.entity?this.identifier=this.metadata.getEntityIdMap(this.entity):this.databaseEntity&&(this.identifier=this.metadata.getEntityIdMap(this.databaseEntity));var t}return Object.defineProperty(e.prototype,"mustBeInserted",{get:function(){return this.canBeInserted&&!this.databaseEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeUpdated",{get:function(){return this.canBeUpdated&&this.identifier&&(this.changeMaps.length>0||!!this.metadata.objectIdColumn)},enumerable:!0,configurable:!0}),e.prototype.createValueSetAndPopChangeMap=function(){var t=this,n=[],i=this.changeMaps.reduce(function(i,o){var a=o.value;a instanceof e&&(a=a.insertedValueSet?a.insertedValueSet:a.entity);var s;if(t.metadata.isJunction&&o.column)s=o.column.createValueMap(o.column.referencedColumn.getEntityValue(a));else if(o.column)s=o.column.createValueMap(a);else if(o.relation)if(a instanceof Object){var u=o.relation.getRelationIdMap(a);if(void 0===u)return n.push(o),t.canBeUpdated=!0,i;s=o.relation.createValueMap(u)}else s=o.relation.createValueMap(a);return r.OrmUtils.mergeDeep(i,s),i},{});return this.changeMaps=n,i},e}(),e("Subject",n)}}}),System.register("typeorm/util/PromiseUtils",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(){}return e.create=function(e){var t=Promise.resolve(e);return t.__value__=e,t},e.extractValue=function(e){return e instanceof Promise&&e.__value__?e.__value__:e},e.runInSequence=function(e,t){var r=[];return e.reduce(function(e,n){return e.then(function(){return t(n)}).then(function(e){r.push(e)})},Promise.resolve()).then(function(){return r})},e.settle=function(e){return Promise.all(e.map(function(e){return Promise.resolve(e).then(function(e){return{state:"fulfilled",value:e}},function(e){return{state:"rejected",reason:e}})})).then(function(e){var t=e.find(function(e){return"rejected"===e.state});return t?Promise.reject(t.reason):e.map(function(e){return e.value})})},e}(),e("PromiseUtils",r)}}}),System.register("typeorm/persistence/SubjectTopoligicalSorter",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e){this.subjects=e.slice(),this.metadatas=this.getUniqueMetadatas(this.subjects)}return e.prototype.sort=function(e){var t=this;if(!this.metadatas.length)return this.subjects;var r=[];if("delete"===e){var n=this.subjects.filter(function(e){return!e.entity&&!e.databaseEntity});r.push.apply(r,n),this.removeAlreadySorted(n)}var i=this.getNonNullableDependencies(),o=this.toposort(i);"insert"===e&&(o=o.reverse()),o.forEach(function(e){var n=t.subjects.filter(function(t){return t.metadata.targetName===e});r.push.apply(r,n),t.removeAlreadySorted(n)});var a=this.getDependencies(),s=this.toposort(a);return"insert"===e&&(s=s.reverse()),s.forEach(function(e){var n=t.subjects.filter(function(t){return t.metadata.targetName===e});r.push.apply(r,n),t.removeAlreadySorted(n)}),r.push.apply(r,this.subjects),r},e.prototype.removeAlreadySorted=function(e){var t=this;e.forEach(function(e){t.subjects.splice(t.subjects.indexOf(e),1)})},e.prototype.getUniqueMetadatas=function(e){var t=[];return e.forEach(function(e){-1===t.indexOf(e.metadata)&&t.push(e.metadata)}),t},e.prototype.getNonNullableDependencies=function(){return this.metadatas.reduce(function(e,t){return t.relationsWithJoinColumns.forEach(function(r){r.isNullable||e.push([t.targetName,r.inverseEntityMetadata.targetName])}),e},[])},e.prototype.getDependencies=function(){return this.metadatas.reduce(function(e,t){return t.relationsWithJoinColumns.forEach(function(r){r.inverseEntityMetadata!==t&&e.push([t.targetName,r.inverseEntityMetadata.targetName])}),e},[])},e.prototype.toposort=function(e){function t(a,s,u){if(u.indexOf(a)>=0)throw new Error("Cyclic dependency: "+JSON.stringify(a));if(!~r.indexOf(a))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(a));if(!o[s]){o[s]=!0;var c=e.filter(function(e){return e[0]===a});if(s=c.length){var l=u.concat(a);do{var p=c[--s][1];t(p,r.indexOf(p),l)}while(s)}i[--n]=a}}for(var r=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];t.indexOf(i[0])<0&&t.push(i[0]),t.indexOf(i[1])<0&&t.push(i[1])}return t}(e),n=r.length,i=new Array(n),o={},a=n;a--;)o[a]||t(r[a],a,[]);return i},e}(),e("SubjectTopoligicalSorter",r)}}}),System.register("typeorm/util/DateUtils",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(){}return e.normalizeHydratedDate=function(e){if(!e)return e;var t="string"==typeof e?new Date(e):e,r=new Date;return r.setUTCFullYear(t.getFullYear(),t.getMonth(),t.getDate()),r.setUTCHours(t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()),r},e.mixedDateToDateString=function(e){return e instanceof Date?this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate()):e},e.mixedDateToDate=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!0);var n="string"==typeof e?new Date(e):e;return t&&(n=new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds())),r||n.setUTCMilliseconds(0),n},e.mixedDateToTimeString=function(e,t){return void 0===t&&(t=!1),e instanceof Date?this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+(t?"":":"+this.formatZerolessValue(e.getSeconds())):e},e.mixedTimeToDate=function(e){if("string"==typeof e){var t=e.split(":"),r=t[0],n=t[1],i=t[2],o=new Date;return r&&o.setHours(parseInt(r)),n&&o.setMinutes(parseInt(n)),i&&o.setSeconds(parseInt(i)),o}return e},e.mixedTimeToString=function(e,t){return void 0===t&&(t=!1),"string"==typeof(e=e instanceof Date?e.getHours()+":"+e.getMinutes()+(t?"":":"+e.getSeconds()):e)?e.split(":").map(function(e){return 1===e.length?"0"+e:e}).join(":"):e},e.mixedDateToDatetimeString=function(e){return"string"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate())+" "+this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds())+"."+this.formatMilliseconds(e.getUTCMilliseconds()):e},e.mixedDateToUtcDatetimeString=function(e){return"string"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getUTCFullYear())+"-"+this.formatZerolessValue(e.getUTCMonth()+1)+"-"+this.formatZerolessValue(e.getUTCDate())+" "+this.formatZerolessValue(e.getUTCHours())+":"+this.formatZerolessValue(e.getUTCMinutes())+":"+this.formatZerolessValue(e.getUTCSeconds())+"."+this.formatMilliseconds(e.getUTCMilliseconds()):e},e.simpleArrayToString=function(e){return e instanceof Array?e.map(function(e){return String(e)}).join(","):e},e.stringToSimpleArray=function(e){return e instanceof String||"string"==typeof e?e.length>0?e.split(","):[]:e},e.formatZerolessValue=function(e){return e<10?"0"+e:String(e)},e.formatMilliseconds=function(e){return e<100?"0"+e:String(e)},e}(),e("DateUtils",r)}}}),System.register("typeorm/persistence/SubjectChangedColumnsComputer",["typeorm/util/DateUtils"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(){}return e.prototype.compute=function(e){var t=this;e.forEach(function(r){t.computeDiffColumns(r),t.computeDiffRelationalColumns(e,r)})},e.prototype.computeDiffColumns=function(e){e.entity&&e.metadata.columns.forEach(function(t){if(!(t.isVirtual||t.isParentId||t.isDiscriminator||t.isUpdateDate||t.isVersion||t.isCreateDate)){var n=t.getEntityValue(e.entity);if(void 0!==n){if(e.databaseEntity){var i=t.getEntityValue(e.databaseEntity);if(t.relationMetadata){var o=t.relationMetadata.getEntityValue(e.entity);if(null!==o&&void 0!==o)return}if(null!==n&&void 0!==n&&("date"===t.type?n=r.DateUtils.mixedDateToDateString(n):"time"===t.type?n=r.DateUtils.mixedDateToTimeString(n):"datetime"===t.type||t.type===Date?(n=r.DateUtils.mixedDateToUtcDatetimeString(n),i=r.DateUtils.mixedDateToUtcDatetimeString(i)):"json"===t.type||"jsonb"===t.type?(n=JSON.stringify(n),null!==i&&void 0!==i&&(i=JSON.stringify(i))):"sample-array"===t.type&&(n=r.DateUtils.simpleArrayToString(n),i=r.DateUtils.simpleArrayToString(i))),n===i)return}var a=e.changeMaps.find(function(e){return e.column===t});a?a.value=n:e.changeMaps.push({column:t,value:n})}}})},e.prototype.computeDiffRelationalColumns=function(e,t){t.entity&&t.metadata.relationsWithJoinColumns.forEach(function(r){var n=r.getEntityValue(t.entity);if(void 0!==n){if(t.databaseEntity){var i=n;null===i||i instanceof Object||(i=r.getRelationIdMap(i));var o=r.getEntityValue(t.databaseEntity);if(r.inverseEntityMetadata.compareIds(i,o))return}var a=e.find(function(e){return e.mustBeInserted&&e.entity===n});a&&(n=a);var s=t.changeMaps.find(function(e){return e.relation===r});s?s.value=n:t.changeMaps.push({relation:r,value:n})}})},e}(),e("SubjectChangedColumnsComputer",n)}}}),System.register("typeorm/error/SubjectWithoutIdentifierError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;return r.name="SubjectWithoutIdentifierError",r.message="Internal error. Subject "+t.metadata.targetName+" must have an identifier to perform operation. Please report a github issue if you face this error.",r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("SubjectWithoutIdentifierError",r)}}}),System.register("typeorm/error/SubjectRemovedAndUpdatedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;return r.name="SubjectRemovedAndUpdatedError",r.message='Removed entity "'+t.metadata.name+'" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("SubjectRemovedAndUpdatedError",r)}}}),System.register("typeorm/persistence/SubjectExecutor",["typeorm/util/PromiseUtils","typeorm/persistence/SubjectTopoligicalSorter","typeorm/persistence/SubjectChangedColumnsComputer","typeorm/error/SubjectWithoutIdentifierError","typeorm/error/SubjectRemovedAndUpdatedError","typeorm/driver/mongodb/MongoQueryRunner","typeorm/driver/mongodb/MongoDriver","typeorm/subscriber/BroadcasterResult"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e,t,r){this.hasExecutableOperations=!1,this.insertSubjects=[],this.updateSubjects=[],this.removeSubjects=[],this.queryRunner=e,this.allSubjects=t,this.options=r,this.validate(),this.recompute()}return e.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=void 0,this.options&&!1===this.options.listeners?[3,2]:(e=this.broadcastBeforeEventsForAll()).promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:t.sent(),t.label=2;case 2:return e&&e.count>0&&this.recompute(),this.insertSubjects=new n.SubjectTopoligicalSorter(this.insertSubjects).sort("insert"),[4,this.executeInsertOperations()];case 3:return t.sent(),this.updateSubjects=this.allSubjects.filter(function(e){return e.mustBeUpdated}),[4,this.executeUpdateOperations()];case 4:return t.sent(),this.removeSubjects=new n.SubjectTopoligicalSorter(this.removeSubjects).sort("delete"),[4,this.executeRemoveOperations()];case 5:return t.sent(),[4,this.updateSpecialColumnsInPersistedEntities()];case 6:return t.sent(),this.options&&!1===this.options.listeners?[3,8]:(e=this.broadcastAfterEventsForAll()).promises.length>0?[4,Promise.all(e.promises)]:[3,8];case 7:t.sent(),t.label=8;case 8:return[2]}})})},e.prototype.validate=function(){this.allSubjects.forEach(function(e){if(e.mustBeUpdated&&e.mustBeRemoved)throw new a.SubjectRemovedAndUpdatedError(e)})},e.prototype.recompute=function(){(new i.SubjectChangedColumnsComputer).compute(this.allSubjects),this.insertSubjects=this.allSubjects.filter(function(e){return e.mustBeInserted}),this.updateSubjects=this.allSubjects.filter(function(e){return e.mustBeUpdated}),this.removeSubjects=this.allSubjects.filter(function(e){return e.mustBeRemoved}),this.hasExecutableOperations=this.insertSubjects.length>0||this.updateSubjects.length>0||this.removeSubjects.length>0},e.prototype.broadcastBeforeEventsForAll=function(){var e=this,t=new c.BroadcasterResult;return this.insertSubjects.length&&this.insertSubjects.forEach(function(r){return e.queryRunner.broadcaster.broadcastBeforeInsertEvent(t,r.metadata,r.entity)}),this.updateSubjects.length&&this.updateSubjects.forEach(function(r){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,r.metadata,r.entity,r.databaseEntity)}),this.removeSubjects.length&&this.removeSubjects.forEach(function(r){return e.queryRunner.broadcaster.broadcastBeforeRemoveEvent(t,r.metadata,r.entity,r.databaseEntity)}),t},e.prototype.broadcastAfterEventsForAll=function(){var e=this,t=new c.BroadcasterResult;return this.insertSubjects.length&&this.insertSubjects.forEach(function(r){return e.queryRunner.broadcaster.broadcastAfterInsertEvent(t,r.metadata,r.entity)}),this.updateSubjects.length&&this.updateSubjects.forEach(function(r){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,r.metadata,r.entity,r.databaseEntity)}),this.removeSubjects.length&&this.removeSubjects.forEach(function(r){return e.queryRunner.broadcaster.broadcastAfterRemoveEvent(t,r.metadata,r.entity,r.databaseEntity)}),t},e.prototype.executeInsertOperations=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i=this;return __generator(this,function(o){switch(o.label){case 0:return e=this.groupBulkSubjects(this.insertSubjects,"insert"),t=e[0],n=e[1],[4,r.PromiseUtils.runInSequence(n,function(e){return __awaiter(i,void 0,void 0,function(){var r,n,i,o,a=this;return __generator(this,function(c){switch(c.label){case 0:return r=t[e],n=r.map(function(e){return a.queryRunner.connection.driver instanceof u.MongoDriver?e.entity:e.createValueSetAndPopChangeMap()}),this.queryRunner instanceof s.MongoQueryRunner?(o=this.queryRunner.manager,[4,o.insert(r[0].metadata.target,n)]):[3,2];case 1:return i=c.sent(),[3,4];case 2:return[4,this.queryRunner.manager.createQueryBuilder().insert().into(r[0].metadata.target).values(n).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1).execute()];case 3:i=c.sent(),c.label=4;case 4:return r.forEach(function(e,t){e.identifier=i.identifiers[t],e.generatedMap=i.generatedMaps[t],e.insertedValueSet=n[t]}),[2]}})})})];case 1:return o.sent(),[2]}})})},e.prototype.executeUpdateOperations=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,Promise.all(this.updateSubjects.map(function(t){return __awaiter(e,void 0,void 0,function(){var e,r,n,i;return __generator(this,function(a){switch(a.label){case 0:if(!t.identifier)throw new o.SubjectWithoutIdentifierError(t);return e=this.queryRunner.connection.driver instanceof u.MongoDriver?t.entity:t.createValueSetAndPopChangeMap(),this.queryRunner instanceof s.MongoQueryRunner?(r=this.queryRunner.manager,[4,r.update(t.metadata.target,t.identifier,e)]):[3,2];case 1:return a.sent(),[3,4];case 2:return n=this.queryRunner.manager.createQueryBuilder().update(t.metadata.target).set(e).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),t.entity?n.whereEntity(t.identifier):n.where(t.identifier),[4,n.execute()];case 3:i=a.sent(),t.generatedMap=i.generatedMaps[0],a.label=4;case 4:return[2]}})})}))];case 1:return t.sent(),[2]}})})},e.prototype.executeRemoveOperations=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i=this;return __generator(this,function(a){switch(a.label){case 0:return e=this.groupBulkSubjects(this.removeSubjects,"delete"),t=e[0],n=e[1],[4,r.PromiseUtils.runInSequence(n,function(e){return __awaiter(i,void 0,void 0,function(){var r,n,i;return __generator(this,function(a){switch(a.label){case 0:return r=t[e],n=r.map(function(e){if(!e.identifier)throw new o.SubjectWithoutIdentifierError(e);return e.identifier}),this.queryRunner instanceof s.MongoQueryRunner?(i=this.queryRunner.manager,[4,i.delete(r[0].metadata.target,n)]):[3,2];case 1:return a.sent(),[3,4];case 2:return[4,this.queryRunner.manager.createQueryBuilder().delete().from(r[0].metadata.target).where(n).callListeners(!1).execute()];case 3:a.sent(),a.label=4;case 4:return[2]}})})})];case 1:return a.sent(),[2]}})})},e.prototype.updateSpecialColumnsInPersistedEntities=function(){this.insertSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.insertSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.updateSubjects),this.removeSubjects.length&&this.removeSubjects.forEach(function(e){e.entity&&e.metadata.primaryColumns.forEach(function(t){t.setEntityValue(e.entity,void 0)})}),this.allSubjects.forEach(function(e){e.entity&&e.metadata.relationIds.forEach(function(t){t.setValue(e.entity)})})},e.prototype.updateSpecialColumnsInInsertedAndUpdatedEntities=function(e){var t=this;e.forEach(function(e){e.entity&&(e.metadata.columns.forEach(function(t){if(t.isNullable&&!t.isVirtual){void 0===t.getEntityValue(e.entity)&&t.setEntityValue(e.entity,null)}}),e.generatedMap&&t.queryRunner.manager.merge(e.metadata.target,e.entity,e.generatedMap))})},e.prototype.groupBulkSubjects=function(e,t){var r={},n=[],i="delete"===t||this.queryRunner.connection.driver.isReturningSqlSupported();return e.forEach(function(e,t){var o=i||e.metadata.isJunction?e.metadata.name:e.metadata.name+"_"+t;r[o]?r[o].push(e):(r[o]=[e],n.push(o))}),[r,n]},e}(),e("SubjectExecutor",l)}}}),System.register("typeorm/error/CannotDetermineEntityError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;return r.name="CannotDetermineEntityError",r.message="Cannot "+t+", given value must be instance of entity class, instead object literal is given. Or you must specify an entity target to method call.",r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("CannotDetermineEntityError",r)}}}),System.register("typeorm/metadata/EntityMetadataUtils",["typeorm/util/OrmUtils"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(){}return e.createPropertyPath=function(e,t,r){var n=this;void 0===r&&(r="");var i=[];return Object.keys(t).forEach(function(o){var a=r?r+"."+o:o;if(e.hasEmbeddedWithPropertyPath(a)){var s=n.createPropertyPath(e,t[o],a);i.push.apply(i,s)}else{var u=r?r+"."+o:o;i.push(u)}}),i},e.getPropertyPathValue=function(e,t){var r=t.split("."),n=function(e){var t=r.shift(),i=t?e[t]:e;return r.length?n(i):i};return n(e)},e.difference=function(e,t){return e.filter(function(e){return!t.find(function(t){return r.OrmUtils.deepCompare(e,t)})})},e.compareIds=function(e,t){return void 0!==e&&null!==e&&void 0!==t&&null!==t&&r.OrmUtils.deepCompare(e,t)},e}(),e("EntityMetadataUtils",n)}}}),System.register("typeorm/persistence/subject-builder/OneToManySubjectBuilder",["typeorm/persistence/Subject","typeorm/util/OrmUtils","typeorm/metadata/EntityMetadataUtils"],function(e,t){"use strict";var r,n,i,o;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e}],execute:function(){o=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach(function(t){t.metadata.oneToManyRelations.forEach(function(r){!1!==r.persistenceEnabled&&e.buildForSubjectRelation(t,r)})})},e.prototype.buildForSubjectRelation=function(e,t){var o=this,a=[];e.databaseEntity&&(a=t.getEntityValue(e.databaseEntity));var s=t.getEntityValue(e.entity);if(null===s&&(s=[]),void 0!==s){var u=[];s.forEach(function(i){var s=t.inverseEntityMetadata.getEntityIdMap(i),c=o.subjects.find(function(e){return e.entity===i});if(s){a.find(function(e){return n.OrmUtils.deepCompare(s,e)})||(c||(c=new r.Subject({metadata:t.inverseEntityMetadata,canBeUpdated:!0,identifier:s}),o.subjects.push(c)),c.changeMaps.push({relation:t.inverseRelation,value:e})),u.push(s)}else{if(!c)throw new Error('One-to-many relation "'+t.entityMetadata.name+"."+t.propertyPath+'" contains entities which do not exist in the database yet, thus they cannot be bind in the database. Please setup cascade insertion or save entities before binding it.');c.changeMaps.push({relation:t.inverseRelation,value:e})}}),i.EntityMetadataUtils.difference(a,u).forEach(function(e){var n=new r.Subject({metadata:t.inverseEntityMetadata,canBeUpdated:!0,identifier:e,changeMaps:[{relation:t.inverseRelation,value:null}]});o.subjects.push(n)})}},e}(),e("OneToManySubjectBuilder",o)}}}),System.register("typeorm/persistence/subject-builder/OneToOneInverseSideSubjectBuilder",["typeorm/persistence/Subject","typeorm/util/OrmUtils"],function(e,t){"use strict";var r,n,i;t&&t.id;return{setters:[function(e){r=e},function(e){n=e}],execute:function(){i=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach(function(t){t.metadata.oneToOneRelations.forEach(function(r){r.isOwning||!1===r.persistenceEnabled||e.buildForSubjectRelation(t,r)})})},e.prototype.buildForSubjectRelation=function(e,t){var i=void 0;e.databaseEntity&&(i=t.getEntityValue(e.databaseEntity));var o=t.getEntityValue(e.entity);if(void 0!==o)if(null!==o){var a=t.inverseEntityMetadata.getEntityIdMap(o),s=this.subjects.find(function(e){return!!e.entity&&e.entity===o});if(!a){if(!s)throw new Error('One-to-one inverse relation "'+t.entityMetadata.name+"."+t.propertyPath+'" contains entity which does not exist in the database yet, thus cannot be bind in the database. Please setup cascade insertion or save entity before binding it.');s.changeMaps.push({relation:t.inverseRelation,value:e})}i&&n.OrmUtils.deepCompare(a,i)||(s||(s=new r.Subject({metadata:t.inverseEntityMetadata,canBeUpdated:!0,identifier:a}),this.subjects.push(s)),s.changeMaps.push({relation:t.inverseRelation,value:e}))}else if(i){var u=new r.Subject({metadata:t.inverseEntityMetadata,canBeUpdated:!0,identifier:i,changeMaps:[{relation:t.inverseRelation,value:null}]});this.subjects.push(u)}},e}(),e("OneToOneInverseSideSubjectBuilder",i)}}}),System.register("typeorm/persistence/subject-builder/ManyToManySubjectBuilder",["typeorm/persistence/Subject","typeorm/util/OrmUtils"],function(e,t){"use strict";var r,n,i;t&&t.id;return{setters:[function(e){r=e},function(e){n=e}],execute:function(){i=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach(function(t){t.entity&&t.metadata.manyToManyRelations.forEach(function(r){!1!==r.persistenceEnabled&&e.buildForSubjectRelation(t,r)})})},e.prototype.buildForAllRemoval=function(e){var t=this;e.databaseEntity&&e.metadata.manyToManyRelations.forEach(function(n){if(!1!==n.persistenceEnabled){n.getEntityValue(e.databaseEntity).forEach(function(i){var o=new r.Subject({metadata:n.junctionEntityMetadata,mustBeRemoved:!0,identifier:t.buildJunctionIdentifier(e,n,i)});t.subjects.push(o)})}})},e.prototype.buildForSubjectRelation=function(e,t){var n=this,i=[];e.databaseEntity&&(i=t.getEntityValue(e.databaseEntity));var o=t.getEntityValue(e.entity);if(null===o&&(o=[]),o instanceof Array){o.forEach(function(o){var a=t.inverseEntityMetadata.getEntityIdMap(o),s=n.subjects.find(function(e){return e.entity===o});if(!a&&!s)throw new Error('Many-to-many relation "'+t.entityMetadata.name+"."+t.propertyPath+'" contains entities which do not exist in the database yet, thus they cannot be bind in the database. Please setup cascade insertion or save entities before binding it.');if(!i.find(function(e){return t.inverseEntityMetadata.compareIds(e,a)})){var u=t.isOwning?e:s||o,c=t.isOwning?s||o:e,l=new r.Subject({metadata:t.junctionEntityMetadata,canBeInserted:!0});n.subjects.push(l),t.junctionEntityMetadata.ownerColumns.forEach(function(e){l.changeMaps.push({column:e,value:u})}),t.junctionEntityMetadata.inverseColumns.forEach(function(e){l.changeMaps.push({column:e,value:c})})}});var a=o.map(function(e){return t.inverseEntityMetadata.getEntityIdMap(e)}).filter(function(e){return void 0!==e&&null!==e});i.filter(function(e){return!a.find(function(r){return t.inverseEntityMetadata.compareIds(r,e)})}).forEach(function(i){var o=new r.Subject({metadata:t.junctionEntityMetadata,mustBeRemoved:!0,identifier:n.buildJunctionIdentifier(e,t,i)});n.subjects.push(o)})}},e.prototype.buildJunctionIdentifier=function(e,t,r){var i=t.isOwning?e.entity:r,o=t.isOwning?r:e.entity,a={};return t.junctionEntityMetadata.ownerColumns.forEach(function(e){n.OrmUtils.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(i)))}),t.junctionEntityMetadata.inverseColumns.forEach(function(e){n.OrmUtils.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(o)))}),a},e}(),e("ManyToManySubjectBuilder",i)}}}),System.register("typeorm/persistence/SubjectDatabaseEntityLoader",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e,t){this.queryRunner=e,this.subjects=t}return e.prototype.load=function(e){return __awaiter(this,void 0,void 0,function(){var t,r=this;return __generator(this,function(n){switch(n.label){case 0:return t=this.groupByEntityTargets().map(function(t){return __awaiter(r,void 0,void 0,function(){var r,n,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return r=[],t.subjects.forEach(function(e){e.databaseEntity||e.metadata.isEntityIdMapEmpty(e.entity)||r.push(e.metadata.getEntityIdMap(e.entity))}),r.length?(n=[],"save"===e?t.subjects.forEach(function(e){e.metadata.relations.filter(function(t){return void 0!==t.getEntityValue(e.entity)}).map(function(e){return e.propertyPath}).forEach(function(e){-1===n.indexOf(e)&&n.push(e)})}):n.push.apply(n,t.subjects[0].metadata.manyToManyRelations.map(function(e){return e.propertyPath})),i={loadRelationIds:{relations:n,disableMixedMap:!0}},[4,this.queryRunner.manager.getRepository(t.target).findByIds(r,i)]):[2];case 1:return(o=s.sent()).forEach(function(e){var r=a.findByPersistEntityLike(t.target,e);r&&(r.databaseEntity=e,r.identifier||(r.identifier=r.metadata.isEntityIdMapEmpty(e)?void 0:r.metadata.getEntityIdMap(e)))}),[2]}})})}),[4,Promise.all(t)];case 1:return n.sent(),[2]}})})},e.prototype.findByPersistEntityLike=function(e,t){return this.subjects.find(function(r){return!!r.entity&&(r.entity===t||r.metadata.target===e&&r.metadata.compareEntities(r.entity,t))})},e.prototype.groupByEntityTargets=function(){return this.subjects.reduce(function(e,t){var r=e.find(function(e){return e.target===t.metadata.target});return r||(r={target:t.metadata.target,subjects:[]},e.push(r)),r.subjects.push(t),e},[])},e}(),e("SubjectDatabaseEntityLoader",r)}}}),System.register("typeorm/persistence/subject-builder/CascadesSubjectBuilder",["typeorm/persistence/Subject"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e,t){this.subject=e,this.allSubjects=t}return e.prototype.build=function(){this.buildRecursively(this.subject)},e.prototype.buildRecursively=function(e){var t=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).forEach(function(e){var n=e[0],i=e[1],o=e[2];if(void 0!==i&&null!==i&&(n.isCascadeInsert||n.isCascadeUpdate)&&i instanceof Object){var a=t.findByPersistEntityLike(o.target,i);if(a)return!1===a.canBeInserted&&(a.canBeInserted=!0===n.isCascadeInsert),void(!1===a.canBeUpdated&&(a.canBeUpdated=!0===n.isCascadeUpdate));var s=new r.Subject({metadata:o,entity:i,canBeInserted:!0===n.isCascadeInsert,canBeUpdated:!0===n.isCascadeUpdate});t.allSubjects.push(s),t.buildRecursively(s)}})},e.prototype.findByPersistEntityLike=function(e,t){return this.allSubjects.find(function(r){return!!r.entity&&(r.entity===t||r.metadata.target===e&&r.metadata.compareEntities(r.entity,t))})},e}(),e("CascadesSubjectBuilder",n)}}}),System.register("typeorm/persistence/EntityPersistExecutor",["typeorm/error/MustBeEntityError","typeorm/persistence/SubjectExecutor","typeorm/error/CannotDetermineEntityError","typeorm/persistence/Subject","typeorm/persistence/subject-builder/OneToManySubjectBuilder","typeorm/persistence/subject-builder/OneToOneInverseSideSubjectBuilder","typeorm/persistence/subject-builder/ManyToManySubjectBuilder","typeorm/persistence/SubjectDatabaseEntityLoader","typeorm/persistence/subject-builder/CascadesSubjectBuilder","typeorm/util/OrmUtils","typeorm/util/PromiseUtils"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l,p,d,m;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e},function(e){d=e}],execute:function(){m=function(){function e(e,t,r,n,i,o){this.connection=e,this.queryRunner=t,this.mode=r,this.target=n,this.entity=i,this.options=o}return e.prototype.execute=function(){var e=this;return this.entity&&this.entity instanceof Object?Promise.resolve().then(function(){return __awaiter(e,void 0,void 0,function(){var e,t,r,m,f,h,y,g,v=this;return __generator(this,function(b){switch(b.label){case 0:e=this.queryRunner||this.connection.createQueryRunner("master"),this.options&&this.options.data&&(e.data=this.options.data),b.label=1;case 1:return b.trys.push([1,,15,18]),t=this.entity instanceof Array?this.entity:[this.entity],r=this.options&&this.options.chunk&&this.options.chunk>0?p.OrmUtils.chunk(t,this.options.chunk):[t],[4,Promise.all(r.map(function(t){return __awaiter(v,void 0,void 0,function(){var r,p=this;return __generator(this,function(d){switch(d.label){case 0:return r=[],t.forEach(function(e){var t=p.target?p.target:e.constructor;if(t===Object)throw new i.CannotDetermineEntityError(p.mode);r.push(new o.Subject({metadata:p.connection.getMetadata(t),entity:e,canBeInserted:"save"===p.mode,canBeUpdated:"save"===p.mode,mustBeRemoved:"remove"===p.mode}))}),r.forEach(function(e){new l.CascadesSubjectBuilder(e,r).build()}),[4,new c.SubjectDatabaseEntityLoader(e,r).load(this.mode)];case 1:return d.sent(),"save"===this.mode?(new a.OneToManySubjectBuilder(r).build(),new s.OneToOneInverseSideSubjectBuilder(r).build(),new u.ManyToManySubjectBuilder(r).build()):r.forEach(function(e){e.mustBeRemoved&&new u.ManyToManySubjectBuilder(r).buildForAllRemoval(e)}),[2,new n.SubjectExecutor(e,r,this.options)]}})})}))];case 2:if(m=b.sent(),0===(f=m.filter(function(e){return e.hasExecutableOperations})).length)return[2];h=!1,b.label=3;case 3:return b.trys.push([3,9,,14]),e.isTransactionActive?[3,5]:this.options&&!1===this.options.transaction?[3,5]:(h=!0,[4,e.startTransaction()]);case 4:b.sent(),b.label=5;case 5:return[4,d.PromiseUtils.runInSequence(f,function(e){return e.execute()})];case 6:return b.sent(),!0!==h?[3,8]:[4,e.commitTransaction()];case 7:b.sent(),b.label=8;case 8:return[3,14];case 9:if(y=b.sent(),!h)return[3,13];b.label=10;case 10:return b.trys.push([10,12,,13]),[4,e.rollbackTransaction()];case 11:return b.sent(),[3,13];case 12:return g=b.sent(),[3,13];case 13:throw y;case 14:return[3,18];case 15:return this.queryRunner?[3,17]:[4,e.release()];case 16:b.sent(),b.label=17;case 17:return[7];case 18:return[2]}})})}):Promise.reject(new r.MustBeEntityError(this.mode,this.entity))},e}(),e("EntityPersistExecutor",m)}}}),System.register("typeorm/entity-manager/EntityManager",["typeorm/error/EntityNotFoundError","typeorm/error/QueryRunnerProviderAlreadyReleasedError","typeorm/error/NoNeedToReleaseEntityManagerError","typeorm/repository/TreeRepository","typeorm/repository/Repository","typeorm/find-options/FindOptionsUtils","typeorm/query-builder/transformer/PlainObjectToNewEntityTransformer","typeorm/query-builder/transformer/PlainObjectToDatabaseEntityTransformer","typeorm/error/CustomRepositoryNotFoundError","typeorm/index","typeorm/repository/AbstractRepository","typeorm/error/CustomRepositoryCannotInheritRepositoryError","typeorm/driver/mongodb/MongoDriver","typeorm/error/RepositoryNotFoundError","typeorm/error/RepositoryNotTreeError","typeorm/repository/RepositoryFactory","typeorm/error/TreeRepositoryNotSupportedError","typeorm/persistence/EntityPersistExecutor"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l,p,d,m,f,h,y,g,v,b,E;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e},function(e){d=e},function(e){m=e},function(e){f=e},function(e){h=e},function(e){y=e},function(e){g=e},function(e){v=e},function(e){b=e}],execute:function(){E=function(){function e(e,t){this.repositories=[],this.plainObjectToEntityTransformer=new u.PlainObjectToNewEntityTransformer,this.connection=e,t&&(this.queryRunner=t,Object.assign(this.queryRunner,{manager:this}))}return e.prototype.transaction=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,i,o;return __generator(this,function(a){switch(a.label){case 0:if(this.connection.driver instanceof f.MongoDriver)throw new Error("Transactions aren't supported by MongoDB.");if(this.queryRunner&&this.queryRunner.isReleased)throw new n.QueryRunnerProviderAlreadyReleasedError;if(this.queryRunner&&this.queryRunner.isTransactionActive)throw new Error("Cannot start transaction because its already started");t=this.queryRunner||this.connection.createQueryRunner("master"),a.label=1;case 1:return a.trys.push([1,5,10,13]),[4,t.startTransaction()];case 2:return a.sent(),[4,e(t.manager)];case 3:return r=a.sent(),[4,t.commitTransaction()];case 4:return a.sent(),[2,r];case 5:i=a.sent(),a.label=6;case 6:return a.trys.push([6,8,,9]),[4,t.rollbackTransaction()];case 7:return a.sent(),[3,9];case 8:return o=a.sent(),[3,9];case 9:throw i;case 10:return this.queryRunner?[3,12]:[4,t.release()];case 11:a.sent(),a.label=12;case 12:return[7];case 13:return[2]}})})},e.prototype.query=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,this.connection.query(e,t,this.queryRunner)]})})},e.prototype.createQueryBuilder=function(e,t,r){return t?this.connection.createQueryBuilder(e,t,r||this.queryRunner):this.connection.createQueryBuilder(e||this.queryRunner)},e.prototype.hasId=function(e,t){var r=2===arguments.length?e:e.constructor,n=2===arguments.length?t:e;return this.connection.getMetadata(r).hasId(n)},e.prototype.getId=function(e,t){var r=2===arguments.length?e:e.constructor,n=2===arguments.length?t:e;return this.connection.getMetadata(r).getEntityIdMixedMap(n)},e.prototype.create=function(e,t){var r=this,n=this.connection.getMetadata(e);if(!t)return n.create();if(t instanceof Array)return t.map(function(t){return r.create(e,t)});var i=n.create();return this.plainObjectToEntityTransformer.transform(i,t,n,!0),i},e.prototype.merge=function(e,t){for(var r=this,n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o=this.connection.getMetadata(e);return n.forEach(function(e){return r.plainObjectToEntityTransformer.transform(t,e,o)}),t},e.prototype.preload=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i;return __generator(this,function(o){switch(o.label){case 0:return r=this.connection.getMetadata(e),n=new c.PlainObjectToDatabaseEntityTransformer(this.connection.manager),[4,n.transform(t,r)];case 1:return(i=o.sent())?[2,this.merge(e,i,t)]:[2,void 0]}})})},e.prototype.save=function(e,t,r){var n=arguments.length>1&&(e instanceof Function||"string"==typeof e)?e:void 0,i=n?t:e,o=n?r:t;return i instanceof Array&&0===i.length?Promise.resolve(i):new b.EntityPersistExecutor(this.connection,this.queryRunner,"save",n,i,o).execute().then(function(){return i})},e.prototype.remove=function(e,t,r){var n=arguments.length>1&&(e instanceof Function||"string"==typeof e)?e:void 0,i=n?t:e,o=n?r:t;return i instanceof Array&&0===i.length?Promise.resolve(i):new b.EntityPersistExecutor(this.connection,this.queryRunner,"remove",n,i,o).execute().then(function(){return i})},e.prototype.insert=function(e,t,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,this.createQueryBuilder().insert().into(e).values(t).execute()]})})},e.prototype.update=function(e,t,r,n){return"string"==typeof t||"number"==typeof t||t instanceof Date||t instanceof Array?this.createQueryBuilder().update(e).set(r).whereInIds(t).execute():this.createQueryBuilder().update(e).set(r).where(t).execute()},e.prototype.delete=function(e,t,r){return"string"==typeof t||"number"==typeof t||t instanceof Date||t instanceof Array?this.createQueryBuilder().delete().from(e).whereInIds(t).execute():this.createQueryBuilder().delete().from(e).where(t).execute()},e.prototype.count=function(e,t){var r=this.connection.getMetadata(e),n=this.createQueryBuilder(e,s.FindOptionsUtils.extractFindManyOptionsAlias(t)||r.name);return s.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(n,t).getCount()},e.prototype.find=function(e,t){var r=this.connection.getMetadata(e),n=this.createQueryBuilder(e,s.FindOptionsUtils.extractFindManyOptionsAlias(t)||r.name);return this.joinEagerRelations(n,n.alias,r),s.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(n,t).getMany()},e.prototype.findAndCount=function(e,t){var r=this.connection.getMetadata(e),n=this.createQueryBuilder(e,s.FindOptionsUtils.extractFindManyOptionsAlias(t)||r.name);return this.joinEagerRelations(n,n.alias,r),s.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(n,t).getManyAndCount()},e.prototype.findByIds=function(e,t,r){if(!t.length)return Promise.resolve([]);var n=this.connection.getMetadata(e),i=this.createQueryBuilder(e,s.FindOptionsUtils.extractFindManyOptionsAlias(r)||n.name);return s.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(i,r),this.joinEagerRelations(i,i.alias,n),i.andWhereInIds(t).getMany()},e.prototype.findOne=function(e,t,r){var n=this.connection.getMetadata(e),i=n.name;s.FindOptionsUtils.isFindOneOptions(t)&&t.join?i=t.join.alias:r&&s.FindOptionsUtils.isFindOneOptions(r)&&r.join&&(i=r.join.alias);var o=this.createQueryBuilder(e,i);return this.joinEagerRelations(o,o.alias,n),r&&s.FindOptionsUtils.applyOptionsToQueryBuilder(o,r),s.FindOptionsUtils.isFindOneOptions(t)?s.FindOptionsUtils.applyOptionsToQueryBuilder(o,t):t instanceof Object?o.where(t):("string"==typeof t||"number"==typeof t||t instanceof Date)&&o.andWhereInIds(n.ensureEntityIdMap(t)),o.getOne()},e.prototype.findOneOrFail=function(e,t,n){return this.findOne(e,t,n).then(function(n){return void 0===n?Promise.reject(new r.EntityNotFoundError(e,t)):Promise.resolve(n)})},e.prototype.clear=function(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(n){switch(n.label){case 0:t=this.connection.getMetadata(e),r=this.queryRunner||this.connection.createQueryRunner("master"),n.label=1;case 1:return n.trys.push([1,,3,6]),[4,r.truncate(t.tablePath)];case 2:return[2,n.sent()];case 3:return this.queryRunner?[3,5]:[4,r.release()];case 4:n.sent(),n.label=5;case 5:return[7];case 6:return[2]}})})},e.prototype.getRepository=function(e){if(!this.connection.hasMetadata(e))throw new h.RepositoryNotFoundError(this.connection.name,e);var t=this.connection.getMetadata(e),r=this.repositories.find(function(e){return e.metadata===t});if(r)return r;var n=(new g.RepositoryFactory).create(this,t,this.queryRunner);return this.repositories.push(n),n},e.prototype.getTreeRepository=function(e){if(!1===this.connection.driver.treeSupport)throw new v.TreeRepositoryNotSupportedError(this.connection.driver);var t=this.getRepository(e);if(!(t instanceof o.TreeRepository))throw new y.RepositoryNotTreeError(e);return t},e.prototype.getMongoRepository=function(e){return this.connection.getMongoRepository(e)},e.prototype.getCustomRepository=function(e){var t=p.getMetadataArgsStorage().entityRepositories.find(function(t){return t.target===(e instanceof Function?e:e.constructor)});if(!t)throw new l.CustomRepositoryNotFoundError(e);var r=t.entity?this.connection.getMetadata(t.entity):void 0,n=new t.target(this,r);if(n instanceof d.AbstractRepository&&(n.manager||(n.manager=this)),n instanceof a.Repository){if(!r)throw new m.CustomRepositoryCannotInheritRepositoryError(e);n.manager=this,n.metadata=r}return n},e.prototype.release=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(!this.queryRunner)throw new i.NoNeedToReleaseEntityManagerError;return[2,this.queryRunner.release()]})})},e.prototype.joinEagerRelations=function(e,t,r){var n=this;r.eagerRelations.forEach(function(r){var i=t+"_"+r.propertyPath.replace(".","_");e.leftJoinAndSelect(t+"."+r.propertyPath,i),n.joinEagerRelations(e,i,r.inverseEntityMetadata)})},e}(),e("EntityManager",E)}}}),System.register("typeorm/error/QueryFailedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(r,n,i){var o=e.call(this)||this;return o.message=i.toString().replace(/^error: /,"").replace(/^Error: /,"").replace(/^Request/,""),Object.setPrototypeOf(o,t.prototype),Object.assign(o,__assign({},i,{name:"QueryFailedError",query:r,parameters:n||[]})),o}return __extends(t,e),t}(Error),e("QueryFailedError",r)}}}),System.register("typeorm/driver/sqlserver/SqlServerQueryRunner",["typeorm/error/TransactionAlreadyStartedError","typeorm/error/TransactionNotStartedError","typeorm/schema-builder/schema/TableColumn","typeorm/schema-builder/schema/Table","typeorm/schema-builder/schema/TableForeignKey","typeorm/schema-builder/schema/TablePrimaryKey","typeorm/schema-builder/schema/TableIndex","typeorm/error/QueryRunnerAlreadyReleasedError","typeorm/driver/sqlserver/MssqlParameter","typeorm/error/QueryFailedError","typeorm/util/PromiseUtils","typeorm/subscriber/Broadcaster"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l,p,d,m,f;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e},function(e){d=e},function(e){m=e}],execute:function(){f=function(){function e(e,t){void 0===t&&(t="master"),this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.queryResponsibilityChain=[],this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.driver=e,this.connection=e.connection,this.broadcaster=new m.Broadcaster(this),this.mode=t}return e.prototype.connect=function(){return Promise.resolve()},e.prototype.release=function(){return this.isReleased=!0,Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;if(this.isTransactionActive)throw new r.TransactionAlreadyStartedError;return[2,new Promise(function(t,r){return __awaiter(e,void 0,void 0,function(){var e,n=this;return __generator(this,function(i){switch(i.label){case 0:return this.isTransactionActive=!0,[4,"slave"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return e=i.sent(),this.databaseConnection=e.transaction(),this.databaseConnection.begin(function(e){if(e)return n.isTransactionActive=!1,r(e);t()}),[2]}})})})]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;if(!this.isTransactionActive)throw new n.TransactionNotStartedError;return[2,new Promise(function(t,r){e.databaseConnection.commit(function(n){if(n)return r(n);e.isTransactionActive=!1,e.databaseConnection=null,t()})})]})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;if(!this.isTransactionActive)throw new n.TransactionNotStartedError;return[2,new Promise(function(t,r){e.databaseConnection.rollback(function(n){if(n)return r(n);e.isTransactionActive=!1,e.databaseConnection=null,t()})})]})})},e.prototype.mssqlParameterToNativeParameter=function(e){switch(this.driver.normalizeType({type:e.type})){case"bit":return this.driver.mssql.Bit;case"bigint":return this.driver.mssql.BigInt;case"decimal":return(t=this.driver.mssql).Decimal.apply(t,e.params);case"float":return this.driver.mssql.Float;case"int":return this.driver.mssql.Int;case"money":return this.driver.mssql.Money;case"numeric":return(r=this.driver.mssql).Numeric.apply(r,e.params);case"smallint":return this.driver.mssql.SmallInt;case"smallmoney":return this.driver.mssql.SmallMoney;case"real":return this.driver.mssql.Real;case"tinyint":return this.driver.mssql.TinyInt;case"char":return(n=this.driver.mssql).Char.apply(n,e.params);case"nchar":return(i=this.driver.mssql).NChar.apply(i,e.params);case"text":return this.driver.mssql.Text;case"ntext":return this.driver.mssql.Ntext;case"varchar":return(o=this.driver.mssql).VarChar.apply(o,e.params);case"nvarchar":return(a=this.driver.mssql).NVarChar.apply(a,e.params);case"xml":return this.driver.mssql.Xml;case"time":return(s=this.driver.mssql).Time.apply(s,e.params);case"date":return this.driver.mssql.Date;case"datetime":return this.driver.mssql.DateTime;case"datetime2":return(u=this.driver.mssql).DateTime2.apply(u,e.params);case"datetimeoffset":return(c=this.driver.mssql).DateTimeOffset.apply(c,e.params);case"smalldatetime":return this.driver.mssql.SmallDateTime;case"uniqueidentifier":return this.driver.mssql.UniqueIdentifier;case"variant":return this.driver.mssql.Variant;case"binary":return this.driver.mssql.Binary;case"varbinary":return(l=this.driver.mssql).VarBinary.apply(l,e.params);case"image":return this.driver.mssql.Image;case"udt":return this.driver.mssql.UDT;case"geography":return this.driver.mssql.Geography;case"geometry":return this.driver.mssql.Geometry}var t,r,n,i,o,a,s,u,c,l},e.prototype.query=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return n=new Promise(function(e){return r=e}),this.queryResponsibilityChain.length?(i=this.queryResponsibilityChain.slice(),this.queryResponsibilityChain.push(n),[4,Promise.all(i)]):[3,2];case 1:s.sent(),s.label=2;case 2:return o=new Promise(function(i,s){return __awaiter(a,void 0,void 0,function(){var a,u,c,d,m=this;return __generator(this,function(f){switch(f.label){case 0:return f.trys.push([0,2,,3]),this.driver.connection.logger.logQuery(e,t,this),[4,"slave"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return a=f.sent(),u=new this.driver.mssql.Request(this.isTransactionActive?this.databaseConnection:a),t&&t.length&&t.forEach(function(e,t){if(e instanceof l.MssqlParameter){var r=m.mssqlParameterToNativeParameter(e);r?u.input(t,r,e.value):u.input(t,e.value)}else u.input(t,e)}),c=+new Date,u.query(e,function(a,u){var l=m.driver.connection.options.maxQueryExecutionTime,d=+new Date-c;l&&d>l&&m.driver.connection.logger.logQuerySlow(d,e,t,m);var f=function(){-1!==h&&m.queryResponsibilityChain.splice(h,1),-1!==y&&m.queryResponsibilityChain.splice(y,1),r()},h=m.queryResponsibilityChain.indexOf(o),y=m.queryResponsibilityChain.indexOf(n);if(a)return m.driver.connection.logger.logQueryError(a,e,t,m),f(),s(new p.QueryFailedError(e,t,a));i(u.recordset),f()}),[3,3];case 2:return d=f.sent(),s(d),[3,3];case 3:return[2]}})})}),this.isTransactionActive&&this.queryResponsibilityChain.push(o),[2,o]}})})},e.prototype.stream=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u=this;return __generator(this,function(p){switch(p.label){case 0:if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return o=new Promise(function(e){return i=e}),this.queryResponsibilityChain.length?(a=this.queryResponsibilityChain.slice(),this.queryResponsibilityChain.push(o),[4,Promise.all(a)]):[3,2];case 1:p.sent(),p.label=2;case 2:return s=new Promise(function(a,c){return __awaiter(u,void 0,void 0,function(){var u,p,d=this;return __generator(this,function(m){switch(m.label){case 0:return this.driver.connection.logger.logQuery(e,t,this),[4,"slave"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return u=m.sent(),p=new this.driver.mssql.Request(this.isTransactionActive?this.databaseConnection:u),p.stream=!0,t&&t.length&&t.forEach(function(e,t){e instanceof l.MssqlParameter?p.input(t,d.mssqlParameterToNativeParameter(e),e.value):p.input(t,e)}),p.query(e,function(r,n){var u=function(){-1!==l&&d.queryResponsibilityChain.splice(l,1),-1!==p&&d.queryResponsibilityChain.splice(p,1),i()},l=d.queryResponsibilityChain.indexOf(s),p=d.queryResponsibilityChain.indexOf(o);if(r)return d.driver.connection.logger.logQueryError(r,e,t,d),u(),c(r);a(n.recordset),u()}),r&&p.on("done",r),n&&p.on("error",n),a(p),[2]}})})}),this.isTransactionActive&&this.queryResponsibilityChain.push(s),[2,s]}})})},e.prototype.insertIntoClosureTable=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:return i="",i=n?"INSERT INTO "+this.escapeTablePath(e)+'("ancestor", "descendant", "level") SELECT "ancestor", '+t+', "level" + 1 FROM '+this.escapeTablePath(e)+' WHERE "descendant" = '+r+" UNION ALL SELECT "+t+", "+t+", 1":"INSERT INTO "+this.escapeTablePath(e)+'("ancestor", "descendant") SELECT "ancestor", '+t+" FROM "+this.escapeTablePath(e)+' WHERE "descendant" = '+r+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),n?[4,this.query("SELECT MAX(level) as level FROM "+this.escapeTablePath(e)+" WHERE descendant = "+r)]:[3,3];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1];case 3:return[2,-1]}})})},e.prototype.getTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return[4,this.getTables([e])];case 1:return t=r.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.getTables=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,c,l,p,d,m,f,h,y,g,v,b,E,M,T=this;return __generator(this,function(_){switch(_.label){case 0:return e&&e.length?(t=e.map(function(e){return 3===e.split(".").length?e.split(".")[2]:2===e.split(".").length?e.split(".")[1]:e}),r=[],e.filter(function(e){return-1!==e.indexOf(".")}).forEach(function(e){3===e.split(".").length?""!==e.split(".")[1]&&r.push(e.split(".")[1]):r.push(e.split(".")[0])}),r.push(this.driver.options.schema||"SCHEMA_NAME()"),n=e.filter(function(e){return 3===e.split(".").length}).map(function(e){return e.split(".")[0]}),this.driver.database&&!n.find(function(e){return e===T.driver.database})&&n.push(this.driver.database),c=r.map(function(e){return"SCHEMA_NAME()"===e?e:"'"+e+"'"}).join(", "),l=t.map(function(e){return"'"+e+"'"}).join(", "),p=n.map(function(e){return"SELECT * FROM "+e+".INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME IN ("+l+") AND TABLE_SCHEMA IN ("+c+")"}).join(" UNION ALL "),d=n.map(function(e){return"SELECT * FROM "+e+".INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA IN ("+c+")"}).join(" UNION ALL "),m=n.map(function(e){return"SELECT columnUsages.*, tableConstraints.CONSTRAINT_TYPE FROM "+e+".INFORMATION_SCHEMA.KEY_COLUMN_USAGE columnUsages LEFT JOIN "+e+".INFORMATION_SCHEMA.TABLE_CONSTRAINTS tableConstraints ON tableConstraints.CONSTRAINT_NAME = columnUsages.CONSTRAINT_NAME WHERE columnUsages.TABLE_SCHEMA IN ("+c+") AND tableConstraints.TABLE_SCHEMA IN ("+c+")"}).join(" UNION ALL "),f=n.map(function(e){return"SELECT COLUMN_NAME, TABLE_NAME FROM "+e+".INFORMATION_SCHEMA.COLUMNS WHERE COLUMNPROPERTY(object_id(TABLE_SCHEMA + '.' + TABLE_NAME), COLUMN_NAME, 'IsIdentity') = 1 AND TABLE_SCHEMA IN ("+c+")"}).join(" UNION ALL "),h=n.map(function(e){return"SELECT TABLE_NAME = t.name, INDEX_NAME = ind.name, IndexId = ind.index_id, ColumnId = ic.index_column_id, \n                    COLUMN_NAME = col.name, IS_UNIQUE = ind.is_unique, ind.*, ic.*, col.* \n                    FROM "+e+".sys.indexes ind \n                    INNER JOIN "+e+".sys.index_columns ic ON ind.object_id = ic.object_id and ind.index_id = ic.index_id\n                    INNER JOIN "+e+".sys.columns col ON ic.object_id = col.object_id and ic.column_id = col.column_id \n                    INNER JOIN "+e+".sys.tables t ON ind.object_id = t.object_id WHERE ind.is_primary_key = 0 \n                    AND ind.is_unique_constraint = 0 AND t.is_ms_shipped = 0"}).join(" UNION ALL "),[4,Promise.all([this.query(p),this.query(d),this.query(m),this.query(f),this.query(h)])]):[2,[]];case 1:return y=_.sent(),g=y[0],v=y[1],b=y[2],E=y[3],M=y[4],g.length?[2,Promise.all(g.map(function(e){return __awaiter(T,void 0,void 0,function(){var t;return __generator(this,function(r){return t=new o.Table(e.TABLE_NAME),t.database=e.TABLE_CATALOG,t.schema=e.TABLE_SCHEMA,t.columns=v.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var r=!!b.find(function(r){return r.TABLE_NAME===t.name&&r.COLUMN_NAME===e.COLUMN_NAME&&"PRIMARY KEY"===r.CONSTRAINT_TYPE}),n=!!E.find(function(r){return r.TABLE_NAME===t.name&&r.COLUMN_NAME===e.COLUMN_NAME}),o=!!b.find(function(r){return r.TABLE_NAME===t.name&&r.COLUMN_NAME===e.COLUMN_NAME&&"UNIQUE"===r.CONSTRAINT_TYPE}),a=new i.TableColumn;return a.name=e.COLUMN_NAME,a.type=e.DATA_TYPE.toLowerCase(),a.length=e.CHARACTER_MAXIMUM_LENGTH?e.CHARACTER_MAXIMUM_LENGTH.toString():"","-1"===a.length&&(a.length="MAX"),a.precision=e.NUMERIC_PRECISION,a.scale=e.NUMERIC_SCALE,a.default=null!==e.COLUMN_DEFAULT&&void 0!==e.COLUMN_DEFAULT?e.COLUMN_DEFAULT:void 0,a.isNullable="YES"===e.IS_NULLABLE,a.isPrimary=r,a.isGenerated=n,"(newsequentialid())"===a.default&&(a.isGenerated=!0,a.default=void 0),a.isUnique=o,a.charset=e.CHARACTER_SET_NAME,a.collation=e.COLLATION_NAME,a.comment="","datetime2"!==a.type&&"time"!==a.type&&"datetimeoffset"!==a.type||(a.precision=e.DATETIME_PRECISION),a}),t.primaryKeys=b.filter(function(e){return e.TABLE_NAME===t.name&&"PRIMARY KEY"===e.CONSTRAINT_TYPE}).map(function(e){return new s.TablePrimaryKey(e.CONSTRAINT_NAME,e.COLUMN_NAME)}),t.foreignKeys=b.filter(function(e){return e.TABLE_NAME===t.name&&"FOREIGN KEY"===e.CONSTRAINT_TYPE}).map(function(e){return new a.TableForeignKey(e.CONSTRAINT_NAME,[],[],"","")}),t.indices=M.filter(function(e){return e.TABLE_NAME===t.name&&!t.foreignKeys.find(function(t){return t.name===e.INDEX_NAME})&&!t.primaryKeys.find(function(t){return t.name===e.INDEX_NAME})}).map(function(e){return e.INDEX_NAME}).filter(function(e,t,r){return r.indexOf(e)===t}).map(function(r){var n=M.filter(function(e){return e.TABLE_NAME===t.name&&e.INDEX_NAME===r}).map(function(e){return e.COLUMN_NAME}),i=!!M.find(function(e){return e.TABLE_NAME===t.name&&e.INDEX_NAME===r&&!0===e.IS_UNIQUE});return new u.TableIndex(e.TABLE_NAME,r,n,i)}),[2,t]})})}))]:[2,[]]}})})},e.prototype.hasDatabase=function(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(n){switch(n.label){case 0:return[4,this.query("SELECT DB_ID('"+e+"') as db_id")];case 1:return t=n.sent(),r=t[0].db_id,[2,!!r]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n;return __generator(this,function(i){switch(i.label){case 0:return t=this.parseTablePath(e),r="SELECT * FROM "+t.database+".INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = '"+t.schema+"' AND TABLE_SCHEMA = '"+t.tableName+"'",[4,this.query(r)];case 1:return n=i.sent(),[2,!!n.length]}})})},e.prototype.createDatabase=function(e){return this.query("IF DB_ID('"+e+"') IS NULL CREATE DATABASE "+e)},e.prototype.createSchema=function(e){var t=this;return this.driver.options.schema&&e.push(this.driver.options.schema),d.PromiseUtils.runInSequence(e,function(e){return __awaiter(t,void 0,void 0,function(){var t,r,n,i,o;return __generator(this,function(a){switch(a.label){case 0:return-1!==e.indexOf(".")?[3,1]:(o="IF SCHEMA_ID('"+e+"') IS NULL BEGIN EXEC sp_executesql N'CREATE SCHEMA "+e+"' END",[2,this.query(o)]);case 1:return t=e.split(".")[0],r=e.split(".")[1],[4,this.query("SELECT DB_NAME() AS db_name")];case 2:return n=a.sent(),i=n[0].db_name,[4,this.query("USE "+t)];case 3:return a.sent(),o="IF SCHEMA_ID('"+r+"') IS NULL BEGIN EXEC sp_executesql N'CREATE SCHEMA "+r+"' END",[4,this.query(o)];case 4:return a.sent(),[2,this.query("USE "+i)]}})})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,i=this;return __generator(this,function(o){switch(o.label){case 0:return t=e.columns.map(function(t){return i.buildCreateColumnSql(e.name,t,!1,!0)}).join(", "),r="CREATE TABLE "+this.escapeTablePath(e)+" ("+t,r+=e.columns.filter(function(e){return e.isUnique}).map(function(t){var r=e.name+"_"+t.name,n=e.schema||i.driver.options.schema;return n&&(r=n+"_"+r),', CONSTRAINT "uk_'+r+'" UNIQUE ("'+t.name+'")'}).join(" "),(n=e.columns.filter(function(e){return e.isPrimary})).length>0&&(r+=", PRIMARY KEY("+n.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),r+=")",[4,this.query(r)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("DROP TABLE "+this.escapeTablePath(e))];case 1:return t.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i;return __generator(this,function(o){switch(o.label){case 0:return r=this.parseTablePath(e),n="SELECT * FROM "+r.database+".INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = '"+r.tableName+"' AND COLUMN_NAME = '"+t+"' AND TABLE_SCHEMA = '"+r.schema+"'",[4,this.query(n)];case 1:return i=o.sent(),[2,!!i.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){return r=e instanceof o.Table?e.name:this.parseTablePath(e).tableName,n="ALTER TABLE "+this.escapeTablePath(e)+" ADD "+this.buildCreateColumnSql(r,t,!1,!0),[2,this.query(n)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return n.addColumn(e,t)}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var n,a,s;return __generator(this,function(u){switch(u.label){case 0:return n=void 0,e instanceof o.Table?(n=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:n=u.sent(),u.label=3;case 3:if(!n)throw new Error("Table "+e+" was not found.");if(a=void 0,!(a=t instanceof i.TableColumn?t:n.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,r instanceof i.TableColumn?s=r:(s=a.clone()).name=r,[2,this.changeColumn(n,a,s)]}})})},e.prototype.changeColumn=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var n,a,s;return __generator(this,function(u){switch(u.label){case 0:return n=void 0,e instanceof o.Table?(n=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:n=u.sent(),u.label=3;case 3:if(!n)throw new Error("Table "+e+" was not found.");if(a=void 0,!(a=t instanceof i.TableColumn?t:n.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return r.isGenerated===a.isGenerated?[3,6]:[4,this.query("ALTER TABLE "+this.escapeTablePath(e)+' DROP COLUMN "'+r.name+'"')];case 4:return u.sent(),[4,this.query("ALTER TABLE "+this.escapeTablePath(e)+" ADD "+this.buildCreateColumnSql(n.name,r,!1,!1))];case 5:u.sent(),u.label=6;case 6:return s="ALTER TABLE "+this.escapeTablePath(e)+" ALTER COLUMN "+this.buildCreateColumnSql(n.name,r,!0,!1),[4,this.query(s)];case 7:return u.sent(),r.isUnique===a.isUnique?[3,11]:!0!==r.isUnique?[3,9]:[4,this.query("ALTER TABLE "+this.escapeTablePath(e)+' ADD CONSTRAINT "uk_'+n.name+"_"+r.name+'" UNIQUE ("'+r.name+'")')];case 8:return u.sent(),[3,11];case 9:return!1!==r.isUnique?[3,11]:[4,this.query("ALTER TABLE "+this.escapeTablePath(e)+' DROP CONSTRAINT "uk_'+n.name+"_"+r.name+'"')];case 10:u.sent(),u.label=11;case 11:return r.default===a.default?[3,16]:null===r.default||void 0===r.default?[3,14]:[4,this.query("ALTER TABLE "+this.escapeTablePath(e)+' DROP CONSTRAINT "df_'+n.name+"_"+r.name+'"')];case 12:return u.sent(),[4,this.query("ALTER TABLE "+this.escapeTablePath(e)+' ADD CONSTRAINT "df_'+n.name+"_"+r.name+'" DEFAULT '+r.default+' FOR "'+r.name+'"')];case 13:return u.sent(),[3,16];case 14:return null===a.default||void 0===a.default?[3,16]:[4,this.query("ALTER TABLE "+this.escapeTablePath(e)+' DROP CONSTRAINT "df_'+n.name+"_"+r.name+'"')];case 15:u.sent(),u.label=16;case 16:return[2]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(r){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return t.default?[4,this.query("ALTER TABLE "+this.escapeTablePath(e)+' DROP CONSTRAINT "df_'+e.name+"_"+t.name+'"')]:[3,2];case 1:r.sent(),r.label=2;case 2:return[4,this.query("ALTER TABLE "+this.escapeTablePath(e)+' DROP COLUMN "'+t.name+'"')];case 3:return r.sent(),[2]}})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return n.dropColumn(e,t)}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,i,o;return __generator(this,function(a){switch(a.label){case 0:return t=e.schema||"SCHEMA_NAME()",r=e.database||this.driver.database,n="SELECT columnUsages.*, tableConstraints.CONSTRAINT_TYPE FROM "+r+".INFORMATION_SCHEMA.KEY_COLUMN_USAGE columnUsages\nLEFT JOIN "+r+".INFORMATION_SCHEMA.TABLE_CONSTRAINTS tableConstraints ON tableConstraints.CONSTRAINT_NAME = columnUsages.CONSTRAINT_NAME AND tableConstraints.CONSTRAINT_TYPE = 'PRIMARY KEY'\nWHERE tableConstraints.TABLE_CATALOG = '"+r+"' AND columnUsages.TABLE_SCHEMA = '"+t+"' AND tableConstraints.TABLE_SCHEMA = '"+t+"'",[4,this.query(n)];case 1:return(i=a.sent()).length>0?[4,this.query("ALTER TABLE "+this.escapeTablePath(e)+' DROP CONSTRAINT "'+i[0].CONSTRAINT_NAME+'"')]:[3,3];case 2:a.sent(),a.label=3;case 3:return(o=e.primaryKeys.map(function(e){return'"'+e.columnName+'"'})).length>0?[4,this.query("ALTER TABLE "+this.escapeTablePath(e)+" ADD PRIMARY KEY ("+o.join(", ")+")")]:[3,5];case 4:a.sent(),a.label=5;case 5:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i;return __generator(this,function(o){return r=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),n=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(","),i="ALTER TABLE "+this.escapeTablePath(e)+' ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+") REFERENCES "+this.escapeTablePath(t.referencedTablePath)+"("+n+")",t.onDelete&&(i+=" ON DELETE "+t.onDelete),[2,this.query(i)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return n.createForeignKey(e,t)}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){return r="ALTER TABLE "+this.escapeTablePath(e)+' DROP CONSTRAINT "'+t.name+'"',[2,this.query(r)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return n.dropForeignKey(e,t)}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){switch(i.label){case 0:return r=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),n="CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON '+this.escapeTablePath(e)+"("+r+")",[4,this.query(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return r='DROP INDEX "'+t+'" ON '+this.escapeTablePath(e),[4,this.query(r)];case 1:return n.sent(),[2]}})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.escapeTablePath(e))];case 1:return t.sent(),[2]}})})},e.prototype.clearDatabase=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return[4,this.hasDatabase(t)];case 1:return(r=c.sent())?(e||(e=[]),e.push(this.driver.options.schema||"SCHEMA_NAME()"),n=e.map(function(e){return"SCHEMA_NAME()"===e?e:"'"+e+"'"}).join(", "),[4,this.startTransaction()]):[2,Promise.resolve()];case 2:c.sent(),c.label=3;case 3:return c.trys.push([3,8,,13]),i="SELECT * FROM "+t+".INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_SCHEMA IN ("+n+")",[4,this.query(i)];case 4:return o=c.sent(),[4,Promise.all(o.map(function(e){return __awaiter(u,void 0,void 0,function(){var r,n,i=this;return __generator(this,function(o){switch(o.label){case 0:return r="SELECT 'ALTER TABLE \""+t+"\".\"' + OBJECT_SCHEMA_NAME(fk.parent_object_id, DB_ID('"+t+"')) + '\".\"' + OBJECT_NAME(fk.parent_object_id, DB_ID('"+t+"')) + '\" DROP CONSTRAINT \"' + fk.name + '\"' as query FROM "+t+".sys.foreign_keys AS fk WHERE fk.referenced_object_id = object_id('\""+t+'"."'+e.TABLE_SCHEMA+'"."'+e.TABLE_NAME+"\"')",[4,this.query(r)];case 1:return n=o.sent(),[2,Promise.all(n.map(function(e){return e.query}).map(function(e){return i.query(e)}))]}})})}))];case 5:return c.sent(),[4,Promise.all(o.map(function(e){var t='DROP TABLE "'+e.TABLE_CATALOG+'"."'+e.TABLE_SCHEMA+'"."'+e.TABLE_NAME+'"';return u.query(t)}))];case 6:return c.sent(),[4,this.commitTransaction()];case 7:return c.sent(),[3,13];case 8:a=c.sent(),c.label=9;case 9:return c.trys.push([9,11,,12]),[4,this.rollbackTransaction()];case 10:return c.sent(),[3,12];case 11:return s=c.sent(),[3,12];case 12:throw a;case 13:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},e.prototype.escapeTablePath=function(e,t){var r;if(e instanceof o.Table){var n=e.schema||this.driver.options.schema;n?(r=n+"."+e.name,e.database&&(r=e.database+"."+r)):(r=e.name,e.database&&(r=e.database+".."+r))}else r=-1===e.indexOf(".")&&this.driver.options.schema?this.driver.options.schema+"."+e:e;return r.split(".").map(function(e){return""===e?e:t?e:'"'+e+'"'}).join(".")},e.prototype.parseTablePath=function(e){return 3===e.split(".").length?{database:"'"+e.split(".")[0]+"'",schema:""===e.split(".")[1]?"SCHEMA_NAME()":"'"+e.split(".")[1]+"'",tableName:"'"+e.split(".")[2]+"'"}:2===e.split(".").length?{database:this.driver.options.database,schema:"'"+e.split(".")[1]+"'",tableName:"'"+e.split(".")[2]+"'"}:{database:this.driver.options.database,schema:this.driver.options.schema?"'"+this.driver.options.schema+"'":"SCHEMA_NAME()",tableName:e}},e.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,r){return'"'+e+'"=@'+(t+r)})},e.prototype.buildCreateColumnSql=function(e,t,r,n){var i='"'+t.name+'" '+this.connection.driver.createFullType(t);return t.collation&&(i+=" COLLATE "+t.collation),!0!==t.isNullable&&(i+=" NOT NULL"),!0!==t.isGenerated||"increment"!==t.generationStrategy||r||(i+=" IDENTITY(1,1)"),t.comment&&(i+=" COMMENT '"+t.comment+"'"),n&&void 0!==t.default&&null!==t.default&&(i+=' CONSTRAINT "df_'+e+"_"+t.name+'" DEFAULT '+t.default),t.isGenerated&&"uuid"===t.generationStrategy&&!t.default&&(i+=" DEFAULT NEWSEQUENTIALID()"),i},e}(),e("SqlServerQueryRunner",f)}}}),System.register("typeorm/schema-builder/RdbmsSchemaBuilder",["typeorm/schema-builder/schema/Table","typeorm/schema-builder/schema/TableColumn","typeorm/schema-builder/schema/TableForeignKey","typeorm/schema-builder/schema/TableIndex","typeorm/schema-builder/schema/TablePrimaryKey","typeorm/util/PromiseUtils"],function(e,t){"use strict";var r,n,i,o,a,s,u;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(){function e(e){this.connection=e}return e.prototype.build=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n;return __generator(this,function(i){switch(i.label){case 0:return e=this,[4,this.connection.createQueryRunner("master")];case 1:return e.queryRunner=i.sent(),[4,this.createNewDatabases()];case 2:return i.sent(),[4,this.queryRunner.startTransaction()];case 3:i.sent(),i.label=4;case 4:return i.trys.push([4,10,15,17]),t=this,[4,this.loadTableSchemas()];case 5:return t.tables=i.sent(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 6:return i.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,8];case 7:i.sent(),i.label=8;case 8:return[4,this.queryRunner.commitTransaction()];case 9:return i.sent(),[3,17];case 10:r=i.sent(),i.label=11;case 11:return i.trys.push([11,13,,14]),[4,this.queryRunner.rollbackTransaction()];case 12:return i.sent(),[3,14];case 13:return n=i.sent(),[3,14];case 14:throw r;case 15:return[4,this.queryRunner.release()];case 16:return i.sent(),[7];case 17:return[2]}})})},e.prototype.log=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:return e=this,[4,this.connection.createQueryRunner("master")];case 1:e.queryRunner=r.sent(),r.label=2;case 2:return r.trys.push([2,,8,10]),[4,this.createNewDatabases()];case 3:return r.sent(),t=this,[4,this.loadTableSchemas()];case 4:return t.tables=r.sent(),this.queryRunner.enableSqlMemory(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 5:return r.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,7];case 6:r.sent(),r.label=7;case 7:return[2,this.queryRunner.getMemorySql()];case 8:return this.queryRunner.disableSqlMemory(),[4,this.queryRunner.release()];case 9:return r.sent(),[7];case 10:return[2]}})})},e.prototype.loadTableSchemas=function(){var e=this.entityToSyncMetadatas.map(function(e){return e.tablePath});return this.queryRunner.getTables(e)},Object.defineProperty(e.prototype,"entityToSyncMetadatas",{get:function(){return this.connection.entityMetadatas.filter(function(e){return!e.skipSync&&"single-table-child"!==e.tableType})},enumerable:!0,configurable:!0}),e.prototype.createNewDatabases=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(r){switch(r.label){case 0:return e=[],this.connection.entityMetadatas.forEach(function(t){t.database&&-1===e.indexOf(t.database)&&e.push(t.database)}),[4,Promise.all(e.map(function(e){return t.queryRunner.createDatabase(e)}))];case 1:return r.sent(),[2]}})})},e.prototype.executeSchemaSyncOperationsInProperOrder=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=[],this.connection.entityMetadatas.filter(function(e){return!!e.schemaPath}).forEach(function(t){e.find(function(e){return e===t.schemaPath})||e.push(t.schemaPath)}),[4,this.queryRunner.createSchema(e)];case 1:return t.sent(),[4,this.dropOldForeignKeys()];case 2:return t.sent(),[4,this.createNewTables()];case 3:return t.sent(),[4,this.dropRemovedColumns()];case 4:return t.sent(),[4,this.addNewColumns()];case 5:return t.sent(),[4,this.updateExistColumns()];case 6:return t.sent(),[4,this.updatePrimaryKeys()];case 7:return t.sent(),[4,this.createIndices()];case 8:return t.sent(),[4,this.createForeignKeys()];case 9:return t.sent(),[2]}})})},e.prototype.dropOldForeignKeys=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,r;return __generator(this,function(n){switch(n.label){case 0:return(e=this.tables.find(function(e){return e.name===t.tableName}))?0===(r=e.foreignKeys.filter(function(e){return!t.foreignKeys.find(function(t){return t.name===e.name})})).length?[2]:(this.connection.logger.logSchemaBuild("dropping old foreign keys of "+e.name+": "+r.map(function(e){return e.name}).join(", ")),e.removeForeignKeys(r),[4,this.queryRunner.dropForeignKeys(e,r)]):[2];case 1:return n.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.createNewTables=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n;return __generator(this,function(i){switch(i.label){case 0:return(e=this.tables.find(function(e){return e.name===t.tableName&&((!t.schema||e.schema===t.schema)&&(!t.database||e.database===t.database))}))?[2]:(this.connection.logger.logSchemaBuild("creating a new table: "+t.tableName),n=new r.Table(t.tableName,this.metadataColumnsToTableColumns(t.columns),!0,t.engine,t.database,t.schema),this.tables.push(n),[4,this.queryRunner.createTable(n)]);case 1:return i.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.dropRemovedColumns=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,r,n=this;return __generator(this,function(i){switch(i.label){case 0:return(e=this.tables.find(function(e){return e.name===t.tableName}))?0===(r=e.columns.filter(function(e){return!t.columns.find(function(t){return t.databaseName===e.name})})).length?[2]:[4,Promise.all(r.map(function(e){return n.dropColumnReferencedForeignKeys(t.tableName,e.name)}))]:[2];case 1:return i.sent(),[4,Promise.all(r.map(function(e){return n.dropColumnReferencedIndices(t.tableName,e.name)}))];case 2:return i.sent(),this.connection.logger.logSchemaBuild("columns dropped in "+e.name+": "+r.map(function(e){return e.name}).join(", ")),e.removeColumns(r),e.removePrimaryKeysOfColumns(r),[4,this.queryRunner.dropColumns(e,r)];case 3:return i.sent(),[2]}})})})},e.prototype.addNewColumns=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,r,n;return __generator(this,function(i){switch(i.label){case 0:return(e=this.tables.find(function(e){return e.name===t.tableName}))?0===(r=t.columns.filter(function(t){return!e.columns.find(function(e){return e.name===t.databaseName})})).length?[2]:(this.connection.logger.logSchemaBuild("new columns added: "+r.map(function(e){return e.databaseName}).join(", ")),n=this.metadataColumnsToTableColumns(r),[4,this.queryRunner.addColumns(e,n)]):[2];case 1:return i.sent(),e.addColumns(n),[2]}})})})},e.prototype.updateExistColumns=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,r,i,o,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return(e=this.tables.find(function(e){return e.name===t.tableName}))?0===(r=e.findChangedColumns(this.connection.driver,t.columns)).length?[2]:(this.connection.logger.logSchemaBuild("columns changed in "+e.name+". updating: "+r.map(function(e){return e.name}).join(", ")),i=r.filter(function(e){return!!t.columns.find(function(t){return t.databaseName===e.name})}).map(function(e){return s.dropColumnReferencedForeignKeys(t.tableName,e.name)}),[4,Promise.all(i)]):[2];case 1:return u.sent(),o=r.filter(function(e){return!!t.columns.find(function(t){return t.databaseName===e.name})}).map(function(e){return s.dropColumnReferencedIndices(t.tableName,e.name)}),[4,Promise.all(o)];case 2:return u.sent(),a=r.map(function(r){var i=t.columns.find(function(e){return e.databaseName===r.name}),o=n.TableColumn.create(i,s.connection.driver.normalizeType(i),s.connection.driver.normalizeDefault(i),s.connection.driver.getColumnLength(i));return e.replaceColumn(r,o),{newColumn:o,oldColumn:r}}),[2,this.queryRunner.changeColumns(e,a)]}})})})},e.prototype.updatePrimaryKeys=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,r,n,i;return __generator(this,function(o){switch(o.label){case 0:return(e=this.tables.find(function(e){return e.name===t.tableName&&!e.justCreated}))?(r=t.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}),n=r.filter(function(t){return!e.primaryKeysWithoutGenerated.find(function(e){return e.columnName===t.databaseName})}).map(function(e){return new a.TablePrimaryKey("",e.databaseName)}),i=e.primaryKeysWithoutGenerated.filter(function(e){return!r.find(function(t){return t.databaseName===e.columnName})}),0===n.length&&0===i.length?[2]:(this.connection.logger.logSchemaBuild("primary keys of "+e.name+" has changed: dropped - "+(i.map(function(e){return e.columnName}).join(", ")||"nothing")+"; added - "+(n.map(function(e){return e.columnName}).join(", ")||"nothing")),e.addPrimaryKeys(n),e.removePrimaryKeys(i),[4,this.queryRunner.updatePrimaryKeys(e)])):[2];case 1:return o.sent(),[2]}})})})},e.prototype.createForeignKeys=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,r,n;return __generator(this,function(o){switch(o.label){case 0:return(e=this.tables.find(function(e){return e.name===t.tableName}))?0===(r=t.foreignKeys.filter(function(t){return!e.foreignKeys.find(function(e){return e.name===t.name})})).length?[2]:(n=r.map(function(e){return i.TableForeignKey.create(e)}),this.connection.logger.logSchemaBuild("creating a foreign keys: "+r.map(function(e){return e.name}).join(", ")),[4,this.queryRunner.createForeignKeys(e,n)]):[2];case 1:return o.sent(),e.addForeignKeys(n),[2]}})})})},e.prototype.createIndices=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,r,n,i=this;return __generator(this,function(a){switch(a.label){case 0:return(e=this.tables.find(function(e){return e.name===t.tableName}))?(r=e.indices.filter(function(e){var r=t.indices.find(function(t){return t.name===e.name});return!r||(r.isUnique!==e.isUnique||(r.columns.length!==e.columnNames.length||-1!==r.columns.findIndex(function(t,r){return t.databaseName!==e.columnNames[r]})))}).map(function(r){return __awaiter(i,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return this.connection.logger.logSchemaBuild("dropping an index: "+r.name),e.removeIndex(r),[4,this.queryRunner.dropIndex(t.tablePath,r.name)];case 1:return n.sent(),[2]}})})}),[4,Promise.all(r)]):[2];case 1:return a.sent(),n=t.indices.filter(function(t){return!e.indices.find(function(e){return e.name===t.name})}).map(function(t){return __awaiter(i,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return r=o.TableIndex.create(t),e.indices.push(r),this.connection.logger.logSchemaBuild("adding new index: "+r.name),[4,this.queryRunner.createIndex(e,r)];case 1:return n.sent(),[2]}})})}),[4,Promise.all(n)];case 2:return a.sent(),[2]}})})})},e.prototype.dropColumnReferencedIndices=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return(r=this.tables.find(function(t){return t.name===e}))?0===(n=r.indices.filter(function(r){return r.tableName===e&&!!r.columnNames.find(function(e){return e===t})})).length?[2]:(this.connection.logger.logSchemaBuild("dropping related indices of "+e+"#"+t+": "+n.map(function(e){return e.name}).join(", ")),i=n.map(function(e){return r.removeIndex(e),o.queryRunner.dropIndex(r,e.name)}),[4,Promise.all(i)]):[2];case 1:return a.sent(),[2]}})})},e.prototype.dropColumnReferencedForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return r=this.connection.entityMetadatas.reduce(function(e,t){return e.concat(t.foreignKeys)},[]),(n=this.tables.find(function(t){return t.name===e}))?(o=r.filter(function(r){return r.tableName===e?!!r.columns.find(function(e){return e.databaseName===t}):r.referencedTableName===e&&!!r.referencedColumns.find(function(e){return e.databaseName===t})})).length?0===(a=o.filter(function(e){return!!n.foreignKeys.find(function(t){return t.name===e.name})})).length?[2]:(this.connection.logger.logSchemaBuild("dropping related foreign keys of "+e+"#"+t+": "+a.map(function(e){return e.name}).join(", ")),s=a.map(function(e){return i.TableForeignKey.create(e)}),n.removeForeignKeys(s),[4,this.queryRunner.dropForeignKeys(n,s)]):[2]:[2];case 1:return u.sent(),[2]}})})},e.prototype.metadataColumnsToTableColumns=function(e){var t=this;return e.map(function(e){return n.TableColumn.create(e,t.connection.driver.normalizeType(e),t.connection.driver.normalizeDefault(e),t.connection.driver.getColumnLength(e))})},e}(),e("RdbmsSchemaBuilder",u)}}}),System.register("typeorm/query-builder/ArrayParameter",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){return function(e){this.value=e}}(),e("ArrayParameter",r)}}}),System.register("typeorm/driver/sqlserver/SqlServerDriver",["typeorm/error/ConnectionIsNotSetError","typeorm/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/driver/sqlserver/SqlServerQueryRunner","typeorm/util/DateUtils","typeorm/platform/PlatformTools","typeorm/schema-builder/RdbmsSchemaBuilder","typeorm/driver/sqlserver/MssqlParameter","typeorm/util/OrmUtils","typeorm/query-builder/ArrayParameter"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l,p,d;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e}],execute:function(){d=function(){function e(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["bigint","bit","decimal","int","money","numeric","smallint","smallmoney","tinyint","float","real","date","datetime2","datetime","datetimeoffset","smalldatetime","time","char","text","varchar","nchar","ntext","nvarchar","binary","image","varbinary","cursor","hierarchyid","sql_variant","table","timestamp","uniqueidentifier","xml"],this.withLengthColumnTypes=["char","varchar","nchar","nvarchar","binary","varbinary"],this.mappedDataTypes={createDate:"datetime2",createDateDefault:"getdate()",updateDate:"datetime2",updateDateDefault:"getdate()",version:"int",treeLevel:"int",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"nvarchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"nvarchar(MAX)",cacheResult:"nvarchar(MAX)"},this.dataTypeDefaults={varchar:{length:255},nvarchar:{length:255}},this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n=this;return __generator(this,function(i){switch(i.label){case 0:return this.options.replication?(e=this,[4,Promise.all(this.options.replication.slaves.map(function(e){return n.createPool(n.options,e)}))]):[3,3];case 1:return e.slaves=i.sent(),t=this,[4,this.createPool(this.options,this.options.replication.master)];case 2:return t.master=i.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return r=this,[4,this.createPool(this.options,this.options)];case 4:r.master=i.sent(),this.database=this.options.database,i.label=5;case 5:return[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.master?(this.master.close(),this.slaves.forEach(function(e){return e.close()}),this.master=void 0,this.slaves=[],[2]):[2,Promise.reject(new r.ConnectionIsNotSetError("mssql"))]})})},e.prototype.createSchemaBuilder=function(){return new u.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new o.SqlServerQueryRunner(this,e)},e.prototype.escapeQueryWithParameters=function(e,t,r){var n=Object.keys(r).map(function(e){return r[e]});if(!t||!Object.keys(t).length)return[e,n];var i=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(i,"g"),function(e){var r=t[e.substr(1)];return r instanceof Array?r.map(function(e){return n.push(e),"@"+(n.length-1)}).join(", "):r instanceof Function?r():(r instanceof p.ArrayParameter&&(r=r.value),n.push(r),"@"+(n.length-1))}),[e,n]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?a.DateUtils.mixedDateToDate(e):"time"===t.type?a.DateUtils.mixedTimeToDate(e):"datetime"===t.type||"smalldatetime"===t.type||t.type===Date?a.DateUtils.mixedDateToDate(e,!0,!1):"datetime2"===t.type||"datetimeoffset"===t.type?a.DateUtils.mixedDateToDate(e,!0,!0):"simple-array"===t.type?a.DateUtils.simpleArrayToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return t.transformer&&(e=t.transformer.from(e)),null===e||void 0===e?e:t.type===Boolean?!!e:"datetime"===t.type||t.type===Date||"datetime2"===t.type||"smalldatetime"===t.type||"datetimeoffset"===t.type?a.DateUtils.normalizeHydratedDate(e):"date"===t.type?a.DateUtils.mixedDateToDateString(e):"time"===t.type?a.DateUtils.mixedTimeToString(e):"simple-array"===t.type?a.DateUtils.stringToSimpleArray(e):e},e.prototype.normalizeType=function(e){return e.type===Number?"int":e.type===String?"nvarchar":e.type===Date?"datetime":e.type===Boolean?"bit":e.type===Buffer?"binary":"uuid"===e.type?"uniqueidentifier":"simple-array"===e.type?"ntext":"integer"===e.type?"int":"dec"===e.type?"decimal":"float"===e.type&&e.precision&&e.precision>=1&&e.precision<25?"real":"double precision"===e.type?"float":e.type||""},e.prototype.normalizeDefault=function(e){return"number"==typeof e.default?""+e.default:"boolean"==typeof e.default?!0===e.default?"1":"0":"function"==typeof e.default?"("+e.default()+")":"string"==typeof e.default?"'"+e.default+"'":e.default},e.prototype.normalizeIsUnique=function(e){return e.isUnique},e.prototype.getColumnLength=function(e){if(e.length)return e.length;var t=this.normalizeType(e);return this.dataTypeDefaults&&this.dataTypeDefaults[t]&&this.dataTypeDefaults[t].length?this.dataTypeDefaults[t].length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+="("+e.length+")":e.precision&&e.scale?t+="("+e.precision+","+e.scale+")":e.precision&&"real"!==e.type?t+="("+e.precision+")":e.scale?t+="("+e.scale+")":this.dataTypeDefaults&&this.dataTypeDefaults[e.type]&&this.dataTypeDefaults[e.type].length&&(t+="("+this.dataTypeDefaults[e.type].length.toString()+")"),e.isArray&&(t+=" array"),t},e.prototype.obtainMasterConnection=function(){return Promise.resolve(this.master)},e.prototype.obtainSlaveConnection=function(){if(!this.slaves.length)return this.obtainMasterConnection();var e=Math.floor(Math.random()*this.slaves.length);return Promise.resolve(this.slaves[e])},e.prototype.createGeneratedMap=function(e,t){if(t)return Object.keys(t).reduce(function(r,n){var i=e.findColumnWithDatabaseName(n);return i&&l.OrmUtils.mergeDeep(r,i.createValueMap(t[n])),r},{})},e.prototype.isReturningSqlSupported=function(){return!0},e.prototype.isUUIDGenerationSupported=function(){return!0},e.prototype.createParameter=function(e,t){return"@"+t},e.prototype.parametrizeValue=function(e,t){if(t instanceof c.MssqlParameter)return t;var r=this.normalizeType({type:e.type});return e.length?new c.MssqlParameter(t,r,e.length):e.precision&&e.scale?new c.MssqlParameter(t,r,e.precision,e.scale):e.precision?new c.MssqlParameter(t,r,e.precision):e.scale?new c.MssqlParameter(t,r,e.scale):new c.MssqlParameter(t,r)},e.prototype.parametrizeMap=function(e,t){var r=this;if(!this.connection.hasMetadata(e))return t;var n=this.connection.getMetadata(e);return Object.keys(t).reduce(function(e,i){var o=t[i],a=n.findColumnWithDatabaseName(i);return a?(e[i]=r.parametrizeValue(a,o),e):o},{})},e.prototype.loadDependencies=function(){try{this.mssql=s.PlatformTools.load("mssql")}catch(e){throw new n.DriverPackageNotInstalledError("SQL Server","mssql")}},e.prototype.createPool=function(e,t){var r=this;t=Object.assign(t,i.DriverUtils.buildDriverOptions(t));var n=Object.assign({},{connectionTimeout:this.options.connectionTimeout,requestTimeout:this.options.requestTimeout,stream:this.options.stream,pool:this.options.pool,options:this.options.options},{server:t.host,user:t.username,password:t.password,database:t.database,port:t.port,domain:t.domain},e.extra||{});return n.options?n.options.useUTC||(n.options.useUTC=!1):n.options={useUTC:!1},new Promise(function(e,t){var i=new r.mssql.ConnectionPool(n).connect(function(r){if(r)return t(r);e(i)})})},e}(),e("SqlServerDriver",d)}}}),System.register("typeorm/driver/postgres/PostgresQueryRunner",["typeorm/error/TransactionAlreadyStartedError","typeorm/error/TransactionNotStartedError","typeorm/schema-builder/schema/TableColumn","typeorm/schema-builder/schema/Table","typeorm/schema-builder/schema/TableIndex","typeorm/schema-builder/schema/TableForeignKey","typeorm/schema-builder/schema/TablePrimaryKey","typeorm/error/QueryRunnerAlreadyReleasedError","typeorm/error/QueryFailedError","typeorm/subscriber/Broadcaster"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l,p,d;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e}],execute:function(){d=function(){function e(e,t){void 0===t&&(t="master"),this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.driver=e,this.connection=e.connection,this.mode=t,this.broadcaster=new p.Broadcaster(this)}return e.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(function(t){var r=t[0],n=t[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=r,e.releaseCallback=n,e.databaseConnection}):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(function(t){var r=t[0],n=t[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=r,e.releaseCallback=n,e.databaseConnection}),this.databaseConnectionPromise)},e.prototype.release=function(){this.isReleased=!0,this.releaseCallback&&this.releaseCallback();var e=this.driver.connectedQueryRunners.indexOf(this);return-1!==e&&this.driver.connectedQueryRunners.splice(e),Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isTransactionActive)throw new r.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[4,this.query("START TRANSACTION")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new n.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new n.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.query=function(e,t){var r=this;if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;var n=/INNER JOIN "([^"]+)" "([^"]+)"/.exec(e);return n&&e.includes(n[2]+".")&&(e=e.replace(RegExp(n[2]+"\\.","g"),'"'+n[2]+'".')),new Promise(function(n,i){return __awaiter(r,void 0,void 0,function(){var r,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return[4,this.connect()];case 1:return r=s.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,r.query(e,t,function(r,s){var u=a.driver.connection.options.maxQueryExecutionTime,c=+new Date-o;u&&c>u&&a.driver.connection.logger.logQuerySlow(c,e,t,a),r?(a.driver.connection.logger.logQueryError(r,e,t,a),i(new l.QueryFailedError(e,t,r))):n(s.rows)}),[2]}})})})},e.prototype.stream=function(e,t,r,n){var i=this,o=this.driver.loadStreamDependency();if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return new Promise(function(a,s){return __awaiter(i,void 0,void 0,function(){var i,u,c;return __generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,this.connect()];case 1:return i=l.sent(),this.driver.connection.logger.logQuery(e,t,this),u=i.query(new o(e,t)),r&&u.on("end",r),n&&u.on("error",n),a(u),[3,3];case 2:return c=l.sent(),s(c),[3,3];case 3:return[2]}})})})},e.prototype.insertIntoClosureTable=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:return i="",i=n?"INSERT INTO "+this.escapeTablePath(e)+'("ancestor", "descendant", "level") SELECT "ancestor", '+t+', "level" + 1 FROM '+this.escapeTablePath(e)+' WHERE "descendant" = '+r+" UNION ALL SELECT "+t+", "+t+", 1":"INSERT INTO "+this.escapeTablePath(e)+'("ancestor", "descendant") SELECT "ancestor", '+t+" FROM "+this.escapeTablePath(e)+' WHERE "descendant" = '+r+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),n?[4,this.query("SELECT MAX(level) as level FROM "+this.escapeTablePath(e)+" WHERE descendant = "+r)]:[3,3];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1];case 3:return[2,-1]}})})},e.prototype.getTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return[4,this.getTables([e])];case 1:return t=r.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.getTables=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,c,l,p,d,m,f,h,y,g,v,b,E,M,T,_,C,w,N=this;return __generator(this,function(R){switch(R.label){case 0:return e&&e.length?(t=e.map(function(e){return-1===e.indexOf(".")?e:e.split(".")[1]}),[4,this.query("SELECT * FROM current_schema()")]):[2,[]];case 1:return r=R.sent(),n=r[0].current_schema,(c=e.filter(function(e){return-1!==e.indexOf(".")}).map(function(e){return e.split(".")[0]})).push(this.driver.options.schema||n),l=t.map(function(e){return"'"+e+"'"}).join(", "),p=c.map(function(e){return"'"+e+"'"}).join(", "),d=e.map(function(e){var t=e.split("."),r=t[0],i=t[1];return i||(i=r,r=N.driver.options.schema||n),"table_schema = '"+r+"' AND table_name = '"+i+"'"}).join(" OR "),m="SELECT * FROM information_schema.tables WHERE "+d,f="SELECT * FROM information_schema.columns WHERE table_schema IN ("+p+")",h="SELECT t.relname AS table_name, i.relname AS index_name, a.attname AS column_name, ix.indisunique AS is_unique, a.attnum, ix.indkey FROM pg_class t, pg_class i, pg_index ix, pg_attribute a, pg_namespace ns\nWHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid\nAND a.attnum = ANY(ix.indkey) AND t.relkind = 'r' AND t.relname IN ("+l+") AND t.relnamespace = ns.OID AND ns.nspname IN ("+p+") ORDER BY t.relname, i.relname",y="SELECT table_name, constraint_name FROM information_schema.table_constraints WHERE table_schema IN ("+p+") AND constraint_type = 'FOREIGN KEY'",g="SELECT * FROM information_schema.table_constraints WHERE table_schema IN ("+p+") AND constraint_type = 'UNIQUE'",v="SELECT c.column_name, tc.table_name, tc.constraint_name FROM information_schema.table_constraints tc\nJOIN information_schema.constraint_column_usage AS ccu USING (constraint_schema, constraint_name)\nJOIN information_schema.columns AS c ON c.table_schema = tc.constraint_schema AND tc.table_name = c.table_name AND ccu.column_name = c.column_name\nwhere constraint_type = 'PRIMARY KEY' AND c.table_schema IN ("+p+")",[4,Promise.all([this.query(m),this.query(f),this.query(h),this.query(y),this.query(g),this.query(v)])];case 2:return b=R.sent(),E=b[0],M=b[1],T=b[2],_=b[3],C=b[4],w=b[5],E.length?[2,E.map(function(e){var t=new o.Table(e.table_name);return t.database=e.table_catalog,t.schema=e.table_schema,t.columns=M.filter(function(e){return e.table_name===t.name}).map(function(e){var r=t.schema===n?e.table_name+"_"+e.column_name+"_seq":t.schema+"."+e.table_name+"_"+e.column_name+"_seq",o=!!e.column_default&&(e.column_default.replace(/"/gi,"")==="nextval('"+r+"'::regclass)"||/^uuid\_generate\_v\d\(\)/.test(e.column_default)),a=new i.TableColumn;if(a.name=e.column_name,a.type=e.data_type.toLowerCase(),a.length=e.character_maximum_length?e.character_maximum_length.toString():"",a.precision=e.numeric_precision,a.scale=e.numeric_scale,a.default=null!==e.column_default&&void 0!==e.column_default?e.column_default.replace(/::character varying/,""):void 0,a.isNullable="YES"===e.is_nullable,a.isGenerated=o,a.comment="",a.charset=e.character_set_name,a.collation=e.collation_name,a.isUnique=!!C.find(function(t){return t.constraint_name==="uk_"+e.table_name+"_"+e.column_name}),"array"===a.type){a.isArray=!0;var s=e.udt_name.substring(1);a.type=N.connection.driver.normalizeType({type:s})}return"time without time zone"!==a.type&&"time with time zone"!==a.type&&"timestamp without time zone"!==a.type&&"timestamp with time zone"!==a.type||(a.precision=e.datetime_precision),a}),t.primaryKeys=w.filter(function(e){return e.table_name===t.name}).map(function(e){return new u.TablePrimaryKey(e.constraint_name,e.column_name)}),t.foreignKeys=_.filter(function(e){return e.table_name===t.name}).map(function(e){return new s.TableForeignKey(e.constraint_name,[],[],"","")}),t.indices=T.filter(function(e){return e.table_name===t.name&&!t.foreignKeys.find(function(t){return t.name===e.index_name})&&!t.primaryKeys.find(function(t){return t.name===e.index_name})&&!C.find(function(t){return t.constraint_name===e.index_name})}).map(function(e){return e.index_name}).filter(function(e,t,r){return r.indexOf(e)===t}).map(function(r){var n=T.filter(function(e){return e.table_name===t.name&&e.index_name===r}),i=n[0].indkey.split(" ").map(function(e){return parseInt(e)}).map(function(e){return n.find(function(t){return t.attnum===e}).column_name});return new a.TableIndex(e.table_name,r,i,n[0].is_unique)}),t})]:[2,[]]}})})},e.prototype.hasDatabase=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve(!1)]})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n;return __generator(this,function(i){switch(i.label){case 0:return t=this.parseTablePath(e),r="SELECT * FROM information_schema.tables WHERE table_schema = "+t.schema+" AND table_name = "+t.tableName,[4,this.query(r)];case 1:return n=i.sent(),[2,!!n.length]}})})},e.prototype.createDatabase=function(e){return Promise.resolve([])},e.prototype.createSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(r){return this.driver.options.schema&&e.push(this.driver.options.schema),[2,Promise.all(e.map(function(e){return t.query('CREATE SCHEMA IF NOT EXISTS "'+e+'"')}))]})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return t=e.schema||this.driver.options.schema,r=e.columns.map(function(e){return a.buildCreateColumnSql(e,!1)}).join(", "),n="CREATE TABLE "+this.escapeTablePath(e)+" ("+r,n+=e.columns.filter(function(e){return e.isUnique}).map(function(r){return t?', CONSTRAINT "uk_'+t+"_"+e.name+"_"+r.name+'" UNIQUE ("'+r.name+'")':', CONSTRAINT "uk_'+e.name+"_"+r.name+'" UNIQUE ("'+r.name+'")'}).join(" "),(i=e.columns.filter(function(e){return e.isPrimary})).length>0&&(n+=", PRIMARY KEY("+i.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),n+=")",o='DROP TABLE "'+e.name+'"',[4,this.schemaQuery(n,o)];case 1:return s.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("DROP TABLE "+this.escapeTablePath(e))];case 1:return t.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i;return __generator(this,function(o){switch(o.label){case 0:return r=this.parseTablePath(e),n="SELECT * FROM information_schema.columns WHERE table_schema = "+r.schema+" AND table_name = '"+r.tableName+"' AND column_name = '"+t+"'",[4,this.query(n)];case 1:return i=o.sent(),[2,!!i.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){return r="ALTER TABLE "+this.escapeTablePath(e)+" ADD "+this.buildCreateColumnSql(t,!1),n="ALTER TABLE "+this.escapeTablePath(e)+' DROP "'+t.name+'"',[2,this.schemaQuery(r,n)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return n.addColumn(e,t)}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var n,a,s;return __generator(this,function(u){switch(u.label){case 0:return n=void 0,e instanceof o.Table?(n=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:n=u.sent(),u.label=3;case 3:if(!n)throw new Error("Table "+e+" was not found.");if(a=void 0,!(a=t instanceof i.TableColumn?t:n.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,r instanceof i.TableColumn?s=r:(s=a.clone()).name=r,[2,this.changeColumn(n,a,s)]}})})},e.prototype.changeColumn=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var n,a,s,u,c,l,p=this;return __generator(this,function(d){switch(d.label){case 0:return n=void 0,a=[],e instanceof o.Table?(n=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:n=d.sent(),d.label=3;case 3:if(!n)throw new Error("Table "+e+" was not found.");if(s=void 0,!(s=t instanceof i.TableColumn?t:n.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return this.connection.driver.createFullType(s)===this.connection.driver.createFullType(r)&&s.name===r.name||(l="ALTER TABLE "+this.escapeTablePath(e)+' ALTER COLUMN "'+s.name+'"',this.connection.driver.createFullType(s)!==this.connection.driver.createFullType(r)&&(l+=" TYPE "+this.connection.driver.createFullType(r)),s.name!==r.name&&(l+=" RENAME TO "+r.name),a.push({up:l,down:"-- TODO: revert "+l})),s.isNullable!==r.isNullable&&(l="ALTER TABLE "+this.escapeTablePath(e)+' ALTER COLUMN "'+s.name+'"',r.isNullable?l+=" DROP NOT NULL":l+=" SET NOT NULL",a.push({up:l,down:"-- TODO: revert "+l})),s.isGenerated!==r.isGenerated&&(u=n.schema||this.driver.options.schema,s.isGenerated||"uuid"===r.type?(l="ALTER TABLE "+this.escapeTablePath(n)+' ALTER COLUMN "'+s.name+'" DROP DEFAULT',a.push({up:l,down:"-- TODO: revert "+l}),c=u?'DROP SEQUENCE "'+u+'"."'+n.name+"_"+s.name+'_seq"':'DROP SEQUENCE "'+n.name+"_"+s.name+'_seq"',a.push({up:c,down:"-- TODO: revert "+c})):(l=u?'CREATE SEQUENCE "'+u+'"."'+n.name+"_"+s.name+'_seq" OWNED BY '+this.escapeTablePath(n)+'."'+s.name+'"':'CREATE SEQUENCE "'+n.name+"_"+s.name+'_seq" OWNED BY '+this.escapeTablePath(n)+'."'+s.name+'"',a.push({up:l,down:"-- TODO: revert "+l}),c=u?"ALTER TABLE "+this.escapeTablePath(n)+' ALTER COLUMN "'+s.name+'" SET DEFAULT nextval(\'"'+u+"."+n.name+"_"+s.name+"_seq\"')":"ALTER TABLE "+this.escapeTablePath(n)+' ALTER COLUMN "'+s.name+'" SET DEFAULT nextval(\'"'+n.name+"_"+s.name+"_seq\"')",a.push({up:c,down:"-- TODO: revert "+c}))),s.comment!==r.comment&&(l="COMMENT ON COLUMN "+this.escapeTablePath(e)+'."'+s.name+"\" is '"+r.comment+"'",a.push({up:l,down:"-- TODO: revert "+l})),s.isUnique!==r.isUnique&&(!0===r.isUnique?(l="ALTER TABLE "+this.escapeTablePath(e)+' ADD CONSTRAINT "uk_'+n.name+"_"+r.name+'" UNIQUE ("'+r.name+'")',a.push({up:l,down:"-- TODO: revert "+l})):!1===r.isUnique&&(l="ALTER TABLE "+this.escapeTablePath(e)+' DROP CONSTRAINT "uk_'+n.name+"_"+r.name+'"',a.push({up:l,down:"-- TODO: revert "+l}))),r.default!==s.default&&(null!==r.default&&void 0!==r.default?(l="ALTER TABLE "+this.escapeTablePath(e)+' ALTER COLUMN "'+r.name+'" SET DEFAULT '+r.default,a.push({up:l,down:"-- TODO: revert "+l})):null!==s.default&&void 0!==s.default&&(l="ALTER TABLE "+this.escapeTablePath(e)+' ALTER COLUMN "'+r.name+'" DROP DEFAULT',a.push({up:l,down:"-- TODO: revert "+l}))),[4,Promise.all(a.map(function(e){var t=e.up,r=e.down;return p.schemaQuery(t,r)}))];case 4:return d.sent(),[2]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(r){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){return r="ALTER TABLE "+this.escapeTablePath(e)+' DROP "'+t.name+'"',n="ALTER TABLE "+this.escapeTablePath(e)+" ADD "+this.buildCreateColumnSql(t,!1),[2,this.schemaQuery(r,n)]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return n.dropColumn(e,t)}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,i,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return t=e.primaryKeys.map(function(e){return'"'+e.columnName+'"'}),r="ALTER TABLE "+this.escapeTablePath(e)+' DROP CONSTRAINT IF EXISTS "'+e.name+'_pkey"',n="-- TODO: revert "+r,[4,this.schemaQuery(r,n)];case 1:return u.sent(),i='DROP INDEX IF EXISTS "'+e.name+'_pkey"',o="-- TODO: revert "+i,[4,this.schemaQuery(i,o)];case 2:return u.sent(),t.length>0?(a="ALTER TABLE "+this.escapeTablePath(e)+" ADD PRIMARY KEY ("+t.join(", ")+")",s="ALTER TABLE "+this.escapeTablePath(e)+" DROP PRIMARY KEY ("+t.join(", ")+")",[4,this.schemaQuery(a,s)]):[3,4];case 3:u.sent(),u.label=4;case 4:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i;return __generator(this,function(o){return r=this.foreignKeySql(e,t),n=r.add,i=r.drop,[2,this.schemaQuery(n,i)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return n.createForeignKey(e,t)}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i;return __generator(this,function(o){return r=this.foreignKeySql(e,t),n=r.add,i=r.drop,[2,this.schemaQuery(i,n)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return n.dropForeignKey(e,t)}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i;return __generator(this,function(o){switch(o.label){case 0:return r=t.columnNames.map(function(e){return'"'+e+'"'}).join(","),n="CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON '+this.escapeTablePath(e)+"("+r+")",i="-- TODO: revert "+n,[4,this.schemaQuery(n,i)];case 1:return o.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i;return __generator(this,function(o){switch(o.label){case 0:return r=this.extractSchema(e),n=r?'DROP INDEX "'+r+'"."'+t+'"':'DROP INDEX "'+t+'"',i="-- TODO: revert "+n,[4,this.schemaQuery(n,i)];case 1:return o.sent(),[2]}})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.escapeTablePath(e))];case 1:return t.sent(),[2]}})})},e.prototype.clearDatabase=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return e||(e=[]),e.push(this.driver.options.schema||"current_schema()"),t=e.map(function(e){return"current_schema()"===e?e:"'"+e+"'"}).join(", "),[4,this.startTransaction()];case 1:s.sent(),s.label=2;case 2:return s.trys.push([2,6,,11]),r="SELECT 'DROP TABLE IF EXISTS \"' || schemaname || '\".\"' || tablename || '\" CASCADE;' as query FROM pg_tables WHERE schemaname IN ("+t+")",[4,this.query(r)];case 3:return n=s.sent(),[4,Promise.all(n.map(function(e){return a.query(e.query)}))];case 4:return s.sent(),[4,this.commitTransaction()];case 5:return s.sent(),[3,11];case 6:i=s.sent(),s.label=7;case 7:return s.trys.push([7,9,,10]),[4,this.rollbackTransaction()];case 8:return s.sent(),[3,10];case 9:return o=s.sent(),[3,10];case 10:throw i;case 11:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},e.prototype.schemaQuery=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return!0===this.sqlMemoryMode?(this.sqlsInMemory.push({up:e,down:t}),[2,Promise.resolve()]):[4,this.query(e)];case 1:return r.sent(),[2]}})})},e.prototype.extractSchema=function(e){return e instanceof o.Table?e.schema||this.driver.options.schema:-1===e.indexOf(".")?this.driver.options.schema:e.split(".")[0]},e.prototype.foreignKeySql=function(e,t){var r="ALTER TABLE "+this.escapeTablePath(e)+' ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ("'+t.columnNames.join('", "')+'") REFERENCES '+this.escapeTablePath(t.referencedTablePath)+'("'+t.referencedColumnNames.join('", "')+'")';t.onDelete&&(r+=" ON DELETE "+t.onDelete);return{add:r,drop:"ALTER TABLE "+this.escapeTablePath(e)+' DROP CONSTRAINT "'+t.name+'"'}},e.prototype.escapeTablePath=function(e,t){if(e instanceof o.Table){var r=e.schema||this.driver.options.schema;e=r?r+"."+e.name:e.name}else e=-1===e.indexOf(".")&&this.driver.options.schema?this.driver.options.schema+"."+e:e;return e.split(".").map(function(e){return t?e:'"'+e+'"'}).join(".")},e.prototype.parseTablePath=function(e){return-1===e.indexOf(".")?{schema:this.driver.options.schema?"'"+this.driver.options.schema+"'":"current_schema()",tableName:"'"+e+"'"}:{schema:"'"+e.split(".")[0]+"'",tableName:"'"+e.split(".")[1]+"'"}},e.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,r){return'"'+e+'"=$'+(t+r+1)})},e.prototype.buildCreateColumnSql=function(e,t){var r='"'+e.name+'"';return!0===e.isGenerated&&"increment"===e.generationStrategy&&("integer"===e.type&&(r+=" SERIAL"),"smallint"===e.type&&(r+=" SMALLSERIAL"),"bigint"===e.type&&(r+=" BIGSERIAL")),e.isGenerated&&"uuid"!==e.type||(r+=" "+this.connection.driver.createFullType(e)),e.charset&&(r+=' CHARACTER SET "'+e.charset+'"'),e.collation&&(r+=' COLLATE "'+e.collation+'"'),!0!==e.isNullable&&(r+=" NOT NULL"),void 0!==e.default&&null!==e.default&&(r+=" DEFAULT "+e.default),e.isGenerated&&"uuid"===e.generationStrategy&&!e.default&&(r+=" DEFAULT uuid_generate_v4()"),r},e}(),e("PostgresQueryRunner",d)}}}),System.register("typeorm/driver/postgres/PostgresDriver",["typeorm/error/ConnectionIsNotSetError","typeorm/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/driver/postgres/PostgresQueryRunner","typeorm/util/DateUtils","typeorm/platform/PlatformTools","typeorm/schema-builder/RdbmsSchemaBuilder","typeorm/util/OrmUtils","typeorm/query-builder/ArrayParameter"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l,p;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e}],execute:function(){p=function(){function e(e){this.slaves=[],this.connectedQueryRunners=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["smallint","integer","bigint","decimal","numeric","real","double precision","money","character varying","varchar","character","char","text","citext","bytea","bit","bit varying","timestamp","timestamp without time zone","timestamp with time zone","date","time","time without time zone","time with time zone","interval","boolean","enum","point","line","lseg","box","path","polygon","circle","cidr","inet","macaddr","tsvector","tsquery","uuid","xml","json","jsonb"],this.withLengthColumnTypes=["character varying","varchar","character","char","bit","bit varying"],this.mappedDataTypes={createDate:"timestamp",createDateDefault:"now()",updateDate:"timestamp",updateDateDefault:"now()",version:"int",treeLevel:"int",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text"},this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n=this;return __generator(this,function(i){switch(i.label){case 0:return this.options.replication?(e=this,[4,Promise.all(this.options.replication.slaves.map(function(e){return n.createPool(n.options,e)}))]):[3,3];case 1:return e.slaves=i.sent(),t=this,[4,this.createPool(this.options,this.options.replication.master)];case 2:return t.master=i.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return r=this,[4,this.createPool(this.options,this.options)];case 4:r.master=i.sent(),this.database=this.options.database,i.label=5;case 5:return[2]}})})},e.prototype.afterConnect=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r=this;return __generator(this,function(n){switch(n.label){case 0:return e=this.connection.entityMetadatas.some(function(e){return e.generatedColumns.filter(function(e){return"uuid"===e.generationStrategy}).length>0}),t=this.connection.entityMetadatas.some(function(e){return e.columns.filter(function(e){return"citext"===e.type}).length>0}),e||t?[4,Promise.all([this.master].concat(this.slaves).map(function(n){return new Promise(function(i,o){n.connect(function(n,a,s){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return n?[2,o(n)]:e?[4,this.executeQuery(a,'CREATE extension IF NOT EXISTS "uuid-ossp"')]:[3,2];case 1:r.sent(),r.label=2;case 2:return t?[4,this.executeQuery(a,'CREATE extension IF NOT EXISTS "citext"')]:[3,4];case 3:r.sent(),r.label=4;case 4:return s(),i(),[2]}})})})})}))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2,Promise.resolve()]}})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return this.master?[4,this.closePool(this.master)]:[2,Promise.reject(new r.ConnectionIsNotSetError("postgres"))];case 1:return t.sent(),[4,Promise.all(this.slaves.map(function(t){return e.closePool(t)}))];case 2:return t.sent(),this.master=void 0,this.slaves=[],[2]}})})},e.prototype.createSchemaBuilder=function(){return new u.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new o.PostgresQueryRunner(this,e)},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?a.DateUtils.mixedDateToDateString(e):"time"===t.type?a.DateUtils.mixedDateToTimeString(e):"datetime"===t.type||t.type===Date||"timestamp"===t.type||"timestamp with time zone"===t.type||"timestamp without time zone"===t.type?a.DateUtils.mixedDateToDate(e,!0):"json"===t.type||"jsonb"===t.type?JSON.stringify(e):"simple-array"===t.type?a.DateUtils.simpleArrayToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return t.transformer&&(e=t.transformer.from(e)),null===e||void 0===e?e:t.type===Boolean?!!e:"datetime"===t.type||t.type===Date||"timestamp"===t.type||"timestamp with time zone"===t.type||"timestamp without time zone"===t.type?a.DateUtils.normalizeHydratedDate(e):"date"===t.type?a.DateUtils.mixedDateToDateString(e):"time"===t.type?a.DateUtils.mixedTimeToString(e):"simple-array"===t.type?a.DateUtils.stringToSimpleArray(e):e},e.prototype.escapeQueryWithParameters=function(e,t,r){var n=Object.keys(r).map(function(e){return r[e]});if(!t||!Object.keys(t).length)return[e,n];var i=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(i,"g"),function(e){var r=t[e.substr(1)];return r instanceof Array?r.map(function(e){return n.push(e),"$"+n.length}).join(", "):r instanceof Function?r():(r instanceof l.ArrayParameter&&(r=r.value),n.push(r),"$"+n.length)}),[e,n]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.normalizeType=function(e){var t="";return e.type===Number?t+="integer":e.type===String?t+="character varying":e.type===Date?t+="timestamp":e.type===Boolean?t+="boolean":"simple-array"===e.type?t+="text":t+=e.type,"int"===t||"int4"===t?t="integer":"int2"===t?t="smallint":"int8"===t?t="bigint":"decimal"===t?t="numeric":"float8"===t?t="double precision":"float4"===t?t="real":"citext"===t?t="citext":"char"===t?t="character":"varchar"===t?t="character varying":"time"===t?t="time without time zone":"timetz"===t?t="time with time zone":"timestamptz"===t?t="timestamp with time zone":"bool"===t?t="boolean":"varbit"===t?t="bit varying":"timestamp"===t&&(t="timestamp without time zone"),t},e.prototype.normalizeDefault=function(e){return"number"==typeof e.default?""+e.default:"boolean"==typeof e.default?!0===e.default?"true":"false":"function"==typeof e.default?e.default():"string"==typeof e.default?"'"+e.default+"'":"object"==typeof e.default?"'"+JSON.stringify(e.default)+"'":e.default},e.prototype.normalizeIsUnique=function(e){return e.isUnique},e.prototype.getColumnLength=function(e){if(e.length)return e.length;var t=this.normalizeType(e);return this.dataTypeDefaults&&this.dataTypeDefaults[t]&&this.dataTypeDefaults[t].length?this.dataTypeDefaults[t].length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+="("+e.length+")":e.precision&&e.scale?t+="("+e.precision+","+e.scale+")":e.precision?t+="("+e.precision+")":e.scale?t+="("+e.scale+")":this.dataTypeDefaults&&this.dataTypeDefaults[e.type]&&this.dataTypeDefaults[e.type].length&&(t+="("+this.dataTypeDefaults[e.type].length.toString()+")"),"time without time zone"===e.type?t="TIME"+(e.precision?"("+e.precision+")":""):"time with time zone"===e.type?t="TIME"+(e.precision?"("+e.precision+")":"")+" WITH TIME ZONE":"timestamp without time zone"===e.type?t="TIMESTAMP"+(e.precision?"("+e.precision+")":""):"timestamp with time zone"===e.type&&(t="TIMESTAMP"+(e.precision?"("+e.precision+")":"")+" WITH TIME ZONE"),e.isArray&&(t+=" array"),t},e.prototype.obtainMasterConnection=function(){var e=this;return new Promise(function(t,r){e.master.connect(function(e,n,i){e?r(e):t([n,i])})})},e.prototype.obtainSlaveConnection=function(){var e=this;return this.slaves.length?new Promise(function(t,r){var n=Math.floor(Math.random()*e.slaves.length);e.slaves[n].connect(function(e,n,i){e?r(e):t([n,i])})}):this.obtainMasterConnection()},e.prototype.createGeneratedMap=function(e,t){if(t)return Object.keys(t).reduce(function(r,n){var i=e.findColumnWithDatabaseName(n);return i&&c.OrmUtils.mergeDeep(r,i.createValueMap(t[n])),r},{})},e.prototype.isReturningSqlSupported=function(){return!0},e.prototype.isUUIDGenerationSupported=function(){return!0},e.prototype.createParameter=function(e,t){return"$"+(t+1)},e.prototype.loadStreamDependency=function(){try{return s.PlatformTools.load("pg-query-stream")}catch(e){throw new Error("To use streams you should install pg-query-stream package. Please run npm i pg-query-stream --save command.")}},e.prototype.loadDependencies=function(){try{this.postgres=s.PlatformTools.load("pg");try{s.PlatformTools.load("pg-native")&&this.postgres.native&&(this.postgres=this.postgres.native)}catch(e){}}catch(e){throw new n.DriverPackageNotInstalledError("Postgres","pg")}},e.prototype.createPool=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(o){return t=Object.assign(t,i.DriverUtils.buildDriverOptions(t)),r=Object.assign({},{host:t.host,user:t.username,password:t.password,database:t.database,port:t.port,ssl:t.ssl},e.extra||{}),n=new this.postgres.Pool(r),[2,new Promise(function(e,t){n.connect(function(r,i,o){if(r)return t(r);o(),e(n)})})]})})},e.prototype.closePool=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,Promise.all(this.connectedQueryRunners.map(function(e){return e.release()}))];case 1:return t.sent(),[2,new Promise(function(t,r){e.end(function(e){return e?r(e):t()})})]}})})},e.prototype.executeQuery=function(e,t){return new Promise(function(r,n){e.query(t,function(e,t){if(e)return n(e);r(t)})})},e}(),e("PostgresDriver",p)}}}),System.register("typeorm/query-builder/Brackets",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){return function(e){this.whereFactory=e}}(),e("Brackets",r)}}}),System.register("typeorm/query-builder/WhereExpression",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/error/ReturningStatementNotSupportedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(){var t=e.call(this)||this;return t.name="ReturningStatementNotSupportedError",t.message="OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL databases.",t.stack=(new Error).stack,t}return __extends(t,e),t}(Error),e("ReturningStatementNotSupportedError",r)}}}),System.register("typeorm/query-builder/ReturningResultsEntityUpdator",["typeorm/util/OrmUtils"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e,t){this.queryRunner=e,this.expressionMap=t}return e.prototype.update=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=this.expressionMap.mainAlias.metadata,[4,Promise.all(t.map(function(t,i){return __awaiter(n,void 0,void 0,function(){var n,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return this.queryRunner.connection.driver.isReturningSqlSupported()?(n=e.raw instanceof Array?e.raw[i]:e.raw,(o=this.queryRunner.connection.driver.createGeneratedMap(r,n))&&(this.queryRunner.manager.merge(r.target,t,o),e.generatedMaps.push(o)),[3,3]):[3,1];case 1:if(!((a=this.getUpdationReturningColumns()).length>0))return[3,3];if(!(s=this.expressionMap.mainAlias.metadata.getEntityIdMap(t)))throw new Error("Cannot update entity because entity id is not set in the entity.");return[4,this.queryRunner.manager.createQueryBuilder().select(r.primaryColumns.map(function(e){return r.targetName+"."+e.propertyPath})).addSelect(this.getUpdationReturningColumns().map(function(e){return r.targetName+"."+e.propertyPath})).from(r.target,r.targetName).where(s).getOne()];case 2:(u=c.sent())&&(this.queryRunner.manager.merge(r.target,t,u),e.generatedMaps.push(u)),c.label=3;case 3:return[2]}})})}))];case 1:return i.sent(),[2]}})})},e.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return n=this.expressionMap.mainAlias.metadata,i=this.getInsertionReturningColumns(),o=t.map(function(t,i){var o=e.raw instanceof Array?e.raw[i]:e.raw,s=a.queryRunner.connection.driver.createGeneratedMap(n,o)||{};return!1===a.queryRunner.connection.driver.isUUIDGenerationSupported()&&n.generatedColumns.forEach(function(e){if("uuid"===e.generationStrategy){var n=e.getEntityValue(t);n||(n=a.expressionMap.nativeParameters["_uuid_"+e.databaseName+i]),r.OrmUtils.mergeDeep(s,e.createValueMap(n))}}),a.queryRunner.manager.merge(n.target,t,s),s}),!1===this.queryRunner.connection.driver.isReturningSqlSupported()&&i.length>0?[4,Promise.all(t.map(function(e,t){return __awaiter(a,void 0,void 0,function(){var r,a;return __generator(this,function(s){switch(s.label){case 0:return r=n.getEntityIdMap(e),[4,this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map(function(e){return n.targetName+"."+e.propertyPath})).addSelect(i.map(function(e){return n.targetName+"."+e.propertyPath})).from(n.target,n.targetName).where(r).getOne()];case 1:return a=s.sent(),this.queryRunner.manager.merge(n.target,o[t],a),[2]}})})}))]:[3,2];case 1:s.sent(),s.label=2;case 2:return t.forEach(function(t,r){var i=n.getEntityIdMap(t);e.identifiers.push(i),e.generatedMaps.push(o[r]),a.queryRunner.manager.merge(a.expressionMap.mainAlias.metadata.target,t,o[r],o[r])}),[2]}})})},e.prototype.getInsertionReturningColumns=function(){var e=this.queryRunner.connection.driver.isReturningSqlSupported();return this.expressionMap.mainAlias.metadata.columns.filter(function(t){return void 0!==t.default||e&&t.isGenerated||t.isCreateDate||t.isUpdateDate||t.isVersion})},e.prototype.getUpdationReturningColumns=function(){return this.expressionMap.mainAlias.metadata.columns.filter(function(e){return e.isUpdateDate||e.isVersion})},e}(),e("ReturningResultsEntityUpdator",n)}}}),System.register("typeorm/util/RandomGenerator",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(){}return e.sha1=function(e){var t,r,n,i,o,a,s,u,c,l=function(e,t){return e<<t|e>>>32-t},p=function(e){var t,r="";for(t=7;t>=0;t--)r+=(e>>>4*t&15).toString(16);return r},d=new Array(80),m=1732584193,f=4023233417,h=2562383102,y=271733878,g=3285377520,v=(e=encodeURIComponent(e)).length,b=[];for(r=0;r<v-3;r+=4)n=e.charCodeAt(r)<<24|e.charCodeAt(r+1)<<16|e.charCodeAt(r+2)<<8|e.charCodeAt(r+3),b.push(n);switch(v%4){case 0:r=2147483648;break;case 1:r=e.charCodeAt(v-1)<<24|8388608;break;case 2:r=e.charCodeAt(v-2)<<24|e.charCodeAt(v-1)<<16|32768;break;case 3:r=e.charCodeAt(v-3)<<24|e.charCodeAt(v-2)<<16|e.charCodeAt(v-1)<<8|128}for(b.push(r);b.length%16!=14;)b.push(0);for(b.push(v>>>29),b.push(v<<3&4294967295),t=0;t<b.length;t+=16){for(r=0;r<16;r++)d[r]=b[t+r];for(r=16;r<=79;r++)d[r]=l(d[r-3]^d[r-8]^d[r-14]^d[r-16],1);for(i=m,o=f,a=h,s=y,u=g,r=0;r<=19;r++)c=l(i,5)+(o&a|~o&s)+u+d[r]+1518500249&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(r=20;r<=39;r++)c=l(i,5)+(o^a^s)+u+d[r]+1859775393&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(r=40;r<=59;r++)c=l(i,5)+(o&a|o&s|a&s)+u+d[r]+2400959708&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(r=60;r<=79;r++)c=l(i,5)+(o^a^s)+u+d[r]+3395469782&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;m=m+i&4294967295,f=f+o&4294967295,h=h+a&4294967295,y=y+s&4294967295,g=g+u&4294967295}return(c=p(m)+p(f)+p(h)+p(y)+p(g)).toLowerCase()},e.uuid4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},e}(),e("RandomGenerator",r)}}}),System.register("typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner",["typeorm/error/TransactionAlreadyStartedError","typeorm/error/TransactionNotStartedError","typeorm/schema-builder/schema/TableColumn","typeorm/metadata/ColumnMetadata","typeorm/schema-builder/schema/Table","typeorm/schema-builder/schema/TableIndex","typeorm/schema-builder/schema/TableForeignKey","typeorm/schema-builder/schema/TablePrimaryKey","typeorm/util/RandomGenerator"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l,p;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e}],execute:function(){p=function(){function e(e){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.sqlMemoryMode=!1,this.sqlsInMemory=[]}return e.prototype.connect=function(){return Promise.resolve(this.driver.databaseConnection)},e.prototype.release=function(){return Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isTransactionActive)throw new r.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[4,this.query("BEGIN TRANSACTION")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new n.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new n.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.query=function(e,t){throw new Error("Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers")},e.prototype.stream=function(e,t,r,n){throw new Error("Stream is not supported by sqlite driver.")},e.prototype.insertIntoClosureTable=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:return i="",i=n?'INSERT INTO "'+e+'"("ancestor", "descendant", "level") SELECT "ancestor", '+t+', "level" + 1 FROM "'+e+'" WHERE "descendant" = '+r+" UNION ALL SELECT "+t+", "+t+", 1":'INSERT INTO "'+e+'"("ancestor", "descendant") SELECT "ancestor", '+t+' FROM "'+e+'" WHERE "descendant" = '+r+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),n?[4,this.query("SELECT MAX(level) as level FROM "+e+" WHERE descendant = "+r)]:[3,3];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1];case 3:return[2,-1]}})})},e.prototype.getTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return[4,this.getTables([e])];case 1:return t=r.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.getTables=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n=this;return __generator(this,function(o){switch(o.label){case 0:return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),[4,this.query("SELECT * FROM sqlite_master WHERE type = 'table' AND name IN ("+t+")")]):[2,[]];case 1:return(r=o.sent())&&r.length?[2,Promise.all(r.map(function(e){return __awaiter(n,void 0,void 0,function(){var t,r,n,o,p,d,m,f,h,y,g,v=this;return __generator(this,function(b){switch(b.label){case 0:return t=new a.Table(e.name),[4,Promise.all([this.query('PRAGMA table_info("'+e.name+'")'),this.query('PRAGMA index_list("'+e.name+'")'),this.query('PRAGMA foreign_key_list("'+e.name+'")')])];case 1:return r=b.sent(),n=r[0],o=r[1],p=r[2],d=void 0,-1!==(m=e.sql).indexOf("AUTOINCREMENT")&&(d=m.substr(0,m.indexOf("AUTOINCREMENT")),f=d.lastIndexOf(","),h=d.lastIndexOf("("),-1!==f?d=(d=(d=d.substr(f)).substr(0,d.lastIndexOf('"'))).substr(d.indexOf('"')+1):-1!==h&&(d=(d=(d=d.substr(h)).substr(0,d.lastIndexOf('"'))).substr(d.indexOf('"')+1))),t.columns=n.map(function(r){var n=new i.TableColumn;n.name=r.name,n.type=r.type.toLowerCase(),n.default=null!==r.dflt_value&&void 0!==r.dflt_value?r.dflt_value:void 0,n.isNullable=0===r.notnull,n.isPrimary=r.pk>0,n.comment="",n.isGenerated=d===r.name,n.isGenerated&&(n.generationStrategy="increment");var o=n.type.indexOf("(");if(-1!==o){var a=n.type.substr(0,o);if(v.driver.withLengthColumnTypes.find(function(e){return e===a})){var s=parseInt(n.type.substring(o+1,n.type.length-1));s&&(n.length=s.toString(),n.type=a)}}var c=p.filter(function(e){return e.from===r.name}).map(function(t){var r=e.name+"_"+[t.from].join("_")+"_"+t.table+"_"+[t.to].join("_"),n="fk_"+l.RandomGenerator.sha1(r).substr(0,27);return new u.TableForeignKey(n,[t.from],[t.to],t.table,t.on_delete)});return t.addForeignKeys(c),n}),[4,Promise.all(o.filter(function(e){return"pk"===e.origin}).map(function(e){return __awaiter(v,void 0,void 0,function(){var r,n;return __generator(this,function(i){switch(i.label){case 0:return[4,this.query('PRAGMA index_info("'+e.name+'")')];case 1:return r=i.sent(),(n=r.map(function(e){return e.name})).forEach(function(r){t.primaryKeys.push(new c.TablePrimaryKey(e.name,r))}),[2]}})})}))];case 2:return b.sent(),y=o.filter(function(e){return"pk"!==e.origin&&!t.foreignKeys.find(function(t){return t.name===e.name})&&!t.primaryKeys.find(function(t){return t.name===e.name})}).map(function(e){return e.name}).filter(function(e,t,r){return r.indexOf(e)===t}).map(function(r){return __awaiter(v,void 0,void 0,function(){var n,i,a,u;return __generator(this,function(c){switch(c.label){case 0:return n=o.find(function(e){return e.name===r}),[4,this.query('PRAGMA index_info("'+n.name+'")')];case 1:return i=c.sent(),a=i.sort(function(e,t){return parseInt(e.seqno)-parseInt(t.seqno)}).map(function(e){return e.name}),"sqlite_autoindex"===n.name.substr(0,"sqlite_autoindex".length)?(1===n.unique&&a.forEach(function(e){var r=t.columns.find(function(t){return t.name===e});r&&(r.isUnique=!0)}),[2,Promise.resolve(void 0)]):(u="1"===n.unique||1===n.unique,[2,new s.TableIndex(e.name,n.name,a,u)])}})})}),[4,Promise.all(y)];case 3:return g=b.sent(),t.indices=g.filter(function(e){return!!e}),[2,t]}})})}))]:[2,[]]}})})},e.prototype.hasDatabase=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve(!1)]})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(n){switch(n.label){case 0:return t="SELECT * FROM sqlite_master WHERE type = 'table' AND name = '"+e+"'",[4,this.query(t)];case 1:return r=n.sent(),[2,!!r.length]}})})},e.prototype.createDatabase=function(e){return Promise.resolve([])},e.prototype.createSchema=function(e){return Promise.resolve([])},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,i=this;return __generator(this,function(o){switch(o.label){case 0:return t=e.columns.map(function(e){return i.buildCreateColumnSql(e)}).join(", "),r='CREATE TABLE "'+e.name+'" ('+t,(n=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated})).length>0&&(r+=", PRIMARY KEY("+n.map(function(e){return""+e.name}).join(", ")+")"),r+=")",[4,this.query(r)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return r.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){switch(i.label){case 0:return r='PRAGMA table_info("'+e+'")',[4,this.query(r)];case 1:return n=i.sent(),[2,!!n.find(function(e){return e.name===t})]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getTableSchema(e)];case 1:return r=i.sent(),(n=r.clone()).addColumns([t]),[4,this.recreateTable(n,r)];case 2:return i.sent(),[2]}})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getTableSchema(e)];case 1:return r=i.sent(),(n=r.clone()).addColumns(t),[4,this.recreateTable(n,r)];case 2:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var n,o,s;return __generator(this,function(u){switch(u.label){case 0:return n=void 0,e instanceof a.Table?(n=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:n=u.sent(),u.label=3;case 3:if(!n)throw new Error("Table "+e+" was not found.");if(o=void 0,!(o=t instanceof i.TableColumn?t:n.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,r instanceof i.TableColumn?s=r:(s=o.clone()).name=r,[2,this.changeColumn(n,o,s)]}})})},e.prototype.changeColumn=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(o){switch(o.label){case 0:return r=void 0,e instanceof a.Table?(r=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:r=o.sent(),o.label=3;case 3:if(!r)throw new Error("Table "+e+" was not found.");if(n=void 0,!(n=t instanceof i.TableColumn?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return[2,this.recreateTable(r)]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.recreateTable(e)]})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,this.dropColumns(e,[t])]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){return(r=e.clone()).removeColumns(t),[2,this.recreateTable(r)]})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.recreateTable(e)]})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,this.createForeignKeys(e,[t])]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getTableSchema(e)];case 1:return r=i.sent(),(n=r.clone()).addForeignKeys(t),[2,this.recreateTable(n)]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,this.dropForeignKeys(e,[t])]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getTableSchema(e)];case 1:return r=i.sent(),(n=r.clone()).removeForeignKeys(t),[2,this.recreateTable(n)]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){switch(i.label){case 0:return r=t.columnNames.map(function(e){return'"'+e+'"'}).join(","),n="CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+(e instanceof a.Table?e.name:e)+'"('+r+")",[4,this.query(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){switch(r.label){case 0:return e='DROP INDEX "'+t+'"',[4,this.query(e)];case 1:return r.sent(),[2]}})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query('DELETE FROM "'+e+'"')];case 1:return t.sent(),[2]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,i=this;return __generator(this,function(o){switch(o.label){case 0:return[4,this.query("PRAGMA foreign_keys = OFF;")];case 1:return o.sent(),[4,this.startTransaction()];case 2:o.sent(),o.label=3;case 3:return o.trys.push([3,7,12,14]),e="select 'drop table \"' || name || '\";' as query from sqlite_master where type = 'table' and name != 'sqlite_sequence'",[4,this.query(e)];case 4:return t=o.sent(),[4,Promise.all(t.map(function(e){return i.query(e.query)}))];case 5:return o.sent(),[4,this.commitTransaction()];case 6:return o.sent(),[3,14];case 7:r=o.sent(),o.label=8;case 8:return o.trys.push([8,10,,11]),[4,this.rollbackTransaction()];case 9:return o.sent(),[3,11];case 10:return n=o.sent(),[3,11];case 11:throw r;case 12:return[4,this.query("PRAGMA foreign_keys = ON;")];case 13:return o.sent(),[7];case 14:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},e.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,r){return'"'+e+'"=$'+(t+r+1)})},e.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'"';return e instanceof o.ColumnMetadata?t+=" "+this.driver.normalizeType(e):t+=" "+this.connection.driver.createFullType(e),e.collation&&(t+=" COLLATE "+e.collation),!0!==e.isNullable&&(t+=" NOT NULL"),!0===e.isUnique&&(t+=" UNIQUE"),!0===e.isGenerated&&"increment"===e.generationStrategy?t+=" PRIMARY KEY AUTOINCREMENT":!0===e.isPrimary&&!0===e.isGenerated&&(t+=" PRIMARY KEY"),void 0!==e.default&&null!==e.default&&(t+=" DEFAULT ("+e.default+")"),t},e.prototype.recreateTable=function(e,t,r){return void 0===r&&(r=!0),__awaiter(this,void 0,void 0,function(){var n,i,o,a,s,u,c,l,p,d=this;return __generator(this,function(m){switch(m.label){case 0:return n=e.columns.map(function(e){return d.buildCreateColumnSql(e)}).join(", "),i=e.columns.map(function(e){return'"'+e.name+'"'}).join(", "),o='CREATE TABLE "temporary_'+e.name+'" ('+n,e.foreignKeys.forEach(function(e){var t=e.columnNames.map(function(e){return'"'+e+'"'}).join(", "),r=e.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(", ");o+=", FOREIGN KEY("+t+') REFERENCES "'+e.referencedTableName+'"('+r+")",e.onDelete&&(o+=" ON DELETE "+e.onDelete)}),(a=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated})).length>0&&(o+=", PRIMARY KEY("+a.map(function(e){return""+e.name}).join(", ")+")"),o+=")",[4,this.query(o)];case 1:return m.sent(),s=t?t.columns.map(function(e){return'"'+e.name+'"'}).join(", "):i,r?(u='INSERT INTO "temporary_'+e.name+'"('+s+") SELECT "+s+' FROM "'+e.name+'"',[4,this.query(u)]):[3,3];case 2:m.sent(),m.label=3;case 3:return c='DROP TABLE "'+e.name+'"',[4,this.query(c)];case 4:return m.sent(),l='ALTER TABLE "temporary_'+e.name+'" RENAME TO "'+e.name+'"',[4,this.query(l)];case 5:return m.sent(),p=e.indices.map(function(t){return d.createIndex(e.name,t)}),[4,Promise.all(p)];case 6:return m.sent(),[2]}})})},e.prototype.getTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return e instanceof a.Table?[2,e]:[3,1];case 1:return[4,this.getTable(e)];case 2:if(!(t=r.sent()))throw new Error("Table named "+e+" was not found in the database.");return[2,t]}})})},e}(),e("AbstractSqliteQueryRunner",p)}}}),System.register("typeorm/driver/sqlite-abstract/AbstractSqliteDriver",["typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner","typeorm/util/DateUtils","typeorm/schema-builder/RdbmsSchemaBuilder","typeorm/util/OrmUtils","typeorm/query-builder/ArrayParameter"],function(e,t){"use strict";var r,n,i,o,a,s;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(){function e(e){this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["int","integer","tinyint","smallint","mediumint","bigint","unsigned big int","int2","int8","integer","character","varchar","varying character","nchar","native character","nvarchar","text","clob","text","blob","real","double","double precision","float","real","numeric","decimal","boolean","date","time","datetime"],this.withLengthColumnTypes=["character","varchar","varying character","nchar","native character","nvarchar","text","blob","clob"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"datetime('now')",updateDate:"datetime",updateDateDefault:"datetime('now')",version:"integer",treeLevel:"integer",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text"},this.connection=e,this.options=e.options}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,r){e.queryRunner=void 0,e.databaseConnection.close(function(e){return e?r(e):t()})})]})})},e.prototype.createSchemaBuilder=function(){return new i.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new r.AbstractSqliteQueryRunner(this)),this.queryRunner},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null===e||void 0===e?e:t.type===Boolean||"boolean"===t.type?!0===e?1:0:"date"===t.type?n.DateUtils.mixedDateToDateString(e):"time"===t.type?n.DateUtils.mixedDateToTimeString(e):"datetime"===t.type||t.type===Date?n.DateUtils.mixedDateToUtcDatetimeString(e):"simple-array"===t.type?n.DateUtils.simpleArrayToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return t.transformer&&(e=t.transformer.from(e)),null===e||void 0===e?e:t.type===Boolean||"boolean"===t.type?!!e:"datetime"===t.type||t.type===Date?n.DateUtils.normalizeHydratedDate(e):"date"===t.type?n.DateUtils.mixedDateToDateString(e):"time"===t.type?n.DateUtils.mixedTimeToString(e):"simple-array"===t.type?n.DateUtils.stringToSimpleArray(e):e},e.prototype.escapeQueryWithParameters=function(e,t,r){var n=Object.keys(r).map(function(e){return r[e]});if(!t||!Object.keys(t).length)return[e,n];var i=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(i,"g"),function(e){var r=t[e.substr(1)];return r instanceof Array?r.map(function(e){return n.push(e),"?"}).join(", "):r instanceof Function?r():(r instanceof a.ArrayParameter&&(r=r.value),n.push(r),"?")}),[e,n]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.normalizeType=function(e){return e.type===Number||"int"===e.type?"integer":e.type===String?"varchar":e.type===Date?"datetime":e.type===Boolean?"boolean":"uuid"===e.type?"varchar":"simple-array"===e.type?"text":e.type||""},e.prototype.normalizeDefault=function(e){return"number"==typeof e.default?""+e.default:"boolean"==typeof e.default?!0===e.default?"1":"0":"function"==typeof e.default?e.default():"string"==typeof e.default?"'"+e.default+"'":e.default},e.prototype.normalizeIsUnique=function(e){return e.isUnique},e.prototype.getColumnLength=function(e){if(e.length)return e.length;var t=this.normalizeType(e);return this.dataTypeDefaults&&this.dataTypeDefaults[t]&&this.dataTypeDefaults[t].length?this.dataTypeDefaults[t].length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+="("+e.length+")":e.precision&&e.scale?t+="("+e.precision+","+e.scale+")":e.precision?t+="("+e.precision+")":e.scale?t+="("+e.scale+")":this.dataTypeDefaults&&this.dataTypeDefaults[e.type]&&this.dataTypeDefaults[e.type].length&&(t+="("+this.dataTypeDefaults[e.type].length.toString()+")"),e.isArray&&(t+=" array"),t},e.prototype.obtainMasterConnection=function(){return Promise.resolve()},e.prototype.obtainSlaveConnection=function(){return Promise.resolve()},e.prototype.createGeneratedMap=function(e,t){var r=e.generatedColumns.reduce(function(e,r){var n;return"increment"===r.generationStrategy&&t&&(n=t),n?o.OrmUtils.mergeDeep(e,r.createValueMap(n)):e},{});return Object.keys(r).length>0?r:void 0},e.prototype.isReturningSqlSupported=function(){return!1},e.prototype.isUUIDGenerationSupported=function(){return!1},e.prototype.createParameter=function(e,t){return"?"},e.prototype.createDatabaseConnection=function(){throw new Error("Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers")},e.prototype.loadDependencies=function(){},e}(),e("AbstractSqliteDriver",s)}}}),System.register("typeorm/driver/sqljs/SqljsQueryRunner",["typeorm/error/QueryRunnerAlreadyReleasedError","typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner","typeorm/subscriber/Broadcaster","typeorm/error/QueryFailedError"],function(e,t){"use strict";var r,n,i,o,a;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(e){function t(t){var r=e.call(this,t)||this;return r.driver=t,r.connection=t.connection,r.broadcaster=new i.Broadcaster(r),r}return __extends(t,e),t.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,e.prototype.commitTransaction.call(this)];case 1:return t.sent(),[4,this.driver.autoSave()];case 2:return t.sent(),[2]}})})},t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new r.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){return __awaiter(n,void 0,void 0,function(){var n,a,s,u,c,l,p;return __generator(this,function(d){n=this.driver.databaseConnection,this.driver.connection.logger.logQuery(e,t,this),a=+new Date;try{for((s=n.prepare(e)).bind(t),u=this.driver.connection.options.maxQueryExecutionTime,c=+new Date,l=c-a,u&&l>u&&this.driver.connection.logger.logQuerySlow(l,e,t,this),p=[];s.step();)p.push(s.getAsObject());s.free(),r(p)}catch(r){this.driver.connection.logger.logQueryError(r,e,t,this),i(new o.QueryFailedError(e,t,r))}return[2]})})})},t}(n.AbstractSqliteQueryRunner),e("SqljsQueryRunner",a)}}}),System.register("typeorm/error/DriverOptionNotSetError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;return r.name="DriverOptionNotSetError",r.message="Driver option ("+t+") is not set. Please set it to perform connection to the database.",r}return __extends(t,e),t}(Error),e("DriverOptionNotSetError",r)}}}),System.register("typeorm/driver/sqljs/SqljsDriver",["typeorm/driver/sqlite-abstract/AbstractSqliteDriver","typeorm/driver/sqljs/SqljsQueryRunner","typeorm/error/DriverPackageNotInstalledError","typeorm/error/DriverOptionNotSetError","typeorm/platform/PlatformTools","typeorm/util/OrmUtils"],function(e,t){"use strict";var r,n,i,o,a,s,u;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(e){function t(t){var r=e.call(this,t)||this;if(r.options.autoSave&&!r.options.location&&!r.options.autoSaveCallback)throw new o.DriverOptionNotSetError("location or autoSaveCallback");return r.loadDependencies(),r}return __extends(t,e),t.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}})})},t.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,r){e.queryRunner=void 0,e.databaseConnection.close(),t()})]})})},t.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new n.SqljsQueryRunner(this)),this.queryRunner},t.prototype.load=function(e){if("string"==typeof e){if("node"===a.PlatformTools.type){if(a.PlatformTools.fileExist(e)){var t=a.PlatformTools.readFileSync(e);return this.createDatabaseConnectionWithImport(t)}throw new Error("File "+e+" does not exist")}var r=a.PlatformTools.getGlobalVariable().localStorage.getItem(e);return this.createDatabaseConnectionWithImport(JSON.parse(r))}return this.createDatabaseConnectionWithImport(e)},t.prototype.save=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,i,o;return __generator(this,function(s){switch(s.label){case 0:if(!e&&!this.options.location)throw new Error("No location is set, specify a location parameter or add the location option to your configuration");if(t="",e?t=e:this.options.location&&(t=this.options.location),"node"!==a.PlatformTools.type)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),r=new Buffer(this.databaseConnection.export()),[4,a.PlatformTools.writeFile(t,r)];case 2:return s.sent(),[3,4];case 3:throw n=s.sent(),new Error("Could not save database, error: "+n);case 4:return[3,6];case 5:i=this.databaseConnection.export(),o=[].slice.call(i),a.PlatformTools.getGlobalVariable().localStorage.setItem(t,JSON.stringify(o)),s.label=6;case 6:return[2]}})})},t.prototype.autoSave=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.options.autoSave?this.options.autoSaveCallback?[4,this.options.autoSaveCallback(this.export())]:[3,2]:[3,4];case 1:return e.sent(),[3,4];case 2:return[4,this.save()];case 3:e.sent(),e.label=4;case 4:return[2]}})})},t.prototype.export=function(){return this.databaseConnection.export()},t.prototype.createGeneratedMap=function(e,t){var r=this,n=e.generatedColumns.reduce(function(e,t){if(t.isPrimary&&"increment"===t.generationStrategy){var n="SELECT last_insert_rowid()";try{var i=r.databaseConnection.exec(n);return r.connection.logger.logQuery(n),s.OrmUtils.mergeDeep(e,t.createValueMap(i[0].values[0][0]))}catch(e){r.connection.logger.logQueryError(e,n,[])}}return e},{});return Object.keys(n).length>0?n:void 0},t.prototype.createDatabaseConnection=function(){return this.options.location?this.load(this.options.location):this.createDatabaseConnectionWithImport(this.options.database)},t.prototype.createDatabaseConnectionWithImport=function(e){return e&&e.length>0?this.databaseConnection=new this.sqlite.Database(e):this.databaseConnection=new this.sqlite.Database,Promise.resolve(this.databaseConnection)},t.prototype.loadDependencies=function(){if("browser"===a.PlatformTools.type)this.sqlite=window.SQL;else try{this.sqlite=a.PlatformTools.load("sql.js")}catch(e){throw new i.DriverPackageNotInstalledError("sql.js","sql.js")}},t}(r.AbstractSqliteDriver),e("SqljsDriver",u)}}}),System.register("typeorm/driver/mysql/MysqlQueryRunner",["typeorm/error/TransactionAlreadyStartedError","typeorm/error/TransactionNotStartedError","typeorm/schema-builder/schema/TableColumn","typeorm/schema-builder/schema/Table","typeorm/schema-builder/schema/TableForeignKey","typeorm/schema-builder/schema/TablePrimaryKey","typeorm/schema-builder/schema/TableIndex","typeorm/error/QueryRunnerAlreadyReleasedError","typeorm/error/QueryFailedError","typeorm/subscriber/Broadcaster"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l,p,d;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e}],execute:function(){d=function(){function e(e,t){void 0===t&&(t="master"),this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.driver=e,this.connection=e.connection,this.broadcaster=new p.Broadcaster(this),this.mode=t}return e.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(function(t){return e.databaseConnection=t,e.databaseConnection}):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(function(t){return e.databaseConnection=t,e.databaseConnection}),this.databaseConnectionPromise)},e.prototype.release=function(){return this.isReleased=!0,this.databaseConnection&&this.databaseConnection.release(),Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isTransactionActive)throw new r.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[4,this.query("START TRANSACTION")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new n.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new n.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.query=function(e,t){var r=this;if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return new Promise(function(n,i){return __awaiter(r,void 0,void 0,function(){var r,o,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,this.connect()];case 1:return r=u.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,r.query(e,t,function(r,a){var u=s.driver.connection.options.maxQueryExecutionTime,c=+new Date-o;if(u&&c>u&&s.driver.connection.logger.logQuerySlow(c,e,t,s),r)return s.driver.connection.logger.logQueryError(r,e,t,s),i(new l.QueryFailedError(e,t,r));n(a)}),[3,3];case 2:return a=u.sent(),i(a),[3,3];case 3:return[2]}})})})},e.prototype.stream=function(e,t,r,n){var i=this;if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return new Promise(function(o,a){return __awaiter(i,void 0,void 0,function(){var i,s,u;return __generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.connect()];case 1:return i=c.sent(),this.driver.connection.logger.logQuery(e,t,this),s=i.query(e,t),r&&s.on("end",r),n&&s.on("error",n),o(s),[3,3];case 2:return u=c.sent(),a(u),[3,3];case 3:return[2]}})})})},e.prototype.insertIntoClosureTable=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return n?[4,this.query("INSERT INTO `"+this.escapeTablePath(e)+"`(`ancestor`, `descendant`, `level`) SELECT `ancestor`, "+t+", `level` + 1 FROM `"+this.escapeTablePath(e)+"` WHERE `descendant` = "+r+" UNION ALL SELECT "+t+", "+t+", 1")]:[3,2];case 1:return o.sent(),[3,4];case 2:return[4,this.query("INSERT INTO `"+this.escapeTablePath(e)+"`(`ancestor`, `descendant`) SELECT `ancestor`, "+t+" FROM `"+this.escapeTablePath(e)+"` WHERE `descendant` = "+r+" UNION ALL SELECT "+t+", "+t)];case 3:o.sent(),o.label=4;case 4:return n?[4,this.query("SELECT MAX(`level`) as `level` FROM `"+this.escapeTablePath(e)+"` WHERE `descendant` = "+r)]:[3,6];case 5:return i=o.sent(),[2,i&&i[0]&&i[0].level?parseInt(i[0].level)+1:1];case 6:return[2,-1]}})})},e.prototype.getTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return[4,this.getTables([e])];case 1:return t=r.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.getTables=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,c,l,p,d,m,f,h,y,g,v,b,E=this;return __generator(this,function(M){switch(M.label){case 0:if(this.sqlMemoryMode)throw new Error("Loading table is not supported in sql memory mode");return e&&e.length?(t=e.map(function(e){return-1===e.indexOf(".")?e:e.split(".")[1]}),r=e.filter(function(e){return-1!==e.indexOf(".")}).map(function(e){return e.split(".")[0]}),this.driver.database&&!r.find(function(e){return e===E.driver.database})&&r.push(this.driver.database),n=r.map(function(e){return"'"+e+"'"}).join(", "),c=t.map(function(e){return"'"+e+"'"}).join(", "),l="SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA IN ("+n+") AND TABLE_NAME IN ("+c+")",p="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA IN ("+n+")",d="SELECT * FROM INFORMATION_SCHEMA.STATISTICS WHERE TABLE_SCHEMA IN ("+n+") AND INDEX_NAME != 'PRIMARY' ORDER BY SEQ_IN_INDEX",m="SELECT * FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA IN ("+n+") AND REFERENCED_COLUMN_NAME IS NOT NULL",[4,Promise.all([this.query(l),this.query(p),this.query(d),this.query(m)])]):[2,[]];case 1:return f=M.sent(),h=f[0],y=f[1],g=f[2],v=f[3],h.length?(b="mariadb"===this.driver.options.type,[2,Promise.all(h.map(function(e){return __awaiter(E,void 0,void 0,function(){var t,r;return __generator(this,function(n){switch(n.label){case 0:return t=new o.Table(e.TABLE_NAME),t.database=e.TABLE_SCHEMA,[4,this.query("SHOW INDEX FROM `"+e.TABLE_SCHEMA+"`.`"+e.TABLE_NAME+"` WHERE Key_name = 'PRIMARY'")];case 1:return r=n.sent(),t.columns=y.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var t=new i.TableColumn;t.name=e.COLUMN_NAME;var r=e.COLUMN_TYPE.toLowerCase(),n=r.indexOf("(");if(t.type=-1!==n?r.substring(0,n):r,null===e.COLUMN_DEFAULT||void 0===e.COLUMN_DEFAULT||b&&"NULL"===e.COLUMN_DEFAULT?t.default=void 0:t.default=e.COLUMN_DEFAULT,t.isNullable="YES"===e.IS_NULLABLE,t.isPrimary=-1!==e.COLUMN_KEY.indexOf("PRI"),t.isUnique=-1!==e.COLUMN_KEY.indexOf("UNI"),t.isGenerated=-1!==e.EXTRA.indexOf("auto_increment"),t.comment=e.COLUMN_COMMENT,t.precision=e.NUMERIC_PRECISION,t.scale=e.NUMERIC_SCALE,t.charset=e.CHARACTER_SET_NAME,t.collation=e.COLLATION_NAME,"int"===t.type||"tinyint"===t.type||"smallint"===t.type||"mediumint"===t.type||"bigint"===t.type||"year"===t.type){var o=r.substring(r.indexOf("(")+1,r.indexOf(")"));t.length=o?o.toString():""}else t.length=e.CHARACTER_MAXIMUM_LENGTH?e.CHARACTER_MAXIMUM_LENGTH.toString():"";if("enum"===t.type){var a=e.COLUMN_TYPE,s=a.substring(a.indexOf("(")+1,a.indexOf(")")).split(",");t.enum=s.map(function(e){return e.substring(1,e.length-1)})}return"datetime"!==t.type&&"time"!==t.type&&"timestamp"!==t.type||(t.precision=e.DATETIME_PRECISION),t}),t.primaryKeys=r.map(function(e){return new s.TablePrimaryKey(e.Key_name,e.Column_name)}),t.foreignKeys=v.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){return new a.TableForeignKey(e.CONSTRAINT_NAME,[],[],"","")}),t.indices=g.filter(function(e){return e.TABLE_NAME===t.name&&!t.foreignKeys.find(function(t){return t.name===e.INDEX_NAME})&&!t.primaryKeys.find(function(t){return t.name===e.INDEX_NAME})}).map(function(e){return e.INDEX_NAME}).filter(function(e,t,r){return r.indexOf(e)===t}).map(function(r){var n=g.filter(function(e){return e.TABLE_NAME===t.name&&e.INDEX_NAME===r}),i=n.map(function(e){return e.COLUMN_NAME});if(1===n.length&&0===n[0].NON_UNIQUE){var o=t.columns.find(function(e){return e.name===n[0].INDEX_NAME&&e.name===n[0].COLUMN_NAME});if(o)return void(o.isUnique=!0)}return new u.TableIndex(e.TABLE_NAME,r,i,0===n[0].NON_UNIQUE)}).filter(function(e){return!!e}),[2,t]}})})}))]):[2,[]]}})})},e.prototype.hasDatabase=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return[4,this.query("SELECT * FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME = '"+e+"'")];case 1:return t=r.sent(),[2,!!t.length]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n;return __generator(this,function(i){switch(i.label){case 0:return t=this.parseTablePath(e),r="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '"+t.database+"' AND TABLE_NAME = '"+t.tableName+"'",[4,this.query(r)];case 1:return n=i.sent(),[2,!!n.length]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,o,a;return __generator(this,function(s){switch(s.label){case 0:return r=this.parseTablePath(e),n=t instanceof i.TableColumn?t.name:t,o="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '"+r.database+"' AND TABLE_NAME = '"+r.tableName+"' AND COLUMN_NAME = '"+n+"'",[4,this.query(o)];case 1:return a=s.sent(),[2,!!a.length]}})})},e.prototype.createDatabase=function(e){return this.query("CREATE DATABASE IF NOT EXISTS "+e)},e.prototype.createSchema=function(e){return Promise.resolve([])},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,i,o=this;return __generator(this,function(a){return t=e.columns.map(function(e){return o.buildCreateColumnSql(e,!1)}).join(", "),r="CREATE TABLE `"+this.escapeTablePath(e)+"` ("+t,(n=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated})).length>0&&(r+=", PRIMARY KEY("+n.map(function(e){return"`"+e.name+"`"}).join(", ")+")"),r+=") ENGINE="+(e.engine||"InnoDB"),i="DROP TABLE `"+this.escapeTablePath(e)+"`",[2,this.schemaQuery(r,i)]})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){return t="DROP TABLE `"+this.escapeTablePath(e)+"`",[2,this.query(t)]})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){return r="ALTER TABLE `"+this.escapeTablePath(e)+"` ADD "+this.buildCreateColumnSql(t,!1),n="ALTER TABLE `"+this.escapeTablePath(e)+"` DROP `"+t.name+"`",[2,this.schemaQuery(r,n)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return n.addColumn(e,t)}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var n,a,s;return __generator(this,function(u){switch(u.label){case 0:return n=void 0,e instanceof o.Table?(n=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:if(!(n=u.sent()))throw new Error("Table "+e+" was not found.");u.label=3;case 3:if(a=void 0,!(a=t instanceof i.TableColumn?t:n.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,r instanceof i.TableColumn?s=r:(s=a.clone()).name=r,[2,this.changeColumn(n,a,s)]}})})},e.prototype.changeColumn=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var n,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return n=void 0,e instanceof o.Table?(n=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:n=c.sent(),c.label=3;case 3:if(!n)throw new Error("Table "+e+" was not found.");if(a=void 0,!(a=t instanceof i.TableColumn?t:n.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return!1!==r.isUnique||!0!==a.isUnique?[3,5]:[4,this.query("ALTER TABLE `"+this.escapeTablePath(n)+"` DROP INDEX `"+a.name+"`")];case 4:c.sent(),c.label=5;case 5:return s="ALTER TABLE `"+this.escapeTablePath(n)+"` CHANGE `"+a.name+"` "+this.buildCreateColumnSql(r,a.isPrimary),u="ALTER TABLE `"+this.escapeTablePath(n)+"` CHANGE `"+a.name+"` "+this.buildCreateColumnSql(a,a.isPrimary),[2,this.schemaQuery(s,u)]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(r){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){return r="ALTER TABLE `"+this.escapeTablePath(e)+"` DROP `"+t.name+"`",n="ALTER TABLE `"+this.escapeTablePath(e)+"` ADD "+this.buildCreateColumnSql(t,!1),[2,this.schemaQuery(r,n)]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return n.dropColumn(e,t)}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n;return __generator(this,function(i){switch(i.label){case 0:return e.hasGeneratedColumn?[3,2]:[4,this.query("ALTER TABLE `"+this.escapeTablePath(e)+"` DROP PRIMARY KEY")];case 1:i.sent(),i.label=2;case 2:return(t=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}).map(function(e){return"`"+e.name+"`"})).length>0?(r="ALTER TABLE `"+this.escapeTablePath(e)+"` ADD PRIMARY KEY ("+t.join(", ")+")",n="ALTER TABLE `"+this.escapeTablePath(e)+"` DROP PRIMARY KEY",[2,this.schemaQuery(r,n)]):[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i,o;return __generator(this,function(a){return r=t.columnNames.map(function(e){return"`"+e+"`"}).join(", "),n=t.referencedColumnNames.map(function(e){return"`"+e+"`"}).join(","),i="ALTER TABLE `"+this.escapeTablePath(e)+"` ADD CONSTRAINT `"+t.name+"` FOREIGN KEY ("+r+") REFERENCES `"+t.referencedTableName+"`("+n+")",t.onDelete&&(i+=" ON DELETE "+t.onDelete),o="ALTER TABLE `"+this.escapeTablePath(e)+"` DROP FOREIGN KEY `"+t.name+"`",[2,this.schemaQuery(i,o)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return n.createForeignKey(e,t)}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i,o;return __generator(this,function(a){return r="ALTER TABLE `"+this.escapeTablePath(e)+"` DROP FOREIGN KEY `"+t.name+"`",n=t.columnNames.map(function(e){return"`"+e+"`"}).join(", "),i=t.referencedColumnNames.map(function(e){return"`"+e+"`"}).join(","),o="ALTER TABLE `"+this.escapeTablePath(e)+"` ADD CONSTRAINT `"+t.name+"` FOREIGN KEY ("+n+") REFERENCES `"+t.referencedTableName+"`("+i+")",t.onDelete&&(o+=" ON DELETE "+t.onDelete),[2,this.schemaQuery(r,o)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return n.dropForeignKey(e,t)}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i;return __generator(this,function(o){switch(o.label){case 0:return r=t.columnNames.map(function(e){return"`"+e+"`"}).join(", "),n="CREATE "+(t.isUnique?"UNIQUE ":"")+"INDEX `"+t.name+"` ON `"+this.escapeTablePath(e)+"`("+r+")",i="ALTER TABLE `"+this.escapeTablePath(e)+"` DROP INDEX `"+t.name+"`",[4,this.schemaQuery(n,i)];case 1:return o.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i,o;return __generator(this,function(a){switch(a.label){case 0:return r=t instanceof u.TableIndex?t.name:t,n="ALTER TABLE `"+this.escapeTablePath(e)+"` DROP INDEX `"+r+"`",t instanceof u.TableIndex?(i=t.columnNames.map(function(e){return"`"+e+"`"}).join(", "),o="CREATE "+(t.isUnique?"UNIQUE ":"")+"INDEX `"+t.name+"` ON `"+this.escapeTablePath(e)+"`("+i+")",[4,this.schemaQuery(n,o)]):[3,2];case 1:return a.sent(),[3,4];case 2:return[4,this.query(n)];case 3:a.sent(),a.label=4;case 4:return[2]}})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE `"+this.escapeTablePath(e)+"`")];case 1:return t.sent(),[2]}})})},e.prototype.clearDatabase=function(e,t){return __awaiter(this,void 0,void 0,function(){var e,r,n,i,o,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return[4,this.startTransaction()];case 1:u.sent(),u.label=2;case 2:return u.trys.push([2,8,,13]),e="SET FOREIGN_KEY_CHECKS = 0;",r="SELECT concat('DROP TABLE IF EXISTS `', table_schema, '`.`', table_name, '`;') AS query FROM information_schema.tables WHERE table_schema = '"+t+"'",n="SET FOREIGN_KEY_CHECKS = 1;",[4,this.query(e)];case 3:return u.sent(),[4,this.query(r)];case 4:return i=u.sent(),[4,Promise.all(i.map(function(e){return s.query(e.query)}))];case 5:return u.sent(),[4,this.query(n)];case 6:return u.sent(),[4,this.commitTransaction()];case 7:return u.sent(),[3,13];case 8:o=u.sent(),u.label=9;case 9:return u.trys.push([9,11,,12]),[4,this.rollbackTransaction()];case 10:return u.sent(),[3,12];case 11:return a=u.sent(),[3,12];case 12:throw o;case 13:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},e.prototype.schemaQuery=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return!0===this.sqlMemoryMode?(this.sqlsInMemory.push({up:e,down:t}),[2,Promise.resolve()]):[4,this.query(e)];case 1:return r.sent(),[2]}})})},e.prototype.parseTablePath=function(e){return e instanceof o.Table?{database:e.database||this.driver.database,tableName:e.name}:{database:-1!==e.indexOf(".")?e.split(".")[0]:this.driver.database,tableName:-1!==e.indexOf(".")?e.split(".")[1]:e}},e.prototype.escapeTablePath=function(e){return e instanceof o.Table?e.database?e.database+"`.`"+e.name:""+e.name:e.split(".").map(function(e){return""+e}).join("`.`")},e.prototype.parametrize=function(e){return Object.keys(e).map(function(e){return"`"+e+"`=?"})},e.prototype.buildCreateColumnSql=function(e,t){var r="`"+e.name+"` "+this.connection.driver.createFullType(e);return e.enum&&(r+="("+e.enum.map(function(e){return"'"+e+"'"}).join(", ")+")"),e.charset&&(r+=" CHARACTER SET "+e.charset),e.collation&&(r+=" COLLATE "+e.collation),!0!==e.isNullable&&(r+=" NOT NULL"),!0===e.isUnique&&(r+=" UNIQUE"),e.isGenerated&&e.isPrimary&&!t&&(r+=" PRIMARY KEY"),!0===e.isGenerated&&"increment"===e.generationStrategy&&(r+=" AUTO_INCREMENT"),e.comment&&(r+=" COMMENT '"+e.comment+"'"),void 0!==e.default&&null!==e.default&&(r+=" DEFAULT "+e.default),r},e}(),e("MysqlQueryRunner",d)}}}),System.register("typeorm/driver/mysql/MysqlDriver",["typeorm/error/ConnectionIsNotSetError","typeorm/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/driver/mysql/MysqlQueryRunner","typeorm/util/DateUtils","typeorm/platform/PlatformTools","typeorm/schema-builder/RdbmsSchemaBuilder","typeorm/util/OrmUtils","typeorm/query-builder/ArrayParameter"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l,p;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e}],execute:function(){p=function(){function e(e){this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["int","tinyint","smallint","mediumint","bigint","float","double","decimal","date","datetime","timestamp","time","year","char","varchar","blob","text","tinyblob","tinytext","mediumblob","mediumtext","longblob","longtext","enum","json"],this.withLengthColumnTypes=["int","tinyint","smallint","mediumint","bigint","char","varchar","blob","text"],this.mappedDataTypes={createDate:"datetime",createDatePrecision:6,createDateDefault:"CURRENT_TIMESTAMP(6)",updateDate:"datetime",updateDatePrecision:6,updateDateDefault:"CURRENT_TIMESTAMP(6)",version:"int",treeLevel:"int",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text"},this.dataTypeDefaults={varchar:{length:255},int:{length:11},tinyint:{length:4},smallint:{length:5},mediumint:{length:9},bigint:{length:20},year:{length:4}},this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(r){switch(r.label){case 0:return this.options.replication?(this.poolCluster=this.mysql.createPoolCluster(),this.options.replication.slaves.forEach(function(e,r){t.poolCluster.add("SLAVE"+r,t.createConnectionOptions(t.options,e))}),this.poolCluster.add("MASTER",this.createConnectionOptions(this.options,this.options.replication.master)),this.database=this.options.replication.master.database,[3,3]):[3,1];case 1:return e=this,[4,this.createPool(this.createConnectionOptions(this.options,this.options))];case 2:e.pool=r.sent(),this.database=this.options.database,r.label=3;case 3:return[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return this.poolCluster||this.pool?this.poolCluster?[2,new Promise(function(t,r){e.poolCluster.end(function(e){return e?r(e):t()}),e.poolCluster=void 0})]:this.pool?[2,new Promise(function(t,r){e.pool.end(function(n){if(n)return r(n);e.pool=void 0,t()})})]:[2]:[2,Promise.reject(new r.ConnectionIsNotSetError("mysql"))]})})},e.prototype.createSchemaBuilder=function(){return new u.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new o.MysqlQueryRunner(this,e)},e.prototype.escapeQueryWithParameters=function(e,t,r){var n=Object.keys(r).map(function(e){return r[e]});if(!t||!Object.keys(t).length)return[e,n];var i=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(i,"g"),function(e){var r=t[e.substr(1)];return r instanceof Function?r():(r instanceof l.ArrayParameter&&(r=r.value),n.push(t[e.substr(1)]),"?")}),[e,n]},e.prototype.escape=function(e){return"`"+e+"`"},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?a.DateUtils.mixedDateToDateString(e):"time"===t.type?a.DateUtils.mixedDateToTimeString(e):"json"===t.type?JSON.stringify(e):"datetime"===t.type||t.type===Date?a.DateUtils.mixedDateToDate(e,!0):"simple-array"===t.type?a.DateUtils.simpleArrayToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return t.transformer&&(e=t.transformer.from(e)),null===e||void 0===e?e:t.type===Boolean?!!e:"datetime"===t.type||t.type===Date?a.DateUtils.normalizeHydratedDate(e):"date"===t.type?a.DateUtils.mixedDateToDateString(e):"json"===t.type?"string"==typeof e?JSON.parse(e):e:"time"===t.type?a.DateUtils.mixedTimeToString(e):"simple-array"===t.type?a.DateUtils.stringToSimpleArray(e):e},e.prototype.normalizeType=function(e){return e.type===Number||"integer"===e.type?"int":e.type===String?"varchar":e.type===Date?"datetime":e.type===Buffer?"blob":e.type===Boolean?"tinyint":"uuid"===e.type?"varchar":"simple-array"===e.type?"text":e.type||""},e.prototype.normalizeDefault=function(e){return"number"==typeof e.default?""+e.default:"boolean"==typeof e.default?!0===e.default?"1":"0":"function"==typeof e.default?e.default():"string"==typeof e.default?"'"+e.default+"'":e.default},e.prototype.normalizeIsUnique=function(e){return e.isUnique||!!e.entityMetadata.indices.find(function(t){return t.isUnique&&1===t.columns.length&&t.columns[0]===e})},e.prototype.getColumnLength=function(e){if(e.length)return e.length;var t=this.normalizeType(e);return this.dataTypeDefaults&&this.dataTypeDefaults[t]&&this.dataTypeDefaults[t].length?this.dataTypeDefaults[t].length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+="("+e.length+")":e.precision&&e.scale?t+="("+e.precision+","+e.scale+")":e.precision?t+="("+e.precision+")":e.scale?t+="("+e.scale+")":this.dataTypeDefaults&&this.dataTypeDefaults[e.type]&&this.dataTypeDefaults[e.type].length&&(t+="("+this.dataTypeDefaults[e.type].length.toString()+")"),e.isArray&&(t+=" array"),t},e.prototype.obtainMasterConnection=function(){var e=this;return new Promise(function(t,r){e.poolCluster?e.poolCluster.getConnection("MASTER",function(e,n){e?r(e):t(n)}):e.pool?e.pool.getConnection(function(e,n){e?r(e):t(n)}):r(new Error("Connection is not established with mysql database"))})},e.prototype.obtainSlaveConnection=function(){var e=this;return this.poolCluster?new Promise(function(t,r){e.poolCluster.getConnection("SLAVE*",function(e,n){e?r(e):t(n)})}):this.obtainMasterConnection()},e.prototype.createGeneratedMap=function(e,t){var r=e.generatedColumns.reduce(function(e,r){var n;return"increment"===r.generationStrategy&&t.insertId&&(n=t.insertId),c.OrmUtils.mergeDeep(e,r.createValueMap(n))},{});return Object.keys(r).length>0?r:void 0},e.prototype.isReturningSqlSupported=function(){return!1},e.prototype.isUUIDGenerationSupported=function(){return!1},e.prototype.createParameter=function(e,t){return"?"},e.prototype.loadDependencies=function(){try{this.mysql=s.PlatformTools.load("mysql")}catch(e){try{this.mysql=s.PlatformTools.load("mysql2")}catch(e){throw new n.DriverPackageNotInstalledError("Mysql","mysql")}}},e.prototype.createConnectionOptions=function(e,t){return t=Object.assign(t,i.DriverUtils.buildDriverOptions(t)),Object.assign({},{charset:e.charset,timezone:e.timezone,connectTimeout:e.connectTimeout,insecureAuth:e.insecureAuth,supportBigNumbers:e.supportBigNumbers,bigNumberStrings:e.bigNumberStrings,dateStrings:e.dateStrings,debug:e.debug,trace:e.trace,multipleStatements:e.multipleStatements,flags:e.flags},{host:t.host,user:t.username,password:t.password,database:t.database,port:t.port,ssl:e.ssl},e.extra||{})},e.prototype.createPool=function(e){var t=this.mysql.createPool(e);return new Promise(function(e,r){t.getConnection(function(n,i){if(n)return t.end(function(){return r(n)});i.release(),e(t)})})},e}(),e("MysqlDriver",p)}}}),System.register("typeorm/driver/websql/WebsqlQueryRunner",["typeorm/error/TransactionAlreadyStartedError","typeorm/error/TransactionNotStartedError","typeorm/schema-builder/schema/Table","typeorm/error/QueryRunnerAlreadyReleasedError","typeorm/error/QueryFailedError","typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner","typeorm/subscriber/Broadcaster"],function(e,t){"use strict";var r,n,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(e){function t(t){var r=e.call(this,t)||this;return r.driver=t,r.connection=t.connection,r.broadcaster=new u.Broadcaster(r),r}return __extends(t,e),t.prototype.connect=function(){var e=this;if(this.databaseConnection)return Promise.resolve(this.databaseConnection);if(this.databaseConnectionPromise)return this.databaseConnectionPromise;var t=Object.assign({},{database:this.driver.options.database,version:this.driver.options.version,description:this.driver.options.description,size:this.driver.options.size},this.driver.options.extra||{});return this.databaseConnectionPromise=new Promise(function(r,n){e.databaseConnection=openDatabase(t.database,t.version,t.description,t.size),r(e.databaseConnection)}),this.databaseConnectionPromise},t.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new o.QueryRunnerAlreadyReleasedError;if(this.isTransactionActive)throw new r.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[2]})})},t.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new o.QueryRunnerAlreadyReleasedError;if(!this.isTransactionActive)throw new n.TransactionNotStartedError;return this.isTransactionActive=!1,[2]})})},t.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new o.QueryRunnerAlreadyReleasedError;if(!this.isTransactionActive)throw new n.TransactionNotStartedError;return this.isTransactionActive=!1,[2]})})},t.prototype.query=function(e,t){var r=this;if(this.isReleased)throw new o.QueryRunnerAlreadyReleasedError;return new Promise(function(n,i){return __awaiter(r,void 0,void 0,function(){var r,o,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.connect()];case 1:return r=c.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,r.transaction(function(r){r.executeSql(e,t,function(r,i){var a=u.driver.connection.options.maxQueryExecutionTime,s=+new Date-o;a&&s>a&&u.driver.connection.logger.logQuerySlow(s,e,t,u);var c=Object.keys(i.rows).filter(function(e){return"length"!==e}).map(function(e){return i.rows[e]});n(c)},function(r,n){return u.driver.connection.logger.logQueryError(n,e,t,u),i(new a.QueryFailedError(e,t,n))})}),[3,3];case 2:return s=c.sent(),i(s),[3,3];case 3:return[2]}})})})},t.prototype.getTables=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n=this;return __generator(this,function(o){switch(o.label){case 0:return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),[4,this.query("SELECT * FROM sqlite_master WHERE type = 'table' AND name IN ("+t+")")]):[2,[]];case 1:return(r=o.sent())&&r.length?[2,Promise.all(r.map(function(e){return __awaiter(n,void 0,void 0,function(){var t;return __generator(this,function(r){return t=new i.Table(e.name),[2,t]})})}))]:[2,[]]}})})},t.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,i=this;return __generator(this,function(o){switch(o.label){case 0:return[4,this.startTransaction()];case 1:o.sent(),o.label=2;case 2:return o.trys.push([2,6,,11]),e="select 'drop table \"' || name || '\";' as query from sqlite_master where type = 'table' and name != 'sqlite_sequence'",[4,this.query(e)];case 3:return t=o.sent(),[4,Promise.all(t.map(function(e){return i.query(e.query)}))];case 4:return o.sent(),[4,this.commitTransaction()];case 5:return o.sent(),[3,11];case 6:r=o.sent(),o.label=7;case 7:return o.trys.push([7,9,,10]),[4,this.rollbackTransaction()];case 8:return o.sent(),[3,10];case 9:return n=o.sent(),[3,10];case 10:throw r;case 11:return[2]}})})},t}(s.AbstractSqliteQueryRunner),e("WebsqlQueryRunner",c)}}}),System.register("typeorm/driver/websql/WebsqlDriver",["typeorm/driver/DriverUtils","typeorm/error/DriverOptionNotSetError","typeorm/driver/websql/WebsqlQueryRunner","typeorm/driver/sqlite-abstract/AbstractSqliteDriver","typeorm/query-builder/ArrayParameter"],function(e,t){"use strict";var r,n,i,o,a,s;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(e){function t(t){var i=e.call(this,t)||this;if(i.options=t.options,Object.assign(t.options,r.DriverUtils.buildDriverOptions(t.options)),i.database=i.options.database,!i.options.database)throw new n.DriverOptionNotSetError("database");return i}return __extends(t,e),t.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve()]})})},t.prototype.disconnect=function(){return Promise.resolve()},t.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new i.WebsqlQueryRunner(this)},t.prototype.preparePersistentValue=function(t,r){return"json"===r.type?JSON.stringify(t):e.prototype.preparePersistentValue.call(this,t,r)},t.prototype.prepareHydratedValue=function(t,r){return"json"===r.type?JSON.parse(t):e.prototype.prepareHydratedValue.call(this,t,r)},t.prototype.escapeQueryWithParameters=function(e,t,r){var n=Object.keys(r).map(function(e){return r[e]});if(!t||!Object.keys(t).length)return[e,n];var i=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(i,"g"),function(e){var r=t[e.substr(1)];return r instanceof Function?r():(r instanceof a.ArrayParameter&&(r=r.value),n.push(r),"?")}),[e,n]},t.prototype.escape=function(e){return e},t}(o.AbstractSqliteDriver),e("WebsqlDriver",s)}}}),System.register("typeorm/driver/sqlite/SqliteQueryRunner",["typeorm/error/QueryRunnerAlreadyReleasedError","typeorm/error/QueryFailedError","typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner","typeorm/subscriber/Broadcaster"],function(e,t){"use strict";var r,n,i,o,a;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(e){function t(t){var r=e.call(this,t)||this;return r.driver=t,r.connection=t.connection,r.broadcaster=new o.Broadcaster(r),r}return __extends(t,e),t.prototype.query=function(e,t){var i=this;if(this.isReleased)throw new r.QueryRunnerAlreadyReleasedError;var o=this.driver.connection;return new Promise(function(r,a){return __awaiter(i,void 0,void 0,function(){var i,s,u,c;return __generator(this,function(l){switch(l.label){case 0:return i=function(i,s){var l=o.options.maxQueryExecutionTime,p=+new Date-u;l&&p>l&&o.logger.logQuerySlow(p,e,t,this),i?(o.logger.logQueryError(i,e,t,this),a(new n.QueryFailedError(e,t,i))):r(c?this.lastID:s)},[4,this.connect()];case 1:return s=l.sent(),this.driver.connection.logger.logQuery(e,t,this),u=+new Date,(c="INSERT INTO"===e.substr(0,11))?s.run(e,t,i):s.all(e,t,i),[2]}})})})},t}(i.AbstractSqliteQueryRunner),e("SqliteQueryRunner",a)}}}),System.register("typeorm/driver/sqlite/SqliteDriver",["typeorm/error/DriverPackageNotInstalledError","typeorm/driver/sqlite/SqliteQueryRunner","typeorm/error/DriverOptionNotSetError","typeorm/platform/PlatformTools","typeorm/driver/sqlite-abstract/AbstractSqliteDriver"],function(e,t){"use strict";var r,n,i,o,a,s;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(e){function t(t){var r=e.call(this,t)||this;if(r.connection=t,r.options=t.options,r.database=r.options.database,!r.options.database)throw new i.DriverOptionNotSetError("database");return r.loadDependencies(),r}return __extends(t,e),t.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,r){e.queryRunner=void 0,e.databaseConnection.close(function(e){return e?r(e):t()})})]})})},t.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new n.SqliteQueryRunner(this)),this.queryRunner},t.prototype.normalizeType=function(t){return t.type===Buffer?"blob":e.prototype.normalizeType.call(this,t)},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,r){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return[4,this.createDatabaseDirectory(this.options.database)];case 1:return n.sent(),e=new this.sqlite.Database(this.options.database,function(n){if(n)return r(n);e.run("PRAGMA foreign_keys = ON;",function(n,i){if(n)return r(n);t(e)})}),[2]}})})})},t.prototype.loadDependencies=function(){try{this.sqlite=o.PlatformTools.load("sqlite3").verbose()}catch(e){throw new r.DriverPackageNotInstalledError("SQLite","sqlite3")}},t.prototype.createDatabaseDirectory=function(e){return new Promise(function(t,r){o.PlatformTools.load("mkdirp")(o.PlatformTools.load("path").dirname(e),function(e){return e?r(e):t()})})},t}(a.AbstractSqliteDriver),e("SqliteDriver",s)}}}),System.register("typeorm/query-builder/UpdateQueryBuilder",["typeorm/query-builder/QueryBuilder","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/postgres/PostgresDriver","typeorm/metadata/EntityMetadataUtils","typeorm/query-builder/result/UpdateResult","typeorm/error/ReturningStatementNotSupportedError","typeorm/query-builder/ReturningResultsEntityUpdator","typeorm/driver/sqljs/SqljsDriver","typeorm/driver/mysql/MysqlDriver","typeorm/driver/websql/WebsqlDriver","typeorm/driver/sqlite/SqliteDriver","typeorm/subscriber/BroadcasterResult"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l,p,d,m,f;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e},function(e){d=e},function(e){m=e}],execute:function(){f=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.expressionMap.aliasNamePrefixingEnabled=!1,n}return __extends(t,e),t.prototype.getQuery=function(){return this.createUpdateExpression().trim()},t.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,i,o,s,l,p,d,f;return __generator(this,function(h){switch(h.label){case 0:e=this.obtainQueryRunner(),t=!1,h.label=1;case 1:return h.trys.push([1,13,18,23]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:h.sent(),t=!0,h.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(p=new m.BroadcasterResult,e.broadcaster.broadcastBeforeUpdateEvent(p,this.expressionMap.mainAlias.metadata),p.promises.length>0?[4,Promise.all(p.promises)]:[3,5]):[3,5];case 4:h.sent(),h.label=5;case 5:return r=new u.ReturningResultsEntityUpdator(e,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=r.getUpdationReturningColumns()),n=this.getQueryAndParameters(),i=n[0],o=n[1],s=new a.UpdateResult,l=s,[4,e.query(i,o)];case 6:return l.raw=h.sent(),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0?[4,r.update(s,this.expressionMap.whereEntities)]:[3,8];case 7:h.sent(),h.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(p=new m.BroadcasterResult,e.broadcaster.broadcastAfterUpdateEvent(p,this.expressionMap.mainAlias.metadata),p.promises.length>0?[4,Promise.all(p.promises)]:[3,10]):[3,10];case 9:h.sent(),h.label=10;case 10:return t?[4,e.commitTransaction()]:[3,12];case 11:h.sent(),h.label=12;case 12:return[2,s];case 13:if(d=h.sent(),!t)return[3,17];h.label=14;case 14:return h.trys.push([14,16,,17]),[4,e.rollbackTransaction()];case 15:return h.sent(),[3,17];case 16:return f=h.sent(),[3,17];case 17:throw d;case 18:return e===this.queryRunner?[3,20]:[4,e.release()];case 19:h.sent(),h.label=20;case 20:return this.connection.driver instanceof c.SqljsDriver&&!e.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,22];case 21:h.sent(),h.label=22;case 22:return[7];case 23:return[2]}})})},t.prototype.set=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var r=this.computeWhereParameter(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new s.ReturningStatementNotSupportedError;return this.expressionMap.returning=e,this},t.prototype.whereEntity=function(e){var t=this;if(!this.expressionMap.mainAlias.hasMetadata)throw new Error(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];var r=e instanceof Array?e:[e];return r.forEach(function(e){var r=t.expressionMap.mainAlias.metadata.getEntityIdMap(e);if(!r)throw new Error("Provided entity does not have ids set, cannot perform operation.");t.orWhereInIds(r)}),this.expressionMap.whereEntities=r,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.createUpdateExpression=function(){var e=this,t=this.getValueSet(),r=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,a=[],s={},u=this.connection.driver instanceof l.MysqlDriver||this.connection.driver instanceof d.SqliteDriver||this.connection.driver instanceof p.WebsqlDriver?0:Object.keys(this.expressionMap.nativeParameters).length;r?(o.EntityMetadataUtils.createPropertyPath(r,t).forEach(function(i){r.findColumnsWithPropertyPath(i).forEach(function(r){var i="_updated_"+r.databaseName,o=r.getEntityValue(t);r.referencedColumn&&o instanceof Object&&(o=r.referencedColumn.getEntityValue(o)),(o=e.connection.driver.preparePersistentValue(o,r))instanceof Function?a.push(e.escape(r.databaseName)+" = "+o()):(e.connection.driver instanceof n.SqlServerDriver&&(o=e.connection.driver.parametrizeValue(r,o)),e.connection.driver instanceof l.MysqlDriver||e.connection.driver instanceof d.SqliteDriver||e.connection.driver instanceof p.WebsqlDriver?s[i]=o:e.expressionMap.nativeParameters[i]=o,a.push(e.escape(r.databaseName)+" = "+e.connection.driver.createParameter(i,u)),u++)})}),r.versionColumn&&a.push(this.escape(r.versionColumn.databaseName)+" = "+this.escape(r.versionColumn.databaseName)+" + 1"),r.updateDateColumn&&a.push(this.escape(r.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP")):Object.keys(t).map(function(r){var n=t[r];n instanceof Function?a.push(e.escape(r)+" = "+n()):(e.connection.driver instanceof l.MysqlDriver||e.connection.driver instanceof d.SqliteDriver||e.connection.driver instanceof p.WebsqlDriver?s[r]=n:e.expressionMap.nativeParameters[r]=n,a.push(e.escape(r)+" = "+e.connection.driver.createParameter(r,u)),u++)}),(this.connection.driver instanceof l.MysqlDriver||this.connection.driver instanceof d.SqliteDriver||this.connection.driver instanceof p.WebsqlDriver)&&(this.expressionMap.nativeParameters=Object.assign(s,this.expressionMap.nativeParameters));var c=this.createWhereExpression(),m=this.createReturningExpression();return m&&this.connection.driver instanceof i.PostgresDriver?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+a.join(", ")+c+" RETURNING "+m:m&&this.connection.driver instanceof n.SqlServerDriver?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+a.join(", ")+" OUTPUT "+m+c:"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+a.join(", ")+c},t.prototype.getValueSet=function(){if(this.expressionMap.valuesSet instanceof Object)return this.expressionMap.valuesSet;throw new Error('Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify inserted values.')},t}(r.QueryBuilder),e("UpdateQueryBuilder",f)}}}),System.register("typeorm/query-builder/DeleteQueryBuilder",["typeorm/query-builder/QueryBuilder","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/postgres/PostgresDriver","typeorm/query-builder/result/DeleteResult","typeorm/error/ReturningStatementNotSupportedError","typeorm/driver/sqljs/SqljsDriver","typeorm/subscriber/BroadcasterResult"],function(e,t){"use strict";var r,n,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.expressionMap.aliasNamePrefixingEnabled=!1,n}return __extends(t,e),t.prototype.getQuery=function(){return this.createDeleteExpression().trim()},t.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,i,a,c,l,p,d;return __generator(this,function(m){switch(m.label){case 0:e=this.getQueryAndParameters(),t=e[0],r=e[1],n=this.obtainQueryRunner(),i=!1,m.label=1;case 1:return m.trys.push([1,11,16,21]),!0!==this.expressionMap.useTransaction||!1!==n.isTransactionActive?[3,3]:[4,n.startTransaction()];case 2:m.sent(),i=!0,m.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(l=new u.BroadcasterResult,n.broadcaster.broadcastBeforeRemoveEvent(l,this.expressionMap.mainAlias.metadata),l.promises.length>0?[4,Promise.all(l.promises)]:[3,5]):[3,5];case 4:m.sent(),m.label=5;case 5:return a=new o.DeleteResult,c=a,[4,n.query(t,r)];case 6:return c.raw=m.sent(),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(l=new u.BroadcasterResult,n.broadcaster.broadcastAfterRemoveEvent(l,this.expressionMap.mainAlias.metadata),l.promises.length>0?[4,Promise.all(l.promises)]:[3,8]):[3,8];case 7:m.sent(),m.label=8;case 8:return i?[4,n.commitTransaction()]:[3,10];case 9:m.sent(),m.label=10;case 10:return[2,a];case 11:if(p=m.sent(),!i)return[3,15];m.label=12;case 12:return m.trys.push([12,14,,15]),[4,n.rollbackTransaction()];case 13:return m.sent(),[3,15];case 14:return d=m.sent(),[3,15];case 15:throw p;case 16:return n===this.queryRunner?[3,18]:[4,n.release()];case 17:m.sent(),m.label=18;case 18:return this.connection.driver instanceof s.SqljsDriver&&!n.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,20];case 19:m.sent(),m.label=20;case 20:return[7];case 21:return[2]}})})},t.prototype.from=function(e,t){var r=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(r),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var r=this.computeWhereParameter(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new a.ReturningStatementNotSupportedError;return this.expressionMap.returning=e,this},t.prototype.createDeleteExpression=function(){var e=this.getTableName(this.getMainTableName()),t=this.createWhereExpression(),r=this.createReturningExpression();return r&&this.connection.driver instanceof i.PostgresDriver?"DELETE FROM "+e+t+" RETURNING "+r:""!==r&&this.connection.driver instanceof n.SqlServerDriver?"DELETE FROM "+e+" OUTPUT "+r+t:"DELETE FROM "+e+t},t}(r.QueryBuilder),e("DeleteQueryBuilder",c)}}}),System.register("typeorm/error/InsertValuesMissingError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(){var t=e.call(this)||this;return t.name="InsertValuesMissingError",t.message='Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.',t}return __extends(t,e),t}(Error),e("InsertValuesMissingError",r)}}}),System.register("typeorm/query-builder/InsertQueryBuilder",["typeorm/query-builder/QueryBuilder","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/postgres/PostgresDriver","typeorm/driver/mysql/MysqlDriver","typeorm/util/RandomGenerator","typeorm/query-builder/result/InsertResult","typeorm/error/ReturningStatementNotSupportedError","typeorm/error/InsertValuesMissingError","typeorm/query-builder/ReturningResultsEntityUpdator","typeorm/driver/sqlite-abstract/AbstractSqliteDriver","typeorm/driver/sqljs/SqljsDriver","typeorm/subscriber/BroadcasterResult"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l,p,d,m,f;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e},function(e){d=e},function(e){m=e}],execute:function(){f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getQuery=function(){return this.createInsertExpression().trim()},t.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,i,o,a,u,c,p,f,h,y,g=this;return __generator(this,function(v){switch(v.label){case 0:e=this.obtainQueryRunner(),t=!1,v.label=1;case 1:return v.trys.push([1,13,18,23]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:v.sent(),t=!0,v.label=3;case 3:return r=this.getValueSets(),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(n=new m.BroadcasterResult,r.forEach(function(t){e.broadcaster.broadcastBeforeInsertEvent(n,g.expressionMap.mainAlias.metadata,t)}),n.promises.length>0?[4,Promise.all(n.promises)]:[3,5]):[3,5];case 4:v.sent(),v.label=5;case 5:return i=new l.ReturningResultsEntityUpdator(e,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.extraReturningColumns=i.getInsertionReturningColumns()),o=this.getQueryAndParameters(),a=o[0],u=o[1],c=new s.InsertResult,p=c,[4,e.query(a,u)];case 6:return p.raw=v.sent(),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata?[4,i.insert(c,r)]:[3,8];case 7:v.sent(),v.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(f=new m.BroadcasterResult,r.forEach(function(t){e.broadcaster.broadcastAfterInsertEvent(f,g.expressionMap.mainAlias.metadata,t)}),f.promises.length>0?[4,Promise.all(f.promises)]:[3,10]):[3,10];case 9:v.sent(),v.label=10;case 10:return t?[4,e.commitTransaction()]:[3,12];case 11:v.sent(),v.label=12;case 12:return[2,c];case 13:if(h=v.sent(),!t)return[3,17];v.label=14;case 14:return v.trys.push([14,16,,17]),[4,e.rollbackTransaction()];case 15:return v.sent(),[3,17];case 16:return y=v.sent(),[3,17];case 17:throw h;case 18:return e===this.queryRunner?[3,20]:[4,e.release()];case 19:v.sent(),v.label=20;case 20:return this.connection.driver instanceof d.SqljsDriver&&!e.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,22];case 21:v.sent(),v.label=22;case 22:return[7];case 23:return[2]}})})},t.prototype.into=function(e,t){var r=this.createFromAlias(e);return this.expressionMap.setMainAlias(r),this.expressionMap.insertColumns=t||[],this},t.prototype.values=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new u.ReturningStatementNotSupportedError;return this.expressionMap.returning=e,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.onConflict=function(e){return this.expressionMap.onConflict=e,this},t.prototype.createInsertExpression=function(){var e=this.getTableName(this.getMainTableName()),t=this.createReturningExpression(),r=this.createColumnNamesExpression(),a=this.createValuesExpression(),s="INSERT INTO "+e;return r?s+="("+r+")":!a&&this.connection.driver instanceof o.MysqlDriver&&(s+="()"),t&&this.connection.driver instanceof n.SqlServerDriver&&(s+=" OUTPUT "+t),a?s+=" VALUES "+a:this.connection.driver instanceof o.MysqlDriver?s+=" VALUES ()":s+=" DEFAULT VALUES",this.expressionMap.onConflict&&this.connection.driver instanceof i.PostgresDriver&&(s+=" ON CONFLICT "+this.expressionMap.onConflict),t&&this.connection.driver instanceof i.PostgresDriver&&(s+=" RETURNING "+t),s},t.prototype.getInsertedColumns=function(){var e=this;return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter(function(t){return e.expressionMap.insertColumns.length?e.expressionMap.insertColumns.indexOf(t.propertyPath):!t.isGenerated||"increment"!==t.generationStrategy}):[]},t.prototype.createColumnNamesExpression=function(){var e=this,t=this.getInsertedColumns();if(t.length>0)return t.map(function(t){return e.escape(t.databaseName)}).join(", ");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){var r=this.getValueSets();if(1===r.length)return Object.keys(r[0]).map(function(t){return e.escape(t)}).join(", ")}return this.expressionMap.insertColumns.map(function(t){return e.escape(t)}).join(", ")},t.prototype.createValuesExpression=function(){var e=this,t=this.getValueSets(),r=this.getInsertedColumns();if(r.length>0){var i="",o=Object.keys(this.expressionMap.nativeParameters).length;return t.forEach(function(s,u){r.forEach(function(c,l){0===l&&(i+="(");var d="_inserted_"+u+"_"+c.databaseName,m=c.getEntityValue(s);if(c.referencedColumn&&m instanceof Object&&!(m instanceof Function)&&(m=c.referencedColumn.getEntityValue(m)),m=e.connection.driver.preparePersistentValue(m,c),c.isVersion)i+="1";else if(c.isGenerated&&"uuid"===c.generationStrategy&&!e.connection.driver.isUUIDGenerationSupported()&&void 0===m){var f="_uuid_"+c.databaseName+u;m=a.RandomGenerator.uuid4(),e.expressionMap.nativeParameters[f]=m,i+=e.connection.driver.createParameter(f,o),o++}else void 0===m?e.connection.driver instanceof p.AbstractSqliteDriver?void 0!==c.default?i+=e.connection.driver.normalizeDefault(c):i+="NULL":i+="DEFAULT":m instanceof Function?i+=m():(e.connection.driver instanceof n.SqlServerDriver&&(m=e.connection.driver.parametrizeValue(c,m)),e.expressionMap.nativeParameters[d]=m,i+=e.connection.driver.createParameter(d,o),o++);l===r.length-1?u===t.length-1?i+=")":i+="), ":i+=", "})}),i}return t.map(function(t,r){var n=Object.keys(t).map(function(n){var i="_inserted_"+r+"_"+n,o=t[n];return o instanceof Function?o():void 0===o?e.connection.driver instanceof p.AbstractSqliteDriver?"NULL":"DEFAULT":(e.expressionMap.nativeParameters[i]=o,e.connection.driver.createParameter(i,Object.keys(e.expressionMap.nativeParameters).length-1))}).join(", ").trim();return n?"("+n+")":""}).join(", ")},t.prototype.getValueSets=function(){if(this.expressionMap.valuesSet instanceof Array&&this.expressionMap.valuesSet.length>0)return this.expressionMap.valuesSet;if(this.expressionMap.valuesSet instanceof Object)return[this.expressionMap.valuesSet];throw new c.InsertValuesMissingError},t}(r.QueryBuilder),e("InsertQueryBuilder",f)}}}),System.register("typeorm/query-builder/RelationUpdater",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.update=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,i,o,a,s,u,c,l,p,d,m;return __generator(this,function(f){switch(f.label){case 0:return(t=this.expressionMap.relationMetadata).isManyToOne||t.isOneToOneOwner?(s=t.joinColumns.reduce(function(t,r){var n=e instanceof Object?r.referencedColumn.getEntityValue(e):e;return r.setEntityValue(t,n),t},{}),!this.expressionMap.of||this.expressionMap.of instanceof Array&&!this.expressionMap.of.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(t.entityMetadata.target).set(s).whereInIds(this.expressionMap.of).execute()]):[3,2];case 1:return f.sent(),[3,8];case 2:return!t.isOneToOneNotOwner&&!t.isOneToMany||null!==e?[3,4]:(r={},t.inverseRelation.joinColumns.forEach(function(e){r[e.propertyName]=null}),c=this.expressionMap.of instanceof Array?this.expressionMap.of:[this.expressionMap.of],n={},i=[],c.forEach(function(e,r){t.inverseRelation.joinColumns.map(function(t,o){var a="joinColumn_"+r+"_"+o;n[a]=e instanceof Object?t.referencedColumn.getEntityValue(e):e,i.push(t.propertyPath+" = :"+a)})}),(o=i.map(function(e){return"("+e+")"}).join(" OR "))?[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(r).where(o).setParameters(n).execute()]:[2]);case 3:return f.sent(),[3,8];case 4:if(!t.isOneToOneNotOwner&&!t.isOneToMany)return[3,6];if(this.expressionMap.of instanceof Array)throw new Error("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");return a=this.expressionMap.of,s=t.inverseRelation.joinColumns.reduce(function(e,t){var r=a instanceof Object?t.referencedColumn.getEntityValue(a):a;return t.setEntityValue(e,r),e},{}),!e||e instanceof Array&&!e.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(s).whereInIds(e).execute()];case 5:return f.sent(),[3,8];case 6:return u=t.junctionEntityMetadata,c=this.expressionMap.of instanceof Array?this.expressionMap.of:[this.expressionMap.of],l=e instanceof Array?e:[e],p=t.isManyToManyOwner?c:l,d=t.isManyToManyOwner?l:c,m=[],p.forEach(function(e){d.forEach(function(t){var r={};u.ownerColumns.forEach(function(t){r[t.databaseName]=e instanceof Object?t.referencedColumn.getEntityValue(e):e}),u.inverseColumns.forEach(function(e){r[e.databaseName]=t instanceof Object?e.referencedColumn.getEntityValue(t):t}),m.push(r)})}),m.length?[4,this.queryBuilder.createQueryBuilder().insert().into(u.tableName).values(m).execute()]:[2];case 7:f.sent(),f.label=8;case 8:return[2]}})})},e}(),e("RelationUpdater",r)}}}),System.register("typeorm/query-builder/RelationRemover",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.remove=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,i,o,a,s,u,c,l,p,d,m;return __generator(this,function(f){switch(f.label){case 0:return(t=this.expressionMap.relationMetadata).isOneToMany?(s=this.expressionMap.of instanceof Array?this.expressionMap.of:[this.expressionMap.of],r=e instanceof Array?e:[e],n={},t.inverseRelation.joinColumns.forEach(function(e){n[e.propertyName]=null}),i={},o=[],s.forEach(function(e,n){o.push.apply(o,r.map(function(r,o){return t.inverseRelation.joinColumns.map(function(t,r){var a="joinColumn_"+n+"_"+o+"_"+r;return i[a]=e instanceof Object?t.referencedColumn.getEntityValue(e):e,t.propertyPath+" = :"+a}).concat(t.inverseRelation.entityMetadata.primaryColumns.map(function(e,t){var n="primaryColumn_"+o+"_"+o+"_"+t;return i[n]=r instanceof Object?e.getEntityValue(r):r,e.propertyPath+" = :"+n})).join(" AND ")}))}),(m=o.map(function(e){return"("+e+")"}).join(" OR "))?[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(n).where(m).setParameters(i).execute()]:[2]):[3,2];case 1:return f.sent(),[3,4];case 2:return a=t.junctionEntityMetadata,s=this.expressionMap.of instanceof Array?this.expressionMap.of:[this.expressionMap.of],u=e instanceof Array?e:[e],c=t.isManyToManyOwner?s:u,l=t.isManyToManyOwner?u:s,p={},d=[],c.forEach(function(e,t){d.push.apply(d,l.map(function(r,n){return a.ownerColumns.map(function(r,i){var o="firstValue_"+t+"_"+n+"_"+i;return p[o]=e instanceof Object?r.referencedColumn.getEntityValue(e):e,r.databaseName+" = :"+o}).concat(a.inverseColumns.map(function(i,o){var a="secondValue_"+t+"_"+n+"_"+o;return p[a]=e instanceof Object?i.referencedColumn.getEntityValue(r):r,i.databaseName+" = :"+a})).join(" AND ")}))}),m=d.map(function(e){return"("+e+")"}).join(" OR "),[4,this.queryBuilder.createQueryBuilder().delete().from(a.tableName).where(m).setParameters(p).execute()];case 3:f.sent(),f.label=4;case 4:return[2]}})})},e}(),e("RelationRemover",r)}}}),System.register("typeorm/query-builder/RelationLoader",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e){this.connection=e}return e.prototype.load=function(e,t){return e.isManyToOne||e.isOneToOneOwner?this.loadManyToOneOrOneToOneOwner(e,t):e.isOneToMany||e.isOneToOneNotOwner?this.loadOneToManyOrOneToOneNotOwner(e,t):e.isManyToManyOwner?this.loadManyToManyOwner(e,t):this.loadManyToManyNotOwner(e,t)},e.prototype.loadManyToOneOrOneToOneOwner=function(e,t){var r=e.entityMetadata.primaryColumns,n=(e.isOwning?e.joinColumns:e.inverseRelation.joinColumns).map(function(t){return e.entityMetadata.name+"."+e.propertyName+" = "+e.propertyName+"."+t.referencedColumn.propertyName}).join(" AND "),i=this.connection.createQueryBuilder().select(e.propertyName).from(e.type,e.propertyName).innerJoin(e.entityMetadata.target,e.entityMetadata.name,n);return r.forEach(function(r){i.andWhere(e.entityMetadata.name+"."+r.propertyPath+" = :"+r.propertyName).setParameter(""+r.propertyName,r.getEntityValue(t))}),i.getOne()},e.prototype.loadOneToManyOrOneToOneNotOwner=function(e,t){var r=this.connection.createQueryBuilder().select(e.propertyName).from(e.inverseRelation.entityMetadata.target,e.propertyName);return e.inverseRelation.joinColumns.forEach(function(n){r.andWhere(e.propertyName+"."+n.propertyName+" = :"+n.referencedColumn.propertyName).setParameter(""+n.referencedColumn.propertyName,n.referencedColumn.getEntityValue(t))}),e.isOneToMany?r.getMany():r.getOne()},e.prototype.loadManyToManyOwner=function(e,t){var r=e.propertyName,n=e.junctionEntityMetadata.tableName,i=e.joinColumns.map(function(e){return n+"."+e.propertyName+" = :"+e.propertyName}),o=e.inverseJoinColumns.map(function(e){return n+"."+e.propertyName+"="+r+"."+e.referencedColumn.propertyName}),a=e.joinColumns.reduce(function(e,r){return e[r.propertyName]=r.referencedColumn.getEntityValue(t),e},{});return this.connection.createQueryBuilder().select(r).from(e.type,r).innerJoin(n,n,i.concat(o).join(" AND ")).setParameters(a).getMany()},e.prototype.loadManyToManyNotOwner=function(e,t){var r=e.propertyName,n=e.junctionEntityMetadata.tableName,i=e.inverseRelation.joinColumns.map(function(e){return n+"."+e.propertyName+" = "+r+"."+e.referencedColumn.propertyName}),o=e.inverseRelation.inverseJoinColumns.map(function(e){return n+"."+e.propertyName+" = :"+e.propertyName}),a=e.inverseRelation.inverseJoinColumns.reduce(function(e,r){return e[r.propertyName]=r.referencedColumn.getEntityValue(t),e},{});return this.connection.createQueryBuilder().select(r).from(e.type,r).innerJoin(n,n,i.concat(o).join(" AND ")).setParameters(a).getMany()},e}(),e("RelationLoader",r)}}}),System.register("typeorm/query-builder/RelationQueryBuilder",["typeorm/query-builder/QueryBuilder","typeorm/query-builder/RelationUpdater","typeorm/query-builder/RelationRemover","typeorm/query-builder/RelationLoader"],function(e,t){"use strict";var r,n,i,o,a;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getQuery=function(){return""},t.prototype.of=function(e){return this.expressionMap.of=e,this},t.prototype.set=function(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(i){if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToMany||t.isOneToMany)throw new Error('Set operation is only supported for many-to-one and one-to-one relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .add() method instead.");if(t.joinColumns&&t.joinColumns.length>1&&(!(e instanceof Object)||Object.keys(e).length<t.joinColumns.length))throw new Error('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return r=new n.RelationUpdater(this,this.expressionMap),[2,r.update(e)]})})},t.prototype.add=function(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(i){if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw new Error('Add operation is only supported for many-to-many and one-to-many relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .set() method instead.");if(t.joinColumns&&t.joinColumns.length>1&&(!(e instanceof Object)||Object.keys(e).length<t.joinColumns.length))throw new Error('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return r=new n.RelationUpdater(this,this.expressionMap),[2,r.update(e)]})})},t.prototype.remove=function(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(n){if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw new Error('Add operation is only supported for many-to-many and one-to-many relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .set(null) method instead.");return r=new i.RelationRemover(this,this.expressionMap),[2,r.remove(e)]})})},t.prototype.addAndRemove=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.remove(t)];case 1:return r.sent(),[4,this.add(e)];case 2:return r.sent(),[2]}})})},t.prototype.loadOne=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r;return __generator(this,function(n){if(!((e=this.expressionMap.of)instanceof Object)){if((t=this.expressionMap.mainAlias.metadata).hasMultiplePrimaryKeys)throw new Error("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");e=t.primaryColumns[0].createValueMap(e)}return r=new o.RelationLoader(this.connection),[2,r.load(this.expressionMap.relationMetadata,e)]})})},t.prototype.loadMany=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.loadOne()]})})},t}(r.QueryBuilder),e("RelationQueryBuilder",a)}}}),System.register("typeorm/query-builder/QueryBuilder",["typeorm/query-builder/QueryExpressionMap","typeorm/query-builder/Brackets","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/postgres/PostgresDriver","typeorm/driver/mysql/MysqlDriver","typeorm/metadata/EntityMetadataUtils","typeorm/driver/sqljs/SqljsDriver"],function(e,t){"use strict";var r,n,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(){function e(t,n){t instanceof e?(this.connection=t.connection,this.queryRunner=t.queryRunner,this.expressionMap=t.expressionMap.clone()):(this.connection=t,this.queryRunner=n,this.expressionMap=new r.QueryExpressionMap(this.connection))}return Object.defineProperty(e.prototype,"alias",{get:function(){if(!this.expressionMap.mainAlias)throw new Error("Main alias is not set");return this.expressionMap.mainAlias.name},enumerable:!0,configurable:!0}),e.prototype.select=function(e,t){this.expressionMap.queryType="select",e instanceof Array?this.expressionMap.selects=e.map(function(e){return{selection:e}}):e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);var r=require("./SelectQueryBuilder").SelectQueryBuilder;return this instanceof r?this:new r(this)},e.prototype.insert=function(){this.expressionMap.queryType="insert";var e=require("./InsertQueryBuilder").InsertQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.update=function(e,t){var r=t||e;if(e instanceof Function||"string"==typeof e){var n=this.createFromAlias(e);this.expressionMap.setMainAlias(n)}this.expressionMap.queryType="update",this.expressionMap.valuesSet=r;var i=require("./UpdateQueryBuilder").UpdateQueryBuilder;return this instanceof i?this:new i(this)},e.prototype.delete=function(){this.expressionMap.queryType="delete";var e=require("./DeleteQueryBuilder").DeleteQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.relation=function(e,t){var r=2===arguments.length?e:void 0,n=2===arguments.length?t:e;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=n,r){var i=this.createFromAlias(r);this.expressionMap.setMainAlias(i)}var o=require("./RelationQueryBuilder").RelationQueryBuilder;return this instanceof o?this:new o(this)},e.prototype.hasRelation=function(e,t){var r=this.connection.getMetadata(e);return(t instanceof Array?t:[t]).every(function(e){return!!r.findRelationWithPropertyPath(e)})},e.prototype.setParameter=function(e,t){return this.expressionMap.parameters[e]=t,this},e.prototype.setParameters=function(e){var t=this;return this.expressionMap.parentQueryBuilder&&this.expressionMap.parentQueryBuilder.setParameters(e),Object.keys(e).forEach(function(r){t.expressionMap.parameters[r]=e[r]}),this},e.prototype.setNativeParameters=function(e){var t=this;return this.expressionMap.parentQueryBuilder&&this.expressionMap.parentQueryBuilder.setNativeParameters(e),Object.keys(e).forEach(function(r){t.expressionMap.nativeParameters[r]=e[r]}),this},e.prototype.getParameters=function(){var e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){var r=t.childEntityMetadatas.filter(function(e){return e.discriminatorColumn}).map(function(e){return e.discriminatorValue});r.push(t.discriminatorValue),e.discriminatorColumnValues=r}}return e},e.prototype.printSql=function(){return console.log(this.getSql()),this},e.prototype.getSql=function(){return this.getQueryAndParameters()[0]},e.prototype.getQueryAndParameters=function(){var e=this.getQuery(),t=this.getParameters();return this.connection.driver.escapeQueryWithParameters(e,t,this.expressionMap.nativeParameters)},e.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n;return __generator(this,function(i){switch(i.label){case 0:e=this.getQueryAndParameters(),t=e[0],r=e[1],n=this.obtainQueryRunner(),i.label=1;case 1:return i.trys.push([1,,3,8]),[4,n.query(t,r)];case 2:return[2,i.sent()];case 3:return n===this.queryRunner?[3,5]:[4,n.release()];case 4:i.sent(),i.label=5;case 5:return this.connection.driver instanceof u.SqljsDriver?[4,this.connection.driver.autoSave()]:[3,7];case 6:i.sent(),i.label=7;case 7:return[7];case 8:return[2]}})})},e.prototype.createQueryBuilder=function(){return new this.constructor(this.connection,this.queryRunner)},e.prototype.clone=function(){return new this.constructor(this)},e.prototype.disableEscaping=function(){return this.expressionMap.disableEscaping=!1,this},e.prototype.escape=function(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e},e.prototype.setQueryRunner=function(e){return this.queryRunner=e,this},e.prototype.callListeners=function(e){return this.expressionMap.callListeners=e,this},e.prototype.useTransaction=function(e){return this.expressionMap.useTransaction=e,this},e.prototype.getTableName=function(e){var t=this,r=e,n=this.connection.driver,s=n.options.schema,u=this.connection.hasMetadata(e)?this.connection.getMetadata(e):void 0;return(n instanceof i.SqlServerDriver||n instanceof o.PostgresDriver||n instanceof a.MysqlDriver)&&(u?(u.schema?r=u.schema+"."+e:s&&(r=s+"."+e),!u.database||n instanceof o.PostgresDriver||(r=!s&&!u.schema&&n instanceof i.SqlServerDriver?u.database+".."+r:u.database+"."+r)):s&&(r=s+"."+e)),r.split(".").map(function(e){return""===e?e:t.escape(e)}).join(".")},e.prototype.getMainTableName=function(){if(!this.expressionMap.mainAlias)throw new Error('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tableName:this.expressionMap.mainAlias.tableName},e.prototype.createFromAlias=function(e,t){if(this.connection.hasMetadata(e)){var r=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:"from",name:t,metadata:this.connection.getMetadata(e),tableName:r.tableName})}var n="";if(e instanceof Function){var i=e(this.subQuery());this.setParameters(i.getParameters()),n=i.getQuery()}else n=e;var o=e instanceof Function||"("===e.substr(0,1)&&")"===e.substr(-1);return this.expressionMap.createAlias({type:"from",name:t,tableName:!1===o?e:void 0,subQuery:!0===o?n:void 0})},e.prototype.replacePropertyNames=function(e){var t=this;return this.expressionMap.aliases.forEach(function(r){if(r.hasMetadata){var n=t.expressionMap.aliasNamePrefixingEnabled?r.name+"\\.":"",i=t.expressionMap.aliasNamePrefixingEnabled?t.escape(r.name)+".":"";r.metadata.columns.forEach(function(r){var o="([ =(]|^.{0})"+n+r.propertyPath+"([ =),]|.{0}$)";e=e.replace(new RegExp(o,"gm"),"$1"+i+t.escape(r.databaseName)+"$2");var a="([ =(]|^.{0})"+n+r.propertyName+"([ =),]|.{0}$)";e=e.replace(new RegExp(a,"gm"),"$1"+i+t.escape(r.databaseName)+"$2")}),r.metadata.relations.forEach(function(r){if(r.joinColumns.concat(r.inverseJoinColumns).forEach(function(o){var a="([ =(]|^.{0})"+n+r.propertyPath+"\\."+o.referencedColumn.propertyPath+"([ =),]|.{0}$)";e=e.replace(new RegExp(a,"gm"),"$1"+i+t.escape(o.databaseName)+"$2")}),r.joinColumns.length>0){var o="([ =(]|^.{0})"+n+r.propertyPath+"([ =),]|.{0}$)";e=e.replace(new RegExp(o,"gm"),"$1"+i+t.escape(r.joinColumns[0].databaseName)+"$2")}})}}),e},e.prototype.createWhereExpression=function(){var e=this.createWhereExpressionString();if(this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){var r=this.replacePropertyNames(this.expressionMap.mainAlias.name+"."+t.discriminatorColumn.databaseName)+" IN (:discriminatorColumnValues)";return" WHERE "+(e.length?"("+e+") AND":"")+" "+r}}return e.length?this.expressionMap.extraAppendedAndWhereCondition?" WHERE ("+e+") AND "+this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition):" WHERE "+e:this.expressionMap.extraAppendedAndWhereCondition?" WHERE "+this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition):""},e.prototype.createReturningExpression=function(){var e=this,t=this.getReturningColumns();return"string"!=typeof this.expressionMap.returning&&this.expressionMap.extraReturningColumns.length>0&&this.connection.driver.isReturningSqlSupported()&&t.push.apply(t,this.expressionMap.extraReturningColumns.filter(function(e){return-1===t.indexOf(e)})),t.length?t.map(function(t){var r=e.escape(t.databaseName);return e.connection.driver instanceof i.SqlServerDriver?"insert"===e.expressionMap.queryType||"update"===e.expressionMap.queryType?"INSERTED."+r:e.escape(e.getMainTableName())+"."+r:r}).join(", "):"string"==typeof this.expressionMap.returning?this.expressionMap.returning:""},e.prototype.getReturningColumns=function(){var e=this,t=[];return this.expressionMap.returning instanceof Array&&this.expressionMap.returning.forEach(function(r){e.expressionMap.mainAlias.hasMetadata&&t.push.apply(t,e.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(r))}),t},e.prototype.createWhereExpressionString=function(){var e=this;return this.expressionMap.wheres.map(function(t,r){switch(t.type){case"and":return(r>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(r>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}}).join(" ")},e.prototype.createWhereIdsExpression=function(e){var t=this;e=e instanceof Array?e:[e];var r=this.expressionMap.mainAlias.metadata,n=this.expressionMap.aliasNamePrefixingEnabled?this.escape(this.expressionMap.mainAlias.name)+".":"",i=Object.keys(this.expressionMap.nativeParameters).length,o=e.map(function(e,o){e=r.ensureEntityIdMap(e);var a=[];return r.primaryColumns.forEach(function(r,s){var u="id_"+o+"_"+s;a.push(n+t.escape(r.databaseName)+" = "+t.connection.driver.createParameter(u,i)),t.expressionMap.nativeParameters[u]=r.getEntityValue(e),i++}),r.parentIdColumns.forEach(function(r,s){var u="parentId_"+o+"_"+s;a.push(n+t.escape(r.databaseName)+" = "+t.connection.driver.createParameter(u,i)),t.expressionMap.nativeParameters[u]=r.getEntityValue(e),i++}),a.join(" AND ")});return o.length>1?o.map(function(e){return"("+e+")"}).join(" OR "):o[0]},e.prototype.computeWhereParameter=function(e){var t=this;if("string"==typeof e)return e;if(e instanceof n.Brackets){var r=this.createQueryBuilder();e.whereFactory(r);var i=r.createWhereExpressionString();return this.setParameters(r.getParameters()),i?"("+i+")":""}if(e instanceof Function)return e(this);if(e instanceof Object){var o=e instanceof Array?e:[e],a=void 0,u=Object.keys(this.expressionMap.nativeParameters).length;return(a=this.expressionMap.mainAlias.hasMetadata?o.map(function(e,r){return s.EntityMetadataUtils.createPropertyPath(t.expressionMap.mainAlias.metadata,e).map(function(n,i){return t.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(n).map(function(o,a){var s=o.getEntityValue(e),c=t.expressionMap.aliasNamePrefixingEnabled?t.alias+"."+n:o.propertyPath;if(null===s)return c+" IS NULL";var l="where_"+r+"_"+i+"_"+a;return t.expressionMap.nativeParameters[l]=s,u++,c+" = "+t.connection.driver.createParameter(l,u-1)}).join(" AND ")}).join(" AND ")}):o.map(function(e,r){return Object.keys(e).map(function(n,i){var o=e[n],a=t.expressionMap.aliasNamePrefixingEnabled?t.alias+"."+n:n;if(null===o)return a+" IS NULL";var s="where_"+r+"_"+i;return t.expressionMap.nativeParameters[s]=o,i++,a+" = "+t.connection.driver.createParameter(s,i-1)}).join(" AND ")})).length>1?a.map(function(e){return"("+e+")"}).join(" OR "):a.join("")}return""},e.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner("master")},e}(),e("QueryBuilder",c)}}}),System.register("typeorm/query-builder/QueryExpressionMap",["typeorm/query-builder/Alias","typeorm/query-builder/JoinAttribute","typeorm/query-builder/relation-id/RelationIdAttribute","typeorm/query-builder/relation-count/RelationCountAttribute"],function(e,t){"use strict";var r,n,i,o,a;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.connection=e,this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.extraReturningColumns=[],this.onConflict="",this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.parameters={},this.disableEscaping=!0,this.ignoreParentTablesJoins=!1,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.cache=!1,this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={}}return Object.defineProperty(e.prototype,"allOrderBys",{get:function(){var e=this;if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata){var t=this.mainAlias.metadata.orderBy||{};return Object.keys(t).reduce(function(r,n){return r[e.mainAlias.name+"."+n]=t[n],r},{})}return this.orderBys},enumerable:!0,configurable:!0}),e.prototype.setMainAlias=function(e){return this.mainAlias&&this.aliases.splice(this.aliases.indexOf(this.mainAlias)),this.mainAlias=e,e},e.prototype.createAlias=function(e){var t=e.name;!t&&e.tableName&&(t=e.tableName),!t&&e.target instanceof Function&&(t=e.target.name),t||"string"!=typeof e.target||(t=e.target);var n=new r.Alias;return n.type=e.type,t&&(n.name=t),e.metadata&&(n.metadata=e.metadata),e.target&&!n.hasMetadata&&(n.metadata=this.connection.getMetadata(e.target)),e.tableName&&(n.tableName=e.tableName),e.subQuery&&(n.subQuery=e.subQuery),this.aliases.push(n),n},e.prototype.findAliasByName=function(e){var t=this.aliases.find(function(t){return t.name===e});if(!t)throw new Error('"'+e+'" alias was not found. Maybe you forgot to join it?');return t},e.prototype.findColumnByAliasExpression=function(e){var t=e.split("."),r=t[0],n=t[1];return this.findAliasByName(r).metadata.findColumnWithPropertyName(n)},Object.defineProperty(e.prototype,"relationMetadata",{get:function(){if(!this.mainAlias)throw new Error("Entity to work with is not specified!");var e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Error("Relation "+this.relationPropertyPath+" was not found in entity "+this.mainAlias.name);return e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=this,a=new e(this.connection);return a.queryType=this.queryType,a.selects=this.selects.map(function(e){return e}),this.aliases.forEach(function(e){return a.aliases.push(new r.Alias(e))}),a.mainAlias=this.mainAlias,a.valuesSet=this.valuesSet,a.returning=this.returning,a.onConflict=this.onConflict,a.joinAttributes=this.joinAttributes.map(function(e){return new n.JoinAttribute(t.connection,t,e)}),a.relationIdAttributes=this.relationIdAttributes.map(function(e){return new i.RelationIdAttribute(t,e)}),a.relationCountAttributes=this.relationCountAttributes.map(function(e){return new o.RelationCountAttribute(t,e)}),a.wheres=this.wheres.map(function(e){return __assign({},e)}),a.havings=this.havings.map(function(e){return __assign({},e)}),a.orderBys=Object.assign({},this.orderBys),a.groupBys=this.groupBys.map(function(e){return e}),a.limit=this.limit,a.offset=this.offset,a.skip=this.skip,a.take=this.take,a.lockMode=this.lockMode,a.lockVersion=this.lockVersion,a.parameters=Object.assign({},this.parameters),a.disableEscaping=this.disableEscaping,a.ignoreParentTablesJoins=this.ignoreParentTablesJoins,a.enableRelationIdValues=this.enableRelationIdValues,a.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,a.subQuery=this.subQuery,a.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,a.cache=this.cache,a.cacheId=this.cacheId,a.cacheDuration=this.cacheDuration,a.relationPropertyPath=this.relationPropertyPath,a.of=this.of,a.insertColumns=this.insertColumns,a.whereEntities=this.whereEntities,a.updateEntity=this.updateEntity,a.callListeners=this.callListeners,a.useTransaction=this.useTransaction,a.nativeParameters=this.nativeParameters,a},e}(),e("QueryExpressionMap",a)}}}),System.register("typeorm/query-builder/relation-id/RelationIdAttribute",["typeorm/query-builder/QueryBuilderUtils"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e,t){this.queryExpressionMap=e,this.disableMixedMap=!1,Object.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!r.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(!r.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!r.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");var e=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Error("Relation with property path "+this.relationPropertyPath+" in entity was not found.");return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=this.relationName.split(".");return e[0]+"_"+e[1]+"_relation_id"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionMetadata",{get:function(){return this.relation.junctionEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyPath",{get:function(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)},enumerable:!0,configurable:!0}),e}(),e("RelationIdAttribute",n)}}}),System.register("typeorm/query-builder/relation-id/RelationIdLoadResult",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/relation-count/RelationCountLoadResult",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/transformer/RawSqlResultsToEntityTransformer",["typeorm/util/OrmUtils"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e,t,r,n){this.expressionMap=e,this.driver=t,this.rawRelationIdResults=r,this.rawRelationCountResults=n}return e.prototype.transform=function(e,t){var r=this;return this.group(e,t).map(function(e){return r.transformRawResultsGroup(e,t)}).filter(function(e){return void 0!==e})},e.prototype.group=function(e,t){var r=[];return e.forEach(function(e){var n=t.metadata.primaryColumns.map(function(r){return e[t.name+"_"+r.databaseName]}).join("_");if(n){var i=r.find(function(e){return e.id===n});i||(i={id:n,items:[]},r.push(i)),i.items.push(e)}}),r.map(function(e){return e.items})},e.prototype.transformRawResultsGroup=function(e,t){var r=t.metadata.create();if(t.metadata.discriminatorColumn){var n=e.map(function(e){return e[t.name+"_"+t.metadata.discriminatorColumn.databaseName]}),i=t.metadata.childEntityMetadatas.find(function(e){return!!n.find(function(t){return t===e.discriminatorValue})});i&&(r=i.create())}var o=this.transformColumns(e,t,r,t.metadata),a=this.transformJoins(e,r,t),s=this.transformRelationIds(e,t,r),u=this.transformRelationCounts(e,t,r);if(o)return r;return 0===t.metadata.primaryColumns.filter(function(e){return!1===e.isVirtual}).length&&(a||s||u)?r:void 0},e.prototype.transformColumns=function(e,t,r,n){var i=this,o=!1;return n.columns.forEach(function(n){var a=e[0][t.name+"_"+n.databaseName];void 0===a||n.isVirtual||n.isParentId||n.isDiscriminator||i.expressionMap.selects.find(function(e){return e.selection===t.name||e.selection===t.name+"."+n.propertyPath})&&(n.setEntityValue(r,i.driver.prepareHydratedValue(a,n)),null!==a&&(o=!0))}),t.metadata.parentEntityMetadata&&t.metadata.parentEntityMetadata.columns.forEach(function(n){var a=e[0]["parentIdColumn_"+t.metadata.parentEntityMetadata.tableName+"_"+n.databaseName];void 0===a||n.isVirtual||n.isParentId||n.isDiscriminator||(n.setEntityValue(r,i.driver.prepareHydratedValue(a,n)),null!==a&&(o=!0))}),o},e.prototype.transformJoins=function(e,t,r){var n=this,i=!1,o="";return r.metadata.discriminatorColumn&&(o=e[0][r.name+"_"+r.metadata.discriminatorColumn.databaseName]),this.expressionMap.joinAttributes.forEach(function(a){if(a.metadata&&a.isSelected){var s=r.metadata.childEntityMetadatas.find(function(e){return o===e.discriminatorValue});if(!s||!a.relation||s.target===a.relation.target){if(a.mapToProperty){if(a.mapToPropertyParentAlias!==r.name)return}else if(!a.relation||a.parentAlias!==r.name||a.relationPropertyPath!==a.relation.propertyPath)return;var u=n.transform(e,a.alias);u=a.isMany?u:u[0],void 0!==(u=a.isMany||void 0!==u?u:null)&&(a.mapToPropertyPropertyName?t[a.mapToPropertyPropertyName]=u:a.relation.setEntityValue(t,u),i=!0)}}}),i},e.prototype.transformRelationIds=function(e,t,n){var i=this,o=!1;return this.rawRelationIdResults.forEach(function(a){if(a.relationIdAttribute.parentAlias===t.name){var s=a.relationIdAttribute.relation,u=i.createValueMapFromJoinColumns(s,a.relationIdAttribute.parentAlias,e);if(void 0!==u&&null!==u){var c=a.results.map(function(e){var n=i.extractEntityPrimaryIds(s,e);if(t.metadata.compareIds(n,u)){var o,c=(o=s.isManyToOne||s.isOneToOneOwner?s.joinColumns.map(function(e){return e}):s.isOneToMany||s.isOneToOneNotOwner?s.inverseEntityMetadata.primaryColumns.map(function(e){return e}):s.isOwning?s.inverseJoinColumns.map(function(e){return e}):s.inverseRelation.joinColumns.map(function(e){return e})).reduce(function(t,n){return s.isOneToMany||s.isOneToOneNotOwner?r.OrmUtils.mergeDeep(t,n.createValueMap(e[n.databaseName])):r.OrmUtils.mergeDeep(t,n.referencedColumn.createValueMap(e[n.databaseName]))},{});return 1===o.length&&!1===a.relationIdAttribute.disableMixedMap?s.isOneToMany||s.isOneToOneNotOwner?o[0].getEntityValue(c):o[0].referencedColumn.getEntityValue(c):c}}).filter(function(e){return e}),l=a.relationIdAttribute.mapToPropertyPropertyPath.split("."),p=function(e,t,r){var n=e.shift();return n&&0===e.length?(t[n]=r,t):n&&e.length>0?void p(e,t[n],r):t};s.isOneToOne||s.isManyToOne?void 0!==c[0]&&(p(l,n,c[0]),o=!0):(p(l,n,c),c.length>0&&(o=!0))}}}),o},e.prototype.transformRelationCounts=function(e,t,r){var n=!1;return this.rawRelationCountResults.filter(function(e){return e.relationCountAttribute.parentAlias===t.name}).forEach(function(i){var o,a=i.relationCountAttribute.relation;o=a.isOneToMany?a.inverseRelation.joinColumns[0].referencedColumn.databaseName:a.isOwning?a.joinColumns[0].referencedColumn.databaseName:a.inverseRelation.joinColumns[0].referencedColumn.databaseName;var s=e[0][t.name+"_"+o];void 0!==s&&null!==s&&(r[i.relationCountAttribute.mapToPropertyPropertyName]=0,i.results.filter(function(e){return e.parentId===s}).forEach(function(e){r[i.relationCountAttribute.mapToPropertyPropertyName]=parseInt(e.cnt),n=!0}))}),n},e.prototype.createValueMapFromJoinColumns=function(e,t,r){return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map(function(e){return e}):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map(function(e){return e}):e.isOwning?e.joinColumns.map(function(e){return e}):e.inverseRelation.inverseJoinColumns.map(function(e){return e})).reduce(function(n,i){return r.forEach(function(r){e.isManyToOne||e.isOneToOneOwner?n[i.databaseName]=r[t+"_"+i.databaseName]:n[i.databaseName]=r[t+"_"+i.referencedColumn.databaseName]}),n},{})},e.prototype.extractEntityPrimaryIds=function(e,t){return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map(function(e){return e}):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map(function(e){return e}):e.isOwning?e.joinColumns.map(function(e){return e}):e.inverseRelation.inverseJoinColumns.map(function(e){return e})).reduce(function(e,r){return e[r.databaseName]=t[r.databaseName],e},{})},e}(),e("RawSqlResultsToEntityTransformer",n)}}}),System.register("typeorm/error/PessimisticLockTransactionRequiredError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(){var r=e.call(this)||this;return r.name="PessimisticLockTransactionRequiredError",Object.setPrototypeOf(r,t.prototype),r.message="An open transaction is required for pessimistic lock.",r}return __extends(t,e),t}(Error),e("PessimisticLockTransactionRequiredError",r)}}}),System.register("typeorm/error/NoVersionOrUpdateDateColumnError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(r){var n=e.call(this)||this;return n.name="NoVersionOrUpdateDateColumnError",Object.setPrototypeOf(n,t.prototype),n.message="Entity "+r+" does not have version or update date columns.",n}return __extends(t,e),t}(Error),e("NoVersionOrUpdateDateColumnError",r)}}}),System.register("typeorm/error/OptimisticLockVersionMismatchError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(r,n,i){var o=e.call(this)||this;return o.name="OptimisticLockVersionMismatchError",Object.setPrototypeOf(o,t.prototype),o.message="The optimistic lock on entity "+r+" failed, version "+n+" was expected, but is actually "+i+".",o}return __extends(t,e),t}(Error),e("OptimisticLockVersionMismatchError",r)}}}),System.register("typeorm/error/OptimisticLockCanNotBeUsedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(){var r=e.call(this)||this;return r.name="OptimisticLockCanNotBeUsedError",Object.setPrototypeOf(r,t.prototype),r.message="The optimistic lock can be used only with getOne() method.",r}return __extends(t,e),t}(Error),e("OptimisticLockCanNotBeUsedError",r)}}}),System.register("typeorm/query-builder/relation-id/RelationIdLoader",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e,t,r){this.connection=e,this.queryRunner=t,this.relationIdAttributes=r}return e.prototype.load=function(e){return __awaiter(this,void 0,void 0,function(){var t,r=this;return __generator(this,function(n){return t=this.relationIdAttributes.map(function(t){return __awaiter(r,void 0,void 0,function(){var r,n,i,o,a,s,u,c,l,p,d,m,f,h,y,g,v,b,E,M,T,_;return __generator(this,function(C){switch(C.label){case 0:if(!t.relation.isManyToOne&&!t.relation.isOneToOneOwner)return[3,1];if(t.queryBuilderFactory)throw new Error("Additional condition can not be used with ManyToOne or OneToOne owner relations.");return r=e.map(function(e){var r={};return t.relation.joinColumns.forEach(function(n){r[n.databaseName]=e[t.parentAlias+"_"+n.databaseName]}),t.relation.entityMetadata.primaryColumns.forEach(function(n){r[n.databaseName]=e[t.parentAlias+"_"+n.databaseName]}),r}),[2,{relationIdAttribute:t,results:r}];case 1:return t.relation.isOneToMany||t.relation.isOneToOneNotOwner?(l=t.relation,n=l.isOwning?l.joinColumns:l.inverseRelation.joinColumns,i=l.inverseEntityMetadata.target,o=l.inverseEntityMetadata.tableName,a=t.alias||o,s={},(M=e.map(function(e,r){return n.map(function(n){var i=n.databaseName+r;return s[i]=e[t.parentAlias+"_"+n.referencedColumn.databaseName],a+"."+n.propertyPath+" = :"+i}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR "))?(u=this.connection.createQueryBuilder(this.queryRunner),n.forEach(function(e){u.addSelect(a+"."+e.propertyPath,e.databaseName)}),l.inverseRelation.entityMetadata.primaryColumns.forEach(function(e){u.addSelect(a+"."+e.propertyPath,e.databaseName)}),u.from(i,a).where("("+M+")").setParameters(s),t.queryBuilderFactory&&t.queryBuilderFactory(u),c={relationIdAttribute:t},[4,u.getRawMany()]):[2,{relationIdAttribute:t,results:[]}]):[3,3];case 2:return[2,(c.results=C.sent(),c)];case 3:return l=t.relation,p=l.isOwning?l.joinColumns:l.inverseRelation.inverseJoinColumns,d=l.isOwning?l.inverseJoinColumns:l.inverseRelation.joinColumns,m=t.junctionAlias,f=t.joinInverseSideMetadata.tableName,h=t.alias||f,y=l.isOwning?l.junctionEntityMetadata.tableName:l.inverseRelation.junctionEntityMetadata.tableName,0===(g=e.map(function(e){return p.reduce(function(r,n){return r[n.propertyPath]=e[t.parentAlias+"_"+n.referencedColumn.databaseName],r},{})})).length?[2,{relationIdAttribute:t,results:[]}]:(v={},b=g.map(function(e,t){return Object.keys(e).map(function(r){var n=r+t;return v[n]=e[r],m+"."+r+" = :"+n}).join(" AND ")}),E=d.map(function(e){return m+"."+e.propertyPath+" = "+h+"."+e.referencedColumn.propertyPath}).join(" AND "),M=b.map(function(e){return"("+e+" AND "+E+")"}).join(" OR "),T=this.connection.createQueryBuilder(this.queryRunner),d.forEach(function(e){T.addSelect(m+"."+e.propertyPath,e.databaseName).addOrderBy(m+"."+e.propertyPath)}),p.forEach(function(e){T.addSelect(m+"."+e.propertyPath,e.databaseName).addOrderBy(m+"."+e.propertyPath)}),T.from(f,h).innerJoin(y,m,M).setParameters(v),t.queryBuilderFactory&&t.queryBuilderFactory(T),_={relationIdAttribute:t},[4,T.getRawMany()]);case 4:return[2,(_.results=C.sent(),_)]}})})}),[2,Promise.all(t)]})})},e}(),e("RelationIdLoader",r)}}}),System.register("typeorm/query-builder/relation-id/RelationIdMetadataToAttributeTransformer",["typeorm/query-builder/relation-id/RelationIdAttribute"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach(function(t){var r=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationIdAttributes.push(r)}),this.expressionMap.joinAttributes.forEach(function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationIds.forEach(function(r){var n=e.metadataToAttribute(t.alias.name,r);e.expressionMap.relationIdAttributes.push(n)})})},e.prototype.metadataToAttribute=function(e,t){return new r.RelationIdAttribute(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),e("RelationIdMetadataToAttributeTransformer",n)}}}),System.register("typeorm/query-builder/relation-count/RelationCountLoader",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e,t,r){this.connection=e,this.queryRunner=t,this.relationCountAttributes=r}return e.prototype.load=function(e){return __awaiter(this,void 0,void 0,function(){var t,r=this;return __generator(this,function(n){return t=this.relationCountAttributes.map(function(t){return __awaiter(r,void 0,void 0,function(){var r,n,i,o,a,s,u,c,l,p,d,m,f,h,y,g,v,b;return __generator(this,function(E){switch(E.label){case 0:return t.relation.isOneToMany?(r=t.relation,n=r.inverseRelation,i=n.joinColumns[0].referencedColumn.propertyName,o=r.inverseEntityMetadata.target,f=r.inverseEntityMetadata.tableName,h=t.alias||f,a=n.propertyName,0===(d=e.map(function(e){return e[t.parentAlias+"_"+i]}).filter(function(e){return!!e})).length?[2,{relationCountAttribute:t,results:[]}]:((v=this.connection.createQueryBuilder(this.queryRunner)).select(h+"."+a,"parentId").addSelect("COUNT(*)","cnt").from(o,h).where(h+"."+a+" IN (:ids)").addGroupBy(h+"."+a).setParameter("ids",d),t.queryBuilderFactory&&t.queryBuilderFactory(v),s={relationCountAttribute:t},[4,v.getRawMany()])):[3,2];case 1:return[2,(s.results=E.sent(),s)];case 2:return c=void 0,l=void 0,p=void 0,t.relation.isOwning?(u=t.relation.joinColumns[0].referencedColumn.databaseName,c=t.relation.inverseJoinColumns[0].referencedColumn.databaseName,l=t.relation.junctionEntityMetadata.columns[0],p=t.relation.junctionEntityMetadata.columns[1]):(u=t.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,c=t.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,l=t.relation.junctionEntityMetadata.columns[1],p=t.relation.junctionEntityMetadata.columns[0]),0===(d=e.map(function(e){return e[t.parentAlias+"_"+u]}).filter(function(e){return e})).length?[2,{relationCountAttribute:t,results:[]}]:(m=t.junctionAlias,f=t.joinInverseSideMetadata.tableName,h=t.alias||f,y=t.relation.junctionEntityMetadata.tableName,g=m+"."+l.propertyName+" IN ("+d+") AND "+m+"."+p.propertyName+" = "+h+"."+c,(v=this.connection.createQueryBuilder(this.queryRunner)).select(m+"."+l.propertyName,"parentId").addSelect("COUNT("+v.escape(h)+"."+v.escape(c)+")","cnt").from(f,h).innerJoin(y,m,g).addGroupBy(m+"."+l.propertyName),t.queryBuilderFactory&&t.queryBuilderFactory(v),b={relationCountAttribute:t},[4,v.getRawMany()]);case 3:return[2,(b.results=E.sent(),b)]}})})}),[2,Promise.all(t)]})})},e}(),e("RelationCountLoader",r)}}}),System.register("typeorm/metadata-args/RelationCountMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/RelationCountMetadata",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error("Cannot find relation "+e+". Wrong relation specified for @RelationCount decorator.");this.relation=t},e}(),e("RelationCountMetadata",r)}}}),System.register("typeorm/query-builder/relation-count/RelationCountMetadataToAttributeTransformer",["typeorm/query-builder/relation-count/RelationCountAttribute"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach(function(t){var r=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationCountAttributes.push(r)}),this.expressionMap.joinAttributes.forEach(function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationCounts.forEach(function(r){var n=e.metadataToAttribute(t.alias.name,r);e.expressionMap.relationCountAttributes.push(n)})})},e.prototype.metadataToAttribute=function(e,t){return new r.RelationCountAttribute(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),e("RelationCountMetadataToAttributeTransformer",n)}}}),System.register("typeorm/error/LockNotSupportedOnGivenDriverError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(){var r=e.call(this)||this;return r.name="LockNotSupportedOnGivenDriverError",Object.setPrototypeOf(r,t.prototype),r.message="Locking not supported on giver driver.",r}return __extends(t,e),t}(Error),e("LockNotSupportedOnGivenDriverError",r)}}}),System.register("typeorm/driver/oracle/OracleQueryRunner",["typeorm/error/TransactionAlreadyStartedError","typeorm/error/TransactionNotStartedError","typeorm/schema-builder/schema/TableColumn","typeorm/schema-builder/schema/Table","typeorm/schema-builder/schema/TableForeignKey","typeorm/schema-builder/schema/TablePrimaryKey","typeorm/schema-builder/schema/TableIndex","typeorm/error/QueryRunnerAlreadyReleasedError","typeorm/error/QueryFailedError","typeorm/subscriber/Broadcaster"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l,p,d;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e}],execute:function(){d=function(){function e(e,t){void 0===t&&(t="master"),this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.driver=e,this.connection=e.connection,this.broadcaster=new p.Broadcaster(this),this.mode=t}return e.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(function(t){return e.databaseConnection=t,e.databaseConnection}):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(function(t){return e.databaseConnection=t,e.databaseConnection}),this.databaseConnectionPromise)},e.prototype.release=function(){var e=this;return new Promise(function(t,r){e.isReleased=!0,e.databaseConnection&&e.databaseConnection.close(function(e){if(e)return r(e);t()})})},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;if(this.isTransactionActive)throw new r.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[2]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new n.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new n.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.query=function(e,t){var r=this;if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return new Promise(function(n,i){return __awaiter(r,void 0,void 0,function(){var r,o,a,s,u,c=this;return __generator(this,function(p){switch(p.label){case 0:return p.trys.push([0,2,,3]),this.driver.connection.logger.logQuery(e,t,this),r=+new Date,o=function(o,a){var s=c.driver.connection.options.maxQueryExecutionTime,u=+new Date-r;if(s&&u>s&&c.driver.connection.logger.logQuerySlow(u,e,t,c),o)return c.driver.connection.logger.logQueryError(o,e,t,c),i(new l.QueryFailedError(e,t,o));n(a.rows||a.outBinds)},a={autoCommit:!this.isTransactionActive},[4,this.connect()];case 1:return(s=p.sent()).execute(e,t||{},a,o),[3,3];case 2:return u=p.sent(),i(u),[3,3];case 3:return[2]}})})})},e.prototype.stream=function(e,t,r,n){throw new Error("Stream is not supported by Oracle driver.")},e.prototype.insertIntoClosureTable=function(e,t,r,n){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:return i="",i=n?'INSERT INTO "'+e+'"("ancestor", "descendant", "level") SELECT "ancestor", '+t+', "level" + 1 FROM "'+e+'" WHERE "descendant" = '+r+" UNION ALL SELECT "+t+", "+t+", 1":'INSERT INTO "'+e+'" ("ancestor", "descendant") SELECT "ancestor", '+t+' FROM "'+e+'" WHERE "descendant" = '+r+" UNION ALL SELECT "+t+", "+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query('SELECT MAX("level") as "level" FROM "'+e+'" WHERE "descendant" = '+r)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.getTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return[4,this.getTables([e])];case 1:return t=r.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.getTables=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,c,l,p,d,m,f,h;return __generator(this,function(y){switch(y.label){case 0:return e&&e.length?(t=e.map(function(e){return"'"+e+"'"}).join(", "),r="SELECT TABLE_NAME FROM user_tables WHERE TABLE_NAME IN ("+t+")",n="SELECT TABLE_NAME, COLUMN_NAME, DATA_TYPE, DATA_LENGTH, DATA_PRECISION, DATA_SCALE, NULLABLE, IDENTITY_COLUMN FROM all_tab_cols WHERE TABLE_NAME IN ("+t+")",c="SELECT ind.INDEX_NAME, ind.TABLE_NAME, ind.UNIQUENESS, LISTAGG(cols.COLUMN_NAME, ',') WITHIN GROUP (ORDER BY cols.COLUMN_NAME) AS COLUMN_NAMES\n                                FROM USER_INDEXES ind, USER_IND_COLUMNS cols \n                                WHERE ind.INDEX_NAME = cols.INDEX_NAME AND ind.TABLE_NAME IN ("+t+")\n                                GROUP BY ind.INDEX_NAME, ind.TABLE_NAME, ind.UNIQUENESS",l="SELECT cols.table_name, cols.column_name, cols.position, cons.constraint_type, cons.constraint_name\nFROM all_constraints cons, all_cons_columns cols WHERE cols.table_name IN ("+t+") \nAND cons.constraint_name = cols.constraint_name AND cons.owner = cols.owner ORDER BY cols.table_name, cols.position",[4,Promise.all([this.query(r),this.query(n),this.query(c),this.query(l)])]):[2,[]];case 1:return p=y.sent(),d=p[0],m=p[1],f=p[2],h=p[3],d.length?[2,d.map(function(e){var t=new o.Table(e.TABLE_NAME);return t.columns=m.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var r=!!h.find(function(r){return r.TABLE_NAME===t.name&&"P"===r.CONSTRAINT_TYPE&&r.COLUMN_NAME===e.COLUMN_NAME}),n=e.DATA_TYPE.toLowerCase();"varchar2"===e.DATA_TYPE.toLowerCase()&&null!==e.DATA_LENGTH?n+="("+e.DATA_LENGTH+")":null!==e.DATA_PRECISION&&null!==e.DATA_SCALE?n+="("+e.DATA_PRECISION+","+e.DATA_SCALE+")":null!==e.DATA_SCALE?n+="(0,"+e.DATA_SCALE+")":null!==e.DATA_PRECISION&&(n+="("+e.DATA_PRECISION+")");var o=new i.TableColumn;return o.name=e.COLUMN_NAME,o.type=n,o.default=null!==e.COLUMN_DEFAULT&&void 0!==e.COLUMN_DEFAULT?e.COLUMN_DEFAULT:void 0,o.isNullable="N"!==e.NULLABLE,o.isPrimary=r,o.isGenerated="YES"===e.IDENTITY_COLUMN,o.comment="",o}),t.primaryKeys=h.filter(function(e){return e.TABLE_NAME===t.name&&"P"===e.CONSTRAINT_TYPE}).map(function(e){return new s.TablePrimaryKey(e.CONSTRAINT_NAME,e.COLUMN_NAME)}),t.foreignKeys=h.filter(function(e){return e.TABLE_NAME===t.name&&"R"===e.CONSTRAINT_TYPE}).map(function(e){return new a.TableForeignKey(e.CONSTRAINT_NAME,[],[],"","")}),t.indices=f.filter(function(e){return e.TABLE_NAME===t.name&&!t.foreignKeys.find(function(t){return t.name===e.INDEX_NAME})&&!t.primaryKeys.find(function(t){return t.name===e.INDEX_NAME})}).map(function(t){return new u.TableIndex(e.TABLE_NAME,t.INDEX_NAME,t.COLUMN_NAMES,!("UNIQUE"!==t.COLUMN_NAMES))}),t})]:[2,[]]}})})},e.prototype.hasDatabase=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve(!1)]})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(n){switch(n.label){case 0:return t="SELECT TABLE_NAME FROM user_tables WHERE TABLE_NAME = '"+e+"'",[4,this.query(t)];case 1:return r=n.sent(),[2,!!r.length]}})})},e.prototype.createDatabase=function(e){return this.query("CREATE DATABASE IF NOT EXISTS "+e)},e.prototype.createSchema=function(e){return Promise.resolve([])},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,i=this;return __generator(this,function(o){switch(o.label){case 0:return t=e.columns.map(function(e){return i.buildCreateColumnSql(e)}).join(", "),r='CREATE TABLE "'+e.name+'" ('+t,(n=e.columns.filter(function(e){return e.isPrimary})).length>0&&(r+=", PRIMARY KEY("+n.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),r+=")",[4,this.query(r)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return t='DROP TABLE "'+e+'"',[4,this.query(t)];case 1:return r.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){switch(i.label){case 0:return r="SELECT COLUMN_NAME FROM all_tab_cols WHERE TABLE_NAME = '"+e+"' AND COLUMN_NAME = '"+t+"'",[4,this.query(r)];case 1:return n=i.sent(),[2,!!n.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){return r=e instanceof o.Table?e.name:e,n='ALTER TABLE "'+r+'" ADD '+this.buildCreateColumnSql(t),[2,this.query(n)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return n.addColumn(e,t)}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var n,a,s;return __generator(this,function(u){switch(u.label){case 0:return n=void 0,e instanceof o.Table?(n=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:n=u.sent(),u.label=3;case 3:if(!n)throw new Error("Table "+e+" was not found.");if(a=void 0,!(a=t instanceof i.TableColumn?t:n.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return s=void 0,r instanceof i.TableColumn?s=r:(s=a.clone()).name=r,[2,this.changeColumn(n,a,s)]}})})},e.prototype.changeColumn=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var n,a,s,u,c,l;return __generator(this,function(p){switch(p.label){case 0:return n=void 0,e instanceof o.Table?(n=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:n=p.sent(),p.label=3;case 3:if(!n)throw new Error("Table "+e+" was not found.");if(a=void 0,!(a=t instanceof i.TableColumn?t:n.columns.find(function(e){return e.name===t})))throw new Error('Column "'+t+'" was not found in the "'+e+'" table.');return r.isGenerated===a.isGenerated?[3,10]:r.isGenerated?n.primaryKeys.length>0&&a.isPrimary?(s='ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+n.primaryKeys[0].name+'"',[4,this.query(s)]):[3,5]:[3,8];case 4:p.sent(),p.label=5;case 5:return u='ALTER TABLE "'+n.name+'" DROP COLUMN "'+r.name+'"',[4,this.query(u)];case 6:return p.sent(),c='ALTER TABLE "'+n.name+'" ADD '+this.buildCreateColumnSql(r),[4,this.query(c)];case 7:return p.sent(),[3,10];case 8:return l='ALTER TABLE "'+n.name+'" MODIFY "'+r.name+'" DROP IDENTITY',[4,this.query(l)];case 9:p.sent(),p.label=10;case 10:return r.isNullable===a.isNullable?[3,12]:(l='ALTER TABLE "'+n.name+'" MODIFY "'+r.name+'" '+this.connection.driver.createFullType(r)+" "+(r.isNullable?"NULL":"NOT NULL"),[4,this.query(l)]);case 11:return p.sent(),[3,14];case 12:return this.connection.driver.createFullType(r)===this.connection.driver.createFullType(a)?[3,14]:(l='ALTER TABLE "'+n.name+'" MODIFY "'+r.name+'" '+this.connection.driver.createFullType(r),[4,this.query(l)]);case 13:p.sent(),p.label=14;case 14:return[2]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(r){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,this.query('ALTER TABLE "'+e.name+'" DROP COLUMN "'+t.name+'"')]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return n.dropColumn(e,t)}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return t=e.primaryKeys.map(function(e){return'"'+e.columnName+'"'}),e.primaryKeys.length>0&&e.primaryKeys[0].name?[4,this.query('ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+e.primaryKeys[0].name+'"')]:[3,2];case 1:r.sent(),r.label=2;case 2:return t.length>0?[4,this.query('ALTER TABLE "'+e.name+'" ADD PRIMARY KEY ('+t.join(", ")+")")]:[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,i,a;return __generator(this,function(s){return r=e instanceof o.Table?e.name:e,n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),i=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(","),a='ALTER TABLE "'+r+'" ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+n+') REFERENCES "'+t.referencedTableName+'"('+i+")",t.onDelete&&(a+=" ON DELETE "+t.onDelete),[2,this.query(a)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return n.createForeignKey(e,t)}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){return r=e instanceof o.Table?e.name:e,n='ALTER TABLE "'+r+'" DROP CONSTRAINT "'+t.name+'"',[2,this.query(n)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){switch(i.label){case 0:return r=t.map(function(t){return n.dropForeignKey(e,t)}),[4,Promise.all(r)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){switch(i.label){case 0:return r=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),n="CREATE "+(t.isUnique?"UNIQUE":"")+' INDEX "'+t.name+'" ON "'+(e instanceof o.Table?e.name:e)+'"('+r+")",[4,this.query(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){switch(i.label){case 0:return r=e instanceof o.Table?e.name:e,n='ALTER TABLE "'+r+'" DROP INDEX "'+t+'"',[4,this.query(n)];case 1:return i.sent(),[2]}})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query('TRUNCATE TABLE "'+e+'"')];case 1:return t.sent(),[2]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return[4,this.startTransaction()];case 1:s.sent(),s.label=2;case 2:return s.trys.push([2,8,,13]),e="SET FOREIGN_KEY_CHECKS = 0;",t="SELECT concat('DROP TABLE IF EXISTS \"', table_name, '\";') AS query FROM information_schema.tables WHERE table_schema = '"+this.dbName+"'",r="SET FOREIGN_KEY_CHECKS = 1;",[4,this.query(e)];case 3:return s.sent(),[4,this.query(t)];case 4:return n=s.sent(),[4,Promise.all(n.map(function(e){return a.query(e.query)}))];case 5:return s.sent(),[4,this.query(r)];case 6:return s.sent(),[4,this.commitTransaction()];case 7:return s.sent(),[3,13];case 8:i=s.sent(),s.label=9;case 9:return s.trys.push([9,11,,12]),[4,this.rollbackTransaction()];case 10:return s.sent(),[3,12];case 11:return o=s.sent(),[3,12];case 12:throw i;case 13:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},Object.defineProperty(e.prototype,"dbName",{get:function(){return this.driver.options.schema},enumerable:!0,configurable:!0}),e.prototype.parametrize=function(e){return Object.keys(e).map(function(e){return'"'+e+'"=:'+e})},e.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'" '+this.connection.driver.createFullType(e);return e.charset&&(t+=" CHARACTER SET "+e.charset),e.collation&&(t+=" COLLATE "+e.collation),!0===e.isNullable||e.isGenerated||(t+=" NOT NULL"),!0===e.isGenerated&&(t+=" GENERATED BY DEFAULT ON NULL AS IDENTITY"),void 0!==e.default&&null!==e.default&&(t+=" DEFAULT "+e.default),t},e}(),e("OracleQueryRunner",d)}}}),System.register("typeorm/driver/oracle/OracleDriver",["typeorm/error/ConnectionIsNotSetError","typeorm/error/DriverPackageNotInstalledError","typeorm/driver/oracle/OracleQueryRunner","typeorm/util/DateUtils","typeorm/platform/PlatformTools","typeorm/schema-builder/RdbmsSchemaBuilder","typeorm/driver/DriverUtils","typeorm/query-builder/ArrayParameter"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["char","nchar","nvarchar2","varchar2","long","raw","long raw","number","numeric","dec","decimal","integer","int","smallint","real","double precision","date","timestamp","timestamp with time zone","timestamp with local time zone","interval year","interval day","bfile","blob","clob","nclob","rowid","urowid"],this.withLengthColumnTypes=["char","nchar","nvarchar2","varchar2"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"CURRENT_TIMESTAMP",updateDate:"datetime",updateDateDefault:"CURRENT_TIMESTAMP",version:"number",treeLevel:"number",migrationName:"nvarchar",migrationTimestamp:"timestamp",cacheId:"int",cacheIdentifier:"nvarchar",cacheTime:"timestamp",cacheDuration:"int",cacheQuery:"text",cacheResult:"text"},this.connection=e,this.options=e.options,this.loadDependencies(),this.oracle.outFormat=this.oracle.OBJECT}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n=this;return __generator(this,function(i){switch(i.label){case 0:return this.options.replication?(e=this,[4,Promise.all(this.options.replication.slaves.map(function(e){return n.createPool(n.options,e)}))]):[3,3];case 1:return e.slaves=i.sent(),t=this,[4,this.createPool(this.options,this.options.replication.master)];case 2:return t.master=i.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return r=this,[4,this.createPool(this.options,this.options)];case 4:r.master=i.sent(),this.database=this.options.database,i.label=5;case 5:return[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return this.master?[4,this.closePool(this.master)]:[2,Promise.reject(new r.ConnectionIsNotSetError("oracle"))];case 1:return t.sent(),[4,Promise.all(this.slaves.map(function(t){return e.closePool(t)}))];case 2:return t.sent(),this.master=void 0,this.slaves=[],[2]}})})},e.prototype.createSchemaBuilder=function(){return new s.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new i.OracleQueryRunner(this,e)},e.prototype.escapeQueryWithParameters=function(e,t,r){var n=Object.keys(r).map(function(e){return r[e]});if(!t||!Object.keys(t).length)return[e,n];var i=Object.keys(t).map(function(e){return"(:"+e+"\\b)"}).join("|");return e=e.replace(new RegExp(i,"g"),function(e){var r=t[e.substr(1)];return r instanceof Function?r():(r instanceof c.ArrayParameter&&(r=r.value),n.push(r),e)}),[e,n]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?o.DateUtils.mixedDateToDateString(e):"time"===t.type?o.DateUtils.mixedDateToTimeString(e):"datetime"===t.type||t.type===Date?o.DateUtils.mixedDateToUtcDatetimeString(e):"json"===t.type?JSON.stringify(e):"simple-array"===t.type?o.DateUtils.simpleArrayToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return t.transformer&&(e=t.transformer.from(e)),null===e||void 0===e?e:t.type===Boolean?!!e:"datetime"===t.type?o.DateUtils.normalizeHydratedDate(e):"date"===t.type?o.DateUtils.mixedDateToDateString(e):"time"===t.type?o.DateUtils.mixedTimeToString(e):"json"===t.type?JSON.parse(e):"simple-array"===t.type?o.DateUtils.stringToSimpleArray(e):e},e.prototype.normalizeType=function(e){var t="";return e.type===Number?t+="integer":e.type===String?t+="nvarchar2":e.type===Date?t+="timestamp(0)":e.type===Boolean?t+="number(1)":"simple-array"===e.type?t+="text":t+=e.type,t},e.prototype.normalizeDefault=function(e){return"number"==typeof e.default?""+e.default:"boolean"==typeof e.default?!0===e.default?"true":"false":"function"==typeof e.default?e.default():"string"==typeof e.default?"'"+e.default+"'":e.default},e.prototype.normalizeIsUnique=function(e){return e.isUnique},e.prototype.getColumnLength=function(e){if(e.length)return e.length;var t=this.normalizeType(e);return this.dataTypeDefaults&&this.dataTypeDefaults[t]&&this.dataTypeDefaults[t].length?this.dataTypeDefaults[t].length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+="("+e.length+")":e.precision&&e.scale?t+="("+e.precision+","+e.scale+")":e.precision?t+="("+e.precision+")":e.scale?t+="("+e.scale+")":this.dataTypeDefaults&&this.dataTypeDefaults[e.type]&&this.dataTypeDefaults[e.type].length&&(t+="("+this.dataTypeDefaults[e.type].length.toString()+")"),e.isArray&&(t+=" array"),t},e.prototype.obtainMasterConnection=function(){var e=this;return new Promise(function(t,r){e.master.getConnection(function(e,n,i){if(e)return r(e);t(n)})})},e.prototype.obtainSlaveConnection=function(){var e=this;return this.slaves.length?new Promise(function(t,r){var n=Math.floor(Math.random()*e.slaves.length);e.slaves[n].getConnection(function(e,n){if(e)return r(e);t(n)})}):this.obtainMasterConnection()},e.prototype.createGeneratedMap=function(e,t){},e.prototype.isReturningSqlSupported=function(){return!1},e.prototype.isUUIDGenerationSupported=function(){return!1},e.prototype.createParameter=function(e,t){return":"+e},e.prototype.loadDependencies=function(){try{this.oracle=a.PlatformTools.load("oracledb")}catch(e){throw new n.DriverPackageNotInstalledError("Oracle","oracledb")}},e.prototype.createPool=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(i){return t=Object.assign(t,u.DriverUtils.buildDriverOptions(t)),r=Object.assign({},{user:t.username,password:t.password,connectString:t.host+":"+t.port+"/"+t.sid},e.extra||{}),[2,new Promise(function(e,t){n.oracle.createPool(r,function(r,n){if(r)return t(r);e(n)})})]})})},e.prototype.closePool=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new Promise(function(t,r){e.close(function(e){return e?r(e):t()}),e=void 0})]})})},e}(),e("OracleDriver",l)}}}),System.register("typeorm/cache/QueryResultCacheOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/error/OffsetWithoutLimitNotSupportedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(r){var n=e.call(this,r+" does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).")||this;return Object.setPrototypeOf(n,t.prototype),n.name="OffsetWithoutLimitNotSupportedError",n}return __extends(t,e),t}(Error),e("OffsetWithoutLimitNotSupportedError",r)}}}),System.register("typeorm/query-builder/SelectQueryBuilder",["typeorm/query-builder/transformer/RawSqlResultsToEntityTransformer","typeorm/driver/sqlserver/SqlServerDriver","typeorm/error/PessimisticLockTransactionRequiredError","typeorm/error/NoVersionOrUpdateDateColumnError","typeorm/error/OptimisticLockVersionMismatchError","typeorm/error/OptimisticLockCanNotBeUsedError","typeorm/query-builder/JoinAttribute","typeorm/query-builder/relation-id/RelationIdAttribute","typeorm/query-builder/relation-count/RelationCountAttribute","typeorm/query-builder/relation-id/RelationIdLoader","typeorm/query-builder/relation-id/RelationIdMetadataToAttributeTransformer","typeorm/query-builder/relation-count/RelationCountLoader","typeorm/query-builder/relation-count/RelationCountMetadataToAttributeTransformer","typeorm/query-builder/QueryBuilder","typeorm/error/LockNotSupportedOnGivenDriverError","typeorm/driver/mysql/MysqlDriver","typeorm/driver/postgres/PostgresDriver","typeorm/driver/oracle/OracleDriver","typeorm/driver/sqlite-abstract/AbstractSqliteDriver","typeorm/error/OffsetWithoutLimitNotSupportedError","typeorm/subscriber/BroadcasterResult"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l,p,d,m,f,h,y,g,v,b,E,M,T,_;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e},function(e){d=e},function(e){m=e},function(e){f=e},function(e){h=e},function(e){y=e},function(e){g=e},function(e){v=e},function(e){b=e},function(e){E=e},function(e){M=e},function(e){T=e}],execute:function(){_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getQuery=function(){var e=this.createSelectExpression();return e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e+=this.createLockExpression(),e=this.createLimitOffsetOracleSpecificExpression(e),e=e.trim(),this.expressionMap.subQuery&&(e="("+e+")"),e},t.prototype.subQuery=function(){var e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.expressionMap.parentQueryBuilder=this,e},t.prototype.select=function(e,t){if(this.expressionMap.queryType="select",e instanceof Array)this.expressionMap.selects=e.map(function(e){return{selection:e}});else if(e instanceof Function){var r=e(this.subQuery());this.setParameters(r.getParameters()),this.expressionMap.selects.push({selection:r.getQuery(),aliasName:t})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);return this},t.prototype.addSelect=function(e,t){if(!e)return this;if(e instanceof Array)this.expressionMap.selects=this.expressionMap.selects.concat(e.map(function(e){return{selection:e}}));else if(e instanceof Function){var r=e(this.subQuery());this.setParameters(r.getParameters()),this.expressionMap.selects.push({selection:r.getQuery(),aliasName:t})}else e&&this.expressionMap.selects.push({selection:e,aliasName:t});return this},t.prototype.from=function(e,t){var r=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(r),this},t.prototype.addFrom=function(e,t){var r=this.createFromAlias(e,t);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(r),this},t.prototype.innerJoin=function(e,t,r,n){return void 0===r&&(r=""),this.join("INNER",e,t,r,n),this},t.prototype.leftJoin=function(e,t,r,n){return void 0===r&&(r=""),this.join("LEFT",e,t,r,n),this},t.prototype.innerJoinAndSelect=function(e,t,r,n){return void 0===r&&(r=""),this.addSelect(t),this.innerJoin(e,t,r,n),this},t.prototype.leftJoinAndSelect=function(e,t,r,n){return void 0===r&&(r=""),this.addSelect(t),this.leftJoin(e,t,r,n),this},t.prototype.innerJoinAndMapMany=function(e,t,r,n,i){return void 0===n&&(n=""),this.addSelect(r),this.join("INNER",t,r,n,i,e,!0),this},t.prototype.innerJoinAndMapOne=function(e,t,r,n,i){return void 0===n&&(n=""),this.addSelect(r),this.join("INNER",t,r,n,i,e,!1),this},t.prototype.leftJoinAndMapMany=function(e,t,r,n,i){return void 0===n&&(n=""),this.addSelect(r),this.join("LEFT",t,r,n,i,e,!0),this},t.prototype.leftJoinAndMapOne=function(e,t,r,n,i){return void 0===n&&(n=""),this.addSelect(r),this.join("LEFT",t,r,n,i,e,!1),this},t.prototype.loadRelationIdAndMap=function(e,t,r,n){var i=new c.RelationIdAttribute(this.expressionMap);return i.mapToProperty=e,i.relationName=t,"string"==typeof r&&(i.alias=r),r instanceof Object&&r.disableMixedMap&&(i.disableMixedMap=!0),i.queryBuilderFactory=n,this.expressionMap.relationIdAttributes.push(i),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadRelationCountAndMap=function(e,t,r,n){var i=new l.RelationCountAttribute(this.expressionMap);return i.mapToProperty=e,i.relationName=t,i.alias=r,i.queryBuilderFactory=n,this.expressionMap.relationCountAttributes.push(i),this.expressionMap.createAlias({type:"other",name:i.junctionAlias}),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadAllRelationIds=function(e){var t=this;return this.expressionMap.mainAlias.metadata.relations.forEach(function(r){void 0!==e&&void 0!==e.relations&&-1===e.relations.indexOf(r.propertyPath)||t.loadRelationIdAndMap(t.expressionMap.mainAlias.name+"."+r.propertyPath,t.expressionMap.mainAlias.name+"."+r.propertyPath,e)}),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var r=this.computeWhereParameter(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere("("+this.createWhereIdsExpression(e)+")")},t.prototype.orWhereInIds=function(e){return this.orWhere("("+this.createWhereIdsExpression(e)+")")},t.prototype.having=function(e,t){return this.expressionMap.havings.push({type:"simple",condition:e}),t&&this.setParameters(t),this},t.prototype.andHaving=function(e,t){return this.expressionMap.havings.push({type:"and",condition:e}),t&&this.setParameters(t),this},t.prototype.orHaving=function(e,t){return this.expressionMap.havings.push({type:"or",condition:e}),t&&this.setParameters(t),this},t.prototype.groupBy=function(e){return this.expressionMap.groupBys=e?[e]:[],this},t.prototype.addGroupBy=function(e){return this.expressionMap.groupBys.push(e),this},t.prototype.orderBy=function(e,t,r){return void 0===t&&(t="ASC"),e?e instanceof Object?this.expressionMap.orderBys=e:this.expressionMap.orderBys=r?(n={},n[e]={order:t,nulls:r},n):(i={},i[e]=t,i):this.expressionMap.orderBys={},this;var n,i},t.prototype.addOrderBy=function(e,t,r){return void 0===t&&(t="ASC"),this.expressionMap.orderBys[e]=r?{order:t,nulls:r}:t,this},t.prototype.limit=function(e){return this.expressionMap.limit=e,this},t.prototype.offset=function(e){return this.expressionMap.offset=e,this},t.prototype.take=function(e){return this.expressionMap.take=e,this},t.prototype.skip=function(e){return this.expressionMap.skip=e,this},t.prototype.setLock=function(e,t){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=t,this},t.prototype.getRawOne=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getRawMany()];case 1:return[2,e.sent()[0]]}})})},t.prototype.getRawMany=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,i;return __generator(this,function(o){switch(o.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new s.OptimisticLockCanNotBeUsedError;this.expressionMap.queryEntity=!1,e=this.obtainQueryRunner(),t=!1,o.label=1;case 1:return o.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:o.sent(),t=!0,o.label=3;case 3:return[4,this.loadRawResults(e)];case 4:return r=o.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:o.sent(),o.label=6;case 6:return[2,r];case 7:if(n=o.sent(),!t)return[3,11];o.label=8;case 8:return o.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:return o.sent(),[3,11];case 10:return i=o.sent(),[3,11];case 11:throw n;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:o.sent(),o.label=14;case 14:return[7];case 15:return[2]}})})},t.prototype.getRawAndEntities=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,i;return __generator(this,function(o){switch(o.label){case 0:e=this.obtainQueryRunner(),t=!1,o.label=1;case 1:return o.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:o.sent(),t=!0,o.label=3;case 3:return this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(e)];case 4:return r=o.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:o.sent(),o.label=6;case 6:return[2,r];case 7:if(n=o.sent(),!t)return[3,11];o.label=8;case 8:return o.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:return o.sent(),[3,11];case 10:return i=o.sent(),[3,11];case 11:throw n;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:o.sent(),o.label=14;case 14:return[7];case 15:return[2]}})})},t.prototype.getOne=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getRawAndEntities()];case 1:if(e=i.sent(),(t=e.entities[0])&&"optimistic"===this.expressionMap.lockMode&&this.expressionMap.lockVersion)if(r=this.expressionMap.mainAlias.metadata,this.expressionMap.lockVersion instanceof Date){if((n=r.updateDateColumn.getEntityValue(t)).getTime()!==this.expressionMap.lockVersion.getTime())throw new a.OptimisticLockVersionMismatchError(r.name,this.expressionMap.lockVersion,n)}else if((n=r.versionColumn.getEntityValue(t))!==this.expressionMap.lockVersion)throw new a.OptimisticLockVersionMismatchError(r.name,this.expressionMap.lockVersion,n);return[2,t]}})})},t.prototype.getMany=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new s.OptimisticLockCanNotBeUsedError;return[4,this.getRawAndEntities()];case 1:return e=t.sent(),[2,e.entities]}})})},t.prototype.getCount=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,i;return __generator(this,function(o){switch(o.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new s.OptimisticLockCanNotBeUsedError;e=this.obtainQueryRunner(),t=!1,o.label=1;case 1:return o.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:o.sent(),t=!0,o.label=3;case 3:return[4,this.executeCountQuery(e)];case 4:return r=o.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:o.sent(),o.label=6;case 6:return[2,r];case 7:if(n=o.sent(),!t)return[3,11];o.label=8;case 8:return o.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:return o.sent(),[3,11];case 10:return i=o.sent(),[3,11];case 11:throw n;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:o.sent(),o.label=14;case 14:return[7];case 15:return[2]}})})},t.prototype.getManyAndCount=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,i,o,a;return __generator(this,function(u){switch(u.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new s.OptimisticLockCanNotBeUsedError;e=this.obtainQueryRunner(),t=!1,u.label=1;case 1:return u.trys.push([1,8,13,16]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:u.sent(),t=!0,u.label=3;case 3:return[4,this.executeEntitiesAndRawResults(e)];case 4:return r=u.sent(),[4,this.executeCountQuery(e)];case 5:return n=u.sent(),i=[r.entities,n],t?[4,e.commitTransaction()]:[3,7];case 6:u.sent(),u.label=7;case 7:return[2,i];case 8:if(o=u.sent(),!t)return[3,12];u.label=9;case 9:return u.trys.push([9,11,,12]),[4,e.rollbackTransaction()];case 10:return u.sent(),[3,12];case 11:return a=u.sent(),[3,12];case 12:throw o;case 13:return e===this.queryRunner?[3,15]:[4,e.release()];case 14:u.sent(),u.label=15;case 15:return[7];case 16:return[2]}})})},t.prototype.stream=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,i,o,a,s,u,c=this;return __generator(this,function(l){switch(l.label){case 0:this.expressionMap.queryEntity=!1,e=this.getQueryAndParameters(),t=e[0],r=e[1],n=this.obtainQueryRunner(),i=!1,l.label=1;case 1:return l.trys.push([1,6,11,14]),!0!==this.expressionMap.useTransaction||!1!==n.isTransactionActive?[3,3]:[4,n.startTransaction()];case 2:l.sent(),i=!0,l.label=3;case 3:return o=function(){if(n!==c.queryRunner)return n.release()},a=n.stream(t,r,o,o),i?[4,n.commitTransaction()]:[3,5];case 4:l.sent(),l.label=5;case 5:return[2,a];case 6:if(s=l.sent(),!i)return[3,10];l.label=7;case 7:return l.trys.push([7,9,,10]),[4,n.rollbackTransaction()];case 8:return l.sent(),[3,10];case 9:return u=l.sent(),[3,10];case 10:throw s;case 11:return n===this.queryRunner?[3,13]:[4,n.release()];case 12:l.sent(),l.label=13;case 13:return[7];case 14:return[2]}})})},t.prototype.cache=function(e,t){return"boolean"==typeof e?this.expressionMap.cache=e:"number"==typeof e?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):"string"!=typeof e&&"number"!=typeof e||(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),t&&(this.expressionMap.cacheDuration=t),this},t.prototype.join=function(e,t,r,n,i,o,a){this.setParameters(i||{});var s=new u.JoinAttribute(this.connection,this.expressionMap);if(s.direction=e,s.mapToProperty=o,s.isMappingMany=a,s.entityOrProperty=t,s.condition=n,this.expressionMap.joinAttributes.push(s),s.metadata)s.alias=this.expressionMap.createAlias({type:"join",name:r,metadata:s.metadata}),s.relation&&s.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:s.junctionAlias,metadata:s.relation.junctionEntityMetadata});else{var c="";if(t instanceof Function){var l=t(this.subQuery());this.setParameters(l.getParameters()),c=l.getQuery()}else c=t;var p=t instanceof Function||"("===t.substr(0,1)&&")"===t.substr(-1);s.alias=this.expressionMap.createAlias({type:"join",name:r,tableName:!1===p?t:void 0,subQuery:!0===p?c:void 0})}},t.prototype.createSelectExpression=function(){var e=this;if(!this.expressionMap.mainAlias)throw new Error("Cannot build query because main alias is not set (call qb#from method)");var t=[],r=[];if(this.expressionMap.mainAlias.hasMetadata){i=this.expressionMap.mainAlias.metadata;t.push.apply(t,this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,i)),r.push.apply(r,this.findEntityColumnSelects(this.expressionMap.mainAlias.name,i))}if(this.expressionMap.joinAttributes.forEach(function(n){if(n.metadata)t.push.apply(t,e.buildEscapedEntityColumnSelects(n.alias.name,n.metadata)),r.push.apply(r,e.findEntityColumnSelects(n.alias.name,n.metadata));else{e.expressionMap.selects.some(function(e){return e.selection===n.alias.name})&&(t.push({selection:e.escape(n.alias.name)+".*"}),r.push({selection:e.escape(n.alias.name)}))}}),!this.expressionMap.ignoreParentTablesJoins&&this.expressionMap.mainAlias.hasMetadata){var i;if((i=this.expressionMap.mainAlias.metadata).parentEntityMetadata&&"class-table"===i.parentEntityMetadata.inheritanceType&&i.parentIdColumns){var o="parentIdColumn_"+i.parentEntityMetadata.tableName;i.parentEntityMetadata.columns.forEach(function(r){t.push({selection:e.escape(o)+"."+e.escape(r.databaseName),aliasName:o+"_"+r.databaseName})})}}this.expressionMap.selects.filter(function(e){return-1===r.indexOf(e)}).forEach(function(r){return t.push({selection:e.replacePropertyNames(r.selection),aliasName:r.aliasName})}),0===t.length&&t.push({selection:"*"});var a="";if(this.connection.driver instanceof n.SqlServerDriver)switch(this.expressionMap.lockMode){case"pessimistic_read":a=" WITH (HOLDLOCK, ROWLOCK)";break;case"pessimistic_write":a=" WITH (UPDLOCK, ROWLOCK)"}var s=this.expressionMap.aliases.filter(function(e){return"from"===e.type&&(e.tableName||e.subQuery)}).map(function(t){return t.subQuery?t.subQuery+" "+e.escape(t.name):e.getTableName(t.tableName)+" "+e.escape(t.name)}),u=t.map(function(t){return t.selection+(t.aliasName?" AS "+e.escape(t.aliasName):"")}).join(", ");return(this.expressionMap.limit||this.expressionMap.offset)&&this.connection.driver instanceof b.OracleDriver?"SELECT ROWNUM "+this.escape("RN")+","+u+" FROM "+s.join(", ")+a:"SELECT "+u+" FROM "+s.join(", ")+a},t.prototype.createJoinExpression=function(){var e=this,t=this.expressionMap.joinAttributes.map(function(t){var r=t.relation,n=t.tableName,i=t.alias.name,o=t.condition?" AND ("+t.condition+")":"",a=t.parentAlias;if(!a||!r){var s=t.alias.subQuery?t.alias.subQuery:e.getTableName(n);return" "+t.direction+" JOIN "+s+" "+e.escape(i)+(t.condition?" ON "+e.replacePropertyNames(t.condition):"")}if(r.isManyToOne||r.isOneToOneOwner){u=r.joinColumns.map(function(e){return i+"."+e.referencedColumn.propertyPath+"="+a+"."+r.propertyPath+"."+e.referencedColumn.propertyPath}).join(" AND ");return" "+t.direction+" JOIN "+e.getTableName(n)+" "+e.escape(i)+" ON "+e.replacePropertyNames(u+o)}if(r.isOneToMany||r.isOneToOneNotOwner){var u=r.inverseRelation.joinColumns.map(function(e){return i+"."+r.inverseRelation.propertyPath+"."+e.referencedColumn.propertyPath+"="+a+"."+e.referencedColumn.propertyPath}).join(" AND ");return" "+t.direction+" JOIN "+e.getTableName(n)+" "+e.escape(i)+" ON "+e.replacePropertyNames(u+o)}var c=r.junctionEntityMetadata.tableName,l=t.junctionAlias,p="",d="";return r.isOwning?(p=r.joinColumns.map(function(e){return l+"."+e.propertyPath+"="+a+"."+e.referencedColumn.propertyPath}).join(" AND "),d=r.inverseJoinColumns.map(function(e){return i+"."+e.referencedColumn.propertyPath+"="+l+"."+e.propertyPath}).join(" AND ")):(p=r.inverseRelation.inverseJoinColumns.map(function(e){return l+"."+e.propertyPath+"="+a+"."+e.referencedColumn.propertyPath}).join(" AND "),d=r.inverseRelation.joinColumns.map(function(e){return i+"."+e.referencedColumn.propertyPath+"="+l+"."+e.propertyPath}).join(" AND "))," "+t.direction+" JOIN "+e.getTableName(c)+" "+e.escape(l)+" ON "+e.replacePropertyNames(p)+" "+t.direction+" JOIN "+e.getTableName(n)+" "+e.escape(i)+" ON "+e.replacePropertyNames(d+o)});if(!this.expressionMap.ignoreParentTablesJoins&&this.expressionMap.mainAlias.hasMetadata){var r=this.expressionMap.mainAlias.metadata;if(r.parentEntityMetadata&&"class-table"===r.parentEntityMetadata.inheritanceType&&r.parentIdColumns){var n="parentIdColumn_"+r.parentEntityMetadata.tableName,i=r.parentIdColumns.map(function(t){return e.expressionMap.mainAlias.name+"."+t.propertyPath+" = "+e.escape(n)+"."+e.escape(t.referencedColumn.propertyPath)}).join(" AND "),o=" JOIN "+this.getTableName(r.parentEntityMetadata.tableName)+" "+this.escape(n)+" ON "+this.replacePropertyNames(i);t.push(o)}}return t.join(" ")},t.prototype.createGroupByExpression=function(){return this.expressionMap.groupBys&&this.expressionMap.groupBys.length?" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", ")):""},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.allOrderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map(function(r){return"string"==typeof t[r]?e.replacePropertyNames(r)+" "+t[r]:e.replacePropertyNames(r)+" "+t[r].order+" "+t[r].nulls}).join(", "):""},t.prototype.createLimitOffsetOracleSpecificExpression=function(e){return(this.expressionMap.offset||this.expressionMap.limit)&&this.connection.driver instanceof b.OracleDriver&&(e="SELECT * FROM ("+e+") WHERE ",this.expressionMap.offset&&(e+=this.escape("RN")+" >= "+this.expressionMap.offset),this.expressionMap.limit&&(e+=(this.expressionMap.offset?" AND ":"")+this.escape("RN")+" <= "+((this.expressionMap.offset||0)+this.expressionMap.limit))),e},t.prototype.createLimitOffsetExpression=function(){if(this.connection.driver instanceof b.OracleDriver)return"";if(this.connection.driver instanceof n.SqlServerDriver){if(this.expressionMap.limit&&this.expressionMap.offset)return" OFFSET "+this.expressionMap.offset+" ROWS FETCH NEXT "+this.expressionMap.limit+" ROWS ONLY";if(this.expressionMap.limit)return" OFFSET 0 ROWS FETCH NEXT "+this.expressionMap.limit+" ROWS ONLY";if(this.expressionMap.offset)return" OFFSET "+this.expressionMap.offset+" ROWS"}else if(this.connection.driver instanceof g.MysqlDriver){if(this.expressionMap.limit&&this.expressionMap.offset)return" LIMIT "+this.expressionMap.limit+" OFFSET "+this.expressionMap.offset;if(this.expressionMap.limit)return" LIMIT "+this.expressionMap.limit;if(this.expressionMap.offset)throw new M.OffsetWithoutLimitNotSupportedError("MySQL")}else if(this.connection.driver instanceof E.AbstractSqliteDriver){if(this.expressionMap.limit&&this.expressionMap.offset)return" LIMIT "+this.expressionMap.limit+" OFFSET "+this.expressionMap.offset;if(this.expressionMap.limit)return" LIMIT "+this.expressionMap.limit;if(this.expressionMap.offset)return" LIMIT -1 OFFSET "+this.expressionMap.offset}else{if(this.expressionMap.limit&&this.expressionMap.offset)return" LIMIT "+this.expressionMap.limit+" OFFSET "+this.expressionMap.offset;if(this.expressionMap.limit)return" LIMIT "+this.expressionMap.limit;if(this.expressionMap.offset)return" OFFSET "+this.expressionMap.offset}return""},t.prototype.createLockExpression=function(){switch(this.expressionMap.lockMode){case"pessimistic_read":if(this.connection.driver instanceof g.MysqlDriver)return" LOCK IN SHARE MODE";if(this.connection.driver instanceof v.PostgresDriver)return" FOR SHARE";if(this.connection.driver instanceof n.SqlServerDriver)return"";throw new y.LockNotSupportedOnGivenDriverError;case"pessimistic_write":if(this.connection.driver instanceof g.MysqlDriver||this.connection.driver instanceof v.PostgresDriver)return" FOR UPDATE";if(this.connection.driver instanceof n.SqlServerDriver)return"";throw new y.LockNotSupportedOnGivenDriverError;default:return""}},t.prototype.createHavingExpression=function(){var e=this;if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";var t=this.expressionMap.havings.map(function(t,r){switch(t.type){case"and":return(r>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(r>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}}).join(" ");return t.length?" HAVING "+t:""},t.prototype.buildEscapedEntityColumnSelects=function(e,t){var r=this,n=this.expressionMap.selects.some(function(t){return t.selection===e}),i=[];n&&i.push.apply(i,t.columns.filter(function(e){return!0===e.isSelect})),i.push.apply(i,t.columns.filter(function(t){return r.expressionMap.selects.some(function(r){return r.selection===e+"."+t.propertyPath})}));var o=this.expressionMap.queryEntity?t.primaryColumns.filter(function(e){return-1===i.indexOf(e)}):[];return i.concat(o).map(function(t){var i=r.expressionMap.selects.find(function(r){return r.selection===e+"."+t.propertyPath});return{selection:r.escape(e)+"."+r.escape(t.databaseName),aliasName:i&&i.aliasName?i.aliasName:e+"_"+t.databaseName,virtual:i?!0===i.virtual:!n}})},t.prototype.findEntityColumnSelects=function(e,t){var r=this.expressionMap.selects.find(function(t){return t.selection===e});return r?[r]:this.expressionMap.selects.filter(function(r){return t.columns.some(function(t){return r.selection===e+"."+t.propertyPath})})},t.prototype.executeCountQuery=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return this.expressionMap.queryEntity=!1,t=this.expressionMap.mainAlias.name,r=this.expressionMap.mainAlias.metadata,n=this.escape(t),i="",i=r.hasMultiplePrimaryKeys?this.connection.driver instanceof E.AbstractSqliteDriver?"COUNT(DISTINCT("+r.primaryColumns.map(function(e,t){var r=a.escape(e.databaseName);return n+"."+r}).join(" || ")+')) as "cnt"':"COUNT(DISTINCT(CONCAT("+r.primaryColumns.map(function(e,t){var r=a.escape(e.databaseName);return n+"."+r}).join(", ")+'))) as "cnt"':"COUNT(DISTINCT("+r.primaryColumns.map(function(e,t){var r=a.escape(e.databaseName);return n+"."+r}).join(", ")+')) as "cnt"',[4,this.clone().mergeExpressionMap({ignoreParentTablesJoins:!0}).orderBy().groupBy().offset(void 0).limit(void 0).select(i).loadRawResults(e)];case 1:return(o=s.sent())&&o[0]&&o[0].cnt?[2,parseInt(o[0].cnt)]:[2,0]}})})},t.prototype.executeEntitiesAndRawResults=function(e){return __awaiter(this,void 0,void 0,function(){var n,a,s,u,c,l,h,y,g,v,b,E,M,_,C,w,N,R,S,A,O,x=this;return __generator(this,function(P){switch(P.label){case 0:if(!this.expressionMap.mainAlias)throw new Error('Alias is not set. Use "from" method to set an alias.');if(("pessimistic_read"===this.expressionMap.lockMode||"pessimistic_write"===this.expressionMap.lockMode)&&!e.isTransactionActive)throw new i.PessimisticLockTransactionRequiredError;if("optimistic"===this.expressionMap.lockMode&&!(n=this.expressionMap.mainAlias.metadata).versionColumn&&!n.updateDateColumn)throw new o.NoVersionOrUpdateDateColumnError(n.name);return a=new p.RelationIdLoader(this.connection,e,this.expressionMap.relationIdAttributes),s=new m.RelationCountLoader(this.connection,e,this.expressionMap.relationCountAttributes),(u=new d.RelationIdMetadataToAttributeTransformer(this.expressionMap)).transform(),(c=new f.RelationCountMetadataToAttributeTransformer(this.expressionMap)).transform(),l=[],h=[],this.expressionMap.skip||this.expressionMap.take?(y=this.createOrderByCombinedWithSelectExpression("distinctAlias"),g=y[0],v=y[1],b=this.expressionMap.mainAlias.metadata,E=this.expressionMap.mainAlias.name,M=b.primaryColumns.map(function(e){var t=x.escape("distinctAlias"),r=x.escape(E+"_"+e.databaseName);return v[r]||(v[r]="ASC"),t+"."+r+' as "ids_'+E+"_"+e.databaseName+'"'}),[4,new t(this.connection,e).select("DISTINCT "+M.join(", ")).addSelect(g).from("("+this.clone().orderBy().groupBy().getQuery()+")","distinctAlias").offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(v).cache(this.expressionMap.cache?this.expressionMap.cache:this.expressionMap.cacheId,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany()]):[3,4];case 1:return(l=P.sent()).length>0?(_="",C={},b.hasMultiplePrimaryKeys?_=l.map(function(e,t){return b.primaryColumns.map(function(r){return C["ids_"+t+"_"+r.databaseName]=e["ids_"+E+"_"+r.databaseName],E+"."+r.propertyPath+"=:ids_"+t+"_"+r.databaseName}).join(" AND ")}).join(" OR "):(w=l.map(function(e){return e["ids_"+E+"_"+b.primaryColumns[0].databaseName]}),(N=w.every(function(e){return"number"==typeof e}))?_=E+"."+b.primaryColumns[0].propertyPath+" IN ("+w.join(", ")+")":(C.ids=w,_=E+"."+b.primaryColumns[0].propertyPath+" IN (:ids)")),[4,this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:_}).setParameters(C).loadRawResults(e)]):[3,3];case 2:l=P.sent(),P.label=3;case 3:return[3,6];case 4:return[4,this.loadRawResults(e)];case 5:l=P.sent(),P.label=6;case 6:return l.length>0?[4,a.load(l)]:[3,10];case 7:return R=P.sent(),[4,s.load(l)];case 8:return S=P.sent(),A=new r.RawSqlResultsToEntityTransformer(this.expressionMap,this.connection.driver,R,S),h=A.transform(l,this.expressionMap.mainAlias),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(O=new T.BroadcasterResult,e.broadcaster.broadcastLoadEventsForAll(O,this.expressionMap.mainAlias.metadata,h),O.promises.length>0?[4,Promise.all(O.promises)]:[3,10]):[3,10];case 9:P.sent(),P.label=10;case 10:return[2,{raw:l,entities:h}]}})})},t.prototype.createOrderByCombinedWithSelectExpression=function(e){var t=this,r=this.expressionMap.allOrderBys,n=Object.keys(r).map(function(r){if(-1!==r.indexOf(".")){var n=r.split("."),i=n[0],o=n[1],a=t.expressionMap.findAliasByName(i).metadata.findColumnWithPropertyName(o);return t.escape(e)+"."+t.escape(i+"_"+a.databaseName)}}).join(", "),i={};return Object.keys(r).forEach(function(n){if(-1!==n.indexOf(".")){var o=n.split("."),a=o[0],s=o[1],u=t.expressionMap.findAliasByName(a).metadata.findColumnWithPropertyName(s);i[t.escape(e)+"."+t.escape(a+"_"+u.databaseName)]=r[n]}}),[n,i]},t.prototype.loadRawResults=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,i,o,a;return __generator(this,function(s){switch(s.label){case 0:return t=this.getQueryAndParameters(),r=t[0],n=t[1],i="object"==typeof this.connection.options.cache?this.connection.options.cache:{},o=void 0,this.connection.queryResultCache&&(this.expressionMap.cache||i.alwaysEnabled)?[4,this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:this.getSql(),duration:this.expressionMap.cacheDuration||i.duration||1e3},e)]:[3,2];case 1:if((o=s.sent())&&!this.connection.queryResultCache.isExpired(o))return[2,JSON.parse(o.result)];s.label=2;case 2:return[4,e.query(r,n)];case 3:return a=s.sent(),this.connection.queryResultCache&&(this.expressionMap.cache||i.alwaysEnabled)?[4,this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:this.getSql(),time:(new Date).getTime(),duration:this.expressionMap.cacheDuration||i.duration||1e3,result:JSON.stringify(a)},o,e)]:[3,5];case 4:s.sent(),s.label=5;case 5:return[2,a]}})})},t.prototype.mergeExpressionMap=function(e){return Object.assign(this.expressionMap,e),this},t.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner("slave")},t}(h.QueryBuilder),e("SelectQueryBuilder",_)}}}),System.register("typeorm/metadata-args/RelationIdMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/RelationIdMetadata",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.setValue=function(e){var t=this,r=this.relation.getEntityValue(e);if(r instanceof Array)e[this.propertyName]=r.map(function(e){return t.relation.inverseEntityMetadata.getEntityIdMixedMap(e)}).filter(function(e){return null!==e&&void 0!==e});else{var n=this.relation.inverseEntityMetadata.getEntityIdMixedMap(r);void 0!==n&&(e[this.propertyName]=n)}},e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error("Cannot find relation "+e+". Wrong relation specified for @RelationId decorator.");this.relation=t},e}(),e("RelationIdMetadata",r)}}}),System.register("typeorm/metadata/types/EventListenerTypes",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(){}return e.AFTER_LOAD="after-load",e.BEFORE_INSERT="before-insert",e.AFTER_INSERT="after-insert",e.BEFORE_UPDATE="before-update",e.AFTER_UPDATE="after-update",e.BEFORE_REMOVE="before-remove",e.AFTER_REMOVE="after-remove",e}(),e("EventListenerTypes",r)}}}),System.register("typeorm/metadata-args/EntityListenerMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/EntityListenerMetadata",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e){this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.type=e.args.type}return e.prototype.isAllowed=function(e){return this.entityMetadata.target===e.constructor||this.entityMetadata.target instanceof Function&&e.constructor.prototype instanceof this.entityMetadata.target},e.prototype.execute=function(e){if(!this.embeddedMetadata)return e[this.propertyName]();this.callEntityEmbeddedMethod(e,this.embeddedMetadata.propertyPath.split("."))},e.prototype.callEntityEmbeddedMethod=function(e,t){var r=t.shift();r&&(0===t.length?e[r][this.propertyName]():e[r]&&this.callEntityEmbeddedMethod(e[r],t))},e}(),e("EntityListenerMetadata",r)}}}),System.register("typeorm/metadata/EmbeddedMetadata",["typeorm/driver/mongodb/MongoDriver"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e){this.columns=[],this.relations=[],this.listeners=[],this.indices=[],this.relationIds=[],this.relationCounts=[],this.embeddeds=[],this.isArray=!1,this.parentPropertyNames=[],this.parentPrefixes=[],this.embeddedMetadataTree=[],this.columnsFromTree=[],this.relationsFromTree=[],this.listenersFromTree=[],this.indicesFromTree=[],this.relationIdsFromTree=[],this.relationCountsFromTree=[],this.entityMetadata=e.entityMetadata,this.type=e.args.type(),this.propertyName=e.args.propertyName,this.customPrefix=e.args.prefix,this.isArray=e.args.isArray}return e.prototype.create=function(){return new this.type},e.prototype.build=function(e){return this.embeddeds.forEach(function(t){return t.build(e)}),this.prefix=this.buildPrefix(e),this.parentPropertyNames=this.buildParentPropertyNames(),this.parentPrefixes=this.buildParentPrefixes(),this.propertyPath=this.parentPropertyNames.join("."),this.embeddedMetadataTree=this.buildEmbeddedMetadataTree(),this.columnsFromTree=this.buildColumnsFromTree(),this.relationsFromTree=this.buildRelationsFromTree(),this.listenersFromTree=this.buildListenersFromTree(),this.indicesFromTree=this.buildIndicesFromTree(),this.relationIdsFromTree=this.buildRelationIdsFromTree(),this.relationCountsFromTree=this.buildRelationCountsFromTree(),this},e.prototype.buildPrefix=function(e){if(e.driver instanceof r.MongoDriver)return this.propertyName;var t=[];return this.parentEmbeddedMetadata&&t.push(this.parentEmbeddedMetadata.buildPrefix(e)),void 0===this.customPrefix?t.push(this.propertyName):"string"==typeof this.customPrefix&&t.push(this.customPrefix),t.join("_")},e.prototype.buildParentPropertyNames=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPropertyNames().concat(this.propertyName):[this.propertyName]},e.prototype.buildParentPrefixes=function(){return[this.prefix||this.propertyName]},e.prototype.buildEmbeddedMetadataTree=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildEmbeddedMetadataTree().concat(this):[this]},e.prototype.buildColumnsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildColumnsFromTree())},this.columns)},e.prototype.buildRelationsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationsFromTree())},this.relations)},e.prototype.buildListenersFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildListenersFromTree())},this.listeners)},e.prototype.buildIndicesFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildIndicesFromTree())},this.indices)},e.prototype.buildRelationIdsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationIdsFromTree())},this.relationIds)},e.prototype.buildRelationCountsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationCountsFromTree())},this.relationCounts)},e}(),e("EmbeddedMetadata",n)}}}),System.register("typeorm/decorator/options/RelationOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/PropertyTypeInFunction",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/RelationTypeInFunction",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/RelationMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/RelationMetadata",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e){this.isTreeParent=!1,this.isTreeChildren=!1,this.isPrimary=!1,this.isLazy=!1,this.isEager=!1,this.persistenceEnabled=!0,this.isCascadeInsert=!1,this.isCascadeUpdate=!1,this.isCascadeRemove=!1,this.isNullable=!0,this.isOwning=!1,this.isOneToOne=!1,this.isOneToOneOwner=!1,this.isWithJoinColumn=!1,this.isOneToOneNotOwner=!1,this.isOneToMany=!1,this.isManyToOne=!1,this.isManyToMany=!1,this.isManyToManyOwner=!1,this.isManyToManyNotOwner=!1,this.foreignKeys=[],this.joinColumns=[],this.inverseJoinColumns=[],this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata;var t=e.args;this.target=t.target,this.propertyName=t.propertyName,this.relationType=t.relationType,t.inverseSideProperty&&(this.givenInverseSidePropertyFactory=t.inverseSideProperty),this.isLazy=t.isLazy||!1,this.isCascadeInsert=!0===t.options.cascade||t.options.cascade instanceof Array&&-1!==t.options.cascade.indexOf("insert"),this.isCascadeUpdate=!0===t.options.cascade||t.options.cascade instanceof Array&&-1!==t.options.cascade.indexOf("update"),this.isNullable=!1!==t.options.nullable,this.onDelete=t.options.onDelete,this.isPrimary=t.options.primary||!1,this.isEager=t.options.eager||!1,this.persistenceEnabled=t.options.persistence||!0,this.isTreeParent=t.isTreeParent||!1,this.isTreeChildren=t.isTreeChildren||!1,this.type=t.type instanceof Function?t.type():t.type,this.isOneToOne="one-to-one"===this.relationType,this.isOneToMany="one-to-many"===this.relationType,this.isManyToOne="many-to-one"===this.relationType,this.isManyToMany="many-to-many"===this.relationType,this.isOneToOneNotOwner=!!this.isOneToOne,this.isManyToManyNotOwner=!!this.isManyToMany}return e.prototype.getRelationIdMap=function(e){var t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map(function(e){return e.referencedColumn});return this.inverseEntityMetadata.getValueMap(e,t)},e.prototype.ensureRelationIdMap=function(e){if(e instanceof Object)return e;var t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map(function(e){return e.referencedColumn});if(t.length>1)throw new Error("Cannot create relation id map for a single value because relation contains multiple referenced columns.");return t[0].createValueMap(e)},e.prototype.getEntityValue=function(e,t){if(void 0===t&&(t=!1),this.embeddedMetadata){var r=this.embeddedMetadata.parentPropertyNames.slice(),n=function(e,t){var r=e.shift();{if(!r)return t;if(t[r])return n(e,t[r])}},i=n(r,e);if(this.isLazy){if(void 0!==i["__"+this.propertyName+"__"])return i["__"+this.propertyName+"__"];if(!0===t)return i[this.propertyName];return}return i?i[this.isLazy?"__"+this.propertyName+"__":this.propertyName]:void 0}return this.isLazy?void 0!==e["__"+this.propertyName+"__"]?e["__"+this.propertyName+"__"]:!0===t?e[this.propertyName]:void 0:e[this.propertyName]},e.prototype.setEntityValue=function(e,t){var r=this.isLazy?"__"+this.propertyName+"__":this.propertyName;if(this.embeddedMetadata){var n=function(e,i){var o=e.shift();return o?(i[o.propertyName]||(i[o.propertyName]=o.create()),n(e,i[o.propertyName]),i):(i[r]=t,i)};return n(this.embeddedMetadata.embeddedMetadataTree.slice(),e)}e[r]=t},e.prototype.createValueMap=function(e){var t=this;if(this.embeddedMetadata){var r=this.embeddedMetadata.parentPropertyNames.slice(),n=function(r,i){var o=r.shift();return o?(i[o]={},n(r,i[o]),i):(i[t.propertyName]=e,i)};return n(r,{})}return i={},i[this.propertyName]=e,i;var i},e.prototype.build=function(){this.propertyPath=this.buildPropertyPath()},e.prototype.registerForeignKeys=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];(r=this.foreignKeys).push.apply(r,e),this.joinColumns=this.foreignKeys[0]?this.foreignKeys[0].columns:[],this.inverseJoinColumns=this.foreignKeys[1]?this.foreignKeys[1].columns:[],this.isOwning=this.isManyToOne||(this.isManyToMany||this.isOneToOne)&&this.joinColumns.length>0,this.isOneToOneOwner=this.isOneToOne&&this.isOwning,this.isOneToOneNotOwner=this.isOneToOne&&!this.isOwning,this.isManyToManyOwner=this.isManyToMany&&this.isOwning,this.isManyToManyNotOwner=this.isManyToMany&&!this.isOwning,this.isWithJoinColumn=this.isManyToOne||this.isOneToOneOwner;var r},e.prototype.registerJunctionEntityMetadata=function(e){this.junctionEntityMetadata=e,this.joinTableName=e.tableName,this.inverseRelation&&(this.inverseRelation.junctionEntityMetadata=e,this.joinTableName=e.tableName)},e.prototype.buildInverseSidePropertyPath=function(){if(this.givenInverseSidePropertyFactory){var e=this.inverseEntityMetadata.propertiesMap;if("function"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory(e);if("string"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory}else{if(this.isTreeParent&&this.entityMetadata.treeChildrenRelation)return this.entityMetadata.treeChildrenRelation.propertyName;if(this.isTreeChildren&&this.entityMetadata.treeParentRelation)return this.entityMetadata.treeParentRelation.propertyName}return""},e.prototype.buildPropertyPath=function(){return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length?this.embeddedMetadata.parentPropertyNames.join(".")+"."+this.propertyName:this.propertyName},e}(),e("RelationMetadata",r)}}}),System.register("typeorm/lazy-loading/LazyRelationsWrapper",["typeorm/query-builder/RelationLoader"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e){this.connection=e}return e.prototype.wrap=function(e,t){var n=new r.RelationLoader(this.connection),i="__"+t.propertyName+"__",o="__promise_"+t.propertyName+"__",a="__has_"+t.propertyName+"__";Object.defineProperty(e,t.propertyName,{get:function(){var e=this;return!0===this[a]?Promise.resolve(this[i]):this[o]?this[o]:(this[o]=n.load(t,this).then(function(t){return e[i]=t,e[a]=!0,delete e[o],e[i]}),this[o])},set:function(e){var t=this;e instanceof Promise?e.then(function(e){t[i]=e,t[a]=!0}):(this[i]=e,this[a]=!0)},configurable:!0})},e}(),e("LazyRelationsWrapper",n)}}}),System.register("typeorm/metadata-args/TableMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/EntityMetadata",["typeorm/lazy-loading/LazyRelationsWrapper","typeorm/util/OrmUtils","typeorm/driver/postgres/PostgresDriver","typeorm/driver/sqlserver/SqlServerDriver"],function(e,t){"use strict";var r,n,i,o,a;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.childEntityMetadatas=[],this.tableType="regular",this.isJunction=!1,this.ownColumns=[],this.ownRelations=[],this.ownListeners=[],this.ownIndices=[],this.relations=[],this.eagerRelations=[],this.lazyRelations=[],this.columns=[],this.nonVirtualColumns=[],this.ownerColumns=[],this.inverseColumns=[],this.relationIds=[],this.relationCounts=[],this.indices=[],this.foreignKeys=[],this.embeddeds=[],this.allEmbeddeds=[],this.listeners=[],this.afterLoadListeners=[],this.beforeInsertListeners=[],this.afterInsertListeners=[],this.beforeUpdateListeners=[],this.afterUpdateListeners=[],this.beforeRemoveListeners=[],this.afterRemoveListeners=[],this.generatedColumns=[],this.primaryColumns=[],this.parentIdColumns=[],this.oneToOneRelations=[],this.ownerOneToOneRelations=[],this.oneToManyRelations=[],this.manyToOneRelations=[],this.manyToManyRelations=[],this.ownerManyToManyRelations=[],this.relationsWithJoinColumns=[];var t=e.connection.namingStrategy,n=e.connection.options.entityPrefix;this.lazyRelationsWrapper=new r.LazyRelationsWrapper(e.connection),this.parentClosureEntityMetadata=e.parentClosureEntityMetadata,this.target=e.args.target,this.tableType=e.args.type,this.engine=e.args.engine,this.database=e.args.database,this.schema=e.args.schema,this.givenTableName=e.args.name,this.skipSync=e.args.skipSync||!1,this.targetName=e.args.target instanceof Function?e.args.target.name:e.args.target,this.tableNameWithoutPrefix="closure-junction"===this.tableType?t.closureJunctionTableName(this.givenTableName):t.tableName(this.targetName,this.givenTableName),this.tableName=n?t.prefixTableName(n,this.tableNameWithoutPrefix):this.tableNameWithoutPrefix,this.target=this.target?this.target:this.tableName,this.name=this.targetName?this.targetName:this.tableName,this.tablePath=this.buildTablePath(e.connection.driver),this.schemaPath=this.buildSchemaPath(e.connection.driver),this.isClassTableChild="class-table-child"===this.tableType,this.isSingleTableChild="single-table-child"===this.tableType,this.isEmbeddable="embeddable"===this.tableType,this.isJunction="closure-junction"===this.tableType||"junction"===this.tableType,this.isClosureJunction="closure-junction"===this.tableType,this.isClosure="closure"===this.tableType,this.isAbstract="abstract"===this.tableType,this.isRegular="regular"===this.tableType,this.orderBy=e.args.orderBy instanceof Function?e.args.orderBy(this.propertiesMap):e.args.orderBy}return e.prototype.create=function(){var e=this;if(this.target instanceof Function)return new this.target;var t={};return this.relations.filter(function(e){return e.isLazy}).forEach(function(r){return e.lazyRelationsWrapper.wrap(t,r)}),t},e.prototype.hasId=function(e){return!!e&&this.primaryColumns.every(function(t){var r=t.getEntityValue(e);return null!==r&&void 0!==r&&""!==r})},e.prototype.compareIds=function(e,t){return void 0!==e&&null!==e&&void 0!==t&&null!==t&&n.OrmUtils.deepCompare(e,t)},e.prototype.compareEntities=function(e,t){var r=this.isEntityIdMapEmpty(e),n=this.isEntityIdMapEmpty(t);if(r||n)return!1;var i=this.getEntityIdMap(e),o=this.getEntityIdMap(t);return this.compareIds(i,o)},e.prototype.hasEmbeddedWithPropertyPath=function(e){return!!this.findEmbeddedWithPropertyPath(e)},e.prototype.findEmbeddedWithPropertyPath=function(e){return this.allEmbeddeds.find(function(t){return t.propertyPath===e})},e.prototype.findColumnWithPropertyName=function(e){return this.columns.find(function(t){return t.propertyName===e})},e.prototype.findColumnsWithPropertyPath=function(e){var t=this.columns.find(function(t){return t.propertyPath===e});if(t)return[t];var r=this.relations.find(function(t){return t.propertyPath===e});return r&&r.joinColumns?r.joinColumns:[]},e.prototype.findColumnWithDatabaseName=function(e){return this.columns.find(function(t){return t.databaseName===e})},e.prototype.findRelationWithDbName=function(e){return this.relationsWithJoinColumns.find(function(t){return!!t.joinColumns.find(function(t){return t.databaseName===e})})},e.prototype.findRelationWithPropertyPath=function(e){return this.relations.find(function(t){return t.propertyPath===e})},e.prototype.computePropertyPath=function(e){return"string"==typeof e?e:e(this.propertiesMap)},e.prototype.ensureEntityIdMap=function(e){if(e instanceof Object)return e;if(this.hasMultiplePrimaryKeys)throw new Error("Cannot create entity id map for a single value because this entity metadata contains multiple primary columns.");return this.primaryColumns[0].createValueMap(e)},e.prototype.isEntityIdMapEmpty=function(e){return!this.primaryColumns.every(function(t){var r=t.getEntityValue(e);return null!==r&&void 0!==r})},e.prototype.getEntityIdMap=function(e){if(e)return this.getValueMap(e,this.primaryColumns)},e.prototype.getValueMap=function(e,t){var r=t.reduce(function(t,r){return r.isObjectId?Object.assign(t,r.getEntityValueMap(e)):n.OrmUtils.mergeDeep(t,r.getEntityValueMap(e))},{});return Object.keys(r).length>0?r:void 0},e.prototype.getValueDatabasePaths=function(e){return this.columns.reduce(function(t,r){var n=r.getEntityValue(e);return void 0!==n&&(t[r.databasePath]=n),t},{})},e.prototype.convertPropertiesMapToDatabaseMap=function(e){var t=this,r={};return this.columns.forEach(function(t){t.isVirtual||n.OrmUtils.mergeDeep(r,t.createValueMap(t.getEntityValue(e)))}),this.relations.forEach(function(i){var o=i.getEntityValue(e);o instanceof Object&&(o=i.createValueMap(t.convertPropertiesMapToDatabaseMap(o))),n.OrmUtils.mergeDeep(r,o)}),r},e.prototype.getDatabaseEntityIdMap=function(e){var t={};this.primaryColumns.forEach(function(r){var n=r.getEntityValue(e);null!==n&&void 0!==n&&(t[r.databaseName]=n)});return Object.keys(t).every(function(e){return void 0!==t[e]&&null!==t[e]})?t:void 0},e.prototype.getEntityIdMixedMap=function(e){if(!e)return e;var t=this.getEntityIdMap(e);return this.hasMultiplePrimaryKeys?t:t?this.primaryColumns[0].getEntityValue(t):t},e.prototype.checkIfObjectContainsAllPrimaryKeys=function(e){return this.primaryColumns.every(function(t){return e.hasOwnProperty(t.propertyName)})},e.prototype.extractRelationValuesFromEntity=function(e,t){var r=[];return t.forEach(function(t){var n=t.getEntityValue(e);n instanceof Array?n.forEach(function(e){return r.push([t,e,t.inverseEntityMetadata])}):n&&r.push([t,n,t.inverseEntityMetadata])}),r},e.prototype.registerColumn=function(e){this.ownColumns.push(e),this.columns=this.embeddeds.reduce(function(e,t){return e.concat(t.columnsFromTree)},this.ownColumns),this.parentIdColumns=this.columns.filter(function(e){return e.isParentId}),this.primaryColumns=this.columns.filter(function(e){return e.isPrimary}),this.hasMultiplePrimaryKeys=this.primaryColumns.length>1,this.hasUUIDGeneratedColumns=this.columns.filter(function(e){return e.isGenerated||"uuid"===e.generationStrategy}).length>0,this.propertiesMap=this.createPropertiesMap()},e.prototype.createPropertiesMap=function(){var e={};return this.columns.forEach(function(t){return n.OrmUtils.mergeDeep(e,t.createValueMap(t.propertyPath))}),this.relations.forEach(function(t){return n.OrmUtils.mergeDeep(e,t.createValueMap(t.propertyPath))}),e},e.prototype.buildTablePath=function(e){var t=this.tableName;return this.schema&&(t=this.schema+"."+t),!this.database||e instanceof i.PostgresDriver||(t=!this.schema&&e instanceof o.SqlServerDriver?this.database+".."+t:this.database+"."+t),t},e.prototype.buildSchemaPath=function(e){if(this.schema)return!this.database||e instanceof i.PostgresDriver?this.schema:this.database+"."+this.schema},e}(),e("EntityMetadata",a)}}}),System.register("typeorm/decorator/options/ValueTransformer",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/ColumnOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/types/ColumnMode",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/ColumnMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/ColumnMetadata",["typeorm/util/OrmUtils","typeorm/driver/mongodb/MongoDriver","typeorm/util/PromiseUtils"],function(e,t){"use strict";var r,n,i,o;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e}],execute:function(){o=function(){function e(e){this.length="",this.isPrimary=!1,this.isGenerated=!1,this.isUnique=!1,this.isNullable=!1,this.isSelect=!0,this.isReadonly=!1,this.comment="",this.isVirtual=!1,this.isParentId=!1,this.isDiscriminator=!1,this.isTreeLevel=!1,this.isCreateDate=!1,this.isUpdateDate=!1,this.isVersion=!1,this.isObjectId=!1,this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.referencedColumn=e.referencedColumn,e.args.target&&(this.target=e.args.target),e.args.propertyName&&(this.propertyName=e.args.propertyName),e.args.options.name&&(this.givenDatabaseName=e.args.options.name),e.args.options.type&&(this.type=e.args.options.type),e.args.options.length&&(this.length=e.args.options.length?e.args.options.length.toString():""),e.args.options.charset&&(this.charset=e.args.options.charset),e.args.options.collation&&(this.collation=e.args.options.collation),e.args.options.primary&&(this.isPrimary=e.args.options.primary),e.args.options.unique&&(this.isUnique=e.args.options.unique),null===e.args.options.default&&(this.isNullable=!0),void 0!==e.args.options.nullable&&(this.isNullable=e.args.options.nullable),void 0!==e.args.options.select&&(this.isSelect=e.args.options.select),void 0!==e.args.options.readonly&&(this.isReadonly=e.args.options.readonly),e.args.options.comment&&(this.comment=e.args.options.comment),void 0!==e.args.options.default&&(this.default=e.args.options.default),e.args.options.scale&&(this.scale=e.args.options.scale),e.args.options.precision&&(this.precision=e.args.options.precision),e.args.options.enum&&(e.args.options.enum instanceof Object?this.enum=Object.keys(e.args.options.enum).map(function(t){return e.args.options.enum[t]}):this.enum=e.args.options.enum),e.args.options.isArray&&(this.isArray=e.args.options.isArray),e.args.options.array&&(this.isArray=e.args.options.array),e.args.mode&&(this.isVirtual="virtual"===e.args.mode,this.isParentId="parentId"===e.args.mode,this.isDiscriminator="discriminator"===e.args.mode,this.isTreeLevel="treeLevel"===e.args.mode,this.isCreateDate="createDate"===e.args.mode,this.isUpdateDate="updateDate"===e.args.mode,this.isVersion="version"===e.args.mode,this.isObjectId="objectId"===e.args.mode),e.args.options.transformer&&(this.transformer=e.args.options.transformer),this.isTreeLevel&&(this.type=e.connection.driver.mappedDataTypes.treeLevel),this.isCreateDate&&(this.type=e.connection.driver.mappedDataTypes.createDate,this.default||(this.default=function(){return e.connection.driver.mappedDataTypes.createDateDefault}),!this.precision&&e.connection.driver.mappedDataTypes.createDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.createDatePrecision)),this.isUpdateDate&&(this.type=e.connection.driver.mappedDataTypes.updateDate,this.default||(this.default=function(){return e.connection.driver.mappedDataTypes.updateDateDefault}),!this.precision&&e.connection.driver.mappedDataTypes.updateDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.updateDatePrecision)),this.isVersion&&(this.type=e.connection.driver.mappedDataTypes.version)}return e.prototype.createValueMap=function(e,t){var r=this;if(void 0===t&&(t=!1),this.embeddedMetadata){var n=this.embeddedMetadata.parentPropertyNames.slice(),i=function(n,o){var a=n.shift();return a?(o[a]={},i(n,o[a]),o):("increment"===r.generationStrategy&&"bigint"===r.type&&(e=String(e)),o[t?r.databaseName:r.propertyName]=e,o)};return i(n,{})}return"increment"===this.generationStrategy&&"bigint"===this.type&&(e=String(e)),o={},o[t?this.databaseName:this.propertyName]=e,o;var o},e.prototype.getEntityValueMap=function(e){var t=this;if(this.embeddedMetadata){var n=this.embeddedMetadata.parentPropertyNames.slice(),i=function(e,r,n){var o=e.shift();if(void 0===r)return n;if(o){var a={};return i(e,r[o],a),Object.keys(a).length>0&&(n[o]=a),n}return void 0!==r[t.propertyName]&&(n[t.propertyName]=r[t.propertyName]),n};return i(n,e,o={}),Object.keys(o).length>0?o:void 0}if(this.relationMetadata&&e[this.propertyName]&&e[this.propertyName]instanceof Object){var o=this.relationMetadata.joinColumns.reduce(function(n,i){var o=i.referencedColumn.getEntityValueMap(e[t.propertyName]);return void 0===o?n:r.OrmUtils.mergeDeep(n,o)},{});if(Object.keys(o).length>0)return a={},a[this.propertyName]=o,a}else{if(void 0!==e[this.propertyName])return s={},s[this.propertyName]=e[this.propertyName],s;return;var a,s}},e.prototype.getEntityValue=function(e){if(!this.embeddedMetadata){if(this.relationMetadata&&this.referencedColumn){o=this.relationMetadata.getEntityValue(e);if(o&&o instanceof Object&&!(o instanceof Function))return this.referencedColumn.getEntityValue(i.PromiseUtils.extractValue(o));if(e[this.propertyName]&&e[this.propertyName]instanceof Object&&!(e[this.propertyName]instanceof Function))return this.referencedColumn.getEntityValue(i.PromiseUtils.extractValue(e[this.propertyName]))}else if(this.referencedColumn)return this.referencedColumn.getEntityValue(i.PromiseUtils.extractValue(e[this.propertyName]));return e[this.propertyName]}var t=this.embeddedMetadata.parentPropertyNames.slice(),r=function(e,t){var n=e.shift();return n&&t?r(e,t[n]):t},n=r(t,e);if(n){if(this.relationMetadata&&this.referencedColumn){var o;if((o=this.relationMetadata.getEntityValue(n))&&o instanceof Object)return this.referencedColumn.getEntityValue(i.PromiseUtils.extractValue(o));if(n[this.propertyName]&&n[this.propertyName]instanceof Object)return this.referencedColumn.getEntityValue(i.PromiseUtils.extractValue(n[this.propertyName]))}else if(this.referencedColumn)return this.referencedColumn.getEntityValue(i.PromiseUtils.extractValue(n[this.propertyName]));return i.PromiseUtils.extractValue(n[this.propertyName])}},e.prototype.setEntityValue=function(e,t){var r=this;if(this.embeddedMetadata){var n=function(e,i){var o=e.shift();return o?(i[o.propertyName]||(i[o.propertyName]=o.create()),n(e,i[o.propertyName]),i):(i[r.propertyName]=t,i)};return n(this.embeddedMetadata.embeddedMetadataTree.slice(),e)}e[this.propertyName]=t},e.prototype.build=function(e){return this.propertyPath=this.buildPropertyPath(),this.databaseName=this.buildDatabaseName(e),this.databasePath=this.buildDatabasePath(),this.databaseNameWithoutPrefixes=e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,[]),this},e.prototype.buildPropertyPath=function(){var e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.propertyName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName&&(e+="."+this.referencedColumn.propertyName),e},e.prototype.buildDatabasePath=function(){var e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.databaseName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.databaseName!==this.databaseName&&(e+="."+this.referencedColumn.databaseName),e},e.prototype.buildDatabaseName=function(e){var t=this.embeddedMetadata?this.embeddedMetadata.parentPrefixes:[];return e.driver instanceof n.MongoDriver&&(t=[]),e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,t)},e}(),e("ColumnMetadata",o)}}}),System.register("typeorm/schema-builder/schema/TableColumn",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e){this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,this.isArray=!1,this.length="",e&&(this.name=e.name||"",this.type=e.type||"",this.length=e.length||"",this.charset=e.charset,this.collation=e.collation,this.precision=e.precision,this.scale=e.scale,this.default=e.default,this.isNullable=e.isNullable||!1,this.isGenerated=e.isGenerated||!1,this.generationStrategy=e.generationStrategy,this.isPrimary=e.isPrimary||!1,this.isUnique=e.isUnique||!1,this.comment=e.comment,this.enum=e.enum)}return e.prototype.clone=function(){var t=new e;return t.name=this.name,t.type=this.type,t.length=this.length,t.charset=this.charset,t.collation=this.collation,t.precision=this.precision,t.scale=this.scale,t.enum=this.enum,t.default=this.default,t.isNullable=this.isNullable,t.isGenerated=this.isGenerated,t.generationStrategy=this.generationStrategy,t.isPrimary=this.isPrimary,t.isUnique=this.isUnique,t.isArray=this.isArray,t.comment=this.comment,t},e.create=function(t,r,n,i){var o=new e;return o.name=t.databaseName,o.length=i,o.charset=t.charset,o.collation=t.collation,o.precision=t.precision,o.scale=t.scale,o.default=n,o.comment=t.comment,o.isGenerated=t.isGenerated,o.generationStrategy=t.generationStrategy,o.isNullable=t.isNullable,o.type=r,o.isPrimary=t.isPrimary,o.isUnique=t.isUnique,o.isArray=t.isArray||!1,o.enum=t.enum,o},e}(),e("TableColumn",r)}}}),System.register("typeorm/query-runner/QueryRunner",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/Driver",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/util/StringUtils",[],function(e,t){"use strict";t&&t.id;return e("camelCase",function(e){return e.replace(/^([A-Z])|[\s-_](\w)/g,function(e,t,r,n){return r?r.toUpperCase():t.toLowerCase()})}),e("snakeCase",function(e){return e.replace(/(?:([a-z])([A-Z]))|(?:((?!^)[A-Z])([a-z]))/g,"$1_$3$2$4").toLowerCase()}),e("titleCase",function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}),{setters:[],execute:function(){}}}),System.register("typeorm/naming-strategy/DefaultNamingStrategy",["typeorm/util/RandomGenerator","typeorm/util/StringUtils"],function(e,t){"use strict";var r,n,i;t&&t.id;return{setters:[function(e){r=e},function(e){n=e}],execute:function(){i=function(){function e(){}return e.prototype.tableName=function(e,t){return t||n.snakeCase(e)},e.prototype.closureJunctionTableName=function(e){return e+"_closure"},e.prototype.columnName=function(e,t,r){return r.length?n.camelCase(r.join("_"))+(t?n.titleCase(t):n.titleCase(e)):t||e},e.prototype.relationName=function(e){return e},e.prototype.indexName=function(e,t,n){if(e)return e;var i="ind_"+t+"_"+n.join("_");return"ind_"+r.RandomGenerator.sha1(i).substr(0,26)},e.prototype.joinColumnName=function(e,t){return n.camelCase(e+"_"+t)},e.prototype.joinTableName=function(e,t,r,i){return n.snakeCase(e+"_"+r.replace(/\./gi,"_")+"_"+t)},e.prototype.joinTableColumnDuplicationPrefix=function(e,t){return e+"_"+t},e.prototype.joinTableColumnName=function(e,t,r){return n.camelCase(e+"_"+(r||t))},e.prototype.foreignKeyName=function(e,t,n,i){var o=e+"_"+t.join("_")+"_"+n+"_"+i.join("_");return"fk_"+r.RandomGenerator.sha1(o).substr(0,27)},e.prototype.classTableInheritanceParentColumnName=function(e,t){return n.camelCase(e+"_"+t)},e.prototype.prefixTableName=function(e,t){return e+t},e}(),e("DefaultNamingStrategy",i)}}}),System.register("typeorm/error/CannotExecuteNotConnectedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;return r.name="CannotExecuteNotConnectedError",r.message='Cannot execute operation on "'+t+'" connection because connection is not yet established.',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("CannotExecuteNotConnectedError",r)}}}),System.register("typeorm/error/CannotConnectAlreadyConnectedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;return r.name="CannotConnectAlreadyConnectedError",r.message='Cannot create a "'+t+'" connection because connection to the database already established.',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("CannotConnectAlreadyConnectedError",r)}}}),System.register("typeorm/error/EntityMetadataNotFound",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;r.name="EntityMetadataNotFound";var n="function"==typeof t&&t.name?t.name:t;return r.message='No metadata for "'+n+'" was found.',r}return __extends(t,e),t}(Error),e("EntityMetadataNotFound",r)}}}),System.register("typeorm/migration/MigrationInterface",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/migration/Migration",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){return function(e,t,r){this.timestamp=e,this.name=t,this.instance=r}}(),e("Migration",r)}}}),System.register("typeorm/migration/MigrationExecutor",["typeorm/schema-builder/schema/Table","typeorm/schema-builder/schema/TableColumn","typeorm/migration/Migration","typeorm/util/PromiseUtils","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/sqlserver/MssqlParameter"],function(e,t){"use strict";var r,n,i,o,a,s,u;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(){function e(e,t){this.connection=e,this.queryRunner=t}return e.prototype.executePendingMigrations=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,i,a,s,u,c=this;return __generator(this,function(l){switch(l.label){case 0:return e=this.queryRunner||this.connection.createQueryRunner("master"),[4,this.createMigrationsTableIfNotExist(e)];case 1:return l.sent(),[4,this.loadExecutedMigrations(e)];case 2:return t=l.sent(),r=this.getLatestMigration(t),n=this.getMigrations(),(i=n.filter(function(e){if(t.find(function(t){return t.name===e.name}))return!1;if(r&&e.timestamp<r.timestamp)throw new Error("New migration found: "+e.name+", however this migration's timestamp is not valid. Migration's timestamp should not be older then migrations already executed in the database.");return!0})).length?(this.connection.logger.logSchemaBuild(t.length+" migrations are already loaded in the database."),this.connection.logger.logSchemaBuild(n.length+" migrations were found in the source code."),r&&this.connection.logger.logSchemaBuild(r.name+" is the last executed migration. It was executed on "+new Date(1e3*r.timestamp).toString()+"."),this.connection.logger.logSchemaBuild(i.length+" migrations are new migrations that needs to be executed."),a=!1,e.isTransactionActive?[3,4]:[4,e.startTransaction()]):(this.connection.logger.logSchemaBuild("No migrations are pending"),[2]);case 3:l.sent(),a=!0,l.label=4;case 4:return l.trys.push([4,8,13,16]),[4,o.PromiseUtils.runInSequence(i,function(t){return t.instance.up(e).then(function(){return c.insertExecutedMigration(e,t)}).then(function(){c.connection.logger.logSchemaBuild("Migration "+t.name+" has been executed successfully.")})})];case 5:return l.sent(),a?[4,e.commitTransaction()]:[3,7];case 6:l.sent(),l.label=7;case 7:return[3,16];case 8:if(s=l.sent(),!a)return[3,12];l.label=9;case 9:return l.trys.push([9,11,,12]),[4,e.rollbackTransaction()];case 10:return l.sent(),[3,12];case 11:return u=l.sent(),[3,12];case 12:throw s;case 13:return this.queryRunner?[3,15]:[4,e.release()];case 14:l.sent(),l.label=15;case 15:return[7];case 16:return[2]}})})},e.prototype.undoLastMigration=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,i,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return e=this.queryRunner||this.connection.createQueryRunner("master"),[4,this.createMigrationsTableIfNotExist(e)];case 1:return u.sent(),[4,this.loadExecutedMigrations(e)];case 2:if(t=u.sent(),!(r=this.getLatestMigration(t)))return this.connection.logger.logSchemaBuild("No migrations was found in the database. Nothing to revert!"),[2];if(n=this.getMigrations(),!(i=n.find(function(e){return e.name===r.name})))throw new Error("No migration "+r.name+" was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.");return this.connection.logger.logSchemaBuild(t.length+" migrations are already loaded in the database."),this.connection.logger.logSchemaBuild(r.name+" is the last executed migration. It was executed on "+new Date(1e3*r.timestamp).toString()+"."),this.connection.logger.logSchemaBuild("Now reverting it..."),o=!1,e.isTransactionActive?[3,4]:[4,e.startTransaction()];case 3:u.sent(),o=!0,u.label=4;case 4:return u.trys.push([4,9,14,17]),[4,i.instance.down(e)];case 5:return u.sent(),[4,this.deleteExecutedMigration(e,i)];case 6:return u.sent(),this.connection.logger.logSchemaBuild("Migration "+i.name+" has been reverted successfully."),o?[4,e.commitTransaction()]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,17];case 9:if(a=u.sent(),!o)return[3,13];u.label=10;case 10:return u.trys.push([10,12,,13]),[4,e.rollbackTransaction()];case 11:return u.sent(),[3,13];case 12:return s=u.sent(),[3,13];case 13:throw a;case 14:return this.queryRunner?[3,16]:[4,e.release()];case 15:u.sent(),u.label=16;case 16:return[7];case 17:return[2]}})})},e.prototype.createMigrationsTableIfNotExist=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,e.hasTable("migrations")];case 1:return(t=i.sent())?[3,3]:[4,e.createTable(new r.Table("migrations",[new n.TableColumn({name:"timestamp",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp}),isPrimary:!0,isNullable:!1}),new n.TableColumn({name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}),isNullable:!1})]))];case 2:i.sent(),i.label=3;case 3:return[2]}})})},e.prototype.loadExecutedMigrations=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return[4,this.connection.manager.createQueryBuilder(e).select().from("migrations","migrations").getRawMany()];case 1:return t=r.sent(),[2,t.map(function(e){return new i.Migration(parseInt(e.timestamp),e.name)})]}})})},e.prototype.getMigrations=function(){return this.connection.migrations.map(function(e){var t=e.constructor.name,r=parseInt(t.substr(-13));if(!r)throw new Error(t+" migration name is wrong. Migration class name should have a UNIX timestamp appended. ");return new i.Migration(r,t,e)}).sort(function(e,t){return e.timestamp-t.timestamp})},e.prototype.getLatestMigration=function(e){var t=e.map(function(e){return e}).sort(function(e,t){return-1*(e.timestamp-t.timestamp)});return t.length>0?t[0]:void 0},e.prototype.insertExecutedMigration=function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return r={},this.connection.driver instanceof a.SqlServerDriver?(r.timestamp=new s.MssqlParameter(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),r.name=new s.MssqlParameter(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(r.timestamp=t.timestamp,r.name=t.name),[4,e.manager.createQueryBuilder().insert().into("migrations").values(r).execute()];case 1:return n.sent(),[2]}})})},e.prototype.deleteExecutedMigration=function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return r={},this.connection.driver instanceof a.SqlServerDriver?(r.timestamp=new s.MssqlParameter(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),r.name=new s.MssqlParameter(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(r.timestamp=t.timestamp,r.name=t.name),[4,e.manager.createQueryBuilder().delete().from("migrations").where(r).execute()];case 1:return n.sent(),[2]}})})},e}(),e("MigrationExecutor",u)}}}),System.register("typeorm/error/MissingPrimaryColumnError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;return r.name="MissingPrimaryColumnError",r.message='Entity "'+t.name+'" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.',r}return __extends(t,e),t}(Error),e("MissingPrimaryColumnError",r)}}}),System.register("typeorm/error/CircularRelationsError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this,"Circular relations detected: "+t+". To resolve this issue you need to set nullable: false somewhere in this dependency structure.")||this;return r.name="CircularRelationsError",r}return __extends(t,e),t}(Error),e("CircularRelationsError",r)}}}),System.register("typeorm/util/DepGraph",[],function(e,t){"use strict";function r(e,t,r){var n=[],i={};return function o(a){i[a]=!0,n.push(a),e[a].forEach(function(e){if(i[e]){if(n.indexOf(e)>=0)throw n.push(e),new Error("Dependency Cycle Found: "+n.join(" -> "))}else o(e)}),n.pop(),t&&0!==e[a].length||-1!==r.indexOf(a)||r.push(a)}}var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}return e.prototype.addNode=function(e,t){this.hasNode(e)||(2===arguments.length?this.nodes[e]=t:this.nodes[e]=e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])},e.prototype.removeNode=function(e){this.hasNode(e)&&(delete this.nodes[e],delete this.outgoingEdges[e],delete this.incomingEdges[e],[this.incomingEdges,this.outgoingEdges].forEach(function(t){Object.keys(t).forEach(function(r){var n=t[r].indexOf(e);n>=0&&t[r].splice(n,1)},this)}))},e.prototype.hasNode=function(e){return this.nodes.hasOwnProperty(e)},e.prototype.getNodeData=function(e){if(this.hasNode(e))return this.nodes[e];throw new Error("Node does not exist: "+e)},e.prototype.setNodeData=function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);this.nodes[e]=t},e.prototype.addDependency=function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);if(!this.hasNode(t))throw new Error("Node does not exist: "+t);return-1===this.outgoingEdges[e].indexOf(t)&&this.outgoingEdges[e].push(t),-1===this.incomingEdges[t].indexOf(e)&&this.incomingEdges[t].push(e),!0},e.prototype.removeDependency=function(e,t){var r;this.hasNode(e)&&(r=this.outgoingEdges[e].indexOf(t))>=0&&this.outgoingEdges[e].splice(r,1),this.hasNode(t)&&(r=this.incomingEdges[t].indexOf(e))>=0&&this.incomingEdges[t].splice(r,1)},e.prototype.dependenciesOf=function(e,t){if(this.hasNode(e)){var n=[];r(this.outgoingEdges,t,n)(e);var i=n.indexOf(e);return i>=0&&n.splice(i,1),n}throw new Error("Node does not exist: "+e)},e.prototype.dependantsOf=function(e,t){if(this.hasNode(e)){var n=[];r(this.incomingEdges,t,n)(e);var i=n.indexOf(e);return i>=0&&n.splice(i,1),n}throw new Error("Node does not exist: "+e)},e.prototype.overallOrder=function(e){var t=this,n=[],i=Object.keys(this.nodes);if(0===i.length)return n;var o=r(this.outgoingEdges,!1,[]);i.forEach(function(e){o(e)});var a=r(this.outgoingEdges,e,n);return i.filter(function(e){return 0===t.incomingEdges[e].length}).forEach(function(e){a(e)}),n},e}(),e("DepGraph",n)}}}),System.register("typeorm/error/DataTypeNotSupportedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r,n){var i=e.call(this)||this;i.name="DataTypeNotSupportedError";var o="string"==typeof r?r:r.name;return i.message='Data type "'+o+'" in "'+t.entityMetadata.targetName+"."+t.propertyName+'" is not supported by "'+n+'" database.',i}return __extends(t,e),t}(Error),e("DataTypeNotSupportedError",r)}}}),System.register("typeorm/metadata-builder/EntityMetadataValidator",["typeorm/error/MissingPrimaryColumnError","typeorm/error/CircularRelationsError","typeorm/util/DepGraph","typeorm/error/DataTypeNotSupportedError","typeorm/driver/mongodb/MongoDriver","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/mysql/MysqlDriver"],function(e,t){"use strict";var r,n,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(){function e(){}return e.prototype.validateMany=function(e,t){return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(n){return e.forEach(function(n){return r.validate(n,e,t)}),this.validateDependencies(e),this.validateEagerRelations(e),[2]})})},e.prototype.validate=function(e,t,n){if(!e.isClassTableChild&&!e.primaryColumns.length&&!e.isJunction)throw new r.MissingPrimaryColumnError(e);if("single-table"===e.inheritanceType){if(!e.discriminatorColumn)throw new Error("Entity "+e.name+" using single-table inheritance, it should also have a discriminator column. Did you forget to put @DiscriminatorColumn decorator?");if(-1!==["",void 0,null].indexOf(e.discriminatorValue))throw new Error("Entity "+e.name+" has empty discriminator value. Discriminator value should not be empty.");var i=t.find(function(t){return t!==e&&t.discriminatorValue===e.discriminatorValue});if(i)throw new Error("Entities "+e.name+" and "+i.name+" as equal discriminator values. Make sure their discriminator values are not equal using @DiscriminatorValue decorator.")}if(e.relationCounts.forEach(function(e){if(e.relation.isManyToOne||e.relation.isOneToOne)throw new Error("Relation count can not be implemented on ManyToOne or OneToOne relations.")}),n instanceof a.MongoDriver||e.columns.forEach(function(t){var r=n.normalizeType(t);if(-1===n.supportedDataTypes.indexOf(r))throw new o.DataTypeNotSupportedError(t,r,n.options.type);if(t.length&&-1===n.withLengthColumnTypes.indexOf(r))throw new Error("Column "+t.propertyName+" of Entity "+e.name+" does not support length property.")}),n instanceof u.MysqlDriver){if(0===t.filter(function(e){return e.database}).length&&!n.database)throw new Error("Database not specified")}if(n instanceof s.SqlServerDriver){if(e.columns.filter(function(e){return e.charset}).length>1)throw new Error("Character set specifying is not supported in Sql Server")}e.relations.forEach(function(e){}),e.relations.forEach(function(t){if(t.isCascadeRemove&&t.inverseRelation&&t.inverseRelation.isCascadeRemove)throw new Error("Relation "+e.name+"#"+t.propertyName+" and "+t.inverseRelation.entityMetadata.name+"#"+t.inverseRelation.propertyName+" both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.")}),e.eagerRelations.forEach(function(e){})},e.prototype.validateDependencies=function(e){var t=new i.DepGraph;e.forEach(function(e){t.addNode(e.name)}),e.forEach(function(e){e.relationsWithJoinColumns.filter(function(e){return!e.isNullable}).forEach(function(r){t.addDependency(e.name,r.inverseEntityMetadata.name)})});try{t.overallOrder()}catch(e){throw new n.CircularRelationsError(e.toString().replace("Error: Dependency Cycle Found: ",""))}},e.prototype.validateEagerRelations=function(e){e.forEach(function(e){e.eagerRelations.forEach(function(t){if(t.inverseRelation&&t.inverseRelation.isEager)throw new Error("Circular eager relations are disallowed. "+e.targetName+"#"+t.propertyPath+' contains "eager: true", and its inverse side '+t.inverseEntityMetadata.targetName+"#"+t.inverseRelation.propertyPath+' contains "eager: true" as well. Remove "eager: true" from one side of the relation.')})})},e}(),e("EntityMetadataValidator",c)}}}),System.register("typeorm/entity-manager/SqljsEntityManager",["typeorm/entity-manager/EntityManager"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.driver=t.driver,n}return __extends(t,e),t.prototype.loadDatabase=function(e){this.driver.load(e)},t.prototype.saveDatabase=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.driver.save(e)];case 1:return t.sent(),[2]}})})},t.prototype.exportDatabase=function(){return this.driver.export()},t}(r.EntityManager),e("SqljsEntityManager",n)}}}),System.register("typeorm/entity-manager/EntityManagerFactory",["typeorm/entity-manager/EntityManager","typeorm/entity-manager/MongoEntityManager","typeorm/driver/mongodb/MongoDriver","typeorm/entity-manager/SqljsEntityManager","typeorm/driver/sqljs/SqljsDriver"],function(e,t){"use strict";var r,n,i,o,a,s;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(){function e(){}return e.prototype.create=function(e,t){return e.driver instanceof i.MongoDriver?new n.MongoEntityManager(e):e.driver instanceof a.SqljsDriver?new o.SqljsEntityManager(e,t):new r.EntityManager(e,t)},e}(),e("EntityManagerFactory",s)}}}),System.register("typeorm/error/MissingDriverError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;return r.name="MissingDriverError",r.message="Wrong driver "+t+' given. Supported drivers are: "cordova", "mysql", "postgres", "mssql", "oracle", "mariadb", "sqlite".',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("MissingDriverError",r)}}}),System.register("typeorm/driver/cordova/CordovaQueryRunner",["typeorm/error/QueryRunnerAlreadyReleasedError","typeorm/error/QueryFailedError","typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner","typeorm/subscriber/Broadcaster"],function(e,t){"use strict";var r,n,i,o,a;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(e){function t(t){var r=e.call(this,t)||this;return r.driver=t,r.connection=t.connection,r.broadcaster=new o.Broadcaster(r),r}return __extends(t,e),t.prototype.query=function(e,t){var i=this;if(this.isReleased)throw new r.QueryRunnerAlreadyReleasedError;return new Promise(function(r,o){return __awaiter(i,void 0,void 0,function(){var i,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return[4,this.connect()];case 1:return i=u.sent(),this.driver.connection.logger.logQuery(e,t,this),a=+new Date,i.executeSql(e,t,function(n){var i=s.driver.connection.options.maxQueryExecutionTime,o=+new Date-a;i&&o>i&&s.driver.connection.logger.logQuerySlow(o,e,t,s),0===n.rows.length&&r([]);for(var u=[],c=0;c<n.rows.length;c++)u.push(n.rows.item(c));r(u)},function(r){s.driver.connection.logger.logQueryError(r,e,t,s),o(new n.QueryFailedError(e,t,r))}),[2]}})})})},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,t){return'"'+e+'"=?'})},t}(i.AbstractSqliteQueryRunner),e("CordovaQueryRunner",a)}}}),System.register("typeorm/driver/cordova/CordovaDriver",["typeorm/driver/sqlite-abstract/AbstractSqliteDriver","typeorm/driver/cordova/CordovaQueryRunner","typeorm/error/DriverOptionNotSetError","typeorm/error/DriverPackageNotInstalledError"],function(e,t){"use strict";var r,n,i,o,a;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(e){function t(t){var r=e.call(this,t)||this;if(r.database=r.options.database,!r.options.database)throw new i.DriverOptionNotSetError("database");if(!r.options.location)throw new i.DriverOptionNotSetError("location");return r.loadDependencies(),r}return __extends(t,e),t.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,r){e.queryRunner=void 0,e.databaseConnection.close(t,r)})]})})},t.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new n.CordovaQueryRunner(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,r){e.sqlite.openDatabase({name:e.options.database,location:e.options.location},function(e){var n=e;n.executeSql("PRAGMA foreign_keys = ON;",[],function(e){t(n)},function(e){r(e)})},function(e){r(e)})})},t.prototype.loadDependencies=function(){try{this.sqlite=window.sqlitePlugin}catch(e){throw new o.DriverPackageNotInstalledError("Cordova-SQLite","cordova-sqlite-storage")}},t}(r.AbstractSqliteDriver),e("CordovaDriver",a)}}}),System.register("typeorm/driver/DriverFactory",["typeorm/error/MissingDriverError","typeorm/driver/mongodb/MongoDriver","typeorm/driver/websql/WebsqlDriver","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/oracle/OracleDriver","typeorm/driver/sqlite/SqliteDriver","typeorm/driver/cordova/CordovaDriver","typeorm/driver/sqljs/SqljsDriver","typeorm/driver/mysql/MysqlDriver","typeorm/driver/postgres/PostgresDriver"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l,p,d;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e}],execute:function(){d=function(){function e(){}return e.prototype.create=function(e){var t=e.options.type;switch(t){case"mysql":return new l.MysqlDriver(e);case"postgres":return new p.PostgresDriver(e);case"mariadb":return new l.MysqlDriver(e);case"sqlite":return new s.SqliteDriver(e);case"cordova":return new u.CordovaDriver(e);case"sqljs":return new c.SqljsDriver(e);case"oracle":return new a.OracleDriver(e);case"mssql":return new o.SqlServerDriver(e);case"websql":return new i.WebsqlDriver(e);case"mongodb":return new n.MongoDriver(e);default:throw new r.MissingDriverError(t)}},e}(),e("DriverFactory",d)}}}),System.register("typeorm/util/DirectoryExportedClassesLoader",["typeorm/platform/PlatformTools"],function(e,t){"use strict";t&&t.id;e("importClassesFromDirectories",function(e,t){function n(e,t){return"function"==typeof e?t.push(e):Array.isArray(e)?e.forEach(function(e){return n(e,t)}):"object"==typeof e&&Object.keys(e).forEach(function(r){return n(e[r],t)}),t}return void 0===t&&(t=[".js",".ts"]),n(e.reduce(function(e,t){return e.concat(r.PlatformTools.load("glob").sync(r.PlatformTools.pathNormalize(t)))},[]).filter(function(e){var n=e.substring(e.length-5,e.length);return-1!==t.indexOf(r.PlatformTools.pathExtname(e))&&".d.ts"!==n}).map(function(e){return r.PlatformTools.load(r.PlatformTools.pathResolve(e))}),[])}),e("importJsonsFromDirectories",function(e,t){return void 0===t&&(t=".json"),e.reduce(function(e,t){return e.concat(r.PlatformTools.load("glob").sync(r.PlatformTools.pathNormalize(t)))},[]).filter(function(e){return r.PlatformTools.pathExtname(e)===t}).map(function(e){return r.PlatformTools.load(r.PlatformTools.pathResolve(e))})});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/container",[],function(e,t){"use strict";t&&t.id;e("useContainer",function(e,t){n=e,i=t}),e("getFromContainer",function(e){if(n)try{var t=n.get(e);if(t)return t;if(!i||!i.fallback)return t}catch(e){if(!i||!i.fallbackOnErrors)throw e}return r.get(e)});var r,n,i;return{setters:[],execute:function(){e("defaultContainer",r=new(function(){function e(){this.instances=[]}return e.prototype.get=function(e){var t=this.instances.find(function(t){return t.type===e});return t||(t={type:e,object:new e},this.instances.push(t)),t.object},e}()))}}}),System.register("typeorm/metadata-args/NamingStrategyMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/JoinColumnMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/JoinTableMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/EntitySubscriberMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/InheritanceMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/DiscriminatorValueMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/EntityRepositoryMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/TransactionEntityMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/TransactionRepositoryMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-builder/MetadataUtils",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(){}return e.getInheritanceTree=function(e){var t=[e],r=function(e){var n=Object.getPrototypeOf(e);n&&n.name&&(t.push(n),r(n))};return r(e),t},e.isInherited=function(e,t){return e.prototype instanceof t},e.filterByTarget=function(e,t){return t?e.filter(function(e){return e.target&&-1!==t.indexOf(e.target)}):e},e}(),e("MetadataUtils",r)}}}),System.register("typeorm/metadata-args/GeneratedMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/MetadataArgsStorage",["typeorm/metadata-builder/MetadataUtils"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(){this.tables=[],this.entityRepositories=[],this.transactionEntityManagers=[],this.transactionRepositories=[],this.namingStrategies=[],this.entitySubscribers=[],this.indices=[],this.columns=[],this.generations=[],this.relations=[],this.joinColumns=[],this.joinTables=[],this.entityListeners=[],this.relationCounts=[],this.relationIds=[],this.embeddeds=[],this.inheritances=[],this.discriminatorValues=[]}return e.prototype.filterTables=function(e){return this.filterByTarget(this.tables,e)},e.prototype.filterColumns=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.columns,e)},e.prototype.findGenerated=function(e,t){return this.generations.find(function(r){return(e instanceof Array?-1!==e.indexOf(r.target):r.target===e)&&r.propertyName===t})},e.prototype.filterRelations=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relations,e)},e.prototype.filterRelationIds=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationIds,e)},e.prototype.filterRelationCounts=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationCounts,e)},e.prototype.filterIndices=function(e){return this.indices.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterListeners=function(e){return this.filterByTarget(this.entityListeners,e)},e.prototype.filterEmbeddeds=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.embeddeds,e)},e.prototype.findJoinTable=function(e,t){return this.joinTables.find(function(r){return r.target===e&&r.propertyName===t})},e.prototype.filterJoinColumns=function(e,t){return this.joinColumns.filter(function(r){return r.target===e&&r.propertyName===t})},e.prototype.filterSubscribers=function(e){return this.filterByTarget(this.entitySubscribers,e)},e.prototype.filterNamingStrategies=function(e){return this.filterByTarget(this.namingStrategies,e)},e.prototype.filterTransactionEntityManagers=function(e){return this.filterByTarget(this.transactionEntityManagers,e)},e.prototype.filterTransactionRepository=function(e){return this.filterByTarget(this.transactionRepositories,e)},e.prototype.filterSingleTableChildren=function(e){return this.tables.filter(function(t){return t.target instanceof Function&&e instanceof Function&&r.MetadataUtils.isInherited(t.target,e)&&"single-table-child"===t.type})},e.prototype.findInheritanceType=function(e){return this.inheritances.find(function(t){return t.target===e})},e.prototype.findDiscriminatorValue=function(e){return this.discriminatorValues.find(function(t){return t.target===e})},e.prototype.filterByTarget=function(e,t){return e.filter(function(e){return t instanceof Array?-1!==t.indexOf(e.target):e.target===t})},e.prototype.filterByTargetAndWithoutDuplicateProperties=function(e,t){var r=[];return e.forEach(function(e){(t instanceof Array?-1!==t.indexOf(e.target):e.target===t)&&(r.find(function(t){return t.propertyName===e.propertyName})||r.push(e))}),r},e}(),e("MetadataArgsStorage",n)}}}),System.register("typeorm/metadata-builder/JunctionEntityMetadataBuilder",["typeorm/metadata/EntityMetadata","typeorm/metadata/ColumnMetadata","typeorm/metadata/ForeignKeyMetadata","typeorm/metadata/IndexMetadata"],function(e,t){"use strict";var r,n,i,o,a;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var a=this,s=this.collectReferencedColumns(e,t),u=this.collectInverseReferencedColumns(e,t),c=t.name||this.connection.namingStrategy.joinTableName(e.entityMetadata.tableNameWithoutPrefix,e.inverseEntityMetadata.tableNameWithoutPrefix,e.propertyPath,e.inverseRelation?e.inverseRelation.propertyName:""),l=new r.EntityMetadata({connection:this.connection,args:{target:"",name:c,type:"junction",database:t.database||e.entityMetadata.database,schema:t.schema||e.entityMetadata.schema}}),p=s.map(function(r){var i=t.joinColumns?t.joinColumns.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==r.propertyName||!e.name)}):void 0,o=i&&i.name?i.name:a.connection.namingStrategy.joinTableColumnName(e.entityMetadata.tableNameWithoutPrefix,r.propertyName,r.databaseName);return new n.ColumnMetadata({connection:a.connection,entityMetadata:l,referencedColumn:r,args:{target:"",mode:"virtual",propertyName:o,options:{name:o,length:r.length,type:r.type,nullable:!1,primary:!0}}})}),d=u.map(function(r){var i=t.inverseJoinColumns?t.inverseJoinColumns.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==r.propertyName||!e.name)}):void 0,o=i&&i.name?i.name:a.connection.namingStrategy.joinTableColumnName(e.inverseEntityMetadata.tableNameWithoutPrefix,r.propertyName,r.databaseName);return new n.ColumnMetadata({connection:a.connection,entityMetadata:l,referencedColumn:r,args:{target:"",mode:"virtual",propertyName:o,options:{length:r.length,type:r.type,name:o,nullable:!1,primary:!0}}})});return this.changeDuplicatedColumnNames(p,d),l.ownerColumns=p,l.inverseColumns=d,l.ownColumns=p.concat(d),l.ownColumns.forEach(function(t){return t.relationMetadata=e}),l.foreignKeys=[new i.ForeignKeyMetadata({entityMetadata:l,referencedEntityMetadata:e.entityMetadata,columns:p,referencedColumns:s}),new i.ForeignKeyMetadata({entityMetadata:l,referencedEntityMetadata:e.inverseEntityMetadata,columns:d,referencedColumns:u})],l.indices=[new o.IndexMetadata({entityMetadata:l,columns:p,args:{target:"",unique:!1}}),new o.IndexMetadata({entityMetadata:l,columns:d,args:{target:"",unique:!1}})],l},e.prototype.collectReferencedColumns=function(e,t){var r=!!t.joinColumns&&t.joinColumns.find(function(e){return!!e.referencedColumnName});return!t.joinColumns||t.joinColumns&&!r?e.entityMetadata.columns.filter(function(e){return e.isPrimary}):t.joinColumns.map(function(t){var r=e.entityMetadata.columns.find(function(e){return e.propertyName===t.referencedColumnName});if(!r)throw new Error("Referenced column "+t.referencedColumnName+" was not found in entity "+e.entityMetadata.name);return r})},e.prototype.collectInverseReferencedColumns=function(e,t){var r=!!t.inverseJoinColumns,n=!!r&&t.inverseJoinColumns.find(function(e){return!!e.referencedColumnName});return!r||r&&!n?e.inverseEntityMetadata.primaryColumns:t.inverseJoinColumns.map(function(t){var r=e.inverseEntityMetadata.ownColumns.find(function(e){return e.propertyName===t.referencedColumnName});if(!r)throw new Error("Referenced column "+t.referencedColumnName+" was not found in entity "+e.inverseEntityMetadata.name);return r})},e.prototype.changeDuplicatedColumnNames=function(e,t){var r=this;e.forEach(function(e){t.forEach(function(t){if(e.givenDatabaseName===t.givenDatabaseName){var n=r.connection.namingStrategy.joinTableColumnDuplicationPrefix(e.propertyName,1);e.propertyName=n,e.givenDatabaseName=n;var i=r.connection.namingStrategy.joinTableColumnDuplicationPrefix(t.propertyName,2);t.propertyName=i,t.givenDatabaseName=i}})})},e}(),e("JunctionEntityMetadataBuilder",a)}}}),System.register("typeorm/metadata-builder/ClosureJunctionEntityMetadataBuilder",["typeorm/metadata/EntityMetadata","typeorm/metadata/ColumnMetadata","typeorm/metadata/ForeignKeyMetadata"],function(e,t){"use strict";var r,n,i,o;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e}],execute:function(){o=function(){function e(e){this.connection=e}return e.prototype.build=function(e){var t=this,o=new r.EntityMetadata({parentClosureEntityMetadata:e,connection:this.connection,args:{target:"",name:e.tableNameWithoutPrefix,type:"closure-junction"}});return e.primaryColumns.forEach(function(e){o.ownColumns.push(new n.ColumnMetadata({connection:t.connection,entityMetadata:o,args:{target:"",mode:"virtual",propertyName:"ancestor",options:{length:e.length,type:e.type}}})),o.ownColumns.push(new n.ColumnMetadata({connection:t.connection,entityMetadata:o,args:{target:"",mode:"virtual",propertyName:"descendant",options:{length:e.length,type:e.type}}}))}),e.treeLevelColumn&&o.ownColumns.push(new n.ColumnMetadata({connection:this.connection,entityMetadata:o,args:{target:"",mode:"virtual",propertyName:"level",options:{type:this.connection.driver.mappedDataTypes.treeLevel}}})),o.foreignKeys=[new i.ForeignKeyMetadata({entityMetadata:o,referencedEntityMetadata:e,columns:[o.ownColumns[0]],referencedColumns:e.primaryColumns}),new i.ForeignKeyMetadata({entityMetadata:o,referencedEntityMetadata:e,columns:[o.ownColumns[1]],referencedColumns:e.primaryColumns})],o},e}(),e("ClosureJunctionEntityMetadataBuilder",o)}}}),System.register("typeorm/metadata-builder/RelationJoinColumnBuilder",["typeorm/metadata/ColumnMetadata","typeorm/metadata/ForeignKeyMetadata"],function(e,t){"use strict";var r,n,i;t&&t.id;return{setters:[function(e){r=e},function(e){n=e}],execute:function(){i=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var r=this.collectReferencedColumns(e,t);if(r.length){var i=this.collectColumns(e,t,r);return new n.ForeignKeyMetadata({entityMetadata:t.entityMetadata,referencedEntityMetadata:t.inverseEntityMetadata,namingStrategy:this.connection.namingStrategy,columns:i,referencedColumns:r,onDelete:t.onDelete})}},e.prototype.collectReferencedColumns=function(e,t){var r=e.find(function(e){return!!e.referencedColumnName}),n=0===e.length&&t.isManyToOne,i=e.length>0&&!r;return n||i?t.inverseEntityMetadata.primaryColumns:e.map(function(e){var r=t.inverseEntityMetadata.ownColumns.find(function(t){return t.propertyName===e.referencedColumnName});if(!r)throw new Error("Referenced column "+e.referencedColumnName+" was not found in entity "+t.inverseEntityMetadata.name);return r})},e.prototype.collectColumns=function(e,t,n){var i=this;return n.map(function(n){var o=e.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name)}),a=o?o.name:i.connection.namingStrategy.joinColumnName(t.propertyName,n.propertyName),s=t.entityMetadata.ownColumns.find(function(e){return e.databaseName===a});return s||(s=new r.ColumnMetadata({connection:i.connection,entityMetadata:t.entityMetadata,args:{target:"",mode:"virtual",propertyName:t.propertyName,options:{name:a,type:n.type,length:n.length,charset:n.charset,collation:n.collation,precision:n.precision,scale:n.scale,comment:n.comment,primary:t.isPrimary,nullable:t.isNullable}}}),t.entityMetadata.registerColumn(s)),s.referencedColumn=n,s.type=n.type,s.relationMetadata=t,s.build(i.connection),s})},e}(),e("RelationJoinColumnBuilder",i)}}}),System.register("typeorm/metadata-builder/EntityMetadataBuilder",["typeorm/metadata/EntityMetadata","typeorm/metadata/ColumnMetadata","typeorm/metadata/IndexMetadata","typeorm/metadata/RelationMetadata","typeorm/metadata/EmbeddedMetadata","typeorm/metadata/RelationIdMetadata","typeorm/metadata/RelationCountMetadata","typeorm/metadata-builder/MetadataUtils","typeorm/metadata-builder/JunctionEntityMetadataBuilder","typeorm/metadata-builder/ClosureJunctionEntityMetadataBuilder","typeorm/metadata-builder/RelationJoinColumnBuilder","typeorm/metadata/EntityListenerMetadata","typeorm/metadata/ForeignKeyMetadata","typeorm/lazy-loading/LazyRelationsWrapper"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l,p,d,m,f,h,y;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e},function(e){d=e},function(e){m=e},function(e){f=e},function(e){h=e}],execute:function(){y=function(){function e(e,t){this.connection=e,this.metadataArgsStorage=t,this.junctionEntityMetadataBuilder=new l.JunctionEntityMetadataBuilder(e),this.closureJunctionEntityMetadataBuilder=new p.ClosureJunctionEntityMetadataBuilder(e),this.relationJoinColumnBuilder=new d.RelationJoinColumnBuilder(e)}return e.prototype.build=function(e){var t=this,r=(e?this.metadataArgsStorage.filterTables(e):this.metadataArgsStorage.tables).filter(function(e){return"regular"===e.type||"closure"===e.type||"class-table-child"===e.type||"single-table-child"===e.type}).map(function(e){return t.createEntityMetadata(e)});return r.forEach(function(e){return t.computeEntityMetadata(e)}),r.forEach(function(e){return t.computeInverseProperties(e,r)}),r.filter(function(e){return"single-table-child"!==e.tableType}).forEach(function(e){e.relations.filter(function(e){return e.isOneToOne||e.isManyToOne}).forEach(function(r){var n=t.metadataArgsStorage.filterJoinColumns(r.target,r.propertyName),i=t.relationJoinColumnBuilder.build(n,r);i&&(r.registerForeignKeys(i),e.foreignKeys.push(i))}),e.relations.filter(function(e){return e.isManyToMany}).forEach(function(e){var n=t.metadataArgsStorage.findJoinTable(e.target,e.propertyName);if(n){var i=t.junctionEntityMetadataBuilder.build(e,n);e.registerForeignKeys.apply(e,i.foreignKeys),e.registerJunctionEntityMetadata(i),t.computeEntityMetadata(i),t.computeInverseProperties(i,r),r.push(i)}}),e.relationsWithJoinColumns=e.relations.filter(function(e){return e.isWithJoinColumn}),e.hasNonNullableRelations=e.relationsWithJoinColumns.some(function(e){return!e.isNullable||e.isPrimary})}),r.filter(function(e){return e.isClosure}).forEach(function(e){var n=t.closureJunctionEntityMetadataBuilder.build(e);e.closureJunctionTable=n,t.computeEntityMetadata(n),t.computeInverseProperties(n,r),r.push(n)}),r.filter(function(e){return"single-table-child"===e.tableType||"class-table-child"===e.tableType}).forEach(function(e){var t=e.target instanceof Function?c.MetadataUtils.getInheritanceTree(e.target):[e.target],n=r.find(function(e){return t.find(function(t){return t===e.target})&&("single-table"===e.inheritanceType||"class-table"===e.inheritanceType)});n&&(e.parentEntityMetadata=n,"single-table"===n.inheritanceType&&(e.tableName=n.tableName))}),r.forEach(function(e){e.childEntityMetadatas=r.filter(function(t){return e.target instanceof Function&&t.target instanceof Function&&c.MetadataUtils.isInherited(t.target,e.target)})}),r.filter(function(e){return"single-table"===e.inheritanceType&&e.discriminatorColumn}).forEach(function(e){return t.createKeysForTableInheritance(e)}),r.forEach(function(e){e.indices.forEach(function(e){return e.build(t.connection.namingStrategy)})}),r.filter(function(e){return!!e.parentEntityMetadata&&"class-table-child"===e.tableType}).forEach(function(e){var r=e.parentEntityMetadata.primaryColumns,i=r.map(function(r){var i=t.connection.namingStrategy.classTableInheritanceParentColumnName(e.parentEntityMetadata.tableName,r.propertyPath),o=new n.ColumnMetadata({connection:t.connection,entityMetadata:e,referencedColumn:r,args:{target:e.target,propertyName:i,mode:"parentId",options:{name:i,type:r.type,unique:!1,nullable:!1,primary:!0}}});return e.registerColumn(o),o.build(t.connection),o});e.foreignKeys=[new f.ForeignKeyMetadata({entityMetadata:e,referencedEntityMetadata:e.parentEntityMetadata,namingStrategy:t.connection.namingStrategy,columns:i,referencedColumns:r,onDelete:"CASCADE"})]}),r.filter(function(e){return e.target instanceof Function}).forEach(function(e){e.relations.filter(function(e){return e.isLazy}).forEach(function(r){new h.LazyRelationsWrapper(t.connection).wrap(e.target.prototype,r)})}),r.forEach(function(e){e.columns.forEach(function(r){var n=t.metadataArgsStorage.findGenerated(r.target,r.propertyName);n&&(r.isGenerated=!0,r.generationStrategy=n.strategy,r.type="increment"===n.strategy?r.type||Number:"uuid",r.build(t.connection),t.computeEntityMetadata(e))})}),r},e.prototype.createEntityMetadata=function(e){var t,a=this,l=e.target instanceof Function?c.MetadataUtils.getInheritanceTree(e.target):[e.target];"single-table-child"===e.type?(t=this.metadataArgsStorage.filterSingleTableChildren(e.target).map(function(e){return e.target}).filter(function(e){return e instanceof Function}),l.push.apply(l,t)):"class-table-child"===e.type&&l.forEach(function(e){!!a.metadataArgsStorage.inheritances.find(function(t){return t.target===e})&&l.splice(l.indexOf(e),1)});var p=new r.EntityMetadata({connection:this.connection,args:e}),d=this.metadataArgsStorage.findInheritanceType(e.target);p.inheritanceType=d?d.type:void 0;var f=this.metadataArgsStorage.findDiscriminatorValue(e.target);return p.discriminatorValue=f?f.value:e.target.name,p.embeddeds=this.createEmbeddedsRecursively(p,this.metadataArgsStorage.filterEmbeddeds(l)),p.ownColumns=this.metadataArgsStorage.filterColumns(l).map(function(e){var r=new n.ColumnMetadata({connection:a.connection,entityMetadata:p,args:e});return t&&-1!==t.indexOf(e.target)&&(r.isNullable=!0),r}),p.ownRelations=this.metadataArgsStorage.filterRelations(l).map(function(e){return new o.RelationMetadata({entityMetadata:p,args:e})}),p.relationIds=this.metadataArgsStorage.filterRelationIds(l).map(function(e){return new s.RelationIdMetadata({entityMetadata:p,args:e})}),p.relationCounts=this.metadataArgsStorage.filterRelationCounts(l).map(function(e){return new u.RelationCountMetadata({entityMetadata:p,args:e})}),p.ownIndices=this.metadataArgsStorage.filterIndices(l).map(function(e){return new i.IndexMetadata({entityMetadata:p,args:e})}),p.ownListeners=this.metadataArgsStorage.filterListeners(l).map(function(e){return new m.EntityListenerMetadata({entityMetadata:p,args:e})}),p},e.prototype.createEmbeddedsRecursively=function(e,t){var r=this;return t.map(function(t){var l=new a.EmbeddedMetadata({entityMetadata:e,args:t}),p=c.MetadataUtils.getInheritanceTree(l.type);return l.columns=r.metadataArgsStorage.filterColumns(p).map(function(t){return new n.ColumnMetadata({connection:r.connection,entityMetadata:e,embeddedMetadata:l,args:t})}),l.relations=r.metadataArgsStorage.filterRelations(p).map(function(t){return new o.RelationMetadata({entityMetadata:e,embeddedMetadata:l,args:t})}),l.listeners=r.metadataArgsStorage.filterListeners(p).map(function(t){return new m.EntityListenerMetadata({entityMetadata:e,embeddedMetadata:l,args:t})}),l.indices=r.metadataArgsStorage.filterIndices(p).map(function(t){return new i.IndexMetadata({entityMetadata:e,embeddedMetadata:l,args:t})}),l.relationIds=r.metadataArgsStorage.filterRelationIds(p).map(function(t){return new s.RelationIdMetadata({entityMetadata:e,args:t})}),l.relationCounts=r.metadataArgsStorage.filterRelationCounts(p).map(function(t){return new u.RelationCountMetadata({entityMetadata:e,args:t})}),l.embeddeds=r.createEmbeddedsRecursively(e,r.metadataArgsStorage.filterEmbeddeds(p)),l.embeddeds.forEach(function(e){return e.parentEmbeddedMetadata=l}),e.allEmbeddeds.push(l),l})},e.prototype.computeEntityMetadata=function(e){var t=this;e.embeddeds.forEach(function(e){return e.build(t.connection)}),e.embeddeds.forEach(function(e){e.columnsFromTree.forEach(function(e){return e.build(t.connection)}),e.relationsFromTree.forEach(function(e){return e.build()})}),e.ownColumns.forEach(function(e){return e.build(t.connection)}),e.ownRelations.forEach(function(e){return e.build()}),e.relations=e.embeddeds.reduce(function(e,t){return e.concat(t.relationsFromTree)},e.ownRelations),e.eagerRelations=e.relations.filter(function(e){return e.isEager}),e.lazyRelations=e.relations.filter(function(e){return e.isLazy}),e.oneToOneRelations=e.relations.filter(function(e){return e.isOneToOne}),e.oneToManyRelations=e.relations.filter(function(e){return e.isOneToMany}),e.manyToOneRelations=e.relations.filter(function(e){return e.isManyToOne}),e.manyToManyRelations=e.relations.filter(function(e){return e.isManyToMany}),e.ownerOneToOneRelations=e.relations.filter(function(e){return e.isOneToOneOwner}),e.ownerManyToManyRelations=e.relations.filter(function(e){return e.isManyToManyOwner}),e.treeParentRelation=e.relations.find(function(e){return e.isTreeParent}),e.treeChildrenRelation=e.relations.find(function(e){return e.isTreeChildren}),e.columns=e.embeddeds.reduce(function(e,t){return e.concat(t.columnsFromTree)},e.ownColumns),e.listeners=e.embeddeds.reduce(function(e,t){return e.concat(t.listenersFromTree)},e.ownListeners),e.afterLoadListeners=e.listeners.filter(function(e){return"after-load"===e.type}),e.afterInsertListeners=e.listeners.filter(function(e){return"after-insert"===e.type}),e.afterUpdateListeners=e.listeners.filter(function(e){return"after-update"===e.type}),e.afterRemoveListeners=e.listeners.filter(function(e){return"after-remove"===e.type}),e.beforeInsertListeners=e.listeners.filter(function(e){return"before-insert"===e.type}),e.beforeUpdateListeners=e.listeners.filter(function(e){return"before-update"===e.type}),e.beforeRemoveListeners=e.listeners.filter(function(e){return"before-remove"===e.type}),e.indices=e.embeddeds.reduce(function(e,t){return e.concat(t.indicesFromTree)},e.ownIndices),e.primaryColumns=e.columns.filter(function(e){return e.isPrimary}),e.nonVirtualColumns=e.columns.filter(function(e){return!e.isVirtual}),e.hasMultiplePrimaryKeys=e.primaryColumns.length>1,e.generatedColumns=e.columns.filter(function(e){return e.isGenerated||e.isObjectId}),e.hasUUIDGeneratedColumns=e.columns.filter(function(e){return e.isGenerated||"uuid"===e.generationStrategy}).length>0,e.createDateColumn=e.columns.find(function(e){return e.isCreateDate}),e.updateDateColumn=e.columns.find(function(e){return e.isUpdateDate}),e.versionColumn=e.columns.find(function(e){return e.isVersion}),e.discriminatorColumn=e.columns.find(function(e){return e.isDiscriminator}),e.treeLevelColumn=e.columns.find(function(e){return e.isTreeLevel}),e.parentIdColumns=e.columns.filter(function(e){return e.isParentId}),e.objectIdColumn=e.columns.find(function(e){return e.isObjectId}),e.foreignKeys.forEach(function(e){return e.build(t.connection.namingStrategy)}),e.propertiesMap=e.createPropertiesMap(),e.relationIds.forEach(function(e){return e.build()}),e.relationCounts.forEach(function(e){return e.build()}),e.embeddeds.forEach(function(e){e.relationIdsFromTree.forEach(function(e){return e.build()}),e.relationCountsFromTree.forEach(function(e){return e.build()})})},e.prototype.computeInverseProperties=function(e,t){e.relations.forEach(function(r){var n=t.find(function(e){return e.target===r.type||"string"==typeof r.type&&e.targetName===r.type});if(!n)throw new Error("Entity metadata for "+e.name+"#"+r.propertyPath+" was not found. Check if you specified a correct entity object, check its really entity and its connected in the connection options.");r.inverseEntityMetadata=n,r.inverseSidePropertyPath=r.buildInverseSidePropertyPath(),r.inverseRelation=n.relations.find(function(e){return e.propertyPath===r.inverseSidePropertyPath})})},e.prototype.createKeysForTableInheritance=function(e){e.indices.push(new i.IndexMetadata({entityMetadata:e,columns:[e.discriminatorColumn],args:{target:e.target,unique:!1}}),new i.IndexMetadata({entityMetadata:e,columns:e.primaryColumns.concat([e.discriminatorColumn]),args:{target:e.target,unique:!1}}))},e}(),e("EntityMetadataBuilder",y)}}}),System.register("typeorm/decorator/options/JoinTableOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-schema/EntitySchemaTransformer",["typeorm/metadata-args/MetadataArgsStorage"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(){}return e.prototype.transform=function(e){var t=new r.MetadataArgsStorage;return e.forEach(function(e){var r=e.table||{},n={target:e.target||e.name,name:r.name,type:r.type||"regular",orderBy:r.orderBy};t.tables.push(n),Object.keys(e.columns).forEach(function(r){var n=e.columns[r],i="regular";n.createDate&&(i="createDate"),n.updateDate&&(i="updateDate"),n.version&&(i="version"),n.treeChildrenCount&&(i="treeChildrenCount"),n.treeLevel&&(i="treeLevel");var o={target:e.target||e.name,mode:i,propertyName:r,options:{type:n.type,name:n.name,length:n.length,primary:n.primary,unique:n.unique,nullable:n.nullable,comment:n.comment,default:n.default,precision:n.precision,scale:n.scale}};if(t.columns.push(o),n.generated){var a={target:e.target||e.name,propertyName:r,strategy:"string"==typeof n.generated?n.generated:"increment"};t.generations.push(a)}}),e.relations&&Object.keys(e.relations).forEach(function(r){var n=e.relations[r],i={target:e.target||e.name,propertyName:r,relationType:n.type,isLazy:n.isLazy||!1,type:n.target,inverseSideProperty:n.inverseSide,isTreeParent:n.isTreeParent,isTreeChildren:n.isTreeChildren,options:{cascade:n.cascade,nullable:n.nullable,onDelete:n.onDelete}};if(t.relations.push(i),n.joinColumn)if("boolean"==typeof n.joinColumn){o={target:e.target||e.name,propertyName:r};t.joinColumns.push(o)}else{var o={target:e.target||e.name,propertyName:r,name:n.joinColumn.name,referencedColumnName:n.joinColumn.referencedColumnName};t.joinColumns.push(o)}if(n.joinTable)if("boolean"==typeof n.joinTable){a={target:e.target||e.name,propertyName:r};t.joinTables.push(a)}else{var a={target:e.target||e.name,propertyName:r,name:n.joinTable.name,joinColumns:n.joinTable.joinColumn?[n.joinTable.joinColumn]:n.joinTable.joinColumns,inverseJoinColumns:n.joinTable.inverseJoinColumn?[n.joinTable.inverseJoinColumn]:n.joinTable.inverseJoinColumns};t.joinTables.push(a)}}),e.indices&&Object.keys(e.indices).forEach(function(r){var n=e.indices[r],i={target:e.target||e.name,name:r,unique:n.unique,sparse:n.sparse,columns:n.columns};t.indices.push(i)})}),t},e}(),e("EntitySchemaTransformer",n)}}}),System.register("typeorm/connection/ConnectionMetadataBuilder",["typeorm/util/DirectoryExportedClassesLoader","typeorm/util/OrmUtils","typeorm/container","typeorm/index","typeorm/metadata-builder/EntityMetadataBuilder","typeorm/entity-schema/EntitySchemaTransformer"],function(e,t){"use strict";var r,n,i,o,a,s,u;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(){function e(e){this.connection=e}return e.prototype.buildMigrations=function(e){var t=n.OrmUtils.splitClassesAndStrings(e),o=t[0],a=t[1];return o.concat(r.importClassesFromDirectories(a)).map(function(e){return i.getFromContainer(e)})},e.prototype.buildSubscribers=function(e){var t=n.OrmUtils.splitClassesAndStrings(e||[]),a=t[0],s=t[1],u=a.concat(r.importClassesFromDirectories(s));return o.getMetadataArgsStorage().filterSubscribers(u).map(function(e){return i.getFromContainer(e.target)})},e.prototype.buildEntityMetadatas=function(e,t){var i=n.OrmUtils.splitClassesAndStrings(e||[]),u=i[0],c=i[1],l=u.concat(r.importClassesFromDirectories(c)),p=new a.EntityMetadataBuilder(this.connection,o.getMetadataArgsStorage()).build(l),d=n.OrmUtils.splitClassesAndStrings(t||[]),m=d[0],f=d[1],h=m.concat(r.importJsonsFromDirectories(f)),y=(new s.EntitySchemaTransformer).transform(h),g=new a.EntityMetadataBuilder(this.connection,y).build();return p.concat(g)},e}(),e("ConnectionMetadataBuilder",u)}}}),System.register("typeorm/logger/SimpleConsoleLogger",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,r){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("query")){var n=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");console.log("executing query: "+n)}},e.prototype.logQueryError=function(e,t,r,n){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("error")){var i=t+(r&&r.length?" -- PARAMETERS: "+this.stringifyParams(r):"");console.log("query failed: "+i),console.log("error:",e)}},e.prototype.logQuerySlow=function(e,t,r,n){var i=t+(r&&r.length?" -- PARAMETERS: "+this.stringifyParams(r):"");console.log("query is slow: "+i),console.log("execution time: "+e)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("schema"))&&console.log(e)},e.prototype.logMigration=function(e,t){console.log(e)},e.prototype.log=function(e,t,r){switch(e){case"log":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("log"))&&console.log(t);break;case"info":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("info"))&&console.info(t);break;case"warn":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("warn"))&&console.warn(t)}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),e("SimpleConsoleLogger",r)}}}),System.register("typeorm/logger/AdvancedConsoleLogger",["typeorm/platform/PlatformTools"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("query")){var i=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");r.PlatformTools.logInfo("executing query:",r.PlatformTools.highlightSql(i))}},e.prototype.logQueryError=function(e,t,n,i){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("error")){var o=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");r.PlatformTools.logError("query failed:",r.PlatformTools.highlightSql(o)),r.PlatformTools.logError("error:",e)}},e.prototype.logQuerySlow=function(e,t,n,i){var o=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");r.PlatformTools.logWarn("query is slow:",r.PlatformTools.highlightSql(o)),r.PlatformTools.logWarn("execution time:",e)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("schema"))&&r.PlatformTools.log(e)},e.prototype.logMigration=function(e,t){r.PlatformTools.log(e)},e.prototype.log=function(e,t,n){switch(e){case"log":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("log"))&&console.log(t);break;case"info":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("info"))&&console.info(t);break;case"warn":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("warn"))&&console.warn(r.PlatformTools.warn(t))}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),e("AdvancedConsoleLogger",n)}}}),System.register("typeorm/logger/FileLogger",["typeorm/platform/PlatformTools"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,r){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("query")){var n=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");this.write("[QUERY]: "+n)}},e.prototype.logQueryError=function(e,t,r,n){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("error")){var i=t+(r&&r.length?" -- PARAMETERS: "+this.stringifyParams(r):"");this.write(["[FAILED QUERY]: "+i,"[QUERY ERROR]: "+e])}},e.prototype.logQuerySlow=function(e,t,r,n){var i=t+(r&&r.length?" -- PARAMETERS: "+this.stringifyParams(r):"");this.write("[SLOW QUERY: "+e+" ms]: "+i)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("schema"))&&this.write(e)},e.prototype.logMigration=function(e,t){this.write(e)},e.prototype.log=function(e,t,r){switch(e){case"log":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("log"))&&this.write("[LOG]: "+t);break;case"info":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("info"))&&this.write("[INFO]: "+t);break;case"warn":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("warn"))&&this.write("[WARN]: "+t)}},e.prototype.write=function(e){e=e instanceof Array?e:[e];var t=r.PlatformTools.load("app-root-path").path;e=e.map(function(e){return"["+(new Date).toISOString()+"]"+e}),r.PlatformTools.appendFileSync(t+"/ormlogs.log",e.join("\r\n")+"\r\n")},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),e("FileLogger",n)}}}),System.register("typeorm/logger/LoggerFactory",["typeorm/logger/SimpleConsoleLogger","typeorm/logger/AdvancedConsoleLogger","typeorm/logger/FileLogger"],function(e,t){"use strict";var r,n,i,o;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e}],execute:function(){o=function(){function e(){}return e.prototype.create=function(e,t){if(e instanceof Object)return e;if(e)switch(e){case"simple-console":return new r.SimpleConsoleLogger(t);case"file":return new i.FileLogger(t);case"advanced-console":return new n.AdvancedConsoleLogger(t)}return new n.AdvancedConsoleLogger(t)},e}(),e("LoggerFactory",o)}}}),System.register("typeorm/cache/QueryResultCache",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/cache/RedisQueryResultCache",["typeorm/platform/PlatformTools"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e){this.connection=e,this.redis=this.loadRedis()}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){return(e=this.connection.options.cache)&&e.options?this.client=this.redis.createClient(e.options):this.client=this.redis.createClient(),[2]})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,r){e.client.quit(function(n,i){if(n)return r(n);t(),e.client=void 0})})]})})},e.prototype.synchronize=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.getFromCache=function(e,t){var r=this;return new Promise(function(t,n){e.identifier?r.client.get(e.identifier,function(e,r){if(e)return n(e);t(JSON.parse(r))}):e.query?r.client.get(e.query,function(e,r){if(e)return n(e);t(JSON.parse(r))}):t(void 0)})},e.prototype.isExpired=function(e){return e.time+e.duration<(new Date).getTime()},e.prototype.storeInCache=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(r){return[2,new Promise(function(r,n){e.identifier?t.client.set(e.identifier,JSON.stringify(e),function(e,t){if(e)return n(e);r()}):e.query&&t.client.set(e.query,JSON.stringify(e),function(e,t){if(e)return n(e);r()})})]})})},e.prototype.clear=function(e){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,r){e.client.flushdb(function(e,n){if(e)return r(e);t()})})]})})},e.prototype.remove=function(e,t){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(r){switch(r.label){case 0:return[4,Promise.all(e.map(function(e){return t.deleteKey(e)}))];case 1:return r.sent(),[2]}})})},e.prototype.deleteKey=function(e){var t=this;return new Promise(function(r,n){t.client.del(e,function(e,t){if(e)return n(e);r()})})},e.prototype.loadRedis=function(){try{return r.PlatformTools.load("redis")}catch(e){throw new Error('Cannot use cache because redis is not installed. Please run "npm i redis --save".')}},e}(),e("RedisQueryResultCache",n)}}}),System.register("typeorm/cache/DbQueryResultCache",["typeorm/schema-builder/schema/Table","typeorm/schema-builder/schema/TableColumn","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/sqlserver/MssqlParameter"],function(e,t){"use strict";var r,n,i,o,a;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.connection=e}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.synchronize=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(o){switch(o.label){case 0:return e=this.getQueryRunner(e),t=this.connection.driver,[4,e.hasTable("query-result-cache")];case 1:return(i=o.sent())?[2]:[4,e.createTable(new r.Table("query-result-cache",[new n.TableColumn({name:"id",isNullable:!0,isPrimary:!0,type:t.normalizeType({type:t.mappedDataTypes.cacheId}),generationStrategy:"increment",isGenerated:!0}),new n.TableColumn({name:"identifier",type:t.normalizeType({type:t.mappedDataTypes.cacheIdentifier}),isNullable:!0}),new n.TableColumn({name:"time",type:t.normalizeType({type:t.mappedDataTypes.cacheTime}),isPrimary:!1,isNullable:!1}),new n.TableColumn({name:"duration",type:t.normalizeType({type:t.mappedDataTypes.cacheDuration}),isPrimary:!1,isNullable:!1}),new n.TableColumn({name:"query",type:t.normalizeType({type:t.mappedDataTypes.cacheQuery}),isPrimary:!1,isNullable:!1}),new n.TableColumn({name:"result",type:t.normalizeType({type:t.mappedDataTypes.cacheResult}),isNullable:!1})]))];case 2:return o.sent(),[2]}})})},e.prototype.getFromCache=function(e,t){t=this.getQueryRunner(t);var r=this.connection.createQueryBuilder(t).select().from("query-result-cache","cache");return e.identifier?r.where(r.escape("cache")+"."+r.escape("identifier")+" = :identifier").setParameters({identifier:this.connection.driver instanceof i.SqlServerDriver?new o.MssqlParameter(e.identifier,"nvarchar"):e.identifier}).getRawOne():e.query?r.where(r.escape("cache")+"."+r.escape("query")+" = :query").setParameters({query:this.connection.driver instanceof i.SqlServerDriver?new o.MssqlParameter(e.query,"nvarchar"):e.query}).getRawOne():Promise.resolve(void 0)},e.prototype.isExpired=function(e){return("string"==typeof e.time?parseInt(e.time):e.time)+e.duration<(new Date).getTime()},e.prototype.storeInCache=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(a){switch(a.label){case 0:return r=this.getQueryRunner(r),n=e,this.connection.driver instanceof i.SqlServerDriver&&(n={identifier:new o.MssqlParameter(e.identifier,"nvarchar"),time:new o.MssqlParameter(e.time,"bigint"),duration:new o.MssqlParameter(e.duration,"int"),query:new o.MssqlParameter(e.query,"nvarchar"),result:new o.MssqlParameter(e.result,"nvarchar")}),t&&t.identifier?[4,r.manager.createQueryBuilder().update("query-result-cache").set(n).where({identifier:n.identifier}).execute()]:[3,2];case 1:return a.sent(),[3,6];case 2:return t&&t.query?[4,r.manager.createQueryBuilder().update("query-result-cache").set(n).where({query:n.query}).execute()]:[3,4];case 3:return a.sent(),[3,6];case 4:return[4,r.manager.createQueryBuilder().insert().into("query-result-cache").values(n).execute()];case 5:a.sent(),a.label=6;case 6:return[2]}})})},e.prototype.clear=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.getQueryRunner(e).truncate("query-result-cache")]})})},e.prototype.remove=function(e,t){return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(e){return r.getQueryRunner(t).manager.createQueryBuilder().delete().from("query-result-cache").where(e).execute()}))];case 1:return n.sent(),[2]}})})},e.prototype.getQueryRunner=function(e){return e||this.connection.createQueryRunner("master")},e}(),e("DbQueryResultCache",a)}}}),System.register("typeorm/cache/QueryResultCacheFactory",["typeorm/cache/RedisQueryResultCache","typeorm/cache/DbQueryResultCache"],function(e,t){"use strict";var r,n,i;t&&t.id;return{setters:[function(e){r=e},function(e){n=e}],execute:function(){i=function(){function e(e){this.connection=e}return e.prototype.create=function(){if(!this.connection.options.cache)throw new Error("To use cache you need to enable it in connection options by setting cache: true or providing some caching options. Example: { host: ..., username: ..., cache: true }");return"redis"===this.connection.options.cache.type?new r.RedisQueryResultCache(this.connection):new n.DbQueryResultCache(this.connection)},e}(),e("QueryResultCacheFactory",i)}}}),System.register("typeorm/connection/Connection",["typeorm/naming-strategy/DefaultNamingStrategy","typeorm/error/CannotExecuteNotConnectedError","typeorm/error/CannotConnectAlreadyConnectedError","typeorm/error/EntityMetadataNotFound","typeorm/migration/MigrationExecutor","typeorm/driver/mongodb/MongoDriver","typeorm/entity-manager/MongoEntityManager","typeorm/metadata-builder/EntityMetadataValidator","typeorm/error/QueryRunnerProviderAlreadyReleasedError","typeorm/entity-manager/EntityManagerFactory","typeorm/driver/DriverFactory","typeorm/connection/ConnectionMetadataBuilder","typeorm/query-builder/SelectQueryBuilder","typeorm/logger/LoggerFactory","typeorm/cache/QueryResultCacheFactory","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/mysql/MysqlDriver","typeorm/util/PromiseUtils","typeorm/entity-manager/SqljsEntityManager"],function(e,t){"use strict";var r,n,i,o,a,s,u,c,l,p,d,m,f,h,y,g,v,b,E,M;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e},function(e){d=e},function(e){m=e},function(e){f=e},function(e){h=e},function(e){y=e},function(e){g=e},function(e){v=e},function(e){b=e},function(e){E=e}],execute:function(){M=function(){function e(e){this.isConnected=!1,this.migrations=[],this.subscribers=[],this.entityMetadatas=[],this.name=e.name||"default",this.options=e,this.logger=(new h.LoggerFactory).create(this.options.logger,this.options.logging),this.driver=(new d.DriverFactory).create(this),this.manager=this.createEntityManager(),this.namingStrategy=e.namingStrategy||new r.DefaultNamingStrategy,this.queryResultCache=e.cache?new y.QueryResultCacheFactory(this).create():void 0}return Object.defineProperty(e.prototype,"mongoManager",{get:function(){if(!(this.manager instanceof u.MongoEntityManager))throw new Error("MongoEntityManager is only available for MongoDB databases.");return this.manager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sqljsManager",{get:function(){if(!(this.manager instanceof E.SqljsEntityManager))throw new Error("SqljsEntityManager is only available for Sqljs databases.");return this.manager},enumerable:!0,configurable:!0}),e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(this.isConnected)throw new i.CannotConnectAlreadyConnectedError(this.name);return[4,this.driver.connect()];case 1:return t.sent(),this.queryResultCache?[4,this.queryResultCache.connect()]:[3,3];case 2:t.sent(),t.label=3;case 3:Object.assign(this,{isConnected:!0}),t.label=4;case 4:return t.trys.push([4,12,,14]),this.buildMetadatas(),[4,this.driver.afterConnect()];case 5:return t.sent(),this.options.dropSchema?[4,this.dropDatabase()]:[3,7];case 6:t.sent(),t.label=7;case 7:return this.options.synchronize?[4,this.synchronize()]:[3,9];case 8:t.sent(),t.label=9;case 9:return this.options.migrationsRun?[4,this.runMigrations()]:[3,11];case 10:t.sent(),t.label=11;case 11:return[3,14];case 12:return e=t.sent(),[4,this.close()];case 13:throw t.sent(),e;case 14:return[2,this]}})})},e.prototype.close=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isConnected)throw new n.CannotExecuteNotConnectedError(this.name);return[4,this.driver.disconnect()];case 1:return e.sent(),this.queryResultCache?[4,this.queryResultCache.disconnect()]:[3,3];case 2:e.sent(),e.label=3;case 3:return Object.assign(this,{isConnected:!1}),[2]}})})},e.prototype.synchronize=function(e){return void 0===e&&(e=!1),__awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:if(!this.isConnected)throw new n.CannotExecuteNotConnectedError(this.name);return e?[4,this.dropDatabase()]:[3,2];case 1:r.sent(),r.label=2;case 2:return t=this.driver.createSchemaBuilder(),[4,t.build()];case 3:return r.sent(),[2]}})})},e.prototype.dropDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r;return __generator(this,function(n){switch(n.label){case 0:return[4,this.createQueryRunner("master")];case 1:return e=n.sent(),t=this.entityMetadatas.filter(function(e){return e.schema}).map(function(e){return e.schema}),this.driver instanceof g.SqlServerDriver||this.driver instanceof v.MysqlDriver?(r=this.driver.database?[this.driver.database]:[],this.entityMetadatas.forEach(function(e){e.database&&-1===r.indexOf(e.database)&&r.push(e.database)}),[4,b.PromiseUtils.runInSequence(r,function(r){return e.clearDatabase(t,r)})]):[3,3];case 2:return n.sent(),[3,5];case 3:return[4,e.clearDatabase(t)];case 4:n.sent(),n.label=5;case 5:return[4,e.release()];case 6:return n.sent(),[2]}})})},e.prototype.runMigrations=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(!this.isConnected)throw new n.CannotExecuteNotConnectedError(this.name);return e=new a.MigrationExecutor(this),[4,e.executePendingMigrations()];case 1:return t.sent(),[2]}})})},e.prototype.undoLastMigration=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(!this.isConnected)throw new n.CannotExecuteNotConnectedError(this.name);return e=new a.MigrationExecutor(this),[4,e.undoLastMigration()];case 1:return t.sent(),[2]}})})},e.prototype.hasMetadata=function(e){return!!this.findMetadata(e)},e.prototype.getMetadata=function(e){var t=this.findMetadata(e);if(!t)throw new o.EntityMetadataNotFound(e);return t},e.prototype.getRepository=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepository=function(e){return this.manager.getTreeRepository(e)},e.prototype.getMongoRepository=function(e){if(!(this.driver instanceof s.MongoDriver))throw new Error("You can use getMongoRepository only for MongoDB connections.");return this.manager.getRepository(e)},e.prototype.getCustomRepository=function(e){return this.manager.getCustomRepository(e)},e.prototype.transaction=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.manager.transaction(e)]})})},e.prototype.query=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(i){switch(i.label){case 0:if(this instanceof u.MongoEntityManager)throw new Error("Queries aren't supported by MongoDB.");if(r&&r.isReleased)throw new l.QueryRunnerProviderAlreadyReleasedError;n=r||this.createQueryRunner("master"),i.label=1;case 1:return i.trys.push([1,,3,6]),[4,n.query(e,t)];case 2:return[2,i.sent()];case 3:return r?[3,5]:[4,n.release()];case 4:i.sent(),i.label=5;case 5:return[7];case 6:return[2]}})})},e.prototype.createQueryBuilder=function(e,t,r){if(this instanceof u.MongoEntityManager)throw new Error("Query Builder is not supported by MongoDB.");if(t){var n=this.getMetadata(e);return new f.SelectQueryBuilder(this,r).select(t).from(n.target,t)}return new f.SelectQueryBuilder(this,e)},e.prototype.createQueryRunner=function(e){void 0===e&&(e="master");var t=this.driver.createQueryRunner(e),r=this.createEntityManager(t);return Object.assign(t,{manager:r}),t},e.prototype.getManyToManyMetadata=function(e,t){var r=this.getMetadata(e).findRelationWithPropertyPath(t);if(!r)throw new Error('Relation "'+t+'" was not found in '+e+" entity.");if(!r.isManyToMany)throw new Error('Relation "'+e+"#"+t+'" does not have a many-to-many relationship.You can use this method only on many-to-many relations.');return r.junctionEntityMetadata},e.prototype.createEntityManager=function(e){return(new p.EntityManagerFactory).create(this,e)},e.prototype.findMetadata=function(e){return this.entityMetadatas.find(function(t){return t.target===e||"string"==typeof e&&(-1!==e.indexOf(".")?t.tablePath===e:t.name===e||t.tableName===e)})},e.prototype.buildMetadatas=function(){var e=new m.ConnectionMetadataBuilder(this),t=new c.EntityMetadataValidator,r=e.buildSubscribers(this.options.subscribers||[]);Object.assign(this,{subscribers:r});var n=e.buildEntityMetadatas(this.options.entities||[],this.options.entitySchemas||[]);Object.assign(this,{entityMetadatas:n});var i=e.buildMigrations(this.options.migrations||[]);Object.assign(this,{migrations:i}),t.validateMany(this.entityMetadatas,this.driver)},e}(),e("Connection",M)}}}),System.register("typeorm/error/ConnectionNotFoundError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;return r.name="ConnectionNotFoundError",r.message='Connection "'+t+'" was not found.',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("ConnectionNotFoundError",r)}}}),System.register("typeorm/error/AlreadyHasActiveConnectionError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;return r.name="AlreadyHasActiveConnectionError",r.message='Cannot create a new connection named "'+t+'", because connection with such name already exist and it now has an active connection session.',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("AlreadyHasActiveConnectionError",r)}}}),System.register("typeorm/connection/ConnectionManager",["typeorm/connection/Connection","typeorm/error/ConnectionNotFoundError","typeorm/error/AlreadyHasActiveConnectionError"],function(e,t){"use strict";var r,n,i,o;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e}],execute:function(){o=function(){function e(){this.connections=[]}return e.prototype.has=function(e){return!!this.connections.find(function(t){return t.name===e})},e.prototype.get=function(e){void 0===e&&(e="default");var t=this.connections.find(function(t){return t.name===e});if(!t)throw new n.ConnectionNotFoundError(e);return t},e.prototype.create=function(e){var t=this.connections.find(function(t){return t.name===(e.name||"default")});if(t){if(t.isConnected)throw new i.AlreadyHasActiveConnectionError(e.name||"default");this.connections.splice(this.connections.indexOf(t),1)}var n=new r.Connection(e);return this.connections.push(n),n},e}(),e("ConnectionManager",o)}}}),System.register("typeorm/connection/options-reader/ConnectionOptionsEnvReader",["typeorm/platform/PlatformTools","typeorm/util/OrmUtils"],function(e,t){"use strict";var r,n,i;t&&t.id;return{setters:[function(e){r=e},function(e){n=e}],execute:function(){i=function(){function e(){}return e.prototype.read=function(){return{type:r.PlatformTools.getEnvVariable("TYPEORM_CONNECTION"),url:r.PlatformTools.getEnvVariable("TYPEORM_URL"),host:r.PlatformTools.getEnvVariable("TYPEORM_HOST"),port:r.PlatformTools.getEnvVariable("TYPEORM_PORT"),username:r.PlatformTools.getEnvVariable("TYPEORM_USERNAME"),password:r.PlatformTools.getEnvVariable("TYPEORM_PASSWORD"),database:r.PlatformTools.getEnvVariable("TYPEORM_DATABASE"),sid:r.PlatformTools.getEnvVariable("TYPEORM_SID"),schema:r.PlatformTools.getEnvVariable("TYPEORM_SCHEMA"),extra:r.PlatformTools.getEnvVariable("TYPEORM_DRIVER_EXTRA")?JSON.parse(r.PlatformTools.getEnvVariable("TYPEORM_DRIVER_EXTRA")):void 0,synchronize:n.OrmUtils.toBoolean(r.PlatformTools.getEnvVariable("TYPEORM_SYNCHRONIZE")),dropSchema:n.OrmUtils.toBoolean(r.PlatformTools.getEnvVariable("TYPEORM_DROP_SCHEMA")),migrationsRun:n.OrmUtils.toBoolean(r.PlatformTools.getEnvVariable("TYPEORM_MIGRATIONS_RUN")),entities:this.stringToArray(r.PlatformTools.getEnvVariable("TYPEORM_ENTITIES")),migrations:this.stringToArray(r.PlatformTools.getEnvVariable("TYPEORM_MIGRATIONS")),subscribers:this.stringToArray(r.PlatformTools.getEnvVariable("TYPEORM_SUBSCRIBERS")),entitySchemas:this.stringToArray(r.PlatformTools.getEnvVariable("TYPEORM_ENTITY_SCHEMAS")),logging:this.transformLogging(r.PlatformTools.getEnvVariable("TYPEORM_LOGGING")),logger:r.PlatformTools.getEnvVariable("TYPEORM_LOGGER"),entityPrefix:r.PlatformTools.getEnvVariable("TYPEORM_ENTITY_PREFIX"),maxQueryExecutionTime:r.PlatformTools.getEnvVariable("TYPEORM_MAX_QUERY_EXECUTION_TIME"),cli:{entitiesDir:r.PlatformTools.getEnvVariable("TYPEORM_ENTITIES_DIR"),migrationsDir:r.PlatformTools.getEnvVariable("TYPEORM_MIGRATIONS_DIR"),subscribersDir:r.PlatformTools.getEnvVariable("TYPEORM_SUBSCRIBERS_DIR")}}},e.prototype.transformLogging=function(e){return"true"===e||"TRUE"===e||"1"===e||("all"===e?"all":this.stringToArray(e))},e.prototype.stringToArray=function(e){return e?e.split(",").map(function(e){return e.trim()}):[]},e}(),e("ConnectionOptionsEnvReader",i)}}}),System.register("typeorm/connection/options-reader/ConnectionOptionsYmlReader",["typeorm/platform/PlatformTools"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(){}return e.prototype.read=function(e){var t=r.PlatformTools.load("js-yaml").safeLoad(r.PlatformTools.readFileSync(e));return Object.keys(t).map(function(e){return Object.assign({name:e},t[e])})},e}(),e("ConnectionOptionsYmlReader",n)}}}),System.register("typeorm/connection/options-reader/ConnectionOptionsXmlReader",["typeorm/platform/PlatformTools"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(){}return e.prototype.read=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return[4,this.readXml(e)];case 1:return t=r.sent(),[2,t.connection.map(function(e){return{name:e.$.name,type:e.$.type,url:e.url?e.url[0]:void 0,host:e.host?e.host[0]:void 0,port:e.port&&e.port[0]?parseInt(e.port[0]):void 0,username:e.username?e.username[0]:void 0,password:e.password?e.password[0]:void 0,database:e.database?e.database[0]:void 0,sid:e.sid?e.sid[0]:void 0,extra:e.extra?e.extra[0]:void 0,synchronize:e.synchronize?e.synchronize[0]:void 0,entities:e.entities?e.entities[0].entity:[],subscribers:e.subscribers?e.subscribers[0].entity:[],entitySchemas:e.entitySchemas?e.entitySchemas[0].entity:[],logging:e.logging[0]?e.logging[0].split(","):void 0}})]}})})},e.prototype.readXml=function(e){var t=r.PlatformTools.load("xml2js").parseString,n={trim:!0,explicitRoot:!1};return new Promise(function(i,o){t(r.PlatformTools.readFileSync(e),n,function(e,t){return e?o(e):i(t)})})},e}(),e("ConnectionOptionsXmlReader",n)}}}),System.register("typeorm/connection/ConnectionOptionsReader",["typeorm/platform/PlatformTools","typeorm/connection/options-reader/ConnectionOptionsEnvReader","typeorm/connection/options-reader/ConnectionOptionsYmlReader","typeorm/connection/options-reader/ConnectionOptionsXmlReader"],function(e,t){"use strict";var r,n,i,o,a;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.options=e}return e.prototype.all=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.load()]})})},e.prototype.get=function(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(n){switch(n.label){case 0:return[4,this.all()];case 1:if(t=n.sent(),!(r=t.find(function(t){return t.name===e||"default"===e&&!t.name})))throw new Error("Cannot find connection "+e+" because its not defined in any orm configuration files.");return[2,r]}})})},e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e,t,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return"env"===(e=["env","js","json","yml","yaml","xml"].find(function(e){return r.PlatformTools.fileExist(s.baseFilePath+"."+e)}))?(t=r.PlatformTools.load("dotenv")).config({path:this.baseFilePath+".env"}):r.PlatformTools.fileExist(".env")&&(t=r.PlatformTools.load("dotenv")).config({path:".env"}),r.PlatformTools.getEnvVariable("TYPEORM_CONNECTION")?(a=(new n.ConnectionOptionsEnvReader).read(),[3,8]):[3,1];case 1:return"js"!==e?[3,2]:(a=r.PlatformTools.load(this.baseFilePath+".js"),[3,8]);case 2:return"json"!==e?[3,3]:(a=r.PlatformTools.load(this.baseFilePath+".json"),[3,8]);case 3:return"yml"!==e?[3,4]:(a=(new i.ConnectionOptionsYmlReader).read(this.baseFilePath+".yml"),[3,8]);case 4:return"yaml"!==e?[3,5]:(a=(new i.ConnectionOptionsYmlReader).read(this.baseFilePath+".yaml"),[3,8]);case 5:return"xml"!==e?[3,7]:[4,(new o.ConnectionOptionsXmlReader).read(this.baseFilePath+".xml")];case 6:return a=u.sent(),[3,8];case 7:throw new Error("No connection options were found in any of configurations file.");case 8:return[2,this.normalizeConnectionOptions(a)]}})})},e.prototype.normalizeConnectionOptions=function(e){var t=this;return e instanceof Array||(e=[e]),e.forEach(function(r){if(r.entities){var n=r.entities.map(function(e){return"string"==typeof e&&"/"!==e.substr(0,1)?t.baseFilePath+"/"+e:e});Object.assign(e,{entities:n})}if(r.subscribers){var i=r.subscribers.map(function(e){return"string"==typeof e&&"/"!==e.substr(0,1)?t.baseFilePath+"/"+e:e});Object.assign(e,{subscribers:i})}if(r.migrations){var o=r.migrations.map(function(e){return"string"==typeof e&&"/"!==e.substr(0,1)?t.baseFilePath+"/"+e:e});Object.assign(e,{migrations:o})}"sqlite"===r.type&&"string"==typeof r.database&&"/"!==r.database.substr(0,1)&&Object.assign(r,{database:t.baseDirectory+"/"+r.database})}),e},Object.defineProperty(e.prototype,"baseFilePath",{get:function(){return this.baseDirectory+"/"+this.baseConfigName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseDirectory",{get:function(){return this.options&&this.options.root?this.options.root:r.PlatformTools.load("app-root-path").path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseConfigName",{get:function(){return this.options&&this.options.configName?this.options.configName:"ormconfig"},enumerable:!0,configurable:!0}),e}(),e("ConnectionOptionsReader",a)}}}),System.register("typeorm/decorator/options/ColumnCommonOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/ColumnWithLengthOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/ColumnNumericOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/ColumnEnumOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/ColumnEmbeddedOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/columns/Column",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("Column",function(e,t){var n;return"string"==typeof e||e instanceof Function?n=e:e&&(t=e,n=e.type),function(i,o){if(e instanceof Function){var a=!((u=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",i,o):void 0)!==Array&&(!t||!0!==t.isArray&&!0!==t.array)),s={target:i.constructor,propertyName:o,isArray:a,prefix:t&&void 0!==t.prefix?t.prefix:void 0,type:e};r.getMetadataArgsStorage().embeddeds.push(s)}else{if(!n){var u=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",i,o):void 0;u&&(n=u)}t||(t={}),!t.type&&n&&(t=Object.assign({type:n},t)),s={target:i.constructor,propertyName:o,mode:"regular",options:t},r.getMetadataArgsStorage().columns.push(s)}}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/CreateDateColumn",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("CreateDateColumn",function(e){return function(t,n){e||(e={});var i={target:t.constructor,propertyName:n,mode:"createDate",options:e};r.getMetadataArgsStorage().columns.push(i)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/DiscriminatorColumn",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("DiscriminatorColumn",function(e){return function(t){var n={name:e.name,type:e.type},i={target:t,mode:"discriminator",propertyName:e.name,options:n};r.getMetadataArgsStorage().columns.push(i)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/options/PrimaryGeneratedColumnNumericOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/PrimaryGeneratedColumnUUIDOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/columns/PrimaryGeneratedColumn",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("PrimaryGeneratedColumn",function(e,t){var n,i={};return e?("string"==typeof e&&(n=e),e instanceof Object&&(n="increment",Object.assign(i,e))):n="increment",t instanceof Object&&Object.assign(i,t),function(e,t){i.type||("increment"===n?Object.assign(i,{type:Number}):Object.assign(i,{type:"uuid"})),Object.assign(i,{primary:!0});var o={target:e.constructor,propertyName:t,mode:"regular",options:i};r.getMetadataArgsStorage().columns.push(o);var a={target:e.constructor,propertyName:t,strategy:n};r.getMetadataArgsStorage().generations.push(a)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/error/ColumnTypeUndefinedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r){var n=e.call(this)||this;return n.name="ColumnTypeUndefinedError",n.message="Column type for "+t.constructor.name+"#"+r+" is not defined or cannot be guessed. Try to explicitly provide a column type to the @Column decorator.",n}return __extends(t,e),t}(Error),e("ColumnTypeUndefinedError",r)}}}),System.register("typeorm/error/PrimaryColumnCannotBeNullableError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r){var n=e.call(this)||this;return n.name="PrimaryColumnCannotBeNullableError",n.message="Primary column "+t.constructor.name+"#"+r+" cannot be nullable. Its not allowed for primary keys. Try to remove nullable option.",n}return __extends(t,e),t}(Error),e("PrimaryColumnCannotBeNullableError",r)}}}),System.register("typeorm/decorator/columns/PrimaryColumn",["typeorm/error/ColumnTypeUndefinedError","typeorm/index","typeorm/error/PrimaryColumnCannotBeNullableError"],function(e,t){"use strict";t&&t.id;e("PrimaryColumn",function(e,t){var o;return"string"==typeof e?o=e:t=e,function(e,a){if(!o){var s=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",e,a):void 0;s&&(o=s)}if(t||(t={}),!t.type&&o&&(t=Object.assign({type:o},t)),!t.type)throw new r.ColumnTypeUndefinedError(e,a);if(t.nullable)throw new i.PrimaryColumnCannotBeNullableError(e,a);t=Object.assign({primary:!0},t);var u={target:e.constructor,propertyName:a,mode:"regular",options:t};n.getMetadataArgsStorage().columns.push(u)}});var r,n,i;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/UpdateDateColumn",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("UpdateDateColumn",function(e){return function(t,n){var i={target:t.constructor,propertyName:n,mode:"updateDate",options:e||{}};r.getMetadataArgsStorage().columns.push(i)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/VersionColumn",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("VersionColumn",function(e){return function(t,n){e||(e={});var i={target:t.constructor,propertyName:n,mode:"version",options:e};r.getMetadataArgsStorage().columns.push(i)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/ObjectIdColumn",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("ObjectIdColumn",function(e){return function(t,n){e||(e={}),e=Object.assign(e,{primary:!0,name:e.name?e.name:"_id"});var i={target:t.constructor,propertyName:n,mode:"objectId",options:e};r.getMetadataArgsStorage().columns.push(i)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterInsert",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";t&&t.id;e("AfterInsert",function(){return function(e,t){var i={target:e.constructor,propertyName:t,type:n.EventListenerTypes.AFTER_INSERT};r.getMetadataArgsStorage().entityListeners.push(i)}});var r,n;return{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterLoad",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";t&&t.id;e("AfterLoad",function(){return function(e,t){var i={target:e.constructor,propertyName:t,type:n.EventListenerTypes.AFTER_LOAD};r.getMetadataArgsStorage().entityListeners.push(i)}});var r,n;return{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterRemove",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";t&&t.id;e("AfterRemove",function(){return function(e,t){var i={target:e.constructor,propertyName:t,type:n.EventListenerTypes.AFTER_REMOVE};r.getMetadataArgsStorage().entityListeners.push(i)}});var r,n;return{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterUpdate",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";t&&t.id;e("AfterUpdate",function(){return function(e,t){var i={target:e.constructor,propertyName:t,type:n.EventListenerTypes.AFTER_UPDATE};r.getMetadataArgsStorage().entityListeners.push(i)}});var r,n;return{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/BeforeInsert",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";t&&t.id;e("BeforeInsert",function(){return function(e,t){var i={target:e.constructor,propertyName:t,type:n.EventListenerTypes.BEFORE_INSERT};r.getMetadataArgsStorage().entityListeners.push(i)}});var r,n;return{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/BeforeRemove",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";t&&t.id;e("BeforeRemove",function(){return function(e,t){var i={target:e.constructor,propertyName:t,type:n.EventListenerTypes.BEFORE_REMOVE};r.getMetadataArgsStorage().entityListeners.push(i)}});var r,n;return{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/BeforeUpdate",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";t&&t.id;e("BeforeUpdate",function(){return function(e,t){var i={target:e.constructor,propertyName:t,type:n.EventListenerTypes.BEFORE_UPDATE};r.getMetadataArgsStorage().entityListeners.push(i)}});var r,n;return{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/EventSubscriber",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("EventSubscriber",function(){return function(e){var t={target:e};r.getMetadataArgsStorage().entitySubscribers.push(t)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/options/IndexOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/EntityOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/relations/RelationCount",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("RelationCount",function(e,t,n){return function(i,o){var a={target:i.constructor,propertyName:o,relation:e,alias:t,queryBuilderFactory:n};r.getMetadataArgsStorage().relationCounts.push(a)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/JoinColumn",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("JoinColumn",function(e){return function(t,n){(e instanceof Array?e:[e||{}]).forEach(function(e){var i={target:t.constructor,propertyName:n,name:e.name,referencedColumnName:e.referencedColumnName};r.getMetadataArgsStorage().joinColumns.push(i)})}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/JoinTable",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("JoinTable",function(e){return function(t,n){e=e||{};var i={target:t.constructor,propertyName:n,name:e.name,joinColumns:e&&e.joinColumn?[e.joinColumn]:e.joinColumns,inverseJoinColumns:e&&e.inverseJoinColumn?[e.inverseJoinColumn]:e.inverseJoinColumns,schema:e&&e.schema?e.schema:void 0,database:e&&e.database?e.database:void 0};r.getMetadataArgsStorage().joinTables.push(i)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/ManyToMany",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("ManyToMany",function(e,t,n){var i;return"object"==typeof t?n=t:i=t,function(t,o){n||(n={});var a=!(!n||!0!==n.lazy);if(!a&&Reflect&&Reflect.getMetadata){var s=Reflect.getMetadata("design:type",t,o);s&&"string"==typeof s.name&&"promise"===s.name.toLowerCase()&&(a=!0)}var u={target:t.constructor,propertyName:o,relationType:"many-to-many",isLazy:a,type:e,inverseSideProperty:i,options:n};r.getMetadataArgsStorage().relations.push(u)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/ManyToOne",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("ManyToOne",function(e,t,n){var i;return"object"==typeof t?n=t:i=t,function(t,o){n||(n={});var a=!(!n||!0!==n.lazy);if(!a&&Reflect&&Reflect.getMetadata){var s=Reflect.getMetadata("design:type",t,o);s&&"string"==typeof s.name&&"promise"===s.name.toLowerCase()&&(a=!0)}var u={target:t.constructor,propertyName:o,relationType:"many-to-one",isLazy:a,type:e,inverseSideProperty:i,options:n};r.getMetadataArgsStorage().relations.push(u)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/OneToMany",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("OneToMany",function(e,t,n){return function(i,o){n||(n={});var a=!(!n||!0!==n.lazy);if(!a&&Reflect&&Reflect.getMetadata){var s=Reflect.getMetadata("design:type",i,o);s&&"string"==typeof s.name&&"promise"===s.name.toLowerCase()&&(a=!0)}var u={target:i.constructor,propertyName:o,isLazy:a,relationType:"one-to-many",type:e,inverseSideProperty:t,options:n};r.getMetadataArgsStorage().relations.push(u)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/OneToOne",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("OneToOne",function(e,t,n){var i;return"object"==typeof t?n=t:i=t,function(t,o){n||(n={});var a=!(!n||!0!==n.lazy);if(!a&&Reflect&&Reflect.getMetadata){var s=Reflect.getMetadata("design:type",t,o);s&&"string"==typeof s.name&&"promise"===s.name.toLowerCase()&&(a=!0)}var u={target:t.constructor,propertyName:o,isLazy:a,relationType:"one-to-one",type:e,inverseSideProperty:i,options:n};r.getMetadataArgsStorage().relations.push(u)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/RelationId",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("RelationId",function(e,t,n){return function(i,o){var a={target:i.constructor,propertyName:o,relation:e,alias:t,queryBuilderFactory:n};r.getMetadataArgsStorage().relationIds.push(a)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/Entity",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("Entity",function(e,t){var n="string"==typeof e?e:void 0,i="object"==typeof e?e:t;return function(e){var t={target:e,name:n,type:"regular",orderBy:i&&i.orderBy?i.orderBy:void 0,engine:i&&i.engine?i.engine:void 0,database:i&&i.database?i.database:void 0,schema:i&&i.schema?i.schema:void 0,skipSync:!(!i||!0!==i.skipSync)};r.getMetadataArgsStorage().tables.push(t)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/ClassEntityChild",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("ClassEntityChild",function(e,t){return function(n){var i={target:n,name:e,type:"class-table-child",orderBy:t&&t.orderBy?t.orderBy:void 0,skipSync:!(!t||!0!==t.skipSync)};r.getMetadataArgsStorage().tables.push(i)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/ClosureEntity",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("ClosureEntity",function(e,t){return function(n){var i={target:n,name:e,type:"closure",orderBy:t&&t.orderBy?t.orderBy:void 0,skipSync:!(!t||!0!==t.skipSync)};r.getMetadataArgsStorage().tables.push(i)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/SingleEntityChild",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("SingleEntityChild",function(){return function(e){var t={target:e,name:void 0,type:"single-table-child",orderBy:void 0};r.getMetadataArgsStorage().tables.push(t)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/TableInheritance",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("TableInheritance",function(e){return function(t){var n={target:t,type:e};r.getMetadataArgsStorage().inheritances.push(n)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/transaction/Transaction",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("Transaction",function(e){return void 0===e&&(e="default"),function(t,n,i){var o=i.value;i.value=function(){for(var i=this,a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];return r.getConnection(e).manager.transaction(function(e){var s,u=r.getMetadataArgsStorage().filterTransactionEntityManagers(t.constructor).filter(function(e){return e.methodName===n}),c=r.getMetadataArgsStorage().filterTransactionRepository(t.constructor).filter(function(e){return e.methodName===n});return u.length>0?(s=a.slice(),u.forEach(function(t){s.splice(t.index,0,e)})):s=0===c.length?[e].concat(a):a.slice(),c.forEach(function(t){var n;switch(t.repositoryType){case r.Repository:n=e.getRepository(t.entityType);break;case r.MongoRepository:n=e.getMongoRepository(t.entityType);break;case r.TreeRepository:n=e.getTreeRepository(t.entityType);break;default:n=e.getCustomRepository(t.repositoryType)}s.splice(t.index,0,n)}),o.apply(i,s)})}}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/transaction/TransactionManager",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("TransactionManager",function(){return function(e,t,n){var i={target:e.constructor,methodName:t,index:n};r.getMetadataArgsStorage().transactionEntityManagers.push(i)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/transaction/TransactionRepository",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("TransactionRepository",function(e){return function(t,n,i){var o;try{o=Reflect.getOwnMetadata("design:paramtypes",t,n)[i]}catch(e){throw new Error('Cannot get reflected type for a "'+n+"\" method's parameter of "+t.constructor.name+' class. Make sure you have turned on an "emitDecoratorMetadata": true, option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application.')}var a={target:t.constructor,methodName:n,index:i,repositoryType:o,entityType:e};r.getMetadataArgsStorage().transactionRepositories.push(a)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/tree/TreeLevelColumn",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("TreeLevelColumn",function(){return function(e,t){var n={target:e.constructor,propertyName:t,mode:"treeLevel",options:{}};r.getMetadataArgsStorage().columns.push(n)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/tree/TreeParent",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("TreeParent",function(e){return function(t,n){e||(e={});var i=!(!e||!0!==e.lazy);if(!i&&Reflect&&Reflect.getMetadata){var o=Reflect.getMetadata("design:type",t,n);o&&"string"==typeof o.name&&"promise"===o.name.toLowerCase()&&(i=!0)}var a={isTreeParent:!0,target:t.constructor,propertyName:n,isLazy:i,relationType:"many-to-one",type:function(){return t.constructor},options:e};r.getMetadataArgsStorage().relations.push(a)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/tree/TreeChildren",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("TreeChildren",function(e){return function(t,n){e||(e={});var i=!(!e||!0!==e.lazy);if(!i&&Reflect&&Reflect.getMetadata){var o=Reflect.getMetadata("design:type",t,n);o&&"string"==typeof o.name&&"promise"===o.name.toLowerCase()&&(i=!0)}var a={isTreeChildren:!0,target:t.constructor,propertyName:n,isLazy:i,relationType:"one-to-many",type:function(){return t.constructor},options:e};r.getMetadataArgsStorage().relations.push(a)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/Index",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("Index",function(e,t,n){var i="string"==typeof e?e:void 0,o="string"==typeof e?t:e,a="object"!=typeof e||Array.isArray(e)?n:e;return a||(a="object"!=typeof t||Array.isArray(t)?n:t),function(e,t){var n={target:t?e.constructor:e,name:i,columns:t?[t]:o,unique:!(!a||!a.unique),sparse:!(!a||!a.sparse)};r.getMetadataArgsStorage().indices.push(n)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/Generated",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("Generated",function(e){return void 0===e&&(e="increment"),function(t,n){var i={target:t.constructor,propertyName:n,strategy:e};r.getMetadataArgsStorage().generations.push(i)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/DiscriminatorValue",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("DiscriminatorValue",function(e){return function(t){var n={target:t,value:e};r.getMetadataArgsStorage().discriminatorValues.push(n)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/EntityRepository",["typeorm/index"],function(e,t){"use strict";t&&t.id;e("EntityRepository",function(e){return function(t){var n={target:t,entity:e};r.getMetadataArgsStorage().entityRepositories.push(n)}});var r;return{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/repository/BaseEntity",["typeorm/index"],function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(){}return e.prototype.hasId=function(){return this.constructor.getRepository().hasId(this)},e.prototype.save=function(){return this.constructor.getRepository().save(this)},e.prototype.remove=function(){return this.constructor.getRepository().remove(this)},e.useConnection=function(e){this.usedConnection=e},e.getRepository=function(){return(this.usedConnection||r.getConnection()).getRepository(this)},Object.defineProperty(e,"target",{get:function(){return this.getRepository().target},enumerable:!0,configurable:!0}),e.hasId=function(e){return this.getRepository().hasId(e)},e.getId=function(e){return this.getRepository().getId(e)},e.createQueryBuilder=function(e){return this.getRepository().createQueryBuilder(e)},e.create=function(e){return this.getRepository().create(e)},e.merge=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return(n=this.getRepository()).merge.apply(n,[e].concat(t));var n},e.preload=function(e){return this.getRepository().preload(e)},e.save=function(e,t){return this.getRepository().save(e,t)},e.remove=function(e,t){return this.getRepository().remove(e,t)},e.insert=function(e,t){return this.getRepository().insert(e,t)},e.update=function(e,t,r){return this.getRepository().update(e,t,r)},e.delete=function(e,t){return this.getRepository().delete(e,t)},e.count=function(e){return this.getRepository().count(e)},e.find=function(e){return this.getRepository().find(e)},e.findAndCount=function(e){return this.getRepository().findAndCount(e)},e.findByIds=function(e,t){return this.getRepository().findByIds(e,t)},e.findOne=function(e,t){return this.getRepository().findOne(e,t)},e.query=function(e,t){return this.getRepository().query(e,t)},e.clear=function(){return this.getRepository().clear()},e}(),e("BaseEntity",n)}}}),System.register("typeorm/index",["typeorm/connection/ConnectionManager","typeorm/metadata-args/MetadataArgsStorage","typeorm/container","typeorm/platform/PlatformTools","typeorm/connection/ConnectionOptionsReader","typeorm/util/PromiseUtils","typeorm/error/QueryFailedError","typeorm/decorator/columns/Column","typeorm/decorator/columns/CreateDateColumn","typeorm/decorator/columns/DiscriminatorColumn","typeorm/decorator/columns/PrimaryGeneratedColumn","typeorm/decorator/columns/PrimaryColumn","typeorm/decorator/columns/UpdateDateColumn","typeorm/decorator/columns/VersionColumn","typeorm/decorator/columns/ObjectIdColumn","typeorm/decorator/listeners/AfterInsert","typeorm/decorator/listeners/AfterLoad","typeorm/decorator/listeners/AfterRemove","typeorm/decorator/listeners/AfterUpdate","typeorm/decorator/listeners/BeforeInsert","typeorm/decorator/listeners/BeforeRemove","typeorm/decorator/listeners/BeforeUpdate","typeorm/decorator/listeners/EventSubscriber","typeorm/decorator/relations/RelationCount","typeorm/decorator/relations/JoinColumn","typeorm/decorator/relations/JoinTable","typeorm/decorator/relations/ManyToMany","typeorm/decorator/relations/ManyToOne","typeorm/decorator/relations/OneToMany","typeorm/decorator/relations/OneToOne","typeorm/decorator/relations/RelationId","typeorm/decorator/entity/Entity","typeorm/decorator/entity/ClassEntityChild","typeorm/decorator/entity/ClosureEntity","typeorm/decorator/entity/SingleEntityChild","typeorm/decorator/entity/TableInheritance","typeorm/decorator/transaction/Transaction","typeorm/decorator/transaction/TransactionManager","typeorm/decorator/transaction/TransactionRepository","typeorm/decorator/tree/TreeLevelColumn","typeorm/decorator/tree/TreeParent","typeorm/decorator/tree/TreeChildren","typeorm/decorator/Index","typeorm/decorator/Generated","typeorm/decorator/DiscriminatorValue","typeorm/decorator/EntityRepository","typeorm/logger/AdvancedConsoleLogger","typeorm/logger/SimpleConsoleLogger","typeorm/logger/FileLogger","typeorm/metadata/EntityMetadataUtils","typeorm/entity-manager/EntityManager","typeorm/repository/AbstractRepository","typeorm/repository/Repository","typeorm/repository/BaseEntity","typeorm/repository/TreeRepository","typeorm/repository/MongoRepository","typeorm/schema-builder/schema/TableColumn","typeorm/schema-builder/schema/TableForeignKey","typeorm/schema-builder/schema/TableIndex","typeorm/schema-builder/schema/TablePrimaryKey","typeorm/schema-builder/schema/Table","typeorm/driver/mongodb/typings","typeorm/driver/sqlserver/MssqlParameter","typeorm/connection/Connection","typeorm/query-builder/QueryBuilder","typeorm/query-builder/SelectQueryBuilder","typeorm/query-builder/DeleteQueryBuilder","typeorm/query-builder/InsertQueryBuilder","typeorm/query-builder/UpdateQueryBuilder","typeorm/query-builder/RelationQueryBuilder","typeorm/query-builder/Brackets","typeorm/query-builder/result/InsertResult","typeorm/query-builder/result/UpdateResult","typeorm/query-builder/result/DeleteResult","typeorm/entity-manager/MongoEntityManager","typeorm/naming-strategy/DefaultNamingStrategy"],function(e,t){"use strict";function r(e){return void 0===e&&(e="default"),__awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,(new c.ConnectionOptionsReader).get(e)]})})}function n(){return s.getFromContainer(o.ConnectionManager)}function i(t){var r={};for(var n in t)"default"===n||p.hasOwnProperty(n)||(r[n]=t[n]);e(r)}t&&t.id;e("getMetadataArgsStorage",function(){var e=u.PlatformTools.getGlobalVariable();return e.typeormMetadataArgsStorage||(e.typeormMetadataArgsStorage=new a.MetadataArgsStorage),e.typeormMetadataArgsStorage}),e("getConnectionOptions",r),e("getConnectionManager",n),e("createConnection",function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return e?[3,2]:[4,r()];case 1:e=t.sent(),t.label=2;case 2:return[2,n().create(e).connect()]}})})}),e("createConnections",function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return e?[3,2]:[4,(new c.ConnectionOptionsReader).all()];case 1:e=r.sent(),r.label=2;case 2:return t=e.map(function(e){return n().create(e)}),[2,l.PromiseUtils.runInSequence(t,function(e){return e.connect()})]}})})}),e("getConnection",function(e){return void 0===e&&(e="default"),n().get(e)}),e("getManager",function(e){return void 0===e&&(e="default"),n().get(e).manager}),e("getMongoManager",function(e){return void 0===e&&(e="default"),n().get(e).manager}),e("getSqljsManager",function(e){return void 0===e&&(e="default"),n().get(e).manager}),e("getRepository",function(e,t){return void 0===t&&(t="default"),n().get(t).getRepository(e)}),e("getTreeRepository",function(e,t){return void 0===t&&(t="default"),n().get(t).getTreeRepository(e)}),e("getCustomRepository",function(e,t){return void 0===t&&(t="default"),n().get(t).getCustomRepository(e)}),e("getMongoRepository",function(e,t){return void 0===t&&(t="default"),n().get(t).getMongoRepository(e)});var o,a,s,u,c,l,p={getMetadataArgsStorage:!0,getConnectionOptions:!0,getConnectionManager:!0,createConnection:!0,createConnections:!0,getConnection:!0,getManager:!0,getMongoManager:!0,getSqljsManager:!0,getRepository:!0,getTreeRepository:!0,getCustomRepository:!0,getMongoRepository:!0,ConnectionOptionsReader:!0,Connection:!0,ConnectionManager:!0,QueryBuilder:!0,SelectQueryBuilder:!0,DeleteQueryBuilder:!0,InsertQueryBuilder:!0,UpdateQueryBuilder:!0,RelationQueryBuilder:!0,Brackets:!0,InsertResult:!0,UpdateResult:!0,DeleteResult:!0,EntityManager:!0,MongoEntityManager:!0,DefaultNamingStrategy:!0,Repository:!0,TreeRepository:!0,MongoRepository:!0,BaseEntity:!0,PromiseUtils:!0};return{setters:[function(t){o=t,e({ConnectionManager:t.ConnectionManager})},function(e){a=e},function(e){s=e,i(e)},function(e){u=e},function(t){c=t,e({ConnectionOptionsReader:t.ConnectionOptionsReader})},function(t){l=t,e({PromiseUtils:t.PromiseUtils})},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e),i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(t){i(t),e({EntityManager:t.EntityManager})},function(e){i(e)},function(t){i(t),e({Repository:t.Repository})},function(t){i(t),e({BaseEntity:t.BaseEntity})},function(t){i(t),e({TreeRepository:t.TreeRepository})},function(t){i(t),e({MongoRepository:t.MongoRepository})},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(e){i(e)},function(t){e({Connection:t.Connection})},function(t){e({QueryBuilder:t.QueryBuilder})},function(t){e({SelectQueryBuilder:t.SelectQueryBuilder})},function(t){e({DeleteQueryBuilder:t.DeleteQueryBuilder})},function(t){e({InsertQueryBuilder:t.InsertQueryBuilder})},function(t){e({UpdateQueryBuilder:t.UpdateQueryBuilder})},function(t){e({RelationQueryBuilder:t.RelationQueryBuilder})},function(t){e({Brackets:t.Brackets})},function(t){e({InsertResult:t.InsertResult})},function(t){e({UpdateResult:t.UpdateResult})},function(t){e({DeleteResult:t.DeleteResult})},function(t){e({MongoEntityManager:t.MongoEntityManager})},function(t){e({DefaultNamingStrategy:t.DefaultNamingStrategy})}],execute:function(){}}}),System.register("typeorm",["typeorm/index"],function(e,t){"use strict";t&&t.id;return{setters:[function(t){!function(t){var r={};for(var n in t)"default"!==n&&(r[n]=t[n]);e(r)}(t)}],execute:function(){}}}),System.register("typeorm/error/CannotGetEntityManagerNotConnectedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;return r.name="CannotGetEntityManagerNotConnectedError",r.message='Cannot get entity manager for "'+t+'" connection because connection is not yet established.',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("CannotGetEntityManagerNotConnectedError",r)}}}),System.register("typeorm/error/CascadesNotAllowedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r,n){var i=e.call(this)||this;return i.name="CascadesNotAllowedError",i.message="Cascades ("+t+") are not allowed for the given relation "+r.name+"#"+n.joinColumns[0].referencedColumn.databaseName,i}return __extends(t,e),t}(Error),e("CascadesNotAllowedError",r)}}}),System.register("typeorm/error/CustomRepositoryReusedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this,"Custom entity repository "+(t instanceof Function?t.name:t.constructor.name)+" was already used in the different connection. You can't share entity repositories between different connections when useContainer is set to true for the entity repository.")||this;return r.name="CustomRepositoryReusedError",r}return __extends(t,e),t}(Error),e("CustomRepositoryReusedError",r)}}}),System.register("typeorm/error/GeneratedOnlyForPrimaryError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r){var n=e.call(this)||this;return n.name="GeneratedOnlyForPrimaryError",n.message="Column for property "+t.constructor.name+"#"+r+" cannot have a generated value. Generated values supports only in PrimaryColumn decorator or UUID column type.",n}return __extends(t,e),t}(Error),e("GeneratedOnlyForPrimaryError",r)}}}),System.register("typeorm/error/MetadataAlreadyExistsError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r,n){var i=e.call(this)||this;return i.name="MetadataAlreadyExistsError",i.message=t+" metadata already exists for the class constructor "+JSON.stringify(r)+(n?" on property "+n:". If you previously renamed or moved entity class, make sure that compiled version of old entity class source wasn't left in the compiler output directory."),i}return __extends(t,e),t}(Error),e("MetadataAlreadyExistsError",r)}}}),System.register("typeorm/error/MetadataWithSuchNameAlreadyExistsError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r){var n=e.call(this)||this;return n.name="MetadataWithSuchNameAlreadyExistsError",n.message=t+" metadata with such name "+r+" already exists. Do you apply decorator twice? Or maybe try to change a name?",n}return __extends(t,e),t}(Error),e("MetadataWithSuchNameAlreadyExistsError",r)}}}),System.register("typeorm/error/MissingJoinColumnError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r){var n=e.call(this)||this;return n.name="MissingJoinColumnError",r.inverseRelation?n.message="JoinColumn is missing on both sides of "+t.name+"#"+r.propertyName+" and "+r.inverseEntityMetadata.name+"#"+r.inverseRelation.propertyName+" one-to-one relationship. You need to put JoinColumn decorator on one of the sides.":n.message="JoinColumn is missing on "+t.name+"#"+r.propertyName+" one-to-one relationship. You need to put JoinColumn decorator on it.",n}return __extends(t,e),t}(Error),e("MissingJoinColumnError",r)}}}),System.register("typeorm/error/MissingJoinTableError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r){var n=e.call(this)||this;return n.name="MissingJoinTableError",r.inverseRelation?n.message="JoinTable is missing on both sides of "+t.name+"#"+r.propertyName+" and "+r.inverseEntityMetadata.name+"#"+r.inverseRelation.propertyName+" many-to-many relationship. You need to put decorator decorator on one of the sides.":n.message="JoinTable is missing on "+t.name+"#"+r.propertyName+" many-to-many relationship. You need to put JoinTable decorator on it.",n}return __extends(t,e),t}(Error),e("MissingJoinTableError",r)}}}),System.register("typeorm/error/NamingStrategyNotFoundError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r){var n=e.call(this)||this;n.name="NamingStrategyNotFoundError";var i=t instanceof Function?t.name:t;return n.message='Naming strategy "'+i+'" was not found. Looks like this naming strategy does not exist or it was not registered in current "'+r+'" connection?',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e("NamingStrategyNotFoundError",r)}}}),System.register("typeorm/error/NoConnectionForRepositoryError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t){var r=e.call(this)||this;return r.name="NoConnectionForRepositoryError",r.message='Cannot get a Repository for "'+t+" connection, because connection with the database is not established yet. Call connection#connect method to establish connection.",r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e("NoConnectionForRepositoryError",r)}}}),System.register("typeorm/error/PersistedEntityNotFoundError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(){var t=e.call(this)||this;return t.name="PersistedEntityNotFoundError",t.message="Internal error. Persisted entity was not found in the list of prepared operated entities.",t}return __extends(t,e),t}(Error),e("PersistedEntityNotFoundError",r)}}}),System.register("typeorm/error/UsingJoinColumnIsNotAllowedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r){var n=e.call(this)||this;return n.name="UsingJoinColumnIsNotAllowedError",n.message="Using JoinColumn on "+t.name+"#"+r.propertyName+" is wrong. You can use JoinColumn only on one-to-one and many-to-one relations.",n}return __extends(t,e),t}(Error),e("UsingJoinColumnIsNotAllowedError",r)}}}),System.register("typeorm/error/UsingJoinColumnOnlyOnOneSideAllowedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r){var n=e.call(this)||this;return n.name="UsingJoinColumnOnlyOnOneSideAllowedError",n.message="Using JoinColumn is allowed only on one side of the one-to-one relationship. Both "+t.name+"#"+r.propertyName+" and "+r.inverseEntityMetadata.name+"#"+r.inverseRelation.propertyName+" has JoinTable decorators. Choose one of them and left JoinTable decorator only on it.",n}return __extends(t,e),t}(Error),e("UsingJoinColumnOnlyOnOneSideAllowedError",r)}}}),System.register("typeorm/error/UsingJoinTableIsNotAllowedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r){var n=e.call(this)||this;return n.name="UsingJoinTableIsNotAllowedError",n.message="Using JoinTable on "+t.name+"#"+r.propertyName+" is wrong. "+t.name+"#"+r.propertyName+" has "+r.relationType+" relation, however you can use JoinTable only on many-to-many relations.",n}return __extends(t,e),t}(Error),e("UsingJoinTableIsNotAllowedError",r)}}}),System.register("typeorm/error/UsingJoinTableOnlyOnOneSideAllowedError",[],function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=function(e){function t(t,r){var n=e.call(this)||this;return n.name="UsingJoinTableOnlyOnOneSideAllowedError",n.message="Using JoinTable is allowed only on one side of the many-to-many relationship. Both "+t.name+"#"+r.propertyName+" and "+r.inverseEntityMetadata.name+"#"+r.inverseRelation.propertyName+" has JoinTable decorators. Choose one of them and left JoinColumn decorator only on it.",n}return __extends(t,e),t}(Error),e("UsingJoinTableOnlyOnOneSideAllowedError",r)}}}),System.register("typeorm/query-builder/JoinOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/repository/EntityId",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}});